---
description: Правила проекта Helicopter Component Lifecycle (Cursor AI)
globs:
  - "**/*"
alwaysApply: true
---

# Правила проекта (консолидировано)

- Всегда отвечать на русском языке.
- Рабочая разработка — в `code/`. Архив `archive_vnv_cpu_project/` не трогать.
- Запрещено создавать фейковые файлы/результаты и использовать хардкод (кроме лок. отладки с тестами и фиксацией).
- Минимальный дифф по умолчанию: ≤3 файлов, ≤150 строк, 1 подсистема, без новых публичных API.
- Любые изменения архитектуры/алгоритмов/схем данных — только после явного согласования в чате.

## Данные и типы
- В СУБД избегать Float64 без согласования. Предпочтать: UInt8/16/32 и Float32.
- MP5 (суточные минуты) — хранить в `UInt16/UInt32` в Env (в соответствии с источником).
- Тесты/прогоны выполнять ТОЛЬКО на реальных данных из ClickHouse. Синтетика/заглушки — только с явным разрешением Алексея в текущем чате.

## Transform / RTC инварианты (v2)
- Один процесс: единый `ModelDescription` + `CUDASimulation`, без перезагрузки `env` между шагами.
- FRAMES = |MP3 ∪ MP5| (без расширения «впрок»). Индексы для будущих бортов берутся из объединения.
- MP5 держать в `MacroProperty mp5_lin[(DAYS+1)*FRAMES]`; инициализация строго до первых RTC через HostFunction/`importMacroProperty()`.
- Запрет записи в `mp5_lin` после начала чтения агентами.
- Фикс‑имена RTC: `rtc_status_246` (минимум), далее `rtc_probe_mp5`, `rtc_status_2`, `rtc_status_4`, `rtc_status_6` при расширении.

## Тестирование и валидации
- Матрица: DAYS={5,90,365}. Детерминизм повторных прогонов на одном снапшоте.
- Инварианты: S6 неизменяем, Δsne_s2 == sum(dt_s2), корректный D+1 паддинг MP5.
- Логи: размеры/checksum `mp5_lin` (или `mp5_src` временно), выборки значений.

## Документация и процесс
- Перед правками — анализ влияния на ETL/скрипты; после — обновление MD только при зелёных тестах.
- Обновлять `docs/rtc_pipeline_architecture.md` при изменении оркестрации/ядер, `docs/validation.md` — при изменении проверок.
- Хранить этот файл правил как источник истины; при наличии `.cursorrules` держать его синхронным (ссылка/заглушка).

