---
description: Global always-on constraints (safety + invariants)
globs:
  - "**/*"
alwaysApply: true
---

# Always rules (must-follow)

## Процесс
- Для задач с изменением структуры/алгоритмов: анализ → предложение → согласование → реализация → ревью.
- Код без предварительного согласования архитектуры — запрещён.

## Ограничения изменений
- По умолчанию: минимальный дифф (≤3 файлов, ≤150 строк, 1 подсистема, без новых публичных API).
- Не удалять файлы/каталоги/доки/таблицы без явного подтверждения.
- Запрещено создавать фейковые файлы/результаты и использовать недокументированные хардкоды.

## Запуски
- НЕЛЬЗЯ запускать `code/sim_v2/orchestrator_v2.py` без явного разрешения в текущем чате.
- Чтение из ClickHouse (SELECT) разрешено без отдельного согласования; любые мутирующие запросы — только по явному разрешению.

## Формат обращения в ClickHouse (read-only)
- Предпочтительный способ: Python + `clickhouse_driver` (native, порт 9000).
- `clickhouse_connect` использует HTTP (порт 8123) и не применяется, если доступен native.
- Перед запросом: загрузить `.env` и конфиг `config/database_config.yaml` (host/port/user из ENV, пароль из `CLICKHOUSE_PASSWORD`).
- Выполнять только SELECT без мутаций.

## Данные/типы
- НЕЛЬЗЯ использовать Float64 без явного согласования.

## Ошибки
- НЕЛЬЗЯ “тихо” прятать ошибки через try/except; ошибки должны быть явными.

## Документация
- НЕЛЬЗЯ создавать новые `.md` без явного разрешения (кроме `output/`).
