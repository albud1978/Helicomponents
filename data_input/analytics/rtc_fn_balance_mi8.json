{
  "rtc_function": "fn_balance_mi8",
  "aircraft_type": "МИ-8Т",
  "ac_type_mask": 32,
  "execution_condition": "trigger_program != 0",
  
  "macroproperty_sources": [
    {"name": "ops_counter_mi8", "type": "MacroProperty4", "field_id": 74},
    {"name": "trigger_program", "type": "MacroProperty4", "field_id": 80}
  ],
  
  "deficit_calculation": "count(status_id=2 AND ac_type_mask=32) - ops_counter_mi8",
  
  "algorithm": {
    "type": "iterative_balance",
    "goal": "DEFICIT = 0",
    "steps": [
      {
        "step": 1,
        "condition": "DEFICIT > 0",
        "source_status": 2,
        "target_status": 3,
        "filter": "ac_type_mask=32",
        "transfer_count": "min(count(status_id=2 AND ac_type_mask=32), DEFICIT)",
        "deficit_update": "DEFICIT -= transferred"
      },
      {
        "step": 2,
        "condition": "DEFICIT < 0",
        "source_status": 3,
        "target_status": 2,
        "filter": "ac_type_mask=32",
        "transfer_count": "min(count(status_id=3 AND ac_type_mask=32), |DEFICIT|)",
        "deficit_update": "DEFICIT += transferred"
      },
      {
        "step": 3,
        "condition": "DEFICIT < 0",
        "source_status": 5,
        "target_status": 2,
        "filter": "ac_type_mask=32",
        "transfer_count": "min(count(status_id=5 AND ac_type_mask=32), |DEFICIT|)",
        "deficit_update": "DEFICIT += transferred"
      },
      {
        "step": 4,
        "condition": "DEFICIT < 0",
        "source_status": 1,
        "target_status": 2,
        "filter": "ac_type_mask=32",
        "transfer_count": "min(count(status_id=1 AND ac_type_mask=32), |DEFICIT|)",
        "deficit_update": "DEFICIT += transferred"
      }
    ]
  },
  
  "variables": {
    "input": [
      {"name": "status_id", "type": "Variable", "source": "agent"},
      {"name": "ac_type_mask", "type": "Variable", "source": "agent", "value": 32}
    ],
    "output": [
      {"name": "status_id", "type": "Variable", "target": "agent", "action": "conditional_change"}
    ]
  }
}