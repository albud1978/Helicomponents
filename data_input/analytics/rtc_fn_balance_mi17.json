{
  "rtc_function": "fn_balance_mi17",
  "aircraft_type": "МИ-17",
  "ac_type_mask": 64,
  "execution_algorithm": "Балансировка выполняется когда trigger_program != 0 - итеративная балансировка агентов МИ-17 между статусами до достижения баланса",
  
  "macroproperty_sources": [
    {"name": "ops_counter_mi17", "type": "MacroProperty4", "field_id": 75, "lookup_chain": [
      {"step": 1, "source": "MacroProperty4", "lookup_conditions": [
        {"field": "dates", "value": "current_simulation_date"}
      ], "get_field": "ops_counter_mi17"}
    ]},
    {"name": "trigger_program", "type": "MacroProperty4", "field_id": 80, "lookup_chain": [
      {"step": 1, "source": "MacroProperty4", "lookup_conditions": [
        {"field": "dates", "value": "current_simulation_date"}
      ], "get_field": "trigger_program"}
    ]}
  ],
  
  "deficit_calculation": "count(status_id=2 AND ac_type_mask=64) - ops_counter_mi17",
  
  "algorithm": {
    "type": "iterative_balance",
    "goal": "DEFICIT = 0",
    "steps": [
      {
        "step": 1,
        "condition": "DEFICIT > 0",
        "source_status": 2,
        "target_status": 3,
        "filter": "ac_type_mask=64",
        "transfer_count": "min(count(status_id=2 AND ac_type_mask=64), DEFICIT)",
        "deficit_update": "DEFICIT -= transferred"
      },
      {
        "step": 2,
        "condition": "DEFICIT < 0",
        "source_status": 3,
        "target_status": 2,
        "filter": "ac_type_mask=64",
        "transfer_count": "min(count(status_id=3 AND ac_type_mask=64), |DEFICIT|)",
        "deficit_update": "DEFICIT += transferred"
      },
      {
        "step": 3,
        "condition": "DEFICIT < 0",
        "source_status": 5,
        "target_status": 2,
        "filter": "ac_type_mask=64",
        "transfer_count": "min(count(status_id=5 AND ac_type_mask=64), |DEFICIT|)",
        "deficit_update": "DEFICIT += transferred"
      },
      {
        "step": 4,
        "condition": "DEFICIT < 0",
        "source_status": 1,
        "target_status": 2,
        "filter": "ac_type_mask=64",
        "transfer_count": "min(count(status_id=1 AND ac_type_mask=64), |DEFICIT|)",
        "deficit_update": "DEFICIT += transferred"
      }
    ]
  },
  
  "variables": {
    "input": [
      {"name": "status_id", "type": "Variable", "source": "agent"},
      {"name": "ac_type_mask", "type": "Variable", "source": "agent", "value": 64}
    ],
    "output": [
      {"name": "status_id", "type": "Variable", "target": "agent", "action": "conditional_change"}
    ]
  }
}