# Tasktracker - Статус выполнения задач

Система отслеживания задач проекта Helicopter Component Lifecycle.

## Легенда статусов
- **Не начата** - задача запланирована, но работа не началась
- **В процессе** - задача выполняется в данный момент
- **Завершена** - задача полностью выполнена и протестирована
- **Приостановлена** - работа временно остановлена (ожидание решений, зависимостей)
- **Отменена** - задача отменена или больше не актуальна

---

## ЗАВЕРШЕННЫЕ ЗАДАЧИ

## Задача: Синхронизация аналитических форматов
- **Статус**: Завершена
- **Дата завершения**: 20-07-2025
- **Описание**: Обеспечение наличия всех цифровых полей из аналитических форматов в таблицах ClickHouse для корректной интеграции с Flame GPU
- **Проблема**: Необходимость соответствия между полями Excel аналитики и структурой данных в ETL системе
- **Решение**: 
  - Проведен анализ соответствия полей между Excel файлом `OLAP MultiBOM Flame GPU.xlsx` и ETL таблицами
  - Все цифровые поля присутствуют в таблицах heli_pandas, flight_program_ac, flight_program_fl
  - Обеспечена совместимость структур данных для ABM моделирования
  - Унифицированы названия полей (dates вместо flight_date)
- **Результат**: ✅ Все цифровые поля из аналитических форматов доступны в таблицах ClickHouse, обеспечена готовность для интеграции с Flame GPU
- **Зависимости**: Оптимизация структуры flight_program_ac, переименование полей flight_program_fl

## Задача: Оптимизация структуры flight_program_ac для Flame GPU
- **Статус**: Завершена
- **Дата завершения**: 20-07-2025
- **Описание**: Оптимизация таблицы flight_program_ac для эффективной работы с Flame GPU - замена pivot структуры на flat структуру с легкими типами данных
- **Проблема**: Исходная структура с Float32 и pivot (field_name, daily_value) была неэффективна для GPU вычислений
- **Решение**: 
  - Flat структура: прямые колонки вместо pivot (field_name, daily_value)
  - Легкие типы: UInt16 для счетчиков (0-65535), UInt8 для поставок (0-255), Int8 для триггеров (-128/127)
  - Сохранена логика trigger полей: корректировка первой даты на основе реальных компонентов статуса 2
  - Исправлена работа с временными таблицами (правильная структура MergeTree с ORDER BY)
  - Приведение типов в UNION ALL запросах валидации (toInt64)
- **Результат**: ✅ Таблица flight_program_ac готова для Flame GPU с значительно меньшим объемом данных (4000 записей × 8 полей), сохранена специфика trigger логики, ETL пайплайн работает корректно
- **Зависимости**: Интеграция с heli_pandas, соблюдение последовательности ETL для корректировки trigger полей

## Задача: Установка GPU зависимостей
- **Статус**: Завершена
- **Описание**: Восстановить работоспособность Flame GPU и cuDF после предыдущего "инцидента" удаления
- **Результат**: ✅ Flame GPU 2.0.0-rc.2 и cuDF 25.6.0 успешно установлены и протестированы
- **Зависимости**: Требовалось для будущих этапов Transform и Load с GPU ускорением

## Задача: Система аддитивных словарей
- **Статус**: Завершена  
- **Описание**: Реализация полной системы аддитивных словарей с поддержкой dictGet для ClickHouse
- **Результат**: ✅ Все словари (partno, serialno, owner, ac_type, status, aircraft_number) работают аддитивно
- **Зависимости**: Основа для аналитических запросов и Flame GPU интеграции

## Задача: Организация workspace
- **Статус**: Завершена
- **Описание**: Очистка проекта от мусорных файлов и правильная организация структуры папок
- **Результат**: ✅ Workspace очищен, настроен .gitignore, добавлены правила в cursorrules
- **Зависимости**: Нет

## Задача: Обогащение словаря aircraft_number полем ac_type_mask + BUGFIX
- **Статус**: Завершена 
- **Описание**: Доработать словарь aircraft_number для включения поля ac_type_mask из heli_pandas + исправить критический баг с нулевыми значениями
- **Проблема**: Словарь создавался ДО обогащения ac_type_mask, получались нулевые значения
- **Дополнительные проблемы обнаружены:**
  - Аддитивная грязь в словарях от предыдущих загрузок
  - Некорректные регистрационные коды OB-/OM- в исходном Excel  
  - 3100 записей агрегатов с aircraft_number = 0 (не грязь, а склад)
  - 5 ВС без планерных partno (только агрегаты)
- **Решение**: 
  - Исправлен порядок ETL (enrich_heli_pandas.py ПЕРЕД dictionary_creator.py) 
  - Добавлена строгая фильтрация по планерным partno
  - Создана утилита cleanup_dictionaries.py для очистки словарей
  - Ручная очистка Excel от OB-/OM- записей
  - Анализ и категоризация агрегатов без ВС
- **Результат**: ✅ Словарь dict_aircraft_number_flat содержит корректные ac_type_mask (279 ВС: 163×маска32 + 116×маска64), поддерживается dictGet('aircraft_number_dict_flat', 'ac_type_mask', aircraft_number), готов для Flame GPU операций
- **Зависимости**: Требовало корректного порядка ETL этапов + очистки исходных данных

## Задача: Создание тензора flight_program_fl для ежедневных налетов планеров
- **Статус**: Завершена
- **Описание**: Создать таблицу flight_program_fl с ежедневными нормативными налетами для всех планеров на 4000 дней для Flame GPU симуляции
- **Техническое решение**:
  - Приоритетная логика: сначала по экземплярам (aircraft_number = serialno), потом по типам (ac_type_mask)
  - Календарь на 4000 дней начиная с последней version_date из heli_pandas
  - Размер тензора: 279 планеров × 4000 дней = ~1.1M записей
  - Схема: aircraft_number, flight_date, daily_hours, ac_type_mask, version_date, version_id
- **Результат**: ✅ Таблица flight_program_fl создана и заполнена данными (1,116,000 записей). Загрузчик flight_program_fl_loader.py готов. Первый тензор для Flame GPU готов к использованию
- **ВАЖНО**: ❌ flight_program_fl_loader.py НЕ интегрирован в ETL пайплайн etl_master.py - требуется интеграция для автоматического создания тензора при каждом ETL цикле
- **Зависимости**: Требовало словарь aircraft_number и таблицу flight_program с данными daily_flight

---

## ЭТАП EXTRACT (ЗАВЕРШЕНИЕ)

## Задача: Формирование тензоров программы полетов
- **Статус**: ✅ Завершена
- **Описание**: Сформировать два тензора с программой полетов по каждому вертолету и количеству потребных вертолетов
- **Решение**: Созданы прямые загрузчики минуя промежуточную таблицу flight_program
- **Результат**: 
  - ✅ **flight_program_fl**: Тензор полетов (279 планеров × 4000 дней = ~1.1M записей)
  - ✅ **flight_program_ac**: Тензор операций с постпроцессингом (поля × типы × 4000 дней)
  - ✅ **Прямое создание** из Excel файлов через program_fl_direct_loader.py и program_ac_direct_loader.py
  - ✅ **Логика размножения**: Последнее известное значение по месяцам на 4000 дней
  - ✅ **Приоритеты данных**: serialno (экземпляры) > ac_type_mask (типы)
  - ✅ **Постпроцессинг**: ops_counter_total, trigger_program_mi8/mi17, trigger_program с правильными формулами
  - ✅ **Интеграция в ETL**: Автоматическое создание в конце пайплайна
  - ✅ **Валидация**: Комплексная проверка целостности данных
- **Зависимости**: Выполнено - зависимые таблицы heli_pandas и md_components готовы к моменту создания тензоров

## Задача: Синхронизация аналитических форматов
- **Статус**: Не начата  
- **Описание**: Синхронизировать аналитику по полям, форматам данных между data_input/analytics/OLAP MultiBOM Flame GPU.xlsx, data_input/analytics/Agents GPU.xlsx и таблицами в ClickHouse
- **Результат**: Подтверждена готовность форматов данных к ABM моделированию
- **Зависимости**: Все аналитические файлы Excel должны быть актуальны

## Задача: Словарь цифровых значений для ABM
- **Статус**: Завершена
- **Дата завершения**: 20-07-2025
- **Описание**: Создать словарь всех цифровых значений всех полей для загрузки в ABM с оптимизированными типами данных для GPU совместимости
- **Техническое решение**:
  - Автоматическое извлечение типов данных из реальных таблиц ClickHouse вместо статических схем
  - Оптимизация типов для GPU: Float64→Float32, UInt16→UInt32, Float32→UInt32 (где применимо)
  - Очистка и пересоздание словаря для отражения актуальных типов
  - Интеграция в ETL пайплайн как финальный этап (11/11)
- **Изменения типов данных**:
  - `daily_hours`: Float32 → UInt32 (целые значения налета)
  - `purchase_price`, `repair_price`: Float64 → Float32 (достаточная точность для расчетов BR)
  - `aircraft_number`: UInt16 → UInt32 (поддержка больших номеров самолетов до 65000+)
  - Все остальные поля сохранили оптимизированные типы из таблиц
- **Результат**: ✅ Словарь dict_digital_values_flat содержит 70 полей с оптимизированными типами данных, готов для Flame GPU macroproperty загрузки. Полная совместимость с ETL пайплайном подтверждена тестированием
- **Зависимости**: Выполнено - все таблицы ClickHouse с актуальными оптимизированными типами данных

## Задача: Доработка логики RTC balance функции
- **Статус**: Не начата
- **Описание**: Доработать логику RTC balance функции в data_input/analytics/Agents GPU.xlsx
- **Результат**: Функция RTC balance корректно обрабатывает балансы компонентов
- **Зависимости**: Файл Agents GPU.xlsx должен быть готов к модификации

## Задача: Доработка учета специальных условий RTC
- **Статус**: Не начата
- **Описание**: Доработать логику учета специальных условий в RTC функциях, включая группировку оборота и разделение по типам вертолетов в data_input/analytics/Agents GPU.xlsx, data_input/master_data/MD_Сomponents.xlsx
- **Результат**: RTC функции учитывают специальные условия, группировку и типы вертолетов, а также поставку новых вертолетов и формирование дефицита, если времени на запуск в ремонт не осталось
- **Зависимости**: Файлы Agents GPU.xlsx и MD_Components.xlsx готовы к изменениям

## Задача: Формат выдачи аналитики симуляции
- **Статус**: Не начата
- **Описание**: Разработать формат выдачи аналитики по результатам симуляции оборота планеров, включая поля partout_trigger_ac, assembly_trigger_ac
- **Результат**: Определен стандартный формат аналитических отчетов симуляции
- **Зависимости**: Понимание требований к аналитическим отчетам

---

## ЭТАП TRANSFORM (НАЧАЛО)

## Задача: Загрузка данных и имитация оборота планеров
- **Статус**: Не начата
- **Описание**: Реализовать загрузку данных и имитацию оборота планеров, как корневой части multiBOM
- **Результат**: Система имитации оборота планеров работает с multiBOM структурой
- **Зависимости**: Завершение всех задач Extract этапа, готовность данных в ClickHouse

---

## Команды управления задачами

### Добавление новой задачи:
```bash
# Через согласование с пользователем
```

### Изменение статуса задачи:
```bash  
# По команде пользователя или автоматически при завершении
```

### Формат новых задач:
```markdown
## Задача: [Название задачи]
- **Статус**: [Не начата/В процессе/Завершена/Приостановлена/Отменена]
- **Описание**: [Детальное описание задачи]
- **Результат**: [Ожидаемый результат или фактический при завершении]
- **Зависимости**: [Связи с другими задачами, если есть]
```

---

*Последнее обновление: 19-07-2025* 