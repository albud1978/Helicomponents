# RTC Components Architecture (ะะณัะตะณะฐัั)

**ะะฐัะฐ:** 31.10.2025  
**ะะตััะธั:** 0.2 (ะพะฑะฝะพะฒะปะตะฝะพ: ะธะฝัะตะณัะฐัะธั sne_new/ppr_new ะธะท MP1)

## 0. ะขะตะบััะตะต ัะพััะพัะฝะธะต ะธ ะฟัะธะพัะธัะตัั

- ะะพััะฟัะพัะตััะธะฝะณ ETL, ะบะพัะพััะน ะผั ัะตะนัะฐั ะฒัะฟะพะปะฝัะตะผ (`status_overhaul`, `program_ac`, `inactive_planery_processor`, Program_AC / Program_FL ะทะฐะณััะทัะธะบะธ), ะทะฐััะฐะณะธะฒะฐะตั **ัะพะปัะบะพ ะฟะปะฐะฝะตัั** (`group_by โ {1,2}`).  
  - ะญัะธ ัะฐะณะธ ะฝัะถะฝั, ััะพะฑั ัะธะผัะปััะธั ะฟะปะฐะฝะตัะพะฒ ะธะผะตะปะฐ ะบะพััะตะบัะฝัะต `status_id`, `aircraft_number`, `flight_program` ะธ ะบะฒะพัั.  
  - ะะฐ ะฐะณัะตะณะฐัั (`group_by โฅ 3`) ะพะฝะธ ะฝะต ัะฐัะฟัะพัััะฐะฝััััั: ััะฐััั ะพััะฐัััั `0`, `aircraft_number` โ 0, ะฟัะพะณัะฐะผะผ ะฝะฐะปััะฐ ะฝะตั.
- ะะปั ะฐะณัะตะณะฐัะพะฒ ะบะพัะฝะตะฒัะผ ะธััะพัะฝะธะบะพะผ ะฟะพััะตะฑะฝะพััะธ ะพััะฐัััั ะฟะปะฐะฝะตัะฝะฐั ัะธะผัะปััะธั: MP2 ะฒัะดะฐัั ะฝะฐะปัั, ัะตะผะพะฝัะฝัะต ัะพะฑััะธั ะธ `assembly_trigger`, ะบะพัะพััะต ะพะฟัะตะดะตะปััั, ะบะฐะบะธะต ะฐะณัะตะณะฐัั ะฝัะถะฝั/ะฒัะฑัะฒะฐัั. ะะพััะพะผั ะพัะดะตะปัะฝัะต MP ะฟะพะด ะฐะณัะตะณะฐัั (ะฐะฝะฐะปะพะณ MP4/MP5 ั ะฟะปะฐะฝะตัะพะฒ) ะฝะต ััะตะฑััััั โ ะผั ะฑัะดะตะผ ะธัะฟะพะปัะทะพะฒะฐัั MP2 ะบะฐะบ ะธััะพัะฝะธะบ ยซะบะพะผะฐะฝะดยป ะฝะฐ ะบะพะผะฟะปะตะบัะฐัะธั.
- ะฆะตะปั ะฑะปะธะถะฐะนัะธั ะธัะตัะฐัะธะน โ **ะฟะพััะฐะฟะฝะพ ะทะฐะฟะพะปะฝะธัั `status_id` ะดะปั ะฐะณัะตะณะฐัะพะฒ** ัะฐะบ, ััะพะฑั ะฒ ะผะฐััะธะฒะต ะฝะต ะพััะฐะฒะฐะปะพัั ะฝัะปะตะฒัั ะทะฝะฐัะตะฝะธะน. ะะพะณะธะบะฐ ัะฐัะฟัะตะดะตะปะตะฝะธั ััะฐัััะพะฒ ะฑัะดะตั ะพะฟะธัะฐัััั ะฝะฐ ะดะฐะฝะฝัะต MP2 (ัะพััะพัะฝะธะต ะฟะปะฐะฝะตัะฐ, ััะธะณะณะตัั ะทะฐะผะตะฝั) ะธ ััะฐะฝะตั ัะฐัััั ะฐััะธัะตะบัััั, ะพะฟะธัะฐะฝะฝะพะน ะฝะธะถะต.
- ะญัะพั ะดะพะบัะผะตะฝั โ ะดะธะทะฐะนะฝ-ะฟัะพะตะบั RTC ะดะปั ะฐะณัะตะณะฐัะพะฒ. ะะตะฐะปะธะทะฐัะธั ะตัั ะฝะต ะทะฐะฒะตััะตะฝะฐ; ัะตะบัั ะฝะธะถะต ัะธะบัะธััะตั ะดะพะณะพะฒะพััะฝะฝะพััะธ ะฟะพ ะฟะตัะตะผะตะฝะฝัะผ, ะธััะพัะฝะธะบะฐะผ ะดะฐะฝะฝัั ะธ ะฟะปะฐะฝั spawn/ััะฐัััะพะฒ.

---

## 1. ะะะะะะะะะซะ ะะะะะขะะ

### ะะณัะตะณะฐัั (Agent "unit")

| ะะฐัะตะณะพัะธั | ะะตัะตะผะตะฝะฝัะต | ฮ ะพั ะฟะปะฐะฝะตัะพะฒ |
|-----------|------------|---------------|
| **States** | operations, serviceable, repair, reserve, storage | -inactive |
| **ID** | idx, **psn**, aircraft_number, partseqno_i, group_by | +psn (PRIMARY KEY) |
| **ะะฐัะฐะฑะพัะบะฐ** | sne, ppr | -cso |
| **ะะพัะผะฐัะธะฒั** | ll, oh, br | = |
| **ะะตะผะพะฝั** | repair_time, repair_days | -assembly_time, -partout_time |
| **ะขัะธะณะณะตัั** | โ | -assembly_trigger, -active_trigger, -partout_trigger, -s4_days |
| **MP2 ะฟะปะฐะฝะตัะฐ** | dt, dn | ัะธัะฐัััั ะธะท mp2_dt/mp2_dn ะฟะพ aircraft_number |
| **ะะฒะพัั** | intent_state, mfg_date | = |
| **Transitions** | transition_2_to_3, transition_2_to_4, transition_2_to_6, transition_3_to_2, transition_4_to_5, transition_5_to_2 | -transition_1_to_2, -transition_1_to_4, -transition_4_to_2 |
| **ะกะปัะถะตะฑะฝะพะต** | bi_counter | = |

**ะัะพะณะพ:** 23 ะฟะตัะตะผะตะฝะฝัั (vs 33 ั ะฟะปะฐะฝะตัะพะฒ)

**ะะฐะถะฝะพ:** 
- State `inactive` ั ะฐะณัะตะณะฐัะพะฒ ะะ ะธัะฟะพะปัะทัะตััั (ะฝะพะฒัะต ะฐะณัะตะณะฐัั ัะพะทะดะฐัััั ะฒ `reserve`)
- Transition `1โ2` ะะ ะฝัะถะตะฝ (ะฝะตั inactive state)
- Spawn ะฐะณัะตะณะฐัะพะฒ ะธะดัั ััะฐะทั ะฒ `reserve` (ะณะพัะพะฒ ะบ ัััะฐะฝะพะฒะบะต ะฝะฐ ะฟะปะฐะฝะตั)

---

## 2. ะะกะขะะงะะะะ ะะะะฆะะะะะะะฆะะ

### ะขะฐะฑะปะธัะฐ ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั ะฟัะธ ัะพะทะดะฐะฝะธะธ ะฐะณะตะฝัะพะฒ

| ะะตัะตะผะตะฝะฝะฐั | ะััะพัะฝะธะบ (MP3) | ะะพะณะธะบะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ (ัััะตััะฒัััะธะต) | ะะพะณะธะบะฐ spawn (ะฝะพะฒัะต inactive) |
|------------|----------------|-------------------------------------|-------------------------------|
| **idx** | ะะปะพัะฝัะน ะธะฝะดะตะบั | ะะฐัะธะฝะฐะตััั ั (last_idx_ะฟะปะฐะฝะตัะพะฒ + 1), ัะพััะธัะพะฒะบะฐ ะฟะพ mfg_date ะฒะฝัััะธ group_by | ะะฐัะตะทะตัะฒะธัะพะฒะฐะฝะฝัะน idx ะฒ ะบะพะฝัะต ะณััะฟะฟั |
| **psn** | MP3.psn | PRIMARY KEY ะฐะณัะตะณะฐัะฐ, ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั | ะกะตะณะผะตะฝั: 2000000 + (group_by ร 100000) + counter |
| **aircraft_number** | MP3.aircraft_number | ะะพะผะตั ะฟะปะฐะฝะตัะฐ-ัะพะดะธัะตะปั (0 ะตัะปะธ ะฒ ะฟัะปะต) | 0 (ะฒ ะฟัะปะต ะดะพ ัััะฐะฝะพะฒะบะธ) |
| **partseqno_i** | MP3.partseqno_i | ะะพะด ัะธะฟะฐ ะฐะณัะตะณะฐัะฐ ะธะท ัะฟัะฐะฒะพัะฝะธะบะฐ | ะัะฑะพั ะฟะพ ะปะพะณะธะบะต (ัะผ. ัะฐะทะดะตะป 5.5) |
| **group_by** | MP3.group_by | ะขะธะฟ ะฐะณัะตะณะฐัะฐ (3=ะะฒะณ ะะธ-8, 4=ะะฒะณ ะะธ-17) | ะะพะฝััะฐะฝัะฐ: 3 ะธะปะธ 4 |
| **sne** | MP3.sne | ะะฐัะฐะฑะพัะบะฐ ั ะฝะฐัะฐะปะฐ ัะบัะฟะปัะฐัะฐัะธะธ (ะผะธะฝััั) | MP1.sne_new[partseqno_i] (NULLโ0) |
| **ppr** | MP3.ppr | ะะฐัะฐะฑะพัะบะฐ ะฟะพัะปะต ะฟะพัะปะตะดะฝะตะณะพ ะบะฐะฟัะตะผะพะฝัะฐ | MP1.ppr_new[partseqno_i] (NULLโ0) |
| **ll** | MP3.ll ะธะปะธ MP1 | ะัะปะธ MP3.ll > 0 โ MP3, ะธะฝะฐัะต MP1 ะฟะพ group_by | MP1 ะฟะพ group_by |
| **oh** | MP1 | ะะพ partseqno_i ัะตัะตะท mp1_index | MP1 ะฟะพ group_by |
| **br** | MP1 | ะะพ partseqno_i ัะตัะตะท mp1_index | MP1 ะฟะพ group_by |
| **repair_time** | MP1 | mp1_repair_time[pidx] | MP1 ะฟะพ group_by |
| **repair_days** | MP3.repair_days | ะกัะตััะธะบ ะดะฝะตะน ะฒ ัะตะผะพะฝัะต | 0 (ะฝะพะฒัะน ะฐะณัะตะณะฐั) |
| **intent_state** | ะะพะฝััะฐะฝัะฐ | 0 (ะฑะตะท ะฝะฐะผะตัะตะฝะธะน) | 0 (ะฑะตะท ะฝะฐะผะตัะตะฝะธะน) |
| **mfg_date** | MP3.mfg_date | ะะฐัะฐ ะฟัะพะธะทะฒะพะดััะฒะฐ (ะดะฝะธ ั ัะฟะพัะธ) | 0 (ัััะฐะฝะพะฒะธััั ะฟัะธ ัััะฐะฝะพะฒะบะต ะฝะฐ ะฟะปะฐะฝะตั) |
| **dt, dn** | MP2 | ะงัะตะฝะธะต ะฟะพ aircraft_number ะธะท mp2_dt/mp2_dn ะฟะปะฐะฝะตัะฐ | 0 (aircraft_number=0) |
| **bi_counter** | ะะพะฝััะฐะฝัะฐ | 1 (ะดะปั BI) | 1 (ะดะปั BI) |
| **transition_*** | ะะพะฝััะฐะฝัั | 0 (ะฑะตะท ะฟะตัะตัะพะดะพะฒ) | 0 (ะฑะตะท ะฟะตัะตัะพะดะพะฒ) |
| **state** | MP3.status_id | ะะฐะฟะฟะธะฝะณ status_id โ state | reserve (ะณะพัะพะฒ ะบ ัััะฐะฝะพะฒะบะต) |

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะคะธะปัััะฐัะธั: ะธะท ~7113 ัััะพะบ MP3 ะฑะตััััั ัะพะปัะบะพ ะทะฐะฟะธัะธ ั `group_by โ {3,4}` (ัะฝะฐัะฐะปะฐ 3, ะฟะพัะพะผ 4; ะพััะฐะปัะฝัะต ะณััะฟะฟั ะดะพะฑะฐะฒัััั ะฟะพะทะถะต)
- **ะฃะฝะธะบะฐะปัะฝะพััั: ะพะดะธะฝ ะฐะณะตะฝั = ะพะดะธะฝ `psn` (PRIMARY KEY), ะฝะต aircraft_number**
  - โ๏ธ **ะะะะะ:** ะฃ ะฟะปะฐะฝะตัะพะฒ (group_by=1,2) ะฟะตัะตะผะตะฝะฝะพะน `psn` ะะะข! ะัะฟะพะปัะทัะตััั ัะพะปัะบะพ `aircraft_number`
  - ะฃ ะฐะณัะตะณะฐัะพะฒ (group_byโฅ3) `psn` โ ะพะฑัะทะฐัะตะปัะฝะพะต ะฟะพะปะต (PRIMARY KEY ะฒ ะกะฃะะ)
- ะกะฒัะทั ั ะฟะปะฐะฝะตัะพะผ: ัะตัะตะท `aircraft_number` (0 = ะฒ ะฟัะปะต, >0 = ะฝะฐ ะบะพะฝะบัะตัะฝะพะผ ะฟะปะฐะฝะตัะต)
- ะะฝะดะตะบัะฐัะธั: ะฟะปะพัะฝัะน ะธะฝะดะตะบั ะฝะฐัะธะฝะฐะตััั ะฟะพัะปะต ะฟะพัะปะตะดะฝะตะณะพ idx ะฟะปะฐะฝะตัะพะฒ, ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ: ัะฝะฐัะฐะปะฐ ะฒัะต group_by=3, ะทะฐัะตะผ ะฒัะต group_by=4
- ะกะพััะธัะพะฒะบะฐ: ะฟะพ mfg_date (ะพั ััะฐััั ะบ ะฝะพะฒัะผ) ะฒะฝัััะธ ะบะฐะถะดะพะน group_by
- **Spawn-ัะตะทะตัะฒ:** ัะปะพัั ะฒ ะบะพะฝัะต ะบะฐะถะดะพะน ะณััะฟะฟั ัะตะทะตัะฒะธัััััั ะฝะฐ ััะฐะฟะต ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
  - ะะตะทะตัะฒะฝัะต ัะปะพัั ัะฐัััะธััะฒะฐัััั ะฟะพ ัะพัะผัะปะต ะฒััะฐะฑะพัะบะธ ัะตััััะฐ (ัะฐะทะดะตะป 5.4)
  - ะัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะทะฐะฟะพะปะฝััััั **ัะพะปัะบะพ `idx` ะธ `psn`** (ะฟะพ ัะพัะผัะปะต ัะตะณะผะตะฝัะธัะพะฒะฐะฝะธั)
  - ะััะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต **ะะ ะทะฐะฟะพะปะฝััััั** ะดะพ ะผะพะผะตะฝัะฐ ัะตะฐะปัะฝะพะณะพ spawn
  - ะะตะฐะปัะฝัะน spawn ะฟัะพะธััะพะดะธั ะดะธะฝะฐะผะธัะตัะบะธ ะฟัะธ ะดะตัะธัะธัะต ะฒ ะฟัะปะต (ัะฐะทะดะตะป 5.3)

---

---

## 3. ะะะะะะ ะะะะะะะะะะ PSN

### ะขะตะบััะธะต ะดะธะฐะฟะฐะทะพะฝั ะฒ heli_pandas (ะพะฑะฝะพะฒะปะตะฝะพ 30.10.2025)

| group_by | ะขะธะฟ | ะัะตะณะพ | ะฃะฝะธะบ.PSN | MIN(psn) | MAX(psn) |
|----------|-----|-------|----------|----------|----------|
| 1 | ะะปะฐะฝะตัั ะะธ-8 | 163 | 163 | 148724 | 922207 |
| 2 | ะะปะฐะฝะตัั ะะธ-17 | 116 | 116 | 148717 | 1459322 |
| **3** | **ะะฒะณ ะะธ-8** | **520** | **520** | **2702** | **1606586** |
| **4** | **ะะฒะณ ะะธ-17** | **384** | **384** | **2760** | **1519814** |
| 5 | ะะณัะตะณะฐั | 264 | 264 | 2715 | 1543914 |
| 6 | ะะณัะตะณะฐั | 1588 | 1588 | 6557 | 1612576 |
| 7 | ะะณัะตะณะฐั | 248 | 248 | 2934 | 1521154 |
| 8 | ะะณัะตะณะฐั | 287 | 287 | 2778 | 1521178 |
| 9 | ะะณัะตะณะฐั | 275 | 275 | 2716 | 1521182 |
| 10 | ะะณัะตะณะฐั | 249 | 249 | 2777 | 1521186 |
| 11 | ะะณัะตะณะฐั | 324 | 324 | 2746 | 1608677 |
| 12 | ะะณัะตะณะฐั | 269 | 269 | 2718 | 1606588 |
| 13 | ะะณัะตะณะฐั | 155 | 155 | 2880 | 1612142 |
| 14 | ะะณัะตะณะฐั | 212 | 212 | 2750 | 1468367 |
| 15 | ะะณัะตะณะฐั | 23 | 23 | 21721 | 1519916 |
| 16 | ะะณัะตะณะฐั | 15 | 15 | 1058970 | 1150787 |
| 17 | ะะณัะตะณะฐั | 308 | 308 | 2729 | 1612124 |
| 18 | ะะณัะตะณะฐั | 167 | 167 | 15581 | 1612588 |
| 19 | ะะณัะตะณะฐั | 183 | 183 | 3528 | 1612583 |
| 20 | ะะณัะตะณะฐั | 175 | 175 | 24492 | 1612600 |
| 21 | ะะณัะตะณะฐั | 222 | 222 | 7168 | 1612936 |
| 22 | ะะณัะตะณะฐั | 412 | 412 | 6071 | 1606156 |
| 23 | ะะณัะตะณะฐั | 139 | 139 | 3839 | 1606162 |
| 24 | ะะณัะตะณะฐั | 415 | 415 | 4554 | 1520674 |

**ะะฐะถะฝะพ:** ะััะฟะฟะฐ 0 ะฑะพะปััะต ะฝะต ัััะตััะฒัะตั โ ัะฐะทะฑะธัะฐ ะฝะฐ ะธะฝะดะธะฒะธะดัะฐะปัะฝัะต ะณััะฟะฟั 5-24 (ะฟะพะฐะณัะตะณะฐัะฝะพ).

**ะัะพะฑะตะฝะฝะพััั:** PSN ะะ ะฟะปะพัะฝัะต (ะฟัะพะฟััะบะพะฒ ~1.6ะ), ะธัะฟะพะปัะทััััั ัะฐะทัะพะทะฝะตะฝะฝัะต ะทะฝะฐัะตะฝะธั.

**ะัะพะณะพ:** 24 ะณััะฟะฟั (1-2: ะฟะปะฐะฝะตัั, 3-24: ะฐะณัะตะณะฐัั), ะฒัะตะณะพ 7113 ะทะฐะฟะธัะตะน.

**ะะปะพะฑะฐะปัะฝัะน MAX(psn) = 1612936** (group_by=21)

**ะััะธัะตะบัััะฐ ัะตะณะผะตะฝัะธัะพะฒะฐะฝะธั (100k ะฝะฐ ะณััะฟะฟั):**

| group_by | ะขะธะฟ | ะะธะฐะฟะฐะทะพะฝ PSN | Capacity |
|----------|-----|--------------|----------|
| 1 | ะะปะฐะฝะตัั ะะธ-8 | [2100000, 2200000) | 100000 |
| 2 | ะะปะฐะฝะตัั ะะธ-17 | [2200000, 2300000) | 100000 |
| **3** | **ะะฒะณ ะะธ-8** | **[2300000, 2400000)** | **100000** |
| **4** | **ะะฒะณ ะะธ-17** | **[2400000, 2500000)** | **100000** |
| 5 | ะะณัะตะณะฐั | [2500000, 2600000) | 100000 |
| 6 | ะะณัะตะณะฐั | [2600000, 2700000) | 100000 |
| 7 | ะะณัะตะณะฐั | [2700000, 2800000) | 100000 |
| 8 | ะะณัะตะณะฐั | [2800000, 2900000) | 100000 |
| 9 | ะะณัะตะณะฐั | [2900000, 3000000) | 100000 |
| 10 | ะะณัะตะณะฐั | [3000000, 3100000) | 100000 |
| 11 | ะะณัะตะณะฐั | [3100000, 3200000) | 100000 |
| 12 | ะะณัะตะณะฐั | [3200000, 3300000) | 100000 |
| 13 | ะะณัะตะณะฐั | [3300000, 3400000) | 100000 |
| 14 | ะะณัะตะณะฐั | [3400000, 3500000) | 100000 |
| 15 | ะะณัะตะณะฐั | [3500000, 3600000) | 100000 |
| 16 | ะะณัะตะณะฐั | [3600000, 3700000) | 100000 |
| 17 | ะะณัะตะณะฐั | [3700000, 3800000) | 100000 |
| 18 | ะะณัะตะณะฐั | [3800000, 3900000) | 100000 |
| 19 | ะะณัะตะณะฐั | [3900000, 4000000) | 100000 |
| 20 | ะะณัะตะณะฐั | [4000000, 4100000) | 100000 |
| 21 | ะะณัะตะณะฐั | [4100000, 4200000) | 100000 |
| 22 | ะะณัะตะณะฐั | [4200000, 4300000) | 100000 |
| 23 | ะะณัะตะณะฐั | [4300000, 4400000) | 100000 |
| 24 | ะะณัะตะณะฐั | [4400000, 4500000) | 100000 |

**ะคะพัะผัะปะฐ ะณะตะฝะตัะฐัะธะธ:**
```
base_psn_group = 2000000 + (group_by ร 100000)
psn = base_psn_group + spawn_counter_group
```
ะณะดะต `spawn_counter_group` โ ััะตััะธะบ ัะพะทะดะฐะฝะฝัั ะฐะณะตะฝัะพะฒ **ะฒะฝัััะธ ะณััะฟะฟั** (0, 1, 2, ..., 99999)

**ะัะธะผะตัั:**
- ะะตัะฒัะน ะฝะพะฒัะน ะดะฒะธะณะฐัะตะปั ะะธ-8 (group_by=3): `psn = 2300000 + 0 = 2300000`
- ะะตัะฒัะน ะฝะพะฒัะน ะดะฒะธะณะฐัะตะปั ะะธ-17 (group_by=4): `psn = 2400000 + 0 = 2400000`
- ะะตัะฒัะน ะฝะพะฒัะน ะฐะณัะตะณะฐั ะณััะฟะฟั 24: `psn = 4400000 + 0 = 4400000`

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะงะธััะพะต ัะฐะทะดะตะปะตะฝะธะต 24 ะณััะฟะฟ (ะปะตะณะบะพ ะพะฟัะตะดะตะปะธัั ัะธะฟ ะฟะพ PSN)
- โ ะะฐะฟะฐั 100k ะฝะพะฒัั ะฐะณะตะฝัะพะฒ ะฝะฐ ะบะฐะถะดัั ะณััะฟะฟั
- โ ะฃะดะพะฑะฝะฐั ะดะธะฐะณะฝะพััะธะบะฐ: `group_by = (psn - 2000000) / 100000`
- โ ะะตะทะตัะฒ ะดะปั ะฟะปะฐะฝะตัะพะฒ (group_by=1,2) ะฝะฐ ะฑัะดััะตะต
- โ ะะพะดะดะตัะถะบะฐ ะฟะพะปะฝะพะน ััััะบัััั 24 ะณััะฟะฟ (ะฑะตะท group_by=0)

---

## 4. ะะะะะงะ ะะะฅะะขะะะขะฃะะซ

### 4.1. ะะฝะธัะธะฐะปะธะทะฐัะธั ะฟะตัะฒะธัะฝัั ััะฐัััะพะฒ ะฐะณัะตะณะฐัะพะฒ (TODO)



**ะขัะตะฑัะตััั:**
1. ะะฐะทัะฐะฑะพัะฐัั ะฐะปะณะพัะธัะผ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะฟะตัะฒะธัะฝัั ััะฐัััะพะฒ ะฐะณัะตะณะฐัะพะฒ (ะฐะฝะฐะปะพะณ ะปะพะณะธะบะธ ะฟะปะฐะฝะตัะพะฒ)
3. ะฃัะตััั ัะฒัะทั ัะพ ััะฐัััะพะผ ะฟะปะฐะฝะตัะฐ (operations, repair, assembly_trigger)
4. ะะฐะปะธะดะฐัะธั ะบะพะฝัะธััะตะฝัะฝะพััะธ: ะฐะณัะตะณะฐั ะฝะต ะผะพะถะตั ะฑััั ะฒ `operations` ะตัะปะธ ะตะณะพ ะฟะปะฐะฝะตั ะฝะต ะฒ `operations`

**ะะฐัะฐ ัะพะทะดะฐะฝะธั:** 30.10.2025

---

## 5. ะะะฅะะขะะะขะฃะะ SPAWN ะะะะะะะขะะ

### 5.1. ะขะตัะฝะพะปะพะณะธั (ะฐะฝะฐะปะพะณ ะฟะปะฐะฝะตัะพะฒ)

**ะญัะฐะฟ 1: ะะฝะธัะธะฐะปะธะทะฐัะธั (setup_env)**

1. **ะะตะทะตัะฒะธัะพะฒะฐะฝะธะต ัะปะพัะพะฒ ะฒ ะธะฝะดะตะบัะต:**
   - ะกััะตััะฒัััะธะต ะฐะณัะตะณะฐัั ะธะท MP3 (ะฝะฐะฟัะธะผะตั, group_by=3): idx=[0..N-1]
   - ะะฐัะตะทะตัะฒะธัะพะฒะฐะฝะฝัะต ัะปะพัั ะดะปั spawn: idx=[N..N+RESERVE-1]
   - ะัะธะผะตั: 520 ะดะฒะธะณะฐัะตะปะตะน ะะธ-8 + 100 ัะตะทะตัะฒะฝัั ัะปะพัะพะฒ = 620 total
   - โ๏ธ **ะะะะะ:** ะะตะทะตัะฒะฝัะต ัะปะพัั ัะพะทะดะฐัััั **ะฟััััะผะธ** (ัะพะปัะบะพ `idx` ะธ `psn`)

2. **ะัะตะดัะฐัััั PSN ะดะปั ัะตะทะตัะฒะฐ:**
   - ะคะพัะผัะปะฐ: base_psn_group = 2000000 + (group_by ร 100000)
   - ะะปั group_by=3: base_psn ะฝะฐัะธะฝะฐะตััั ั 2300000
   - ะะฐะถะดัะน ะฝะพะฒัะน ะฐะณัะตะณะฐั ะฟะพะปััะฐะตั ัะปะตะดัััะธะน PSN: 2300000, 2300001, 2300002...
   - ะัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ัะตะทะตัะฒะฝัั ัะปะพัะพะฒ:
     ```python
     for i in range(reserve_slots):
         reserve_idx = existing_count + i
         reserve_psn = base_psn_group + i
         # ะััะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะะ ะทะฐะฟะพะปะฝััััั (ะพััะฐัััั ะฟััััะผะธ/ะฝัะปะตะฒัะผะธ)
         # ะะฐะฟะพะปะฝะตะฝะธะต ะฟัะพะธะทะพะนะดัั ะฟัะธ ัะตะฐะปัะฝะพะผ spawn ัะตัะตะท RTC
     ```

3. **ะะฐะทะผะตัั MacroProperty:**
   - **MAX_FRAMES** = ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฐะณะตะฝัะพะฒ (ะฟะปะฐะฝะตัั + ะฐะณัะตะณะฐัั + ัะตะทะตัะฒ ะดะปั spawn)
     - ะะปั ะฟะปะฐะฝะตัะพะฒ: 279 (163 Mi-8 + 116 Mi-17)
     - ะะปั ะฐะณัะตะณะฐัะพะฒ: ะฑัะดะตั ะพะฟัะตะดะตะปััััั ะฐะฝะฐะปะพะณะธัะฝะพ (ัััะตััะฒัััะธะต + ัะตะทะตัะฒ)
   - **MAX_DAYS** = 4000 (ะผะฐะบัะธะผะฐะปัะฝัะน ะณะพัะธะทะพะฝั ัะธะผัะปััะธะธ)
   - **MAX_SIZE** = MAX_FRAMES ร (MAX_DAYS + 1) โ ัะฐะทะผะตั ะปะธะฝะตะนะฝะพะณะพ ะผะฐััะธะฒะฐ MP5

**ะญัะฐะฟ 2: RTC Spawn**

1. **ะะณะตะฝัั-ััะธะปะธัั:**
   - `spawn_mgr_unit_{group_by}` โ ะผะตะฝะตะดะถะตั (1 ัะบะทะตะผะฟะปัั), ััะฐะฝะธั `next_idx`, `next_psn`
   - `spawn_ticket_unit_{group_by}` โ ัะธะบะตัั (N ัะบะทะตะผะฟะปััะพะฒ), ะฟะฐัะฐะปะปะตะปัะฝะพะต ัะพะทะดะฐะฝะธะต

2. **RTC ััะฝะบัะธั spawn:**
   - ะงะธัะฐะตั ััะธะณะณะตั (ะดะตัะธัะธั ะฐะณัะตะณะฐัะพะฒ ะฒ ะฟัะปะต ะธะปะธ ะทะฐะผะตะฝะฐ ะฝะฐ ะฟะปะฐะฝะตัะต)
   - ะะตััั `idx` ะธ `psn` ะธะท ะผะตะฝะตะดะถะตัะฐ (ะฟัะตะดัะฐััะธัะฐะฝะฝัะต ะทะฝะฐัะตะฝะธั)
   - ะกะพะทะดะฐัั ะฐะณะตะฝัะฐ ัะตัะตะท `agent_out` ัะพ ะฒัะตะผะธ ะฟะตัะตะผะตะฝะฝัะผะธ ะธะท ัะฐะฑะปะธัั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ (ัะฐะทะดะตะป 2)
   - ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั `partseqno_i` ะฟะพ ะปะพะณะธะบะต ะฒัะฑะพัะฐ ัะธะฟะฐ (ัะผ. ะญัะฐะฟ 5)
   - ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั ะฝะพัะผะฐัะธะฒั (ll, oh, br) ะธะท Environment constants ะดะปั ะดะฐะฝะฝะพะน group_by

3. **ะััะพะด ะฒ ัะพััะพัะฝะธะต:**
   - Spawn ะฒ ะฟัะป โ state `reserve` (ะณะพัะพะฒ ะบ ัััะฐะฝะพะฒะบะต)
   - Spawn ะฝะฐ ะทะฐะผะตะฝั โ state `operations` (ััะฐะทั ะฝะฐ ะฟะปะฐะฝะตัะต)
   - State `inactive` ะดะปั ะฐะณัะตะณะฐัะพะฒ ะะ ะธัะฟะพะปัะทัะตััั

**ะญัะฐะฟ 3: ะขัะธะณะณะตั spawn**

- **ะะปั ะฟะปะฐะฝะตัะพะฒ:** ะะตัะตัะผะธะฝะธัะพะฒะฐะฝะฝัะน ะฟะปะฐะฝ (`mp4_new_counter_mi17_seed[day] > 0`)
- **ะะปั ะฐะณัะตะณะฐัะพะฒ:** **ะะธะฝะฐะผะธัะตัะบะธะน ะฟะพะดัััั ะดะตัะธัะธัะฐ** ะฒ ะฟัะปะต

**ะคะพัะผัะปะฐ ััะธะณะณะตัะฐ spawn ะดะปั ะฐะณัะตะณะฐัะพะฒ (ะดะปั ะบะฐะถะดะพะน group_by):**

```python
# ะะพะดัััั ะฐะณะตะฝัะพะฒ ะฒ ะฟัะปะต (ะณะพัะพะฒัั ะบ ัััะฐะฝะพะฒะบะต)
pool_count = count_agents(group_by, states=[reserve, serviceable])

# ะะพัะผะฐ ะฟัะปะฐ = ะบะพะปะธัะตััะฒะพ ะฟะปะฐะฝะตัะพะฒ ร comp_number (ะธะท MP1)
# comp_number = ะบะพะปะธัะตััะฒะพ ะพะดะฝะพะธะผัะฝะฝัั ะฐะณัะตะณะฐัะพะฒ ะฝะฐ 1 ะฒะตััะพะปัั
pool_norm = count_planers(group_by_planer) ร comp_number

# ะขัะธะณะณะตั spawn
if pool_count < pool_norm:
    spawn_need = pool_norm - pool_count
    spawn_agents(group_by, spawn_need)
```

**ะัะธะผะตั ะดะปั ะดะฒะธะณะฐัะตะปะตะน ะะธ-8 (group_by=3):**
- `comp_number` = 2 (ะดะฒะฐ ะดะฒะธะณะฐัะตะปั ะฝะฐ ะพะดะธะฝ ะะธ-8)
- ะะปะฐะฝะตัะพะฒ ะะธ-8 ะฒ operations: 120
- `pool_norm` = 120 ร 2 = 240 ะดะฒะธะณะฐัะตะปะตะน
- `pool_count` (reserve + serviceable): 220 ะดะฒะธะณะฐัะตะปะตะน
- `spawn_need` = 240 - 220 = **20 ะดะฒะธะณะฐัะตะปะตะน**

**ะะฐะถะฝะพ:** ะขัะธะณะณะตั ะฟัะพะฒะตััะตััั **ะบะฐะถะดัะน ะดะตะฝั** ะฟะตัะตะด ะฝะฐัะฐะปะพะผ ัะธะผัะปััะธะธ.

**ะญัะฐะฟ 4: ะะฐัััั ัะตะทะตัะฒะฝัั ะบะฐะดัะพะฒ**

ะคะพัะผัะปะฐ ัะตะทะตัะฒะธัะพะฒะฐะฝะธั ัะตัะตะท **ะฟัะพะณะฝะพะท ะฒััะฐะฑะพัะบะธ ัะตััััะฐ** (ะธะท ะฐััะธะฒะฝะพะณะพ ะบะพะดะฐ vNV):

```python
# ะะปั ะบะฐะถะดะพะน group_by ะฐะณัะตะณะฐัะพะฒ (3, 4, 5, ..., 24):

# 1. ะะฟัะตะดะตะปัะตะผ ัะฒัะทั ั ะฟะปะฐะฝะตัะฐะผะธ ัะตัะตะท ac_type_mask
# ac_type_mask ะฐะณัะตะณะฐัะฐ ะพะฟัะตะดะตะปัะตั, ะฝะฐ ะบะฐะบะธั ะฟะปะฐะฝะตัะฐั ะพะฝ ะธัะฟะพะปัะทัะตััั:
# - 32 (0x20) โ ะะธ-8 (group_by=1)
# - 64 (0x40) โ ะะธ-17 (group_by=2)
# - 96 (0x60) โ ะพะฑะฐ ัะธะฟะฐ (ัะฝะธะฒะตััะฐะปัะฝัะน)
planer_group_by = determine_planer_group(aggregate_group_by, ac_type_mask)

# 2. ะกัะผะผะฐัะฝัะน ะฝะฐะปัั ะฟะปะฐะฝะตัะพะฒ ะทะฐ 10 ะปะตั (ะธะท MP2 ะฟัะพะณะฝะพะทะฐ)
total_flight_hours_10y = sum([
    mp2_dt[day, idx] 
    for day in range(0, 3650)
    for idx in planers 
    if planers[idx].group_by == planer_group_by
])

# 3. LL ะฐะณัะตะณะฐัะฐ ะธะท MP1 (ะถะธะทะฝะตะฝะฝัะน ะปะธะผะธั ะฒ ะผะธะฝััะฐั)
ll_aggregate = mp1_ll[aggregate_group_by]

# 4. ะะพะปะธัะตััะฒะพ ะฐะณัะตะณะฐัะพะฒ, ะบะพัะพััะต ะฒััะฐะฑะพัะฐัั ัะตัััั
aggregates_consumed = total_flight_hours_10y / ll_aggregate

# 5. ะะพะฑะฐะฒะปัะตะผ ะทะฐะฟะฐั ะฟัะพัะฝะพััะธ 20%
aggregates_needed = aggregates_consumed ร 1.2

# 6. ะะพะดัััั ัััะตััะฒัััะธั ะฐะณัะตะณะฐัะพะฒ ะธะท MP3
existing_count = len([row for row in MP3 if row.group_by == aggregate_group_by])

# 7. ะะฐัััั ัะตะทะตัะฒะฝัั ัะปะพัะพะฒ
reserve_slots = max(100, aggregates_needed - existing_count)

# 8. ะัะพะณะพะฒะพะต ะบะพะปะธัะตััะฒะพ frames ะดะปั ะณััะฟะฟั
frames_total_group = existing_count + reserve_slots

# 9. ะะฑัะธะน MAX_FRAMES ะดะปั ะฒัะตั ะฐะณะตะฝัะพะฒ
MAX_FRAMES = sum([frames_total_group for group_by in [1, 2, 3, 4, ..., 24]])
```

**ะัะธะผะตั ะดะปั ะดะฒะธะณะฐัะตะปะตะน ะะธ-17 (group_by=4):**
- ะะปะฐะฝะตัะพะฒ ะะธ-17: 116
- ะกัะผะผะฐัะฝัะน ะฝะฐะปัั ะทะฐ 10 ะปะตั: 116 ร 3650 ะดะฝะตะน ร 90 ะผะธะฝ/ะดะตะฝั = **38,232,000 ะผะธะฝัั**
- LL ะดะฒะธะณะฐัะตะปั: 270,000 ะผะธะฝัั (4500 ัะฐัะพะฒ)
- ะะณัะตะณะฐัะพะฒ ะฒััะฐะฑะพัะฐัั ัะตัััั: 38,232,000 / 270,000 = **141.6**
- ะก ะทะฐะฟะฐัะพะผ 20%: 141.6 ร 1.2 = **170 ะดะฒะธะณะฐัะตะปะตะน**
- ะกััะตััะฒัััะธั: 384
- ะะตะทะตัะฒ: max(100, 170 - 384) = **100** (ะผะธะฝะธะผะฐะปัะฝัะน ัะตะทะตัะฒ)
- ะัะพะณะพ: 384 + 100 = **484 ัะปะพัะฐ**

**ะญัะฐะฟ 5: ะะพะณะธะบะฐ ะฒัะฑะพัะฐ partseqno_i ะดะปั ะฝะพะฒะพะณะพ ะฐะณัะตะณะฐัะฐ**

ะัะธ ะทะฐะผะตะฝะต ะฐะณัะตะณะฐัะฐ:
1. **ะงะธัะฐะตะผ `partseqno_i` ัะฝััะพะณะพ ะฐะณัะตะณะฐัะฐ**
2. **ะัะพะฒะตััะตะผ MP1 ะฟะพ ััะพะผั `partseqno_i`:**
   - ะัะปะธ `sne_new` ะธ `ppr_new` **ะะ ะฟััััะต** โ
     - `partseqno_i` = `partseqno_i` ัะฝััะพะณะพ ะฐะณัะตะณะฐัะฐ (ัะพั ะถะต ัะธะฟ)
     - `sne` = `sne_new` ะธะท MP1
     - `ppr` = `ppr_new` ะธะท MP1
   - ะัะปะธ `sne_new` ะธ `ppr_new` **ะฟััััะต** โ
     - `partseqno_i` = `partseqno_i` **ะฟะพัะปะตะดะฝะตะณะพ ัะพะทะดะฐะฝะฝะพะณะพ ะฐะณัะตะณะฐัะฐ** ั ัะพะน ะถะต `group_by` (ะฟะพ ะผะฐะบัะธะผะฐะปัะฝะพะผั `idx`)
     - `sne` = 0
     - `ppr` = 0

**ะะปะณะพัะธัะผ:**
- ะัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต `sne_new` ะธ `ppr_new` ะฒ MP1 ะดะปั `partseqno_i` ัะฝััะพะณะพ ะฐะณัะตะณะฐัะฐ
- ะัะปะธ ะทะฝะฐัะตะฝะธั ะฟัะธัััััะฒััั โ ัะพะทะดะฐัะผ ะฝะพะฒัะน ะฐะณัะตะณะฐั ัะพะณะพ ะถะต ัะธะฟะฐ ั ะฝะฐัะฐะปัะฝะพะน ะฝะฐัะฐะฑะพัะบะพะน ะธะท MP1
- ะัะปะธ ะทะฝะฐัะตะฝะธั ะพััััััะฒััั (ัะธะฟ ะฝะต ะฒัะฟััะบะฐะตััั) โ ะธัะตะผ ัะธะปัััะพะผ ะฐะณะตะฝัะฐ ั ัะพะน ะถะต `group_by` ะธ ะผะฐะบัะธะผะฐะปัะฝัะผ `idx`, ะธัะฟะพะปัะทัะตะผ ะตะณะพ `partseqno_i` ะดะปั ะฝะพะฒะพะณะพ ะฐะณัะตะณะฐัะฐ ั ะฝัะปะตะฒะพะน ะฝะฐัะฐะฑะพัะบะพะน

**ะขะตัะฝะธัะตัะบะธ:** ะะต ััะฐะฝะธะผ ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ัััััะธะบะธ ัะธะฟะพะฒ โ ะดะธะฝะฐะผะธัะตัะบะธะน ะฟะพะธัะบ ะฟะพ ะฐะณะตะฝัะฐะผ ะฑัััััะน (ะฐะณะตะฝัะพะฒ ะฒ ะณััะฟะฟะต ะฝะตะผะฝะพะณะพ).

**ะัะธะผะตัะฐะฝะธะต:** ะญัะพ ะฟัะพะธััะพะดะธั ะฟัะธ ะทะฐะผะตะฝะต, ั.ะต. ะฝะพะฒัะน ะฐะณัะตะณะฐั ะผะพะถะตั ัะพะทะดะฐะฒะฐัััั ััะฐะทั ะฒ `operations` (ัััะฐะฝะพะฒะปะตะฝ ะฝะฐ ะฟะปะฐะฝะตั), ะฐ ะฝะต ะพะฑัะทะฐัะตะปัะฝะพ ะฒ `reserve`.

**ะะฐัะฐ:** 31.10.2025

---

## 6. ะะะะะะะะฆะะฏ ะะะขะะะะะฆะะ SNE_NEW/PPR_NEW (31.10.2025)

### 6.1. ะัะพะฑะปะตะผะฐ
ะะปั spawn ะฐะณัะตะณะฐัะพะฒ ััะตะฑัะตััั ะฝะฐัะฐะปัะฝะฐั ะฝะฐัะฐะฑะพัะบะฐ (`sne`, `ppr`) ะธะท ัะฟัะฐะฒะพัะฝะธะบะฐ `md_components` (ะฟะพะปั `sne_new`, `ppr_new`). ะญัะธ ะทะฝะฐัะตะฝะธั ััะฐะฝัััั ะฒ **ัะฐัะฐั** ะฒ Excel-ะธััะพัะฝะธะบะต, ะฝะพ ัะธะผัะปััะธั ัะฐะฑะพัะฐะตั ะฒ **ะผะธะฝััะฐั**.

### 6.2. ะะตัะตะฝะธะต

**ะญัะฐะฟ 1: ETL (Extract)**
- **ะคะฐะนะป:** `code/md_components_loader.py`
- **ะะทะผะตะฝะตะฝะธั:**
  1. ะะพะฑะฐะฒะปะตะฝะฐ ะบะพะฝะฒะตััะฐัะธั `sne_new` ะธ `ppr_new` ะธะท ัะฐัะพะฒ ะฒ ะผะธะฝััั (ร 60)
  2. ะกะพััะฐะฝะตะฝะธะต `NULL` ะทะฝะฐัะตะฝะธะน (ะฟัะธะทะฝะฐะบ "ะฐะณัะตะณะฐั ะฝะต ะฒัะฟััะบะฐะตััั")
  3. ะะพััะตะบัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ `Nullable(UInt32)` ะฟัะธ ะฒััะฐะฒะบะต ะฒ ClickHouse

**ะญัะฐะฟ 2: ะกะธะผัะปััะธั (Transform)**
- **ะคะฐะนะป:** `code/sim_env_setup.py`
- **ะะทะผะตะฝะตะฝะธั:**
  1. ะะพะฒะฐั ััะฝะบัะธั `fetch_mp1_sne_ppr_new()` โ ะทะฐะณััะทะบะฐ `sne_new`/`ppr_new` ะธะท `md_components`
  2. ะะพะฝะฒะตััะฐัะธั `NULL` โ `SENTINEL` (0xFFFFFFFF) ะดะปั FLAME GPU Environment
  3. ะะพะฑะฐะฒะปะตะฝะธะต ะผะฐััะธะฒะพะฒ `mp1_sne_new` ะธ `mp1_ppr_new` ะฒ Environment

- **ะคะฐะนะป:** `code/sim_v2/base_model.py`
- **ะะทะผะตะฝะตะฝะธั:**
  1. ะะฑััะฒะปะตะฝะธะต Environment Property Arrays: `mp1_sne_new`, `mp1_ppr_new`
  2. ะกะพะทะดะฐะฝะธะต Environment constants: `mi17_sne_new_const`, `mi17_ppr_new_const`
  3. ะะพะฝะฒะตััะฐัะธั `SENTINEL` โ `0` ะดะปั RTC ะธัะฟะพะปัะทะพะฒะฐะฝะธั

- **ะคะฐะนะป:** `code/sim_v2/rtc_modules/rtc_spawn_v2.py`
- **ะะทะผะตะฝะตะฝะธั:**
  1. ะะฐะผะตะฝะฐ ัะฐัะดะบะพะดะฐ `0u` ะฝะฐ ััะตะฝะธะต ะธะท Environment constants
  2. ะะพะณะธัะพะฒะฐะฝะธะต ะฝะฐัะฐะปัะฝะพะน ะฝะฐัะฐะฑะพัะบะธ ะฟัะธ spawn

### 6.3. ะััะธัะตะบัััะฝัะต ัะตัะตะฝะธั

**ะะฑัะฐะฑะพัะบะฐ NULL ะทะฝะฐัะตะฝะธะน:**
- **ะ ะกะฃะะ:** `Nullable(UInt32)` โ NULL ะพะทะฝะฐัะฐะตั "ะฐะณัะตะณะฐั ะฝะต ะฒัะฟััะบะฐะตััั"
- **ะ FLAME GPU:** Sentinel value `0xFFFFFFFF` (Environment ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตั Nullable)
- **ะ RTC ะบะพะดะต:** Sentinel โ `0` (ะฝะพะฒัะน ะฐะณัะตะณะฐั ะฑะตะท ะฝะฐัะฐะฑะพัะบะธ)

**ะะพะฝะฒะตััะฐัะธั ะตะดะธะฝะธั:**
- **Excel ะธััะพัะฝะธะบ:** ัะฐัั (4500-7500)
- **ะกะฃะะ:** ะผะธะฝััั (270000-450000)
- **ะกะธะผัะปััะธั:** ะผะธะฝััั (ะฒัะต ัะฐััะตัั ะฒ ะผะธะฝััะฐั)

### 6.4. ะะฐะปะธะดะฐัะธั

**ะัะพะฒะตัะบะฐ ะกะฃะะ:**
```sql
SELECT partno, sne_new, ppr_new
FROM md_components
WHERE sne_new IS NOT NULL AND sne_new > 0
```

**ะะตะทัะปััะฐั:**
- ะขะ2-117ะ: 270000 ะผะธะฝัั (4500 ัะฐัะพะฒ) โ
- ะขะ3-117ะะ: 270000 ะผะธะฝัั (4500 ัะฐัะพะฒ) โ
- ะะ-9ะ: 360000 ะผะธะฝัั (6000 ัะฐัะพะฒ) โ
- ะะ-8ะ: 450000 ะผะธะฝัั (7500 ัะฐัะพะฒ) โ

**ะัะพะฒะตัะบะฐ ัะธะผัะปััะธะธ:**
- ะะพะปะฝัะน ะฟัะพะณะพะฝ 3650 ะดะฝะตะน: โ ะฃัะฟะตัะฝะพ
- Spawn ะฟะปะฐะฝะตัะพะฒ (Mi-17): `sne=0, ppr=0` โ (ะดะปั ะฟะปะฐะฝะตัะพะฒ ะฟัะฐะฒะธะปัะฝะพ)
- ะัะณััะทะบะฐ MP2: 1039632 ัััะพะบ ะทะฐ 21.71ั โ

### 6.5. ะัะพะณะธ

โ **ะะฝัะตะณัะฐัะธั ะทะฐะฒะตััะตะฝะฐ:**
1. ETL ะบะพััะตะบัะฝะพ ะบะพะฝะฒะตััะธััะตั ัะฐััโะผะธะฝััั ั ัะพััะฐะฝะตะฝะธะตะผ NULL
2. ะกะธะผัะปััะธั ะทะฐะณััะถะฐะตั ะทะฝะฐัะตะฝะธั ัะตัะตะท MP1 arrays
3. RTC spawn ะณะพัะพะฒ ะธัะฟะพะปัะทะพะฒะฐัั `sne_new`/`ppr_new` ะดะปั ะฐะณัะตะณะฐัะพะฒ
4. ะะปั ะฟะปะฐะฝะตัะพะฒ (Mi-17) spawn ะธัะฟะพะปัะทัะตั `0` (ะฟัะฐะฒะธะปัะฝะพะต ะฟะพะฒะตะดะตะฝะธะต)

**ะะฐัะฐ ัะตะฐะปะธะทะฐัะธะธ:** 31.10.2025

---

**ะกัะฐััั:** โ ะััะธัะตะบัััะฐ ัะพะณะปะฐัะพะฒะฐะฝะฐ. ะะฝัะตะณัะฐัะธั sne_new/ppr_new ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะธ ะฟัะพัะตััะธัะพะฒะฐะฝะฐ (31.10.2025).

---

## 7. ะะกะะะซะ ะกะะฃะงะะ ะะะะะะขะ/ะะะะะะะะะฏ

### 7.1. ะะพะฟะฐััะธ (group_by=6): ะฟัะพะดะปะตะฝะธะต ะฑะตะท ะพะฑะฝัะปะตะฝะธั ppr

**ะะฐัะฐ ะดะพะฑะฐะฒะปะตะฝะธั:** 02.01.2026

**ะัะพะฑะปะตะผะฐ:**
ะะพะฟะฐััะธ (group_by=6, ะฝะพะผะตะฝะบะปะฐัััั `8ะะข-2710-00`, `8ะะข.2710.000`) ะฝะต ะฟัะพัะพะดัั ะบะฐะฟะธัะฐะปัะฝัะน ัะตะผะพะฝั ะฒ ะบะปะฐััะธัะตัะบะพะผ ะฟะพะฝะธะผะฐะฝะธะธ. ะะผะตััะพ ััะพะณะพ ะฟัะธะผะตะฝัะตััั **ะฟัะพะดะปะตะฝะธะต ะฝะฐะทะฝะฐัะตะฝะฝะพะณะพ ัะตััััะฐ** โ ะฐะณัะตะณะฐั ะฟัะพะดะพะปะถะฐะตั ัะบัะฟะปัะฐัะฐัะธั ะฑะตะท ะพะฑะฝัะปะตะฝะธั ะฝะฐัะฐะฑะพัะบะธ.

**ะะตัะตะฝะธะต:**

1. **ะะฐะปะธะดะฐัะธั (validate_heli_pandas.py):**
   - ะะปั group_by=6 **ะะ ะฟัะพะฒะตััะตััั** ััะปะพะฒะธะต `ppr > oh`
   - ะัะพะฒะตัะบะฐ `sne > ll` ะพััะฐัััั ะฐะบัะธะฒะฝะพะน
   - ะะฑะพัะฝะพะฒะฐะฝะธะต: ppr ะฝะฐะบะฐะฟะปะธะฒะฐะตััั ะฑะตะท ะพะฑะฝัะปะตะฝะธั, ะฟัะตะฒััะตะฝะธะต oh โ ััะฐัะฝะฐั ัะธััะฐัะธั

2. **ะกะธะผัะปััะธั (RTC spawn/repair):**
   - ะัะธ "ัะตะผะพะฝัะต" (ะฟัะพะดะปะตะฝะธะธ) ะปะพะฟะฐััะตะน **ะะ ะพะฑะฝัะปัะตะผ ppr**
   - ะะณัะตะณะฐั ะฒะพะทะฒัะฐัะฐะตััั ะฒ ัะบัะฟะปัะฐัะฐัะธั ั ัะตะผ ะถะต ะทะฝะฐัะตะฝะธะตะผ ppr
   - ะะพะฝััะพะปั ะฟะพ `sne > ll` ะพััะฐัััั ะบัะธัะธัะฝัะผ

**ะขะตัะฝะธัะตัะบะธ ะฒ RTC:**
```cuda
// ะัะธ ะฒะพะทะฒัะฐัะต ะฐะณัะตะณะฐัะฐ ะธะท ัะตะผะพะฝัะฐ:
if (group_by == 6) {
    // ะะพะฟะฐััะธ: ppr ะะ ะพะฑะฝัะปัะตััั (ะฟัะพะดะปะตะฝะธะต, ะฝะต ัะตะผะพะฝั)
    // ppr ัะพััะฐะฝัะตั ะฝะฐะบะพะฟะปะตะฝะฝะพะต ะทะฝะฐัะตะฝะธะต
} else {
    // ะััะฐะปัะฝัะต ะฐะณัะตะณะฐัั: ะบะปะฐััะธัะตัะบะธะน ัะตะผะพะฝั
    ppr = 0;  // ะะฑะฝัะปะตะฝะธะต ะฟะพัะปะต ะบะฐะฟัะตะผะพะฝัะฐ
}
```

**ะะตััััั ะปะพะฟะฐััะตะน ะฒ md_components:**
| partno | ll_mi8 | ll_mi17 | oh_mi8 | oh_mi17 |
|--------|--------|---------|--------|---------|
| 8ะะข-2710-00 | 150,000 | 150,000 | 120,000 | 120,000 |
| 8ะะข.2710.000 | 150,000 | 150,000 | 120,000 | 120,000 |

**ะัะธะผะตัะฐะฝะธะต:** oh ะดะปั ะปะพะฟะฐััะตะน ัะฐะบัะธัะตัะบะธ ะพะทะฝะฐัะฐะตั "ะธะฝัะตัะฒะฐะป ะดะพ ะพัะตัะตะดะฝะพะณะพ ะฟัะพะดะปะตะฝะธั", ะฐ ะฝะต "ะผะตะถัะตะผะพะฝัะฝัะน ัะตัััั" ะฒ ะบะปะฐััะธัะตัะบะพะผ ะฟะพะฝะธะผะฐะฝะธะธ.

### 7.2. ะะปะฐะฝะตัั Mi-17: ะฟะพัะพะณ ะผะตะถัะตะผะพะฝัะฝะพะณะพ ะดะปั ะฟะพะดััะผะฐ ะธะท inactive (br2_mi17)

**ะะฐัะฐ ะดะพะฑะฐะฒะปะตะฝะธั:** 04.01.2026

**ะัะพะฑะปะตะผะฐ:**
ะัะธ ะฟะพะดััะผะต Mi-17 ะธะท inactive (ะบะฐะฝะฝะธะฑะฐะปะธะทะพะฒะฐะฝะฝัั ะฒะตััะพะปััะพะฒ) ััะตะฑัะตััั ะฟัะธะฝััั ัะตัะตะฝะธะต:
- **ะะตะผะพะฝั** (ะพะฑะฝัะปะตะฝะธะต ppr) โ ะดะพัะพะณะพ, ะฝะพ ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐะตั ะฟะพะปะฝัะน ะผะตะถัะตะผะพะฝัะฝัะน ัะตัััั
- **ะะพะผะฟะปะตะบัะฐัะธั ะฑะตะท ัะตะผะพะฝัะฐ** (ppr ัะพััะฐะฝัะตััั) โ ะดะตัะตะฒะปะต, ะฝะพ ะฟะพะทะถะต ะฟัะธะดัััั ะณะฝะฐัั ะฝะฐ ะฑะฐะทั ะฟะพะฒัะพัะฝะพ

**ะญะบะพะฝะพะผะธะบะฐ:**
- ะะตัะตะณะพะฝ ะฝะฐ ะฑะฐะทั ะดะปั ะบะฐะฟัะตะผะพะฝัะฐ โ 20 ะปััะฝัั ัะฐัะพะฒ
- ะญัะพ 20-25% ััะพะธะผะพััะธ ะบะฐะฟัะตะผะพะฝัะฐ ะฒ ะฟะพัะตััะฝะฝะพะน ะฒััััะบะต
- ะะพัะพะณ ะฟัะธะฝััะธั ัะตัะตะฝะธั: 3500 ัะฐัะพะฒ ะธะท 4500 ัะฐัะพะฒ (oh)

**ะะตัะตะฝะธะต:**

1. **ะะพะฒะพะต ะฟะพะปะต `br2_mi17` ะฒ md_components:**
   - ะะปั group_by=2 (Mi-17): br2_mi17 = 210,000 ะผะธะฝัั (3500 ัะฐัะพะฒ)
   - ะะปั group_by=1 (Mi-8): ะฝะต ะธัะฟะพะปัะทัะตััั (ะฒัะตะณะดะฐ ัะตะผะพะฝั)

2. **ะะพะณะธะบะฐ ะฒ RTC (`rtc_apply_1_to_2`):**

| ppr | ะะตะนััะฒะธะต | ะะฑะพัะฝะพะฒะฐะฝะธะต |
|-----|----------|-------------|
| **< br2_mi17** (< 3500ั) | ะะพะดััะผ **ะะะ ัะตะผะพะฝัะฐ** (ppr ัะพััะฐะฝัะตััั) | ะััะฐัะพะบ > 1000ั โ ะดะตัะตะฒะปะต ะปะตัะฐัั ะฑะตะท ัะตะผะพะฝัะฐ |
| **โฅ br2_mi17** (โฅ 3500ั) | ะะพะดััะผ **ะก ัะตะผะพะฝัะพะผ** (ppr = 0) | ะััะฐัะพะบ < 1000ั โ ะดะตัะตะฒะปะต ััะฐะทั ัะดะตะปะฐัั ะบะฐะฟัะตะผะพะฝั |

**ะขะตัะฝะธัะตัะบะธ ะฒ RTC:**
```cuda
// ะัะธ ะฟะตัะตัะพะดะต inactive โ operations:
const unsigned int br2_mi17 = FLAMEGPU->environment.getProperty<unsigned int>("mi17_br2_const");

if (group_by == 1u) {
    // Mi-8: ะฒัะตะณะดะฐ ัะตะผะพะฝั โ PPR = 0
    FLAMEGPU->setVariable<unsigned int>("ppr", 0u);
} else if (group_by == 2u && ppr >= br2_mi17) {
    // Mi-17 ั ppr >= ะฟะพัะพะณะฐ (3500ั): ัะตะผะพะฝั โ PPR = 0
    FLAMEGPU->setVariable<unsigned int>("ppr", 0u);
}
// Mi-17 ั ppr < ะฟะพัะพะณะฐ: PPR ัะพััะฐะฝัะตััั (ะบะพะผะฟะปะตะบัะฐัะธั ะฑะตะท ัะตะผะพะฝัะฐ)
```

**ะะฝะฐะปะพะณะธั ั br (breakeven repair ะดะปั sne/ll):**
- `br` โ ะฟะพัะพะณ ะดะปั ะฝะฐะทะฝะฐัะตะฝะฝะพะณะพ ัะตััััะฐ (sne/ll): ะตัะปะธ sne > br, ะดะตัะตะฒะปะต ัะฟะธัะฐัั ะฐะณัะตะณะฐั
- `br2` โ ะฟะพัะพะณ ะดะปั ะผะตะถัะตะผะพะฝัะฝะพะณะพ ัะตััััะฐ (ppr/oh): ะตัะปะธ ppr โฅ br2, ะดะตัะตะฒะปะต ัะดะตะปะฐัั ัะตะผะพะฝั

3. **ะัะพะฟััะบ ะพะถะธะดะฐะฝะธั repair_time (`rtc_quota_promote_inactive`):**

   Mi-17 ั ะฝะธะทะบะธะผ ppr ะฝะต ัะพะปัะบะพ ัะพััะฐะฝััั ppr, ะฝะพ ะธ **ะฟัะพะฟััะบะฐัั ะพะถะธะดะฐะฝะธะต ัะตะผะพะฝัะฐ**:
   
   | ppr | ะะถะธะดะฐะฝะธะต repair_time | ะะฑะพัะฝะพะฒะฐะฝะธะต |
   |-----|---------------------|-------------|
   | **< br2_mi17** | **ะัะพะฟััะบะฐะตั** | ะะพะผะฟะปะตะบัะฐัะธั โ ะฑะพัั ััะฐะทั ะณะพัะพะฒ |
   | **โฅ br2_mi17** | **ะะดัั** | ะะตะผะพะฝั โ ะฑะพัั ะถะดัั repair_time ะดะฝะตะน |
   
   **ะญััะตะบั:** ััะบะพัะตะฝะธะต ะฒัะพะดะฐ ะฒ ัะบัะฟะปัะฐัะฐัะธั ะฝะฐ ~43 ะดะฝั ะดะปั ะบะพะผะฟะปะตะบััะตะผัั ะฑะพััะพะฒ.

**ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั:**
| AC | ppr (ะผะธะฝ) | ppr (ั) | ะะถะธะดะฐะฝะธะต | ะะตัะตะฝะธะต |
|----|-----------|---------|----------|---------|
| 25434 | 207,067 | 3,451 | ะัะพะฟััะบ | ะะพะผะฟะปะตะบัะฐัะธั โ |
| 27071 | 37,377 | 623 | ะัะพะฟััะบ | ะะพะผะฟะปะตะบัะฐัะธั โ |
| 22378 | 435 | 7 | ะัะพะฟััะบ | ะะพะผะฟะปะตะบัะฐัะธั โ |
| ะััะฐะปัะฝัะต | โฅ 210,000 | โฅ 3,500 | repair_time | ะะตะผะพะฝั โ |

---

## 8. ะะะฅะะขะะะขะฃะะ ะะะะะะซ ะะะะะะะขะะ (FIFO-ะะงะะะะะฌ)

**ะะฐัะฐ ะดะพะฑะฐะฒะปะตะฝะธั:** 05.01.2026

### 8.1. ะัะพะฑะปะตะผะฐ

ะัะธ ะฒััะพะดะต ะฐะณัะตะณะฐัะฐ ะธะท ัััะพั (ppr โฅ oh ะธะปะธ sne โฅ ll) ะฝะตะพะฑัะพะดะธะผะพ:
1. ะะฐะนัะธ ะทะฐะผะตะฝั ะฝะฐ ัะบะปะฐะดะต ะธัะฟัะฐะฒะฝัั
2. ะะตัะตะดะฐัั ัะธะณะฝะฐะป ะพั ะฝะตะธัะฟัะฐะฒะฝะพะณะพ ะฐะณัะตะณะฐัะฐ ะบ ะทะฐะผะตะฝะต
3. ะะทะผะตะฝะธัั `aircraft_number` (location) ั ะพะฑะพะธั ะฐะณัะตะณะฐัะพะฒ
4. ะะฐัะฐะฝัะธัะพะฒะฐัั ัะฝะธะบะฐะปัะฝะพััั ะทะฐะผะตะฝั (1:1)

**ะะณัะฐะฝะธัะตะฝะธะต:** Host-ััะฝะบัะธะธ ะฝะฐัััะฐัั GPU-ัะธะผัะปััะธั, ะฟะพััะพะผั ะฒัั ะดะพะปะถะฝะพ ัะฐะฑะพัะฐัั ะฝะฐ GPU ัะตัะตะท RTC.

### 8.2. ะะตัะตะฝะธะต: FIFO-ะพัะตัะตะดั ะฝะฐ GPU

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะกะะะะ ะะกะะะะะะซะฅ (reserve + serviceable)                    โ
โ                                                             โ
โ  queue_position:  0    1    2    3    4    ...   N         โ
โ                   โฒ                              โฒ          โ
โ               ััะฐััะต                          ะฝะพะฒัะต         โ
โ               (ะฟะตัะฒัะต ะฝะฐ ะฒัะดะฐัั)            (ะฟะพัะปะตะดะฝะธะต)     โ
โ                   โ                              โ          โ
โ              queue_head                     queue_tail      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะธะฝัะธะฟ FIFO:**
- ะกะฐะผัะต ััะฐััะต ะฐะณัะตะณะฐัั (ะฟะพ mfg_date ะธะปะธ ะฟะพััะดะบั ะฟัะธะฑััะธั) ะฒัะดะฐัััั ะฟะตัะฒัะผะธ
- ะะพะฒัะต ะฐะณัะตะณะฐัั ะฟะพะปััะฐัั ัะปะตะดัััะธะน ะธะฝะดะตะบั `queue_tail + 1`
- UInt32 ะดะพััะฐัะพัะฝะพ ะดะปั ะธะฝะดะตะบัะพะฒ (4 ะผะปัะด > 10 ะปะตั ร 365 ะดะฝะตะน ร 10,000 ะฐะณัะตะณะฐัะพะฒ)

### 8.3. ะะพะฒัะต ะฟะตัะตะผะตะฝะฝัะต

**ะะณะตะฝั:**
| ะะตัะตะผะตะฝะฝะฐั | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------------|-----|----------|
| `queue_position` | UInt32 | ะะพะทะธัะธั ะฒ FIFO ะพัะตัะตะดะธ ะฒะฝัััะธ group_by |

**MacroProperty:**
| ะะตัะตะผะตะฝะฝะฐั | ะะฐะทะผะตั | ะะฟะธัะฐะฝะธะต |
|------------|--------|----------|
| `mp_queue_head[25]` | UInt32 ร 25 | ะะพะปะพะฒะฐ ะพัะตัะตะดะธ ะฟะพ group_by (ัะปะตะดัััะธะน ะฝะฐ ะฒัะดะฐัั) |
| `mp_queue_tail[25]` | UInt32 ร 25 | ะฅะฒะพัั ะพัะตัะตะดะธ ะฟะพ group_by (ัะปะตะดัััะธะน ะธะฝะดะตะบั ะดะปั ะฝะพะฒัั) |
| `mp_replacement_request[MAX_FRAMES]` | UInt32 | aircraft_number ะดะปั ะทะฐะผะตะฝั (0 = ะฝะตั ะทะฐะฟัะพัะฐ) |

### 8.4. ะะปะณะพัะธัะผ

**ะะฝะธัะธะฐะปะธะทะฐัะธั (setup_env):**
```python
# ะกะพััะธัะพะฒะบะฐ ะฟะพ mfg_date ะฒะฝัััะธ ะบะฐะถะดะพะน group_by
for group_by in range(3, 25):
    pool_agents = [a for a in agents if a.group_by == group_by and a.state in [reserve, serviceable]]
    pool_agents.sort(key=lambda a: a.mfg_date)
    
    for i, agent in enumerate(pool_agents):
        agent.queue_position = i
    
    mp_queue_head[group_by] = 0                # ะะตัะฒัะน ะฝะฐ ะฒัะดะฐัั
    mp_queue_tail[group_by] = len(pool_agents) # ะกะปะตะดัััะธะน ะธะฝะดะตะบั ะดะปั ะฝะพะฒัั
```

**RTC: ะะตะธัะฟัะฐะฒะฝัะน ะฐะณัะตะณะฐั ะทะฐะฟัะฐัะธะฒะฐะตั ะทะฐะผะตะฝั:**
```cuda
FLAMEGPU_AGENT_FUNCTION(rtc_request_replacement, ...) {
    const unsigned int ppr = FLAMEGPU->getVariable<unsigned int>("ppr");
    const unsigned int oh = FLAMEGPU->getVariable<unsigned int>("oh");
    const unsigned int sne = FLAMEGPU->getVariable<unsigned int>("sne");
    const unsigned int ll = FLAMEGPU->getVariable<unsigned int>("ll");
    
    // ะฃัะปะพะฒะธะต ะทะฐะผะตะฝั: ppr >= oh ะะะ sne >= ll
    if (ppr >= oh || sne >= ll) {
        const unsigned int my_idx = FLAMEGPU->getVariable<unsigned int>("idx");
        const unsigned int my_ac = FLAMEGPU->getVariable<unsigned int>("aircraft_number");
        
        // ะะธัะตะผ ะทะฐะฟัะพั ะฒ MacroProperty
        auto& requests = FLAMEGPU->environment.getMacroProperty<unsigned int, MAX_FRAMES>("mp_replacement_request");
        requests[my_idx] = my_ac;  // ะะฐะฟัะพั: ะฝัะถะฝะฐ ะทะฐะผะตะฝะฐ ะดะปั ััะพะณะพ ะฑะพััะฐ
    }
    
    return flamegpu::ALIVE;
}
```

**RTC: ะะณัะตะณะฐั ะธะท ะฟัะปะฐ ะฟัะพะฒะตััะตั FIFO-ะพัะตัะตะดั:**
```cuda
FLAMEGPU_AGENT_FUNCTION(rtc_check_fifo_assignment, ...) {
    const unsigned int group_by = FLAMEGPU->getVariable<unsigned int>("group_by");
    const unsigned int my_position = FLAMEGPU->getVariable<unsigned int>("queue_position");
    const unsigned int state = cycleVariable...  // reserve ะธะปะธ serviceable
    
    // ะขะพะปัะบะพ ะฐะณะตะฝัั ะฒ ะฟัะปะต ััะฐััะฒััั
    if (state != STATE_RESERVE && state != STATE_SERVICEABLE) {
        return flamegpu::ALIVE;
    }
    
    auto& queue_head = FLAMEGPU->environment.getMacroProperty<unsigned int, 25>("mp_queue_head");
    
    // ะงะธัะฐะตะผ ัะตะบัััั ะณะพะปะพะฒั ะพัะตัะตะดะธ ะดะปั ะผะพะตะน ะณััะฟะฟั
    unsigned int current_head = queue_head[group_by];
    
    // ะัะปะธ ะผะพั ะฟะพะทะธัะธั == ะณะพะปะพะฒะฐ โ ั ัะปะตะดัััะธะน ะฝะฐ ะฒัะดะฐัั
    if (my_position == current_head) {
        // ะัะพะผะฐัะฝะพ ะฟััะฐััั "ะทะฐะฝััั" ัะปะพั
        unsigned int expected = current_head;
        unsigned int result = queue_head[group_by].compare_exchange(expected, current_head + 1);
        
        if (result == expected) {
            // ะฏ ะฒัะธะณัะฐะป! ะัั ะทะฐะฟัะพั ะดะปั ะผะพะตะน ะณััะฟะฟั ะฒ mp_replacement_request
            // ... (ััะตะฝะธะต ะทะฐะฟัะพัะฐ, ัััะฐะฝะพะฒะบะฐ aircraft_number, ะฟะตัะตัะพะด ะฒ operations)
        }
    }
    
    return flamegpu::ALIVE;
}
```

**RTC: ะะณัะตะณะฐั ะฒะพะทะฒัะฐัะฐะตััั ะฒ ะฟัะป (ะธะท ัะตะผะพะฝัะฐ):**
```cuda
FLAMEGPU_AGENT_FUNCTION(rtc_return_to_pool, ...) {
    const unsigned int group_by = FLAMEGPU->getVariable<unsigned int>("group_by");
    
    // ะัะพะผะฐัะฝะพ ะฟะพะปััะฐะตะผ ัะปะตะดัััะธะน ะธะฝะดะตะบั ะฒ ะพัะตัะตะดะธ
    auto& queue_tail = FLAMEGPU->environment.getMacroProperty<unsigned int, 25>("mp_queue_tail");
    unsigned int my_position = queue_tail[group_by].exchange(queue_tail[group_by] + 1);
    
    FLAMEGPU->setVariable<unsigned int>("queue_position", my_position);
    FLAMEGPU->setVariable<unsigned int>("aircraft_number", 0u);  // ะกะฝัั ั ะฑะพััะฐ
    // state โ reserve
    
    return flamegpu::ALIVE;
}
```

### 8.5. ะะพะปะฝัะน ัะธะบะป ะทะฐะผะตะฝั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะตะฝั D: ะะฑะฝะฐััะถะตะฝะธะต ะฝะตะธัะฟัะฐะฒะฝะพััะธ                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะะณัะตะณะฐั A (ะฝะฐ ะฑะพััั 25434):                                โ
โ  โโโ ppr = 271,000 >= oh = 270,000                          โ
โ  โโโ intent_state = 4 (ัะตะผะพะฝั)                              โ
โ  โโโ ะะธัะตั: mp_replacement_request[A.idx] = 25434           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะตะฝั D: FIFO-ะฒัะฑะพั ะทะฐะผะตะฝั                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะะณัะตะณะฐั B (ะฒ ะฟัะปะต, group_by=4):                            โ
โ  โโโ queue_position = 0 (ัะฐะผัะน ััะฐััะน)                      โ
โ  โโโ queue_head[4] = 0 โ B == head โ B ะฒัะธะณััะฒะฐะตั           โ
โ  โโโ atomicCAS โ queue_head[4] = 1                          โ
โ  โโโ ะงะธัะฐะตั ะทะฐะฟัะพั โ aircraft_number = 25434                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะตะฝั D+1: ะัะธะผะตะฝะตะฝะธะต ะทะฐะผะตะฝั                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะะณัะตะณะฐั A:                                                 โ
โ  โโโ aircraft_number = 0 (ัะฝัั)                             โ
โ  โโโ state = repair (ะฒ ัะตะผะพะฝั)                              โ
โ  โโโ location = "ะกะะะะ"                                     โ
โ                                                             โ
โ  ะะณัะตะณะฐั B:                                                 โ
โ  โโโ aircraft_number = 25434 (ัััะฐะฝะพะฒะปะตะฝ)                   โ
โ  โโโ state = operations                                     โ
โ  โโโ location = "RA-25434"                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 8.6. ะกะฒัะทั ั assembly_trigger ะฟะปะฐะฝะตัะฐ

**assembly_trigger** โ ัะธะณะฝะฐะป ะพั ะฟะปะฐะฝะตัะฐ ะฝะฐ ะบะพะผะฟะปะตะบัะฐัะธั:
- ะะปะฐะฝะตั ะฟะตัะตัะพะดะธั ะฒ `repair` โ ัััะฐะฝะฐะฒะปะธะฒะฐะตััั `assembly_trigger = 1`
- ะะณัะตะณะฐัั ะฝะฐ ะฟะปะฐะฝะตัะต **ะพััะฐัััั ะฝะฐ ะผะตััะต** (location = ะฟะปะฐะฝะตั, ะฑะตะท ะฝะฐัะฐะฑะพัะบะธ dt=0)
- ะะพ ะทะฐะฒะตััะตะฝะธะธ ัะตะผะพะฝัะฐ ะฟะปะฐะฝะตัะฐ ะฐะณัะตะณะฐัั ะฟัะพะฒะตัััััั ะฝะฐ ัะตัััั
- ะัะปะธ ะฐะณัะตะณะฐั ะธััะตัะฟะฐะป ัะตัััั โ ะทะฐะผะตะฝะฐ ะฟะพ FIFO-ะพัะตัะตะดะธ
- ะัะปะธ ะฐะณัะตะณะฐั ะธัะฟัะฐะฒะตะฝ โ ะพััะฐัััั ะฝะฐ ะฟะปะฐะฝะตัะต

**ะะปะพะบะธัะพะฒะบะฐ ัะฝััะธั:**
- ะะณัะตะณะฐัั ะฝะฐ ะฟะปะฐะฝะตัะต ะฒ `repair` ะะ ะผะพะณัั ะฑััั ัะฝััั ะดะพ ะทะฐะฒะตััะตะฝะธั ัะตะผะพะฝัะฐ
- ะญัะพ ะบะพะฝััะพะปะธััะตััั ัะตัะตะท ััะฐััั ะฟะปะฐะฝะตัะฐ (ะฝะต ัะตัะตะท ะพัะดะตะปัะฝัะน ัะปะฐะณ ะฐะณัะตะณะฐัะฐ)

### 8.7. ะัะตะธะผััะตััะฒะฐ ะฐััะธัะตะบัััั

| ะะปัั | ะะฟะธัะฐะฝะธะต |
|------|----------|
| **ะะตะท Host** | ะัั ะฝะฐ GPU, ะฝะตั ัะธะฝััะพะฝะธะทะฐัะธะธ ั CPU |
| **FIFO ะณะฐัะฐะฝัะธัะพะฒะฐะฝ** | ะกะฐะผัะต ััะฐััะต ะฐะณัะตะณะฐัั ััะพะดัั ะฟะตัะฒัะผะธ |
| **ะัะพะผะฐัะฝะพััั** | `compare_exchange` ะธัะบะปััะฐะตั ะดัะฑะปะธ ะทะฐะผะตะฝ |
| **UInt32 ัะฒะฐัะธั** | 4 ะผะปัะด ะพะฟะตัะฐัะธะน ะฝะฐ ะฒะตัั ะณะพัะธะทะพะฝั ัะธะผัะปััะธะธ |
| **ะะตัะตะฝััะฐะปะธะทะพะฒะฐะฝะพ** | ะะฐะถะดัะน ะฐะณัะตะณะฐั ะพัะฒะตัะฐะตั ะทะฐ ัะตะฑั |
| **ะัะพััะฐั ะพัะปะฐะดะบะฐ** | queue_position ะทะฐะฟะธััะฒะฐะตััั ะฒ MP2 |

### 8.8. ะกัะฐััั ัะตะฐะปะธะทะฐัะธะธ

| ะะพะผะฟะพะฝะตะฝั | ะกัะฐััั | ะัะธะผะตัะฐะฝะธะต |
|-----------|--------|------------|
| `queue_position` ะฒ ะฐะณะตะฝัะต | ๐ฒ TODO | ะะพะฑะฐะฒะธัั ะฟะตัะตะผะตะฝะฝัั |
| `mp_queue_head/tail` | ๐ฒ TODO | MacroProperty ะฟะพ group_by |
| `mp_replacement_request` | ๐ฒ TODO | ะะฐััะธะฒ ะทะฐะฟัะพัะพะฒ |
| ะะฝะธัะธะฐะปะธะทะฐัะธั FIFO | ๐ฒ TODO | ะกะพััะธัะพะฒะบะฐ ะฟะพ mfg_date |
| RTC rtc_request_replacement | ๐ฒ TODO | ะะฐะฟัะพั ะทะฐะผะตะฝั |
| RTC rtc_check_fifo_assignment | ๐ฒ TODO | FIFO-ะฒัะฑะพั |
| RTC rtc_return_to_pool | ๐ฒ TODO | ะะพะทะฒัะฐั ะฒ ะพัะตัะตะดั |
| ะะฝัะตะณัะฐัะธั ั assembly_trigger | ๐ฒ TODO | ะกะฒัะทั ั ัะตะผะพะฝัะพะผ ะฟะปะฐะฝะตัะฐ |

**ะะฐัะฐ ะดะพะฑะฐะฒะปะตะฝะธั:** 05.01.2026

