# üêõ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 08-10-2025  
**–°—Ç–∞—Ç—É—Å:** –ù–ê–ô–î–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º:** Serviceable —Ä–∞—Å—Ç—ë—Ç –¥–æ 117-124 –∞–≥–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Ü–µ–ª–µ–≤–æ–π –∫–≤–æ—Ç–µ operations=85

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- Target = 85 (–∏–∑ MP4)
- Curr (–≤ operations) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚âà85
- Serviceable –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º (–æ—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å–ª–µ –∫–≤–æ—Ç—ã)

**–†–µ–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- Target = 85
- Curr = ??? (–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ)
- Serviceable = 117-124
- **–ü—Ä–æ–º–æ—É—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å deficit=20** (target - used = 85 - 65 = 20)

---

## üîç –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

### –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –≤ `rtc_quota_promote_serviceable.py`:

```cpp
// –®–ê–ì 1: –ü–æ–¥—Å—á—ë—Ç used (–æ–¥–æ–±—Ä–µ–Ω–æ –≤ –¥–µ–º–æ—É—Ç–µ)
unsigned int used = 0u;
auto approve = FLAMEGPU->environment.getMacroProperty<unsigned int, MAX_FRAMES>("mi17_approve");
for (unsigned int i = 0u; i < frames; ++i) {
    if (approve[i] == 1u) ++used;  // <-- –°—á–∏—Ç–∞–µ–º –¥–µ–º–æ—É–Ω—Ç–æ–≤!
}
target = FLAMEGPU->environment.getProperty<unsigned int>("mp4_ops_counter_mi17", safe_day);

const int deficit = (int)target - (int)used;  // <-- –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `used` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤, –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –∫ **–î–ï–ú–û–£–¢–£** (–ø–µ—Ä–µ—Ö–æ–¥ 2‚Üí3), –∞ –ù–ï —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ operations!

---

## üìä –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

### –î–µ–Ω—å 226:

1. **–î–µ–º–æ—É—Ç (`quota_ops_excess`):**
   - –°—á–∏—Ç–∞–µ—Ç `curr` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ operations (–¥–æ–ø—É—Å—Ç–∏–º, 150)
   - `balance = curr - target = 150 - 85 = 65` (–∏–∑–±—ã—Ç–æ–∫!)
   - –ü–æ–º–µ—á–∞–µ—Ç 65 –∞–≥–µ–Ω—Ç–æ–≤ –∫ –¥–µ–º–æ—É—Ç—É ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `mi17_approve[i] = 1`

2. **–ü—Ä–æ–º–æ—É—Ç P1 (`quota_promote_serviceable`):**
   - –°—á–∏—Ç–∞–µ—Ç `used` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–º–µ—á–µ–Ω–Ω—ã—Ö –∫ –¥–µ–º–æ—É—Ç—É = 65
   - `deficit = target - used = 85 - 65 = 20`
   - –ü—Ä–æ–º–æ—É—Ç–∏—Ç 20 –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ serviceable

3. **–ü–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π:**
   - 65 –∞–≥–µ–Ω—Ç–æ–≤: operations ‚Üí serviceable (–¥–µ–º–æ—É—Ç)
   - 20 –∞–≥–µ–Ω—Ç–æ–≤: serviceable ‚Üí operations (–ø—Ä–æ–º–æ—É—Ç)
   - **–ß–∏—Å—Ç—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** -45 –∞–≥–µ–Ω—Ç–æ–≤ –≤ operations!

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å:**
   - Operations: 150 - 65 + 20 = 105
   - Serviceable: —Å—Ç–∞—Ä–æ–µ + 65 - 20 = —Ä–∞—Å—Ç—ë—Ç –Ω–∞ 45!

---

## ‚ùå –ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**`used`** –≤ –ø—Ä–æ–º–æ—É—Ç–µ –¥–æ–ª–∂–Ω–æ –æ–∑–Ω–∞—á–∞—Ç—å **—Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ operations**, –∞ –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –∫ –¥–µ–º–æ—É—Ç—É!

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:**
```cpp
// –°—á–∏—Ç–∞–µ–º –†–ï–ê–õ–¨–ù–û–ï –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ operations –°–ï–ô–ß–ê–°
unsigned int curr = 0u;
for (unsigned int i = 0u; i < frames; ++i) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–≥–µ–Ω—Ç i –í OPERATIONS (state=2)
    if (agent[i].state == OPERATIONS) ++curr;
}

const int deficit = (int)target - (int)curr;
```

**–ù–æ:** –í FLAME GPU 2 –Ω–µ–ª—å–∑—è —á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥—Ä—É–≥–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞–ø—Ä—è–º—É—é!

---

## üí° –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –î–≤—É—Ö—Ñ–∞–∑–Ω–æ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –≤ sim_master)

**–§–∞–∑–∞ 1:** –ü–æ–¥—Å—á—ë—Ç —Ç–µ–∫—É—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π —á–µ—Ä–µ–∑ MacroProperty
```cpp
// –í –æ—Ç–¥–µ–ª—å–Ω–æ–º RTC —Å–ª–æ–µ –î–û –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
// –ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç –≤ operations –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥
if (state == OPERATIONS && group_by == 2) {
    auto ops_flags = FLAMEGPU->environment.getMacroProperty<unsigned int, MAX_FRAMES>("mi17_ops_flags");
    ops_flags[idx] = 1u;
}
```

**–§–∞–∑–∞ 2:** –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ curr
```cpp
// –í –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:
unsigned int curr = 0u;
auto ops_flags = FLAMEGPU->environment.getMacroProperty<unsigned int, MAX_FRAMES>("mi17_ops_flags");
for (unsigned int i = 0u; i < frames; ++i) {
    if (ops_flags[i] == 1u) ++curr;
}

const int balance = (int)curr - (int)target;

if (balance > 0) {
    // –î–µ–º–æ—É—Ç: –±–µ—Ä—ë–º balance –ø–µ—Ä–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
} else {
    // –ü—Ä–æ–º–æ—É—Ç: –±–µ—Ä—ë–º -balance –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ serviceable
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å agent count –∏–∑ Flame GPU API

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ API –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é.

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–∏–∞–≥–Ω–æ–∑:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ `curr` –≤ operations
2. ‚¨ú **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç curr
3. ‚¨ú **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ serviceable —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
4. ‚¨ú **–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ spawn:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

---

**–í—ã–≤–æ–¥:** –ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ spawn –∏ –ù–ï –≤ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–∏, –∞ –≤ **–±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–µ –ø–æ–¥—Å—á—ë—Ç–∞ deficit**!

–ë—É—Ñ–µ—Ä `mi17_approve` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∏ –≤ –¥–µ–º–æ—É—Ç–µ, –∏ –≤ –ø—Ä–æ–º–æ—É—Ç–µ**, —á—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ø—É—Ç–∞–Ω–∏—Ü—É. –ü—Ä–æ–º–æ—É—Ç –≤–∏–¥–∏—Ç "—Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç –¥–µ–º–æ—É–Ω—Ç–æ–≤" –∏ –¥—É–º–∞–µ—Ç —á—Ç–æ —ç—Ç–æ "—Å–∫–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å –≤ operations", —á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!

