# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–≤–æ—Ç (Intent-based)

**–î–∞—Ç–∞:** 02-10-2025  
**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Ç—ã –æ—Ç –≤—Å–µ—Ö —Å–ª–æ—ë–≤ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

---

## üéØ –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è

**–ú–µ–Ω–µ–¥–∂–µ—Ä –∫–≤–æ—Ç** = –∞—Ä–±–∏—Ç—Ä –º–µ–∂–¥—É –∏–Ω—Ç–µ–Ω—Ç–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ—ë–≤ (—Å–æ—Å—Ç–æ—è–Ω–∏–π)

```
State Processing (—Å–ª–æ–π 3):
‚îú‚îÄ> operations:  intent=2 (–æ—Å—Ç–∞—é—Å—å)  ‚îÄ‚îÄ‚îÄ‚îê
‚îú‚îÄ> serviceable: intent=2 (—Ö–æ—á—É –≤ ops) ‚îÄ‚î§
‚îú‚îÄ> reserve:     intent=2 (—Ö–æ—á—É –≤ ops) ‚îÄ‚îº‚îÄ‚îÄ> QuotaManager
‚îú‚îÄ> inactive:    intent=2 (—Ö–æ—á—É –≤ ops) ‚îÄ‚î§    ‚îú‚îÄ> –°—á–∏—Ç–∞–µ—Ç Curr –∏ Target
‚îî‚îÄ> repair:      intent=4 (–æ—Å—Ç–∞—é—Å—å)     ‚îò    ‚îú‚îÄ> –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
                                              ‚îî‚îÄ> –û–¥–æ–±—Ä—è–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∏–Ω—Ç–µ–Ω—Ç—ã
State Transitions (—Å–ª–æ–π 8):
‚îî‚îÄ> –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–Ω—Ç—ã
```

---

## üìã API –º–µ–Ω–µ–¥–∂–µ—Ä–∞

```python
QuotaManager(
    # –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    target_state_id = 2,  # operations
    
    # –õ–∏–º–∏—Ç
    limit_source = "mp4_ops_counter_mi8",  # PropertyArray
    limit_value = None,                     # –ò–õ–ò –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ—ë–≤ —Å –∏–Ω—Ç–µ–Ω—Ç–∞–º–∏
    intent_layers = [
        # –ü–æ—Ä—è–¥–æ–∫ = –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
        {
            "source_state_id": 2,        # operations (–¥–µ–º–æ—É—Ç)
            "intent_value": 3,           # –•–æ—á–µ—Ç –≤ serviceable
            "logic": "demount",          # demount | promote
            "priority_field": "mp3_mfg_date_days",
            "priority_order": "oldest_first",
            "limit_check": "curr > target"  # –£—Å–ª–æ–≤–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
        },
        {
            "source_state_id": 3,        # serviceable (–ø—Ä–æ–º–æ—É—Ç)
            "intent_value": 2,           # –•–æ—á–µ—Ç –≤ operations
            "logic": "promote",
            "priority_order": "fcfs",
            "limit_check": "curr < target",
            "rank_offset": 0  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ø–µ—Ä–≤—ã–µ)
        },
        {
            "source_state_id": 5,        # reserve (–ø—Ä–æ–º–æ—É—Ç)
            "intent_value": 2,
            "logic": "promote",
            "priority_order": "fcfs",
            "limit_check": "curr < target",
            "rank_offset": "count(state=3, intent=2)"  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–ø–æ—Å–ª–µ serviceable)
        },
        {
            "source_state_id": 1,        # inactive (–ø—Ä–æ–º–æ—É—Ç)
            "intent_value": 2,
            "logic": "promote",
            "condition": "(day - repair_time) > version_date",  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ
            "priority_order": "fcfs",
            "limit_check": "curr < target",
            "rank_offset": "count(state=3|5, intent=2)"  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3
        }
    ]
)
```

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ç–µ–Ω—Ç–æ–≤

```
–î–õ–Ø –ö–ê–ñ–î–û–ì–û group_by (Mi-8, Mi-17):

1. –ü–æ–¥—Å—á—ë—Ç —Ç–µ–∫—É—â–∏—Ö –≤ target_state:
   Curr = count(agents –≥–¥–µ intent == target_state_id)

2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞:
   Target = limit_source[day+1] –ò–õ–ò limit_value

3. –ï–°–õ–ò Curr > Target (–ò–ó–ë–´–¢–û–ö):
   ‚îî‚îÄ> –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–º–æ—É—Ç —Å–ª–æ–π:
       - –ù–∞–π—Ç–∏ –∞–≥–µ–Ω—Ç–æ–≤: state=target AND intent=demount_intent
       - –†–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –ø–æ priority_field
       - K = Curr - Target
       - K –∞–≥–µ–Ω—Ç–æ–≤ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å intent

4. –ï–°–õ–ò Curr < Target (–î–ï–§–ò–¶–ò–¢):
   ‚îî‚îÄ> –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–º–æ—É—Ç —Å–ª–æ–∏ (–ü–û –ü–û–†–Ø–î–ö–£):
       –î–ª—è –∫–∞–∂–¥–æ–≥–æ source_state –≤ promote_from_states:
         - –ù–∞–π—Ç–∏ –∞–≥–µ–Ω—Ç–æ–≤: state=source AND intent=target_state_id
         - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
         - –†–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å —Å —É—á—ë—Ç–æ–º rank_offset
         - –û–¥–æ–±—Ä–∏—Ç—å –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ Curr < Target
         - –û–±–Ω–æ–≤–∏—Ç—å Curr
         - –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É source_state

5. –ï–°–õ–ò Curr == Target:
   ‚îî‚îÄ> –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å (–∫–≤–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
```

---

## üìä –ü—Ä–∏–º–µ—Ä: –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ operations

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
operations_quota = QuotaManager(
    target_state_id=2,
    limit_source="mp4_ops_counter",
    
    intent_layers=[
        # –î–ï–ú–û–£–¢: operations ‚Üí serviceable (–∏–∑–±—ã—Ç–æ–∫)
        {
            "source_state": 2,
            "intent": 3,
            "type": "demount",
            "priority": "oldest_first",
            "field": "mp3_mfg_date_days"
        },
        # –ü–†–û–ú–û–£–¢ 1: serviceable ‚Üí operations (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
        {
            "source_state": 3,
            "intent": 2,
            "type": "promote",
            "priority": "fcfs",
            "rank_offset": 0
        },
        # –ü–†–û–ú–û–£–¢ 2: reserve ‚Üí operations (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
        {
            "source_state": 5,
            "intent": 2,
            "type": "promote",
            "priority": "fcfs",
            "rank_offset": "deficit_after_s3"
        },
        # –ü–†–û–ú–û–£–¢ 3: inactive ‚Üí operations (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
        {
            "source_state": 1,
            "intent": 2,
            "type": "promote",
            "condition": "day > repair_time",
            "priority": "fcfs",
            "rank_offset": "deficit_after_s3_s5"
        }
    ]
)
```

---

## üîß –ü—Ä–∏–º–µ—Ä: –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ repair (–Ω–æ–≤—ã–π –∫–µ–π—Å)

```python
repair_quota = QuotaManager(
    target_state_id=4,
    limit_value=50,  # –ú–∞–∫—Å–∏–º—É–º 50 –≤ —Ä–µ–º–æ–Ω—Ç–µ
    
    intent_layers=[
        # –î–ï–ú–û–£–¢: repair ‚Üí serviceable (–µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç)
        {
            "source_state": 4,
            "intent": 3,  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ serviceable
            "type": "demount",
            "priority": "highest_first",
            "field": "repair_days"  # –ö—Ç–æ –±–ª–∏–∂–µ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é
        }
        # –ü—Ä–æ–º–æ—É—Ç –Ω–µ –Ω—É–∂–µ–Ω (–≤ —Ä–µ–º–æ–Ω—Ç —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ 2‚Üí4)
    ]
)
```

---

## üèóÔ∏è –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Å–ª–æ–∏

```python
# –ú–µ–Ω–µ–¥–∂–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 2 —Å–ª–æ—è:

# –°–õ–û–ô 1: –û—á–∏—Å—Ç–∫–∞ –º–∞—Å–æ–∫
quota_{name}_clear

# –°–õ–û–ô 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ–Ω—Ç–æ–≤ –ø–æ –ø–æ—Ä—è–¥–∫—É
quota_{name}_decide
  ‚îú‚îÄ> –ü–æ–¥—Å—á—ë—Ç Curr
  ‚îú‚îÄ> –ü–æ–ª—É—á–µ–Ω–∏–µ Target
  ‚îú‚îÄ> –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–º–æ—É—Ç–∞ (–µ—Å–ª–∏ –∏–∑–±—ã—Ç–æ–∫)
  ‚îî‚îÄ> –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–æ—É—Ç–æ–≤ (–µ—Å–ª–∏ –¥–µ—Ñ–∏—Ü–∏—Ç, –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º)
```

---

## ‚öôÔ∏è –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –ß—Ç–æ | –ë—ã–ª–æ | –°—Ç–∞–Ω–µ—Ç |
|-----|------|--------|
| **–ú–æ–¥—É–ª–µ–π** | 4+ | 1 |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞** | 1600+ | ~680 |
| **–ù–æ–≤—ã–π –∫–µ–π—Å** | 400 —Å—Ç—Ä–æ–∫ | 20 —Å—Ç—Ä–æ–∫ |
| **–°–ª–æ—ë–≤** | –¢–µ –∂–µ | –¢–µ –∂–µ |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | 4 –º–æ–¥—É–ª—è | 1 –º–æ–¥—É–ª—å |

---

## ü§î –í–æ–ø—Ä–æ—Å—ã –∫ —É—Ç–æ—á–Ω–µ–Ω–∏—é

1. **Rank offset –¥–ª—è –ø—Ä–æ–º–æ—É—Ç–∞:**
   - –ö–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å "—Å–∫–æ–ª—å–∫–æ —É–∂–µ –æ–¥–æ–±—Ä–µ–Ω–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö"?
   - –ß–µ—Ä–µ–∑ MacroProperty counter –∏–ª–∏ –ø–µ—Ä–µ—Å—á—ë—Ç –≤ –∫–∞–∂–¥–æ–º –∞–≥–µ–Ω—Ç–µ?

2. **–£—Å–ª–æ–≤–∏—è –ø—Ä–æ–º–æ—É—Ç–∞:**
   - –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –∫–æ–¥–∞ –≤ RTC?
   - –ò–ª–∏ —á–µ—Ä–µ–∑ Environment properties?

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ:**
   - –î–µ–º–æ—É—Ç –ò –ø—Ä–æ–º–æ—É—Ç –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ decide?
   - –ò–ª–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å: demount_decide + promote_decide?

---

**–°—Ç–∞—Ç—É—Å:** –ö–æ–Ω—Ü–µ–ø—Ç –≥–æ—Ç–æ–≤, —Ç—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π





