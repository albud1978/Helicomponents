# RTC Pipeline Architecture

## –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö RTC —Ñ—É–Ω–∫—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã

### –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ RTC —Ñ—É–Ω–∫—Ü–∏–π

| ‚Ññ | RTC –§—É–Ω–∫—Ü–∏—è | –§–ª–∞–≥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è |
|---|-------------|----------------|------------|------------|----------------|----------------|-------------------|
| 1 | `rtc_probe_mp5` | `HL_ENABLE_MP5_PROBE` | –ß—Ç–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã | –ß–∏—Ç–∞–µ—Ç –∏–∑ MP5 —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –∞–≥–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | MP5 –º–∞—Å—Å–∏–≤ `mp5_daily_hours`, `idx`, `day` | `daily_today_u32`, `daily_next_u32` | –ö–∞–∂–¥—ã–π —à–∞–≥, —Å–∞–º—ã–º –ø–µ—Ä–≤—ã–º |
| 2 | `rtc_quota_begin_day` | `HL_ALWAYS_ON` | –°–±—Ä–æ—Å —Å—É—Ç–æ—á–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤ | –û–±–Ω—É–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–ª–∞–≥–∏ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥—ã—Ö —Å—É—Ç–æ–∫ | –ù–µ—Ç | `ops_ticket=0`, `intent_flag=0` | –ö–∞–∂–¥—ã–π —à–∞–≥, –≤ –Ω–∞—á–∞–ª–µ |
| 3 | `rtc_status_6` | `HL_ENABLE_STATUS_6` | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è | –í–µ–¥–µ—Ç —Å—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π –≤ —Å—Ç–∞—Ç—É—Å–µ 6, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä partout | `status_id`, `s6_started`, `s6_days`, `partout_time` | `s6_days++`, `partout_trigger` | –ö–∞–∂–¥—ã–π —à–∞–≥, –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ 6 |
| 4 | `rtc_status_4` | `HL_ENABLE_STATUS_4` | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–º–æ–Ω—Ç–∞ | –í–µ–¥–µ—Ç —Å—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π —Ä–µ–º–æ–Ω—Ç–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è | `status_id`, `repair_days`, `repair_time`, `assembly_time`, `partout_time` | `repair_days++`, `active_trigger`, `assembly_trigger`, `partout_trigger` | –ö–∞–∂–¥—ã–π —à–∞–≥, –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ 4 |
| 5 | `rtc_status_2` | `HL_ENABLE_STATUS_2` | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ | –ù–∞—á–∏—Å–ª—è–µ—Ç –Ω–∞—Ä–∞–±–æ—Ç–∫—É, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç LL/OH –ª–∏–º–∏—Ç—ã, Beyond Repair | `status_id`, `daily_today_u32`, `sne`, `ppr`, `ll`, `oh`, `br` | `sne+=dt`, `ppr+=dt`, –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ | –ö–∞–∂–¥—ã–π —à–∞–≥, –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ 2 |
| 6 | `rtc_quota_intent_s2` | `HL_ENABLE_QUOTA_S2` | –ó–∞—è–≤–∫–∞ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 2 | –ê–≥–µ–Ω—Ç—ã –≤ —Å—Ç–∞—Ç—É—Å–µ 2 –ø–æ–¥–∞—é—Ç –∑–∞—è–≤–∫—É –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –∫–≤–æ—Ç—É | `status_id==2`, `group_by`, `idx` | MacroProperty `mi8_intent[idx]` –∏–ª–∏ `mi17_intent[idx]` | –ö–∞–∂–¥—ã–π —à–∞–≥, –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ |
| 7 | `rtc_quota_approve_s2` | `HL_ENABLE_QUOTA_S2` | –û–¥–æ–±—Ä–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 2 | –ú–µ–Ω–µ–¥–∂–µ—Ä (idx==0) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–≤–æ—Ç—ã –º–µ–∂–¥—É –∑–∞—è–≤–∏—Ç–µ–ª—è–º–∏ | `mi8_intent`, `mi17_intent`, `mp4_ops_counter` | `mi8_approve`, `mi17_approve` | –ö–∞–∂–¥—ã–π —à–∞–≥, –ø–æ—Å–ª–µ intent |
| 8 | `rtc_quota_apply_s2` | `HL_ENABLE_QUOTA_S2` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 2 | –ê–≥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ | `mi8_approve[idx]`, `mi17_approve[idx]`, `group_by` | `ops_ticket=1` –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ | –ö–∞–∂–¥—ã–π —à–∞–≥, –ø–æ—Å–ª–µ approve |
| 9 | `rtc_quota_clear_s2` | `HL_ENABLE_QUOTA_S2` | –û—á–∏—Å—Ç–∫–∞ intent –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 2 | –ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±–Ω—É–ª—è–µ—Ç intent –º–∞—Å—Å–∏–≤—ã –ø–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è | –ù–µ—Ç | `mi8_intent[]=0`, `mi17_intent[]=0` | –ö–∞–∂–¥—ã–π —à–∞–≥, –ø–æ—Å–ª–µ apply |
| 10 | `rtc_quota_intent_s3` | `HL_ENABLE_QUOTA_S3` | –ó–∞—è–≤–∫–∞ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 | –ê–≥–µ–Ω—Ç—ã –≤ —Å—Ç–∞—Ç—É—Å–µ 3 –ø–æ–¥–∞—é—Ç –∑–∞—è–≤–∫—É –Ω–∞ –∫–≤–æ—Ç—É | `status_id==3`, `group_by`, `idx` | MacroProperty intent –º–∞—Å—Å–∏–≤—ã | –¢–æ –∂–µ —á—Ç–æ s2, –Ω–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 |
| 11 | `rtc_quota_approve_s3` | `HL_ENABLE_QUOTA_S3` | –û–¥–æ–±—Ä–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 | –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 | Intent –º–∞—Å—Å–∏–≤—ã, –∫–≤–æ—Ç—ã MP4 | Approve –º–∞—Å—Å–∏–≤—ã | –¢–æ –∂–µ —á—Ç–æ s2, –Ω–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 |
| 12 | `rtc_quota_apply_s3` | `HL_ENABLE_QUOTA_S3` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 | –ê–≥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç | Approve –º–∞—Å—Å–∏–≤—ã | `ops_ticket` | –¢–æ –∂–µ —á—Ç–æ s2, –Ω–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 |
| 13 | `rtc_quota_clear_s3` | `HL_ENABLE_QUOTA_S3` | –û—á–∏—Å—Ç–∫–∞ intent –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 | –û—á–∏—Å—Ç–∫–∞ intent –ø–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è | –ù–µ—Ç | Intent –º–∞—Å—Å–∏–≤—ã = 0 | –¢–æ –∂–µ —á—Ç–æ s2, –Ω–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3 |
| 14 | `rtc_status_3_post` | `HL_ENABLE_STATUS_3_POST` | –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 3 | –ü–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è/–Ω–µ–ø–æ–ª—É—á–µ–Ω–∏—è –∫–≤–æ—Ç—ã | `status_id`, `ops_ticket` | –ü–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ 3‚Üí1 –∏–ª–∏ 3‚Üí2 | –ü–æ—Å–ª–µ –≤—Å–µ—Ö quota —Ü–∏–∫–ª–æ–≤ |
| 15 | `rtc_quota_intent_s5` | `HL_ENABLE_QUOTA_S5` | –ó–∞—è–≤–∫–∞ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 5 | –ê–≥–µ–Ω—Ç—ã –≤ —Å—Ç–∞—Ç—É—Å–µ 5 –ø–æ–¥–∞—é—Ç –∑–∞—è–≤–∫—É | `status_id==5` | Intent –º–∞—Å—Å–∏–≤—ã | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ s2/s3 |
| 16 | `rtc_quota_approve_s5` | `HL_ENABLE_QUOTA_S5` | –û–¥–æ–±—Ä–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 5 | –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 5 | Intent, MP4 –∫–≤–æ—Ç—ã | Approve –º–∞—Å—Å–∏–≤—ã | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ s2/s3 |
| 17 | `rtc_quota_apply_s5` | `HL_ENABLE_QUOTA_S5` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 5 | –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∏–ª–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 5 | Approve –º–∞—Å—Å–∏–≤—ã | `ops_ticket` | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ s2/s3 |
| 18 | `rtc_quota_clear_s5` | `HL_ENABLE_QUOTA_S5` | –û—á–∏—Å—Ç–∫–∞ intent –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 5 | –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è | –ù–µ—Ç | Intent = 0 | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ s2/s3 |
| 19 | `rtc_quota_intent_s1` | `HL_ENABLE_QUOTA_S1` | –ó–∞—è–≤–∫–∞ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 1 | –ê–≥–µ–Ω—Ç—ã –≤ —Å—Ç–∞—Ç—É—Å–µ 1 –ø–æ–¥–∞—é—Ç –∑–∞—è–≤–∫—É | `status_id==1` | Intent –º–∞—Å—Å–∏–≤—ã | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º —Å—Ç–∞—Ç—É—Å–∞–º |
| 20 | `rtc_quota_approve_s1` | `HL_ENABLE_QUOTA_S1` | –û–¥–æ–±—Ä–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 1 | –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 1 | Intent, MP4 | Approve –º–∞—Å—Å–∏–≤—ã | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º —Å—Ç–∞—Ç—É—Å–∞–º |
| 21 | `rtc_quota_apply_s1` | `HL_ENABLE_QUOTA_S1` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–≤–æ—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 1 | –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∏–ª–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 1 | Approve –º–∞—Å—Å–∏–≤—ã | `ops_ticket` | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º —Å—Ç–∞—Ç—É—Å–∞–º |
| 22 | `rtc_quota_clear_s1` | `HL_ENABLE_QUOTA_S1` | –û—á–∏—Å—Ç–∫–∞ intent –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 1 | –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è | –ù–µ—Ç | Intent = 0 | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º —Å—Ç–∞—Ç—É—Å–∞–º |
| 23 | `rtc_status_1_post` | `HL_ENABLE_STATUS_1_POST` | –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 1 | –ü–µ—Ä–µ—Ö–æ–¥—ã –∏–∑ —Å—Ç–∞—Ç—É—Å–∞ 1 | `status_id==1`, `ops_ticket` | –ü–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ | –ü–æ—Å–ª–µ quota —Ü–∏–∫–ª–æ–≤ |
| 24 | `rtc_status_5_post` | `HL_ENABLE_STATUS_5_POST` | –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 5 | –ü–µ—Ä–µ—Ö–æ–¥—ã –∏–∑ —Å—Ç–∞—Ç—É—Å–∞ 5 | `status_id==5`, `ops_ticket` | –ü–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ | –ü–æ—Å–ª–µ quota —Ü–∏–∫–ª–æ–≤ |
| 25 | `rtc_status_2_post` | `HL_ENABLE_STATUS_2_POST` | –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 2 | –ü–µ—Ä–µ—Ö–æ–¥ 2‚Üí3 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –±–∏–ª–µ—Ç–∞ | `status_id==2`, `ops_ticket==0` | `status_id=3` | –ü–æ—Å–ª–µ quota —Ü–∏–∫–ª–æ–≤ |
| 26 | `rtc_log_day` | `HL_ENABLE_MP2_LOG` | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ MP2 | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –≤ MP2 –ª–æ–≥ –∑–∞ –¥–µ–Ω—å | –í—Å–µ –∞–≥–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, `day`, `idx` | MP2 –º–∞—Å—Å–∏–≤ (SoA) | –ö–∞–∂–¥—ã–π —à–∞–≥, –≤ –∫–æ–Ω—Ü–µ |
| 27 | `rtc_mp2_postprocess` | `export_phase` | –ü–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ MP2 | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –ª–æ–≥–∏ MP2 | MP2 –º–∞—Å—Å–∏–≤—ã | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –¢–æ–ª—å–∫–æ –ø—Ä–∏ `export_phase=2` |
| 28 | `rtc_mp2_copyout` | `HL_ENABLE_MP2_COPY` | –≠–∫—Å–ø–æ—Ä—Ç MP2 –≤ –∞–≥–µ–Ω—Ç—ã | –ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ MP2 –≤ –∞–≥–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | MP2 –º–∞—Å—Å–∏–≤—ã, —Ü–µ–ª–µ–≤–æ–π –¥–µ–Ω—å | –ê–≥–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | –¢–æ–ª—å–∫–æ –ø—Ä–∏ `export_phase=1` |
| 29 | `rtc_spawn_mgr` | `HL_ENABLE_SPAWN` | –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–ø–∞–≤–Ω–∞ | –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ | `mp4_new_counter_mi17_seed[day]`, —Å—á–µ—Ç—á–∏–∫–∏ | MacroProperty spawn –ø–∞—Ä–∞–º–µ—Ç—Ä—ã | –ö–∞–∂–¥—ã–π —à–∞–≥, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–ø–∞–≤–Ω |
| 30 | `rtc_spawn_ticket` | `HL_ENABLE_SPAWN` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ | –ê—Ç–æ–º–∞—Ä–Ω–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã MI-17 | Spawn –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, `ticket` | –ù–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã HELI | –ö–∞–∂–¥—ã–π —à–∞–≥, –ø–æ—Å–ª–µ spawn_mgr |

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

### Status –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Ñ—É–Ω–∫—Ü–∏–∏ 3-5, 23-25)
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∞–≥–µ–Ω—Ç–æ–≤ - –≤–µ–¥–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –¥–Ω–µ–π, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤, –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç–∞—Ç—É—Å–∞–º–∏.

### Quota —Å–∏—Å—Ç–µ–º–∞ (—Ñ—É–Ω–∫—Ü–∏–∏ 6-22) 
4 –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö —Ü–∏–∫–ª–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ 1,2,3,5: intent‚Üíapprove‚Üíapply‚Üíclear. –ú–∞—Å—Å–∏–≤–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ñ—É–Ω–∫—Ü–∏–∏ 26-28)
MP2 —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ host.

### Spawn (—Ñ—É–Ω–∫—Ü–∏–∏ 29-30)
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ - –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç–∏–∫–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç –∞–≥–µ–Ω—Ç–æ–≤.

### –£—Ç–∏–ª–∏—Ç—ã (—Ñ—É–Ω–∫—Ü–∏–∏ 1-2)
MP5 probe –¥–ª—è —á—Ç–µ–Ω–∏—è —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã –∏ —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤ –≤ –Ω–∞—á–∞–ª–µ —Å—É—Ç–æ–∫.

–î–∞—Ç–∞: 12-09-2025

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RTC –ø–∞–π–ø–ª–∞–π–Ω–∞

### üéØ –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–• FLAME GPU (–∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ transform.md, 29-07-2025)

#### MacroProperty1 (md_components) - 20/20 –ø–æ–ª–µ–π ‚úÖ

| **–ü–æ–ª–µ** | **field_id** | **ClickHouse –¢–∏–ø** | **FLAME GPU –¢–∏–ø** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** |
|----------|--------------|-------------------|------------------|----------------|
| `assembly_time` | 50 | `UInt8` | `UInt8` | –°—Ä–æ–∫ —Å–±–æ—Ä–∫–∏ –≤ –¥–Ω—è—Ö |
| `br_mi8` | 51 | `UInt32` | `UInt32` | Beyond Repair –¥–ª—è –ú–∏‚Äë8 (–º–∏–Ω—É—Ç—ã) |
| `br_mi17` | 52 | `UInt32` | `UInt32` | Beyond Repair –¥–ª—è –ú–∏‚Äë17 (–º–∏–Ω—É—Ç—ã) |
| `common_restricted1` | 53 | `UInt8` | `UInt8` | –û–±—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è 1 |
| `common_restricted2` | 54 | `UInt8` | `UInt8` | –û–±—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è 2 |
| `comp_number` | 55 | `UInt8` | `UInt8` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–∏–º—ë–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞ 1 –≤–µ—Ä—Ç–æ–ª—ë—Ç–µ |
| `group_by` | 56 | `UInt8` | `UInt8` | –ì—Ä—É–ø–ø–∞ –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º–æ—Å—Ç–∏: 1=–ú–ò‚Äë8–¢, 2=–ú–ò‚Äë17, 3..N ‚Äî –ø—Ä–æ—á–∏–µ |
| `ll_mi17` | 57 | `UInt32` | `UInt32` | –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç –ú–ò-17 |
| `ll_mi8` | 58 | `UInt32` | `UInt32` | –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç –ú–ò-8 |
| `oh_mi17` | 59 | `UInt32` | `UInt32` | –ú–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å –ú–ò-17 |
| `oh_mi8` | 60 | `UInt32` | `UInt32` | –ú–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å –ú–ò-8 |
| `oh_threshold_mi17` | 61 | `UInt32` | `UInt32` | –ü–æ—Ä–æ–≥ –ø–µ—Ä–≤–æ–≥–æ –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ú–ò-17 |
| `oh_threshold_mi8` | 62 | `UInt32` | `UInt32` | –ü–æ—Ä–æ–≥ –ø–µ—Ä–≤–æ–≥–æ –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ú–ò-8 |
| `partout_time` | 63 | `UInt8` | `UInt8` | –°—Ä–æ–∫ —Ä–∞–∑–±–æ—Ä–∫–∏ –≤ –¥–Ω—è—Ö |
| `ac_type_mask` | 64 | `UInt8` | `UInt8` | –¢–∏–ø –í–° (–º–∞—Å–∫–∞) |
| `repair_time` | 65 | `UInt16` | `UInt16` | –°—Ä–æ–∫ —Ä–µ–º–æ–Ω—Ç–∞ –≤ –¥–Ω—è—Ö |
| `restrictions_mask` | 66 | `UInt8` | `UInt8` | –ú–∞—Å–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π |
| `sne_new` | 67 | `UInt32` | `UInt32` | –ù–∞—á–∞–ª—å–Ω–∞—è SNE –ø—Ä–∏ –∑–∞–∫—É–ø–∫–µ |
| `ppr_new` | 68 | `UInt32` | `UInt32` | –ù–∞—á–∞–ª—å–Ω—ã–π PPR –ø—Ä–∏ –∑–∞–∫—É–ø–∫–µ |
| `trigger_interval` | 69 | `UInt32` | `UInt32` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–≤–æ–≥–æ –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ |

**–≠–∫—Å–ø–æ—Ä—Ç**: `flame_macroproperty1_export` | **–ó–∞–ø–∏—Å–µ–π**: 7,113

#### MacroProperty3 (heli_pandas) - 14/14 –ø–æ–ª–µ–π ‚úÖ

| **–ü–æ–ª–µ** | **field_id** | **ClickHouse –¢–∏–ø** | **FLAME GPU –¢–∏–ø** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** |
|----------|--------------|-------------------|------------------|----------------|
| `partseqno_i` | 32 | `UInt32` | `UInt32` | –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä –∞–≥—Ä–µ–≥–∞—Ç–∞ |
| `psn` | 33 | `UInt32` | `UInt32` | PSN –∞–≥—Ä–µ–≥–∞—Ç–∞ |
| `address_i` | 34 | `UInt16` | `UInt16` | –ê–¥—Ä–µ—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| `lease_restricted` | 35 | `UInt8` | `UInt8` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ª–∏–∑–∏–Ω–≥–∞ |
| `status_id` | 36 | `UInt8` | `UInt8` | –°—Ç–∞—Ç—É—Å –∞–≥—Ä–µ–≥–∞—Ç–∞ |
| `aircraft_number` | 37 | `UInt32` | `UInt32` | –ù–æ–º–µ—Ä –í–° |
| `ac_type_mask` | 38 | `UInt8` | `UInt8` | –¢–∏–ø –í–° (–º–∞—Å–∫–∞) |
| `ll` | 39 | `UInt32` | `UInt32` | –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç |
| `oh` | 40 | `UInt32` | `UInt32` | –ú–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å |
| `oh_threshold` | 41 | `UInt32` | `UInt32` | –ü–æ—Ä–æ–≥ –ø–µ—Ä–≤–æ–≥–æ –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ |
| `sne` | 42 | `UInt32` | `UInt32` | SNE —Ç–µ–∫—É—â–∏–π |
| `ppr` | 43 | `UInt32` | `UInt32` | PPR —Ç–µ–∫—É—â–∏–π |
| `repair_days` | 44 | `UInt16` | `UInt16` | –î–Ω–∏ —Å –Ω–∞—á–∞–ª–∞ —Ä–µ–º–æ–Ω—Ç–∞ |
| `mfg_date` | 45 | `Date` | `UInt16` | –î–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ |

**–≠–∫—Å–ø–æ—Ä—Ç**: `flame_macroproperty3_export` | **–ó–∞–ø–∏—Å–µ–π**: 7,113

#### MacroProperty4 (flight_program_ac) - 8/8 –ø–æ–ª–µ–π ‚úÖ

| **–ü–æ–ª–µ** | **field_id** | **ClickHouse –¢–∏–ø** | **FLAME GPU –¢–∏–ø** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** |
|----------|--------------|-------------------|------------------|----------------|
| `dates` | 73 | `Date` | `UInt16` | –î–∞—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã |
| `ops_counter_mi8` | 74 | `UInt16` | `UInt16` | –°—á–µ—Ç—á–∏–∫ —Ç—Ä–µ–±—É–µ–º—ã—Ö –í–° –ú–ò-8 –Ω–∞ –¥–∞—Ç—É D |
| `ops_counter_mi17` | 75 | `UInt16` | `UInt16` | –°—á–µ—Ç—á–∏–∫ —Ç—Ä–µ–±—É–µ–º—ã—Ö –í–° –ú–ò-17 –Ω–∞ –¥–∞—Ç—É D |
| `ops_counter_total` | 76 | `UInt16` | `UInt16` | –û–±—â–∏–π —Å—á–µ—Ç—á–∏–∫ —Ç—Ä–µ–±—É–µ–º—ã—Ö –í–° |
| `new_counter_mi17` | 77 | `UInt8` | `UInt8` | –¢—Ä–∏–≥–≥–µ—Ä —Ä–æ–∂–¥–µ–Ω–∏—è –ú–ò-17 |
| `trigger_program_mi8` | 78 | `Int8` | `Int8` | –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –ú–ò-8 |
| `trigger_program_mi17` | 79 | `Int8` | `Int8` | –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –ú–ò-17 |
| `trigger_program` | 80 | `Int8` | `Int8` | –û–±—â–∏–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä |

**–≠–∫—Å–ø–æ—Ä—Ç**: `flame_macroproperty4_export` | **–ó–∞–ø–∏—Å–µ–π**: 4,000

#### MacroProperty5 (flight_program_fl) - 4/4 –ø–æ–ª–µ–π ‚úÖ

| **–ü–æ–ª–µ** | **field_id** | **ClickHouse –¢–∏–ø** | **FLAME GPU –¢–∏–ø** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** |
|----------|--------------|-------------------|------------------|----------------|
| `dates` | 81 | `Date` | `UInt16` | –î–∞—Ç—ã –Ω–∞–ª–µ—Ç–æ–≤ |
| `aircraft_number` | 82 | `UInt16` | `UInt16` | –ù–æ–º–µ—Ä –í–° |
| `ac_type_mask` | 83 | `UInt8` | `UInt8` | –¢–∏–ø –í–° (–º–∞—Å–∫–∞) |
| `daily_hours` | 84 | `UInt32` | `UInt32` | –°—É—Ç–æ—á–Ω—ã–π –Ω–∞–ª–µ—Ç (MP5) |

**–≠–∫—Å–ø–æ—Ä—Ç**: `flame_macroproperty5_export` | **–ó–∞–ø–∏—Å–µ–π**: 1,116,000

#### Property (–≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å) - 2/2 –ø–æ–ª—è ‚úÖ

| **–ü–æ–ª–µ** | **field_id** | **ClickHouse –¢–∏–ø** | **FLAME GPU –¢–∏–ø** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** |
|----------|--------------|-------------------|------------------|----------------|
| `version_date` | 71 | `Date` | `UInt16` | –î–∞—Ç–∞ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–∫–∂–µ —Å—Ç–∞—Ä—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ D0) |
| `version_id` | 72 | `UInt8` | `UInt8` | ID –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö |

**–≠–∫—Å–ø–æ—Ä—Ç**: `flame_property_export` | **–ó–∞–ø–∏—Å–µ–π**: 1 (—Å–∫–∞–ª—è—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)

#### MacroProperty2 (LoggingLayer Planes) ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–º—É–ª—è—Ü–∏–∏

–í—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤. –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å BI –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑ MP1/MP3/MP4/MP5, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è. –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–º–µ—á–µ–Ω—ã —è–≤–Ω–æ.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- `dates` ‚Äî –¥–∞—Ç–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ (–∏–∑ MP4)
- `aircraft_number` ‚Äî –Ω–æ–º–µ—Ä –í–° (–∏–∑ MP3)
- `ac_type_mask` ‚Äî —Ç–∏–ø –ø–ª–∞–Ω–µ—Ä–∞ (–∏–∑ MP3)
- `status_id` ‚Äî —Å—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–µ—Ä–∞ (–∏–∑ MP3)
- `daily_flight` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –Ω–∞–ª—ë—Ç (–∏–∑ MP5)
- `ops_counter_mi8` / `ops_counter_mi17` ‚Äî —Ü–µ–ª–µ–≤–æ–π –æ–±—ä—ë–º –Ω–∞ D (–∏–∑ MP4)
- `ops_current_mi8` / `ops_current_mi17` ‚Äî —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —É–∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ D (**–Ω–æ–≤–∞—è**)

#### –°–µ–º–∞–Ω—Ç–∏–∫–∞ –¥–∞—Ç –∏ –≤–µ—Ä—Å–∏–π (–∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ 29-07-2025)
- `dates` –≤–æ –≤—Å–µ—Ö MP ‚Äî —ç—Ç–æ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –¥–Ω–∏ —Å–∏–º—É–ª—è—Ü–∏–∏, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—á–∏–Ω–∞—è —Å `version_date` –∏ –¥–∞–ª–µ–µ (–ø–ª–∞–Ω: 4,000 —Å—É—Ç–æ–∫).
- `version_date` ‚Äî –Ω–µ —Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞ –≤—ã–≥—Ä—É–∑–∫–∏/–≤–µ—Ä—Å–∏–∏, –Ω–æ –∏ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –¥–∞—Ç–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ (D0).
- MP5: `mp5_daily_hours` (–¥–ª–∏–Ω–∞ = (DAYS+1)*FRAMES, –ø–∞–¥–¥–∏–Ω–≥ D+1 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω) ‚Üí –Ω–∞ —Ö–æ—Å—Ç–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ MacroProperty `mp5_lin`.

---

## –ü–æ–ª–Ω—ã–π —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è RTC —Ñ—É–Ω–∫—Ü–∏–π

#### –§–∞–∑–∞: –°–∏–º—É–ª—è—Ü–∏—è (–∫–∞–∂–¥—ã–π —à–∞–≥)

**–°–ª–æ–π 1**: `rtc_probe_mp5` (—É—Å–ª–æ–≤–Ω—ã–π, –µ—Å–ª–∏ `HL_MP5_PROBE=1`)
- –ß—Ç–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã –∏–∑ MP5
- –ó–∞–ø–∏—Å—å –≤ –∞–≥–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `daily_today_u32`, `daily_next_u32`

**–°–ª–æ–π 2**: `rtc_quota_begin_day` (–≤—Å–µ–≥–¥–∞)
- –°–±—Ä–æ—Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤ –≤ –Ω–∞—á–∞–ª–µ —Å—É—Ç–æ–∫
- –û–±–Ω—É–ª–µ–Ω–∏–µ `ops_ticket`, `intent_flag`

**–°–ª–æ–π 3**: `rtc_status_6` (—É—Å–ª–æ–≤–Ω—ã–π)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ 6 (—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
- –°—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ partout

**–°–ª–æ–π 4**: `rtc_status_4` (—É—Å–ª–æ–≤–Ω—ã–π)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ 4 (—Ä–µ–º–æ–Ω—Ç)
- –°—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π —Ä–µ–º–æ–Ω—Ç–∞, —Ç—Ä–∏–≥–≥–µ—Ä—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–°–ª–æ–π 5**: `rtc_status_2` (—É—Å–ª–æ–≤–Ω—ã–π)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ 2 (—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è)
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞—Ä–∞–±–æ—Ç–∫–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤

**–°–ª–æ–π 6-9**: Quota —Ü–∏–∫–ª –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 2
- `rtc_quota_intent_s2` ‚Üí `rtc_quota_approve_s2` ‚Üí `rtc_quota_apply_s2` ‚Üí `rtc_quota_clear_s2`

**–°–ª–æ–π 10-13**: Quota —Ü–∏–∫–ª –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 3
- `rtc_quota_intent_s3` ‚Üí `rtc_quota_approve_s3` ‚Üí `rtc_quota_apply_s3` ‚Üí `rtc_quota_clear_s3`

**–°–ª–æ–π 14**: `rtc_status_3_post`
- –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 3, –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤

**–°–ª–æ–π 15-18**: Quota —Ü–∏–∫–ª –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 5
- `rtc_quota_intent_s5` ‚Üí `rtc_quota_approve_s5` ‚Üí `rtc_quota_apply_s5` ‚Üí `rtc_quota_clear_s5`

**–°–ª–æ–π 19-22**: Quota —Ü–∏–∫–ª –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 1
- `rtc_quota_intent_s1` ‚Üí `rtc_quota_approve_s1` ‚Üí `rtc_quota_apply_s1` ‚Üí `rtc_quota_clear_s1`

**–°–ª–æ–π 23**: `rtc_status_1_post`
- –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 1

**–°–ª–æ–π 24**: `rtc_status_5_post`
- –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 5

**–°–ª–æ–π 25**: `rtc_status_2_post`
- –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 2 (–ø–µ—Ä–µ—Ö–æ–¥ 2‚Üí3 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –±–∏–ª–µ—Ç–∞)

**–°–ª–æ–π 26**: `rtc_log_day` (—É—Å–ª–æ–≤–Ω—ã–π)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤ –≤ MP2

**–°–ª–æ–π 27**: `rtc_spawn_mgr` (—É—Å–ª–æ–≤–Ω—ã–π, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω spawn)
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

**–°–ª–æ–π 28**: `rtc_spawn_ticket` (—É—Å–ª–æ–≤–Ω—ã–π, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω spawn)
- –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ MI-17

#### –§–∞–∑–∞: –ü–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ export_phase=2)

**–°–ª–æ–π 29**: `rtc_mp2_postprocess`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤ MP2
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–Ω—è–º

#### –§–∞–∑–∞: –≠–∫—Å–ø–æ—Ä—Ç (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ export_phase=1)

**–°–ª–æ–π 30**: `rtc_mp2_copyout`
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MP2 –≤ –∞–≥–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ host

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: 4 –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö quota —Ü–∏–∫–ª–∞ (—Å–ª–æ–∏ 6-9, 10-13, 15-18, 19-22)
2. **–ò–∑–±—ã—Ç–æ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å**: 30 —Å–ª–æ–µ–≤ –≤–º–µ—Å—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö 10-15
3. **–ù–µ–ª–æ–≥–∏—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫**: status_3_post –º–µ–∂–¥—É quota —Ü–∏–∫–ª–∞–º–∏
4. **–ñ–µ—Å—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: —Å–ª–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
5. **NVRTC –ø—Ä–æ–±–ª–µ–º—ã**: –∫–æ–º–ø–∏–ª—è—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ —Å FRAMES*DAYS

## –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è quota —Å–∏—Å—Ç–µ–º—ã**: –û–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ü–∏–∫–ª –≤–º–µ—Å—Ç–æ 4 –∫–æ–ø–∏–π
2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ñ–∞–∑–∞–º**: Status ‚Üí Quota ‚Üí Post ‚Üí Log ‚Üí Spawn
3. **–£—Å–ª–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ü–µ–ª—ã—Ö –≥—Ä—É–ø–ø —Ñ—É–Ω–∫—Ü–∏–π
4. **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ RTC —Ñ—É–Ω–∫—Ü–∏–π –ø–æ —Ñ–∞–π–ª–∞–º
5. **–ü—Ä–æ—Ñ–∏–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤


## MP2 Device-side Export (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 28-09-2025)

–í V2 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω device-side —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MP2 (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)

1. **MacroProperty MP2**: –Ω–∞–±–æ—Ä –º–∞—Å—Å–∏–≤–æ–≤ –Ω–∞ GPU –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–Ω–∏–º–∫–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤
   - **–ü–ª–æ—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞** –±–µ–∑ –∫–æ–ª—å—Ü–∞: —Ä–∞–∑–º–µ—Ä = (DAYS+1) √ó FRAMES
   - –ê–¥—Ä–µ—Å–∞—Ü–∏—è: `pos = day * FRAMES + idx` (–ø—Ä–æ—Å—Ç–∞—è, –±–µ–∑ –º–æ–¥—É–ª—è)
   - –ü–æ–ª—è: day, idx, aircraft_number, state, intent_state, sne, ppr, repair_days, dt, dn
   - –ó–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `exchange()` –æ–ø–µ—Ä–∞—Ü–∏—é –≤ RTC —Ñ—É–Ω–∫—Ü–∏—è—Ö

2. **RTC —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø–∏—Å–∏**: –ø–∏—à—É—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ GPU –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CPU
   - –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (rtc_mp2_write_inactive, rtc_mp2_write_operations, etc.)
   - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∑–∞–ø–∏—Å—å —Ç–µ–∫—É—â–µ–≥–æ state –∞–≥–µ–Ω—Ç–∞
   - –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ —Å–∏–º—É–ª—è—Ü–∏–∏
   - **–¢–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å**, —á—Ç–µ–Ω–∏–µ MP2 –∏–∑ RTC –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

3. **Host —Ñ—É–Ω–∫—Ü–∏—è –¥—Ä–µ–Ω–∞–∂–∞**: –≤—ã–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ClickHouse **–æ–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ —Å–∏–º—É–ª—è—Ü–∏–∏**
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥—Ä–µ–Ω–∞–∂: `--mp2-drain-interval=0` (–∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ –≤—ã–∫–ª—é—á–µ–Ω—ã)
   - –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 250000 –∑–∞–ø–∏—Å–µ–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–∑ sim_master)
   - –¢–∞–±–ª–∏—Ü–∞: sim_masterv2 (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - –ö–æ–ª–æ–Ω–Ω–∞—Ä–Ω—ã–µ INSERT (`columnar=True`) –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –¥—Ä–∞–π–≤–µ—Ä–∞
   - –ü–æ–ª–µ `day_date` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ ClickHouse (`Date MATERIALIZED addDays(...)`), –≤ Python –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è

4. **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞**:
   - MP2 —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏ –∂–∏–≤—ë—Ç –Ω–∞ GPU –≤—Å—é —Å–∏–º—É–ª—è—Ü–∏—é
   - –ó–∞–ø–∏—Å—å –≤ MP2 ‚Äî —Ç–æ–ª—å–∫–æ –∏–∑ RTC-—è–¥–µ—Ä (—á–µ—Ä–µ–∑ exchange/++/+=)
   - Read/Write —Ä–∞–∑–≤–æ–¥—è—Ç—Å—è –ø–æ —Å–ª–æ—è–º (–≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Ç–æ–ª—å–∫–æ Write)
   - –•–æ—Å—Ç –ø—Ä–∏–∫–∞—Å–∞–µ—Ç—Å—è –∫ MP2 –æ–¥–∏–Ω —Ä–∞–∑ ‚Äî –ø—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Å–ª–∏–≤–µ
   - –°–£–ë–î ‚Äî —Ç–æ–ª—å–∫–æ –ø–∞–∫–µ—Ç–∞–º–∏ (~250k) —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤

5. **–¢–∞–π–º–∏–Ω–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** (–∫–∞–∫ –≤ sim_master):
   - –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∏ –¥–∞–Ω–Ω—ã—Ö - –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ ClickHouse
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ GPU - –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏
   - –í—ã–≥—Ä—É–∑–∫–∞ –≤ –°–£–ë–î - –≤—Ä–µ–º—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¥—Ä–µ–Ω–∞–∂–∞ MP2
   - –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è - –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —à–∞–≥ - —Ä–∞—Å—á–µ—Ç–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞ (–∞–∫—Ç—É–∞–ª—å–Ω–æ)
- `--enable-mp2` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç device-side —ç–∫—Å–ø–æ—Ä—Ç (MP2)
- `--mp2-drain-interval 0` ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥—Ä–µ–Ω–∞–∂ –±–µ–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º MP2 –ø–µ—á–∞—Ç–∞—é—Ç—Å—è —Å–≤–æ–¥–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥—Ä–µ–Ω–∞–∂–∞: `rows`, `flushes`, `max_batch`, `flush_time`, `rows/s`

## –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è Env (Mode A + Spawn, MP2=off)

- **Property (—Å–∫–∞–ª—è—Ä—ã)**
  - `version_date`: –æ–ø–æ—Ä–Ω–∞—è –¥–∞—Ç–∞ (ord) –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –≤ S1/S5 post –∏ –ª–æ–≥–∏–∫–µ.
  - `days_total`: –≥–æ—Ä–∏–∑–æ–Ω—Ç —Ä–∞—Å—á—ë—Ç–∞; –≥–µ–π—Ç –¥–ª—è day/–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ RTC.
  - `frames_total`: —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å FRAMES, –ø–∞—Ä–∞–º–µ—Ç—Ä —à–∞–±–ª–æ–Ω–æ–≤ RTC.
  - `export_phase`: –≥–µ–π—Ç (0 –≤ –¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏); —Ä—è–¥ RTC —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ 0.
  - `export_day`: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ MP2=off.
  - `approve_policy`: –ø–æ–ª–∏—Ç–∏–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ approve; 0 ‚Äî –ø–æ –∏–Ω–¥–µ–∫—Å—É (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º).
  - `mi17_repair_time_const`, `mi17_partout_time_const`, `mi17_assembly_time_const`: –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ MP1 –¥–ª—è –Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω—ã—Ö.
  - `mi17_br_const`, `mi17_ll_const`, `mi17_oh_const`: –ø–æ—Ä–æ–≥–∏ BR/LL/OH –¥–ª—è MI‚Äë17 (–¥–ª—è –Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω—ã—Ö).

- **PropertyArray (–ø–æ –¥–Ω—è–º, –¥–ª–∏–Ω–∞ = DAYS)**
  - `mp4_ops_counter_mi8`, `mp4_ops_counter_mi17`: —Å—É—Ç–æ—á–Ω—ã–µ –∫–≤–æ—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ approve –≤—Å–µ—Ö —Ñ–∞–∑).
  - `mp4_new_counter_mi17_seed`: –ø–ª–∞–Ω —Å–ø–∞–≤–Ω–∞ –ú–∏‚Äë17 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è spawn_mgr/spawn_ticket).
  - `month_first_u32`: ord –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞ (mfg_date –Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω—ã—Ö).

- **PropertyArray (–ø–æ –∫–∞–¥—Ä–∞–º, –¥–ª–∏–Ω–∞ = FRAMES)**
  - `mp3_mfg_date_days`: –¥–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –ø–æ –∫–∞–¥—Ä–∞–º (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ approve S1 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º ¬´—Å–∞–º—ã–µ –º–æ–ª–æ–¥—ã–µ¬ª).

- **PropertyArray (–ª–∏–Ω–µ–π–Ω—ã–π, –¥–ª–∏–Ω–∞ = (DAYS+1)*FRAMES)**
  - `mp5_daily_hours`: —á–∞—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ MP5; —á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º `HL_MP5_PROBE=1` (—Ñ—É–Ω–∫—Ü–∏—è `rtc_probe_mp5`). –ü—Ä–∏ MP5_PROBE=0 —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è; `daily_today_u32/daily_next_u32` –æ—Å—Ç–∞—é—Ç—Å—è 0.

- **MacroProperty (–ø–æ –∫–∞–¥—Ä–∞–º, –¥–ª–∏–Ω–∞ = FRAMES)**
  - Intent/Approve (—Å—Ç–∞—Ç—É—Å—ã 2/3/5/1): `mi8_intent`, `mi17_intent`, `mi8_approve`, `mi17_approve`,
    `mi8_approve_s3`, `mi17_approve_s3`, `mi8_approve_s5`, `mi17_approve_s5`, `mi8_approve_s1`, `mi17_approve_s1`.

- **MacroProperty (–ø–æ –¥–Ω—è–º, –¥–ª–∏–Ω–∞ = DAYS)**
  - Spawn: `spawn_need_u32`, `spawn_base_idx_u32`, `spawn_base_acn_u32`, `spawn_base_psn_u32`.

- **MacroProperty (—Å–ª—É–∂–µ–±–Ω—ã–µ, –¥–ª–∏–Ω–∞ = 1) ‚Äî –≤ —Ç–µ–∫—É—â–µ–π –ª–æ–≥–∏–∫–µ RTC –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è**
  - `next_idx_spawn`, `next_aircraft_no_mi17`, `next_psn_mi17` (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–≥–µ–Ω—Ç–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ `spawn_mgr`, –∞ –≤ Env ‚Äî –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤).

- **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–∏ MP2=off**
  - –í—Å–µ MP2 MacroProperty (`mp2_*`) –∏ —Ñ–∞–∑—ã `export_phase` 1/2 (copyout/postprocess).
  - `export_day` (–∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `export_phase=1`).

- **–ö–æ—Å—Ç—ã–ª–∏/—Ö–∞—Ä–¥–∫–æ–¥ (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–≥–∏–∫–∏)**
  - Spawn –Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω—ã—Ö: `group_by=2`, `ac_type_mask=64u`, `partseqno_i=70482u` –∑–∞–¥–∞–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏ –≤ `rtc_spawn_mi17_atomic`.
  - –ü–æ–ª–∏—Ç–∏–∫–∞ approve –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `approve_policy=0` (—Å–∫–∞–Ω –ø–æ idx) ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è.
  - –õ–∏–º–∏—Ç —Ç–∏–∫–µ—Ç–æ–≤ —Å–ø–∞–≤–Ω–∞: –≤ —Ç–µ–∫—É—â–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è 16 –∞–≥–µ–Ω—Ç–æ–≤ `spawn_ticket`, —á—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å—É—Ç–æ—á–Ω—ã–π —Å–ø–∞–≤–Ω 16 —à—Ç. (–µ—Å–ª–∏ `need > 16`, —á–∞—Å—Ç—å –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥; —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏).
  - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `daily_today_u32/daily_next_u32`: –±–µ–∑ `HL_MP5_PROBE=1` –æ—Å—Ç–∞—é—Ç—Å—è –Ω—É–ª—è–º–∏ (–∞–≥–µ–Ω—Ç—ã 2‚Äë–≥–æ —Å—Ç–∞—Ç—É—Å–∞ —Å—á–∏—Ç–∞—é—Ç dt=0).

- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è ¬´—Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª (–±–µ–∑ –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞ MP2)**
  - –í–∫–ª—é—á–∏—Ç—å —á—Ç–µ–Ω–∏–µ MP5 –Ω–∞ GPU: –∑–∞–ø—É—Å–∫ —Å `HL_MP5_PROBE=1` (–∏ `--seatbelts on`) –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è `daily_today_u32/daily_next_u32` –∏–∑ `mp5_daily_hours`.
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `mp5_daily_hours` –∏–º–µ–µ—Ç –¥–ª–∏–Ω—É `(DAYS+1)*FRAMES` –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–æ–π `row = day*FRAMES + idx`, –ø–∞–¥–¥–∏–Ω–≥ `D+1` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
  - –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ—Ä–æ–≥–æ–≤ –¥–ª—è –Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω—ã—Ö: `mi17_*_const` –¥–æ–ª–∂–Ω—ã –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–∑ MP1 (—ç—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ —Å–∏–º—É–ª—è—Ü–∏–∏).
  - –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è approve –ø–æ–º–∏–º–æ ¬´–ø–æ idx¬ª, —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–ª–∏—Ç–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ `mp3_mfg_date_days` –¥–ª—è S2/S3/S5) –∏ –≤–∫–ª—é—á–∏—Ç—å –µ—ë —è–≤–Ω–æ —á–µ—Ä–µ–∑ `approve_policy`.


## V2: –ü–æ—à–∞–≥–æ–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω –∏ –∑–∞–≥—Ä—É–∑–∫–∞ Env

- –ù—É–º–µ—Ä–∞—Ü–∏—è —à–∞–≥–æ–≤ (—Å–∫—Ä–∏–ø—Ç—ã `code/sim_v2/`):
  1) 01_setup_env.py ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ Env –∏–∑ ClickHouse, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ `frames_index`, —Å—Ç—Ä–æ–≥–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  2) 02_build_model_base.py ‚Äî –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å –±–µ–∑ RTC, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Env, smoke
  3) 03_add_probe_mp5.py ‚Äî host‚Äë–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `mp5_lin` –∏/–∏–ª–∏ probe‚Äësmoke MP5 (–±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è RTC)
  4) 04_add_status_246.py ‚Äî —Å—Ç–∞—Ç—É—Å—ã 2/4/6 —Å —á—Ç–µ–Ω–∏–µ–º MP5 (–±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è), –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ validation.md
  5) 05_export_mp5_excel.py ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞/—ç–∫—Å–ø–æ—Ä—Ç MP5 –≤ Excel (–¥–ª–∏–Ω–Ω—ã–π/—à–∞—Ö–º–∞—Ç–Ω—ã–π –≤–∏–¥)
  99) 99_debug_probe_mp5.py ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–µ–Ω–¥ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏/–æ—Ç–ª–∞–¥–∫–∏ NVRTC

- **–®–∞–≥ setup_env (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, –ø–µ—Ä–≤—ã–π)**
  - –ò—Å—Ç–æ—á–Ω–∏–∫: ClickHouse (–≥–æ—Ç–æ–≤—ã–µ –º–∞—Å—Å–∏–≤—ã MP1/MP3/MP4/MP5).
  - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π:
    - `frames_index`: –ø–ª–æ—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ `aircraft_number` –∏–∑ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è (MP3_planes ‚à™ MP5_planes), –ø–æ—Ä—è–¥–æ–∫: MP3 ‚Üí MP5-only.
    - `frames_union_no_future`: |MP3_planes ‚à™ MP5_planes| (–±–µ–∑ –±—É–¥—É—â–∏—Ö ACN).
    - `first_reserved_idx`: –Ω–∞—á–∞–ª–æ –±–ª–æ–∫–∞ MP5‚Äëonly —Å–ª–æ—Ç–æ–≤ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ø–∞–≤–Ω–æ–º).
    - `first_future_idx`: –∏–Ω–¥–µ–∫—Å `base_acn_spawn` –µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ union; –∏–Ω–∞—á–µ = `frames_union_no_future`.
    - `frames_total`: –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Üí `frames_union_no_future + future_buffer`.
  - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Env –º–∞—Å—Å–∏–≤–æ–≤ (–ø–æ –º–µ—Ä–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ RTC):
    - –í—Å–µ–≥–¥–∞: `mp4_ops_counter_mi8/mi17`, `mp4_new_counter_mi17_seed`, `month_first_u32` (–¥–ª–∏–Ω–∞ = DAYS).
    - –î–ª—è MP5: `mp5_daily_hours` (–¥–ª–∏–Ω–∞ = (DAYS+1)*FRAMES, –ø–∞–¥–¥–∏–Ω–≥ D+1 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω) ‚Üí –Ω–∞ —Ö–æ—Å—Ç–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ MacroProperty `mp5_lin`.
    - –î–ª—è S1 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: `mp3_mfg_date_days` (–¥–ª–∏–Ω–∞ = FRAMES).
  - –í–∞–ª–∏–¥–∞—Ü–∏–∏ (–∂—ë—Å—Ç–∫–∏–µ):
    - –î–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç DAYS/FRAMES.
    - `(DAYS+1)*FRAMES` –¥–ª—è MP5, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è `row = day*FRAMES + idx` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.
    - `frames_index` –ø–ª–æ—Ç–Ω—ã–π, –±–µ–∑ –¥—ã—Ä–æ–∫; –Ω–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Å–ø–∞–≤–Ω–∞ —Å—Ç–∞—Ä—Ç—É—é—Ç —Å `first_reserved_idx`/`first_future_idx`.

- **–ü–æ—ç—Ç–∞–ø–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ Env**
  - –ü–æ–¥ RTC‚Äë–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö: –≤–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã/—Å–∫–∞–ª—è—Ä—ã –Ω–∞ —Ç–µ–∫—É—â–µ–º —à–∞–≥–µ.
  - –ü—Ä–∏–º–µ—Ä—ã:
    - MP5‚Äëprobe –≤–∫–ª—é—á—ë–Ω ‚Üí –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ `mp5_daily_hours`.
    - –ü–æ–¥–∫–ª—é—á–∞–µ–º S1‚Äëapprove (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ –¥–∞—Ç–µ) ‚Üí –¥–æ–±–∞–≤–ª—è–µ–º `mp3_mfg_date_days`.

- **–¢–µ—Å—Ç setup_env (smoke)**
  - –ü–µ—á–∞—Ç—å: FRAMES, DAYS, —Ä–∞–∑–º–µ—Ä—ã –∫–ª—é—á–µ–≤—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤, top‚Äë5 `frames_index` –∏ –≥—Ä–∞–Ω–∏—Ü—ã –±–ª–æ–∫–æ–≤.
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ assert –ø—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏.


## V2: –¢–∞–±–ª–∏—Ü–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –∏—Ö RTC/—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (host‚Äëonly –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MP5)

| ‚Ññ | –°–∫—Ä–∏–ø—Ç/–®–∞–≥ | RTC –§—É–Ω–∫—Ü–∏–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è |
|---|------------|-------------|------------|------------|----------------|-----------------|-------------------|
| 1 | `code/sim_v2/01_setup_env.py` | ‚Äî | ETL –∏ —Å–Ω–∞–ø—à–æ—Ç—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ ClickHouse MP1/MP3/MP4/MP5, —Å—Ç—Ä–æ–∏—Ç `frames_index`, –≤—ã—á–∏—Å–ª—è–µ—Ç `FRAMES`/`DAYS`, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º—ã; —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `env_snapshot.json` | ClickHouse: MP1/MP3/MP4/MP5 | `env_snapshot.json`, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ | –û–¥–∏–Ω —Ä–∞–∑ –¥–æ —Å–±–æ—Ä–∫–∏ –º–æ–¥–µ–ª–∏ |
| 2 | `code/sim_v2/02_build_model_base.py` | ‚Äî | –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å –±–µ–∑ RTC | –û–±—ä—è–≤–ª—è–µ—Ç Environment –∏ –∞–≥–µ–Ω—Ç `component` —Å –±–∞–∑–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏; –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∫–∞–ª—è—Ä—ã `version_date/frames_total/days_total`; smoke –ø–µ—á–∞—Ç—å | `env_snapshot.json`, –º–∞—Å—Å–∏–≤—ã Env –∏–∑ ClickHouse | –ì–æ—Ç–æ–≤–∞—è –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å (–±–µ–∑ RTC), —Å–æ–æ–±—â–µ–Ω–∏–µ `V2 Base OK` | –û–¥–∏–Ω —Ä–∞–∑ –¥–æ –∑–∞–ø—É—Å–∫–∞ RTC |
| 3 | `code/sim_v2/03_add_probe_mp5.py` | ‚Äî (HostFunction `hf_load_mp5`), –æ–ø—Ü. `rtc_probe_mp5_d{DAYS}` | Host‚Äë–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MP5 –∏/–∏–ª–∏ smoke‚Äë–ø—Ä–æ–±–∞ | –ó–∞–ø–æ–ª–Ω—è–µ—Ç `mp5_lin` –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —Ö–æ—Å—Ç–µ –∏–∑ `mp5_daily_hours_linear` (–±–µ–∑ `mp5_src` –∏ –∫–æ–ø–∏—Ä—É—é—â–µ–≥–æ RTC); –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç probe‚Äë—è–¥—Ä–æ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ `dt/dn` | `env_snapshot.json`, `mp5_daily_hours_linear` | –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π `mp5_lin`, –ª–æ–≥–∏ sample(dt,dn) | –û–¥–∏–Ω —Ä–∞–∑ –¥–æ —Å–∏–º—É–ª—è—Ü–∏–∏ / –æ—Ç–ª–∞–¥–∫–∞ |
| 4 | `code/sim_v2/04_add_status_246.py` | `rtc_probe_mp5`, `rtc_status_2` | –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–æ–Ω–Ω—ã–π —Ü–∏–∫–ª (–º–∏–Ω–∏–º—É–º) | –ù–∞ –∫–∞–∂–¥–æ–º –¥–Ω–µ —á–∏—Ç–∞–µ—Ç `mp5_lin` –≤ `dt/dn`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å‚Äë2 (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ `sne/ppr`, LL‚Äë–ø–æ—Ä–æ–≥ 2‚Üí6); –ª–æ–≥–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ | `env_snapshot.json`, `mp5_lin`, `mp3_ll_by_frame`, `mp3_oh_by_frame` | –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Å—á—ë—Ç—á–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–π | –ö–∞–∂–¥—ã–π —Å–∏–º—É–ª—è—Ü–∏–æ–Ω–Ω—ã–π –¥–µ–Ω—å |
| 5 | `code/sim_v2/05_export_mp5_excel.py` | ‚Äî | –≠–∫—Å–ø–æ—Ä—Ç MP5 –≤ Excel | –§–æ—Ä–º–∏—Ä—É–µ—Ç long‚Äëview –∏ –º–∞—Ç—Ä–∏—á–Ω—ã–π —Å—ç–º–ø–ª MP5; –ø–∏—à–µ—Ç –≤ XLSX —á–∞–Ω–∫–∞–º–∏ | `mp5_daily_hours_linear`, `frames_index` | –§–∞–π–ª Excel (`tmp/mp5_export.xlsx`) | –ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –≤–Ω–µ —Ü–∏–∫–ª–∞ |
| 6 | `code/sim_v2/99_debug_probe_mp5.py` | `rtc_probe_mp5_d{DAYS}` | NVRTC/RTC –æ—Ç–ª–∞–¥–∫–∞ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è probe‚Äë—è–¥—Ä–∞; –ø–µ—á–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞ –∏ –æ—à–∏–±–æ–∫ NVRTC | `env_snapshot.json`, —Ä–∞–∑–º–µ—Ä—ã DAYS/FRAMES | –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏/–∑–∞–ø—É—Å–∫–∞ | –ê–¥‚Äëhoc –æ—Ç–ª–∞–¥–∫–∞ |

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –ù–∞ —à–∞–≥–µ 04 –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∫–ª—é—á—ë–Ω —Ç–æ–ª—å–∫–æ `rtc_status_2`; `rtc_status_4`/`rtc_status_6` –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ MP5 –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤.
- Fallback‚Äë–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `rtc_mp5_copy_columns` –∏—Å–∫–ª—é—á–µ–Ω–∞: MP5 –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ `mp5_lin` –Ω–∞ —Ö–æ—Å—Ç–µ.

## V2: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å state-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 22.12.2024)

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **State-based**: –ü–µ—Ä–µ—Ö–æ–¥ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `status_id` –Ω–∞ FLAME GPU States –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ GPU
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ï–¥–∏–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–≤–æ—Ç –≤–º–µ—Å—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏
- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã**: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ –µ–¥–∏–Ω–æ–π RTC —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–Ω—Ü–µ —Å—Ç–µ–ø–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —Å—Ç–µ–ø–µ:
1. **–§–∞–∑–∞ 0**: HostFunction –¥–ª—è MP5 (—Ç–æ–ª—å–∫–æ –Ω–∞ step=0)
2. **–§–∞–∑–∞ 1**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ RTC –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º
   - –û—Ç–¥–µ–ª—å–Ω–∞—è RTC —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ state (0-6)
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ, GPU —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
3. **–§–∞–∑–∞ 2**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
4. **–§–∞–∑–∞ 3**: –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **OH –∏–∑ MP1 –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏**: –ó–Ω–∞—á–µ–Ω–∏—è oh –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤, –Ω–µ –≤ RTC
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–µ—Ä–æ–≤**: –¢–æ–ª—å–∫–æ group_by ‚àà {1,2} —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞–≥–µ–Ω—Ç–∞–º–∏
- **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã**: MAX_FRAMES –∏–∑ –¥–∞–Ω–Ω—ã—Ö, MAX_DAYS=4000
- **–ï–¥–∏–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ MP5**: –ß–µ—Ä–µ–∑ HostFunction –Ω–∞ step=0

–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: [v2_architecture_consolidated.md](v2_architecture_consolidated.md)
(–°—Ç–∞—Ä—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: [v2_state_based_architecture.md](v2_state_based_architecture.md))

ENV‚Äë–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:
- `FRAMES`, `DAYS`, `frames_index` –±–µ—Ä—É—Ç—Å—è –∏–∑ `env_snapshot.json` –∏ –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ —à–∞–≥–∞—Ö 03/04.
- MacroProperty —Ä–∞–∑–º–µ—Ä—ã: MAX_FRAMES –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö MP3/MP5, MAX_DAYS=4000, MAX_SIZE=MAX_FRAMES*(MAX_DAYS+1). –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ RTC –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–µ—Ä–∏–æ–¥–∞ —Å–∏–º—É–ª—è—Ü–∏–∏.
- –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `mp5_lin` –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ –≤ RTC; –∑–∞–ø–∏—Å—å –≤ –Ω–µ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–∞.
- RTC –∏–º–µ–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã: `rtc_probe_mp5`, `rtc_status_2`, `rtc_status_4`, `rtc_status_6` (–±–µ–∑ `rtc_mp5_copy_columns`).

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ –∏ —Ç–µ—Å—Ç‚Äë–º–∞—Ç—Ä–∏—Ü–∞ (host‚Äëonly):
- DAYS={5,90,365}; –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–¥–µ–Ω–∏–π NVRTC; –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä–∞–∑–º–µ—Ä—ã `mp5_lin`, checksum –ø–µ—Ä–≤—ã—Ö 64–ö–ë, –ø–µ—Ä–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
- –í–∞–ª–∏–¥–∞—Ü–∏–∏: –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç—å S6, `Œîsne_s2 == sum(dt_s2)`; –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è `base = day*MAX_FRAMES + idx`.

## –§–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏ (V2, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)

–î–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏ —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ –Ω–∞ —ç–∫—Ä–∞–Ω –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

- –°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º –Ω–∞ –ö–ê–ñ–î–û–ú —à–∞–≥–µ —Å–∏–º—É–ª—è—Ü–∏–∏:
  - –°—Ç—Ä–æ–∫–∞: `Step <N>: counts inactive=<...>, operations=<...>, serviceable=<...>, repair=<...>, reserve=<...>, storage=<...>`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –±—ã—Å—Ç—Ä—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ state –Ω–∞ —à–∞–≥–µ.

- –õ–æ–≥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π intent –¢–û–õ–¨–ö–û –¥–ª—è state=operations, –∫–æ–≥–¥–∞ intent —Å–º–µ–Ω–∏–ª—Å—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ, –æ—Ç–ª–∏—á–Ω–æ–µ –æ—Ç 2:
  - –°—Ç—Ä–æ–∫–∞ (–æ–¥–Ω–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ):
    - `[Day <N> | date=<YYYY-MM-DD>] AC <aircraft_number> idx=<idx>: intent <old>-><new> (operations) `
      `sne=<sne_curr>, ppr=<ppr_curr>, dt=<dt_curr>, dn=<dn_curr>, s_next=<sne_old+dn_old>, p_next=<ppr_old+dn_old>, `
      `ll=<ll>, oh=<oh>, br=<br>`
  - –î–∞—Ç–∞: –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ `date = 1970-01-01 + (version_date_u16 + day_u16)` –∏ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –≤ ISO (`YYYY-MM-DD`).
  - –ü—Ä–æ–≥–Ω–æ–∑—ã `s_next/p_next`: —Å—á–∏—Ç–∞—é—Ç—Å—è –ò–ó –°–û–°–¢–û–Ø–ù–ò–Ø ¬´–î–û —à–∞–≥–∞¬ª, —Ç–æ –µ—Å—Ç—å –±–µ–∑ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ `dt`:
    - `s_next = sne_old + dn_old`, `p_next = ppr_old + dn_old`.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø–µ—Ä–µ—á–Ω–∏ –∞–≥–µ–Ω—Ç–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –æ—Ç–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –Ω–µ –ø–µ—á–∞—Ç–∞—é—Ç—Å—è –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

## State Manager –∏ Intent-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 10.10.2025)

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è intent_state (V2 —Ñ–∏–Ω–∞–ª—å–Ω–∞—è)

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –∂–µ–ª–∞–Ω–∏—è –∏ —Ñ–∞–∫—Ç–∞**:

1. **intent_state** - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∞–≥–µ–Ω—Ç–∞, —É–∫–∞–∑—ã–≤–∞—é—â–∞—è **–∂–µ–ª–∞–µ–º–æ–µ** —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
2. **RTC —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π** - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç intent_state –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, **–ù–ï –º–µ–Ω—è—é—Ç** state
3. **Quota –º–æ–¥—É–ª–∏** - –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç intent_state –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–≤–æ—Ç (–ø–æ–≤—ã—à–µ–Ω–∏–µ/–ø–æ–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
4. **State Managers** - –ø—Ä–∏–º–µ–Ω—è—é—Ç **—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã** —á–µ—Ä–µ–∑ `setEndState()` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ intent_state

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ intent_state –≤ RTC —Ñ—É–Ω–∫—Ü–∏—è—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:
```cuda
// –í rtc_state_2_operations
const unsigned int sne_next = sne + dn;
const unsigned int ppr_next = ppr + dn;

if (ppr_next >= oh && sne_next < br) {
    FLAMEGPU->setVariable<unsigned int>("intent_state", 4u);  // –†–µ–º–æ–Ω—Ç
} else if (sne_next >= ll) {
    FLAMEGPU->setVariable<unsigned int>("intent_state", 6u);  // –•—Ä–∞–Ω–µ–Ω–∏–µ
} else {
    FLAMEGPU->setVariable<unsigned int>("intent_state", 2u);  // Operations
}
```

#### 2. –°–µ–º–∞–Ω—Ç–∏–∫–∞ intent_state (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è):
- **intent=2** ‚Äî –∞–≥–µ–Ω—Ç **—Ö–æ—á–µ—Ç –±—ã—Ç—å** –≤ operations (–∏–ª–∏ —É–∂–µ —Ç–∞–º –∏ —Ö–æ—á–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è)
- **intent=3** ‚Äî –¥–µ–º–æ—É–Ω—Ç –≤ serviceable (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–≤–æ—Ç—ã –¥–ª—è operations)
- **intent=4** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–º–æ–Ω—Ç (ppr ‚â• oh AND sne < br)
- **intent=6** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (sne ‚â• ll)
- **intent=0** ‚Äî **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** (–≤—Å–µ–≥–¥–∞ —è–≤–Ω–æ–µ –∂–µ–ª–∞–Ω–∏–µ)

**–í–∞–∂–Ω–æ:** intent **–Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è** –≤ 0 –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∫–≤–æ—Ç—ã ‚Äî –∞–≥–µ–Ω—Ç—ã –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç —Ç–µ–∫—É—â–µ–µ –∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

#### 3. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ intent —á–µ—Ä–µ–∑ quota –º–æ–¥—É–ª–∏:
```cuda
// quota_ops_excess (–¥–µ–º–æ—É—Ç)
if (balance > 0 && rank < K) {
    // –ò–∑–±—ã—Ç–æ–∫ –≤ operations ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ serviceable
    FLAMEGPU->setVariable<unsigned int>("intent_state", 3u);
}

// quota_promote_serviceable (–ø—Ä–æ–º–æ—É—Ç P1)
if (deficit > 0 && rank < K) {
    // –î–µ—Ñ–∏—Ü–∏—Ç –≤ operations ‚Üí –ø—Ä–æ–º–æ—É—Ç –∏–∑ serviceable
    FLAMEGPU->setVariable<unsigned int>("intent_state", 2u);
    approve_s3[idx] = 1u;  // –ü–æ–º–µ—á–∞–µ–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–æ—è
}
// –ï—Å–ª–∏ –ù–ï –æ–¥–æ–±—Ä–∏–ª–∏: intent –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ 0!)
```

#### 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ State Managers:
```cuda
// state_manager_operations (–¥–ª—è state=operations)
const unsigned int intent = FLAMEGPU->getVariable<unsigned int>("intent_state");

if (intent == 4u) {
    // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–º–æ–Ω—Ç
    FLAMEGPU->setInitialState("operations");
    FLAMEGPU->setEndState("repair");
    return flamegpu::ALIVE;
} else if (intent == 6u) {
    // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
    FLAMEGPU->setInitialState("operations");
    FLAMEGPU->setEndState("storage");
    return flamegpu::ALIVE;
} else if (intent == 3u) {
    // –ö–≤–æ—Ç–∏—Ä—É–µ–º—ã–π –¥–µ–º–æ—É–Ω—Ç –≤ serviceable
    FLAMEGPU->setInitialState("operations");
    FLAMEGPU->setEndState("serviceable");
    return flamegpu::ALIVE;
} else if (intent == 2u) {
    // –û—Å—Ç–∞—ë–º—Å—è –≤ operations
    return flamegpu::DEAD;  // –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã V2

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: RTC —Å–æ—Å—Ç–æ—è–Ω–∏–π + Quota + State Managers ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
2. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: P1‚ÜíP2‚ÜíP3 —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –æ—Å—Ç–∞—Ç–∫–∞ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è intent –∏ quota**: count_ops —Å—á–∏—Ç–∞–µ—Ç –ø–æ intent=2, –Ω–µ –ø–æ state
4. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: youngest first (–ø—Ä–æ–º–æ—É—Ç) / oldest first (–¥–µ–º–æ—É—Ç)
5. **–û—Ç–ª–∞–¥–∫–∞**: –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ intent –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ V2

#### RTC —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π:
- `rtc_state_2_operations.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ operations (sne/ppr –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã + intent)
- `rtc_states_stub.py` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ intent –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π (1, 4, 5, 6)

#### Quota –º–æ–¥—É–ª–∏ (–∫–∞—Å–∫–∞–¥–Ω–æ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ):
- `rtc_quota_count_ops.py` ‚Äî –ø–æ–¥—Å—á—ë—Ç –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2 –≤ operations (**–í–∞—Ä–∏–∞–Ω—Ç B**)
- `rtc_quota_ops_excess.py` ‚Äî –¥–µ–º–æ—É–Ω—Ç (operations ‚Üí serviceable, oldest first)
- `rtc_quota_promote_serviceable.py` ‚Äî –ø—Ä–æ–º–æ—É—Ç P1 (serviceable ‚Üí operations, youngest first)
- `rtc_quota_promote_reserve.py` ‚Äî –ø—Ä–æ–º–æ—É—Ç P2 (reserve ‚Üí operations, youngest first)
- `rtc_quota_promote_inactive.py` ‚Äî –ø—Ä–æ–º–æ—É—Ç P3 (inactive ‚Üí operations, youngest first)

#### State Managers (–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤):
- `rtc_state_manager_serviceable.py` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ 3‚Üí2 (serviceable ‚Üí operations)
- `rtc_state_manager_operations.py` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥—ã 2‚Üí2, 2‚Üí3, 2‚Üí4, 2‚Üí6
- `rtc_state_manager_repair.py` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥—ã 4‚Üí4, 4‚Üí5 (repair ‚Üí reserve)
- `rtc_state_manager_storage.py` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ 6‚Üí6 (storage ‚Üí storage)

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏:
- `rtc_spawn_v2.py` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ (–≤ –∫–æ–Ω—Ü–µ –ø–∞–π–ø–ª–∞–π–Ω–∞!)

---

## –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ RTC —Ñ—É–Ω–∫—Ü–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–π (–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ 14.10.2025)

### rtc_state_2_operations ‚Äî –õ–æ–≥–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –≤ state=operations ‚Äî –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã –Ω–∞—Ä–∞–±–æ—Ç–∫–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ intent –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞: sne, ppr, ll, oh, br, daily_next_u32 (dn)
- MacroProperty: mp5_lin (—Å—É—Ç–æ—á–Ω—ã–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã –∏–∑ MP5)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏: sne (–Ω–∞—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω–∞—á–∞–ª–∞ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏), ppr (–Ω–∞—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞)
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π intent_state (2=operations, 4=repair, 6=storage)
- –°–±—Ä–æ—Å active_trigger –µ—Å–ª–∏ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å–∏–º—É–ª—è—Ü–∏–∏):**

1. **–î–µ–Ω—å 0 (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è):**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è intent=2 (operations)
   - –ù–∏–∫–∞–∫–∏—Ö –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   - –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É

2. **–î–µ–Ω—å 1+ (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞):**
   
   **–®–∞–≥ 1 ‚Äî –ß—Ç–µ–Ω–∏–µ —Å—É—Ç–æ—á–Ω—ã—Ö —á–∞—Å–æ–≤ –∏–∑ MP5:**
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å –≤ mp5_lin –Ω–∞ –æ—Å–Ω–æ–≤–µ step_day –∏ idx –∞–≥–µ–Ω—Ç–∞
   - –ß–∏—Ç–∞—é—Ç—Å—è dt (—á–∞—Å—ã —Ä–∞–±–æ—Ç—ã —Å–µ–≥–æ–¥–Ω—è) –∏ dn (—á–∞—Å—ã —Ä–∞–±–æ—Ç—ã –∑–∞–≤—Ç—Ä–∞)
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ daily_today_u32 –∏ daily_next_u32

   **–®–∞–≥ 2 ‚Äî –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–∞—Ä–∞–±–æ—Ç–∫–∏:**
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¢–ï–ö–£–©–ò–ï —á–∞—Å—ã (dt), –∞ –Ω–µ –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–µ (dn)
   - sne += dt (–æ–±—â–∞—è –Ω–∞—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω–∞—á–∞–ª–∞ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏)
   - ppr += dt (–Ω–∞—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞)

   **–®–∞–≥ 3 ‚Äî –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞—à–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π:**
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è sne_next = sne + dn (–ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –∑–∞–≤—Ç—Ä–∞)
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è ppr_next = ppr + dn (–ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –∑–∞–≤—Ç—Ä–∞)

   **–®–∞–≥ 4 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ intent:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
     1. –ï—Å–ª–∏ ppr_next >= oh –ò sne_next < br ‚Üí intent=4 (—Ä–µ–º–æ–Ω—Ç)
     2. –ò–Ω–∞—á–µ –µ—Å–ª–∏ sne_next >= ll ‚Üí intent=6 (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ —Å—Ä–æ–∫—É —Å–ª—É–∂–±—ã)
     3. –ò–Ω–∞—á–µ –µ—Å–ª–∏ sne_next >= br ‚Üí intent=6 (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ –Ω–µ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º–æ—Å—Ç–∏)
     4. –ò–Ω–∞—á–µ ‚Üí intent=2 (–æ—Å—Ç–∞–µ–º—Å—è –≤ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö)

   **–®–∞–≥ 5 ‚Äî –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:**
   - –ï—Å–ª–∏ active_trigger=1, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0 (—Ñ–∞–∫—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω)

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- **Day 0 –±–µ–∑ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤:** –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ MP3 –Ω–µ –∏—Å–∫–∞–∂–∞—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã –Ω–∞ dt, –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ dn:** –ù–∞—Ä–∞–±–æ—Ç–∫–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ñ–∞–∫—Ç—É (—Å–µ–≥–æ–¥–Ω—è), –ø–µ—Ä–µ—Ö–æ–¥—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É—é—Ç—Å—è (–Ω–∞ –∑–∞–≤—Ç—Ä–∞)
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç OH –Ω–∞–¥ BR:** –ê–≥–µ–Ω—Ç –∏–¥–µ—Ç –≤ —Ä–µ–º–æ–Ω—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º (sne < br)
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å intent:** –ó–Ω–∞—á–µ–Ω–∏–µ intent —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∑–∞–Ω–æ–≤–æ, –Ω–µ –∞–∫–∫—É–º—É–ª–∏—Ä—É–µ—Ç—Å—è

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- sne –≤—Å–µ–≥–¥–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ —Ä–∞—Å—Ç–µ—Ç (Œîsne = sum(dt) –∑–∞ –≤—Å–µ –¥–Ω–∏ –≤ operations)
- ppr —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ repair (–≤ state_manager)
- intent —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (3650 –¥–Ω–µ–π, 161 –∞–≥–µ–Ω—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤ operations):**
- ‚úÖ 90 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ repair (intent=4) ‚Äî –∞–≥–µ–Ω—Ç—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ (oh)
- ‚úÖ 62 –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ storage (intent=6) ‚Äî 57 –ø–æ BR (beyond repair), 5 –ø–æ LL (—Å—Ä–æ–∫ —Å–ª—É–∂–±—ã)
- ‚úÖ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç Œîsne = sum(dt) –≤—ã–ø–æ–ª–Ω–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: operations=2, repair=97, storage=62 (2+97+62=161)

---

### rtc_states_stub ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ intent –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—Ä–µ–º–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å-–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∞–∑–æ–≤–æ–≥–æ intent_state —É –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö inactive, serviceable, repair, reserve, storage. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ** state_2_operations, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –µ–≥–æ intent.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
1. state_1 (inactive) ‚Äî "–ñ–µ–ª–µ–∑–Ω—ã–π —Ä—è–¥"
2. state_3 (serviceable) ‚Äî –ò—Å–ø—Ä–∞–≤–Ω—ã–µ, –≥–æ—Ç–æ–≤—ã–µ –∫ —Ä–∞–±–æ—Ç–µ
3. state_4 (repair) ‚Äî –í —Ä–µ–º–æ–Ω—Ç–µ
4. state_5 (reserve) ‚Äî –†–µ–∑–µ—Ä–≤ –ø–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞
5. state_6 (storage) ‚Äî –•—Ä–∞–Ω–µ–Ω–∏–µ/—É—Ç–∏–ª–∏–∑–∞—Ü–∏—è

---

#### –õ–æ–≥–∏–∫–∞ state_1 (inactive) ‚Äî "–ñ–µ–ª–µ–∑–Ω—ã–π —Ä—è–¥"

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≥–æ—Ç–æ–≤ –ª–∏ –∞–≥–µ–Ω—Ç –∏–∑ "–∂–µ–ª–µ–∑–Ω–æ–≥–æ —Ä—è–¥–∞" –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- –ê–≥–µ–Ω—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ "–∂–µ–ª–µ–∑–Ω–æ–º —Ä—è–¥—É" ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –ø–µ—Ä–µ–¥ –≤–≤–æ–¥–æ–º –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è repair_time —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞
- –ê–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å –Ω–∞—á–∞–ª–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –ø—Ä–æ—à–ª–æ >= repair_time –¥–Ω–µ–π

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:**
   - –ß–∏—Ç–∞–µ—Ç—Å—è repair_time –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è step_day —Å repair_time
   - –ï—Å–ª–∏ step_day >= repair_time ‚Üí –∞–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (intent=2)
   - –ò–Ω–∞—á–µ ‚Üí –∞–≥–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤ "–∂–µ–ª–µ–∑–Ω–æ–º —Ä—è–¥—É" (intent=1)

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ intent:**
- intent=1: –ê–≥–µ–Ω—Ç –ù–ï –ì–û–¢–û–í –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏, –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- intent=2: –ê–≥–µ–Ω—Ç –ì–û–¢–û–í –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏, –±—É–¥–µ—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥ –≤ operations

**–ü—Ä–∏–º–µ—Ä (repair_time=180):**
- Day 0-179: intent=1 (–µ—â–µ –Ω–µ –ø—Ä–æ—à–ª–æ 180 –¥–Ω–µ–π, –∞–≥–µ–Ω—Ç –≤ –ñ–†)
- Day 180+: intent=2 (–ø—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏, –∞–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (3650 –¥–Ω–µ–π, 118 inactive –∞–≥–µ–Ω—Ç–æ–≤, repair_time=180):**
- ‚úÖ Days 0-179: –≤—Å–µ 118 –∞–≥–µ–Ω—Ç–æ–≤ –∏–º–µ—é—Ç intent=1
- ‚úÖ Days 180-3649: –≤—Å–µ 118 –∞–≥–µ–Ω—Ç–æ–≤ –∏–º–µ—é—Ç intent=2
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–æ–≤–Ω–æ –Ω–∞ day 180 (–Ω–µ —Ä–∞–Ω—å—à–µ –∏ –Ω–µ –ø–æ–∑–∂–µ)
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –∑–Ω–∞—á–µ–Ω–∏–µ intent –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞

---

#### –õ–æ–≥–∏–∫–∞ state_3 (serviceable) ‚Äî –ò—Å–ø—Ä–∞–≤–Ω—ã–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "–∏—Å–ø—Ä–∞–≤–µ–Ω, –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ".

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- –ê–≥–µ–Ω—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –≤–≤–æ–¥—É –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–º–æ–Ω—Ç –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ intent:**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è intent=2 (–≤—Å–µ–≥–¥–∞, –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö)

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ intent:**
- intent=2: –ê–≥–µ–Ω—Ç –í–°–ï–ì–î–ê —Å—Ç—Ä–µ–º–∏—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ operations

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** –ú–æ–¥—É–ª—å –Ω–µ –∏–º–µ–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤. –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç intent=2 –¥–ª—è –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

#### –õ–æ–≥–∏–∫–∞ state_4 (repair) ‚Äî –í —Ä–µ–º–æ–Ω—Ç–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º —Ä–µ–º–æ–Ω—Ç–∞, —Ñ–∞–∑–æ–π —Å–±–æ—Ä–∫–∏ (assembly_trigger) –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Ä–µ–º–æ–Ω—Ç–∞.

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- –ê–≥–µ–Ω—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Ä–µ–º–æ–Ω—Ç —Å –∏–∑–≤–µ—Å—Ç–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é (repair_time)
- –í–Ω—É—Ç—Ä–∏ —Ä–µ–º–æ–Ω—Ç–∞ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è —Ñ–∞–∑–∞ —Å–±–æ—Ä–∫–∏ (assembly_time) –≤ –∫–æ–Ω—Ü–µ —Ü–∏–∫–ª–∞
- –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–µ–º–æ–Ω—Ç–∞ –∞–≥–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∑–µ—Ä–≤ (intent=5)

**–ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
- repair_days: —Å—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π –≤ —Ä–µ–º–æ–Ω—Ç–µ (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
- repair_time: –æ–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞ (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è –∞–≥–µ–Ω—Ç–∞)
- assembly_time: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–∞–∑—ã —Å–±–æ—Ä–∫–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π —Ä–µ–º–æ–Ω—Ç–∞)
- assembly_trigger: —Ñ–ª–∞–≥ —Ñ–∞–∑—ã —Å–±–æ—Ä–∫–∏ (0 –∏–ª–∏ 1)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–î–µ–Ω—å 0 (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è):**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è intent=4
   - repair_days –∏ assembly_trigger –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ MP3 (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
   - –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ë–ï–ó –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤

2. **–î–µ–Ω—å 1+ (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞):**

   **–®–∞–≥ 1 ‚Äî –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á–µ—Ç—á–∏–∫–∞ –¥–Ω–µ–π —Ä–µ–º–æ–Ω—Ç–∞:**
   - repair_days —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 1
   - –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ö–ê–ñ–î–´–ô –¥–µ–Ω—å, –ø–æ–∫–∞ –∞–≥–µ–Ω—Ç –≤ state=repair

   **–®–∞–≥ 2 ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ assembly_trigger (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞):**
   
   2.1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Ç—Ä–∏–≥–≥–µ—Ä–∞:
   - –ï—Å–ª–∏ assembly_trigger=1, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0
   - –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä "–∂–∏–≤–µ—Ç" —Ç–æ–ª—å–∫–æ 1 –¥–µ–Ω—å
   
   2.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–∞ —Ñ–∞–∑—ã —Å–±–æ—Ä–∫–∏:
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ—Ä–æ–≥: repair_time - assembly_time
   - –ï—Å–ª–∏ repair_days –†–ê–í–ï–ù –ø–æ—Ä–æ–≥—É ‚Üí assembly_trigger —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 1
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ (==), —á—Ç–æ–±—ã —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª –û–î–ò–ù –†–ê–ó

   **–®–∞–≥ 3 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞:**
   
   3.1. –ï—Å–ª–∏ repair_days == repair_time (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ):
   - intent —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 5 (—Ä–µ–∑–µ—Ä–≤)
   - ppr —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0 (–Ω–æ–≤—ã–π –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω—ã–π —Ü–∏–∫–ª)
   - repair_days —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0 (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ü–∏–∫–ª—É)
   
   3.2. –ò–Ω–∞—á–µ (—Ä–µ–º–æ–Ω—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è):
   - intent —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 4 (–æ—Å—Ç–∞–µ–º—Å—è –≤ —Ä–µ–º–æ–Ω—Ç–µ)

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π assembly_trigger:** –¢—Ä–∏–≥–≥–µ—Ä —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –Ω–∞ 1 –¥–µ–Ω—å (–∫–æ–≥–¥–∞ repair_days –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ø–æ—Ä–æ–≥–∞), –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –õ–æ–≥–∏–∫–∞ —Å–±—Ä–æ—Å–∞/—É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö
- **–¶–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å –±–µ–∑ state_manager:** –ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π state –∞–≥–µ–Ω—Ç–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è (–Ω–µ—Ç –º–æ–¥—É–ª—è state_manager_repair), –∞–≥–µ–Ω—Ç –±—É–¥–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ä–µ–º–æ–Ω—Ç: repair_days 0‚Üí180‚Üí0‚Üí180...

**–ü—Ä–∏–º–µ—Ä —Ü–∏–∫–ª–∞ —Ä–µ–º–æ–Ω—Ç–∞ (repair_time=180, assembly_time=30):**

–î–µ–Ω—å 0 (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ MP3):
- repair_days=117 (–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏)
- days_left = 180-117 = 63 –¥–Ω—è –¥–æ –∫–æ–Ω—Ü–∞ —Ä–µ–º–æ–Ω—Ç–∞
- 63 > 30 ‚Üí assembly_trigger=0 (–µ—â–µ –Ω–µ –≤ —Ñ–∞–∑–µ —Å–±–æ—Ä–∫–∏)

–î–µ–Ω—å 1-62:
- repair_days –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è: 118, 119, ..., 179
- assembly_trigger –æ—Å—Ç–∞–µ—Ç—Å—è 0

–î–µ–Ω—å 63:
- repair_days=180 (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç)
- intent=5, ppr‚Üí0, repair_days‚Üí0
- (–í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ –∑–¥–µ—Å—å –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –≤ reserve)

–î–µ–Ω—å 64 (—Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, —Ç.–∫. state –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è):
- repair_days=1

–î–µ–Ω—å 150 (—á–µ—Ä–µ–∑ 87 –¥–Ω–µ–π, repair_days=87):
- 87 == 180-30-63 ‚Üí –ù–ï–¢, –Ω–µ–≤–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ: repair_days == 150 == 180-30 ‚Üí assembly_trigger=1

–î–µ–Ω—å 151:
- assembly_trigger —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0

–î–µ–Ω—å 243:
- repair_days=180 ‚Üí intent=5, ppr‚Üí0, repair_days‚Üí0

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (3650 –¥–Ω–µ–π, 7 –∞–≥–µ–Ω—Ç–æ–≤ –≤ repair, repair_time=180, assembly_time=30):**

**Day 0 (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ MP3, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ assembly_trigger):**
- ‚úÖ AC 22431: repair_days=157, days_left=23 < 30 ‚Üí assembly_trigger=1 (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –≤ —Ñ–∞–∑–µ —Å–±–æ—Ä–∫–∏)
- ‚úÖ AC 22215: repair_days=117, days_left=63 > 30 ‚Üí assembly_trigger=0 (–Ω–µ –≤ —Ñ–∞–∑–µ —Å–±–æ—Ä–∫–∏)

**–¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ (7 –∞–≥–µ–Ω—Ç–æ–≤ √ó 3650 –¥–Ω–µ–π):**
- ‚úÖ 20 –ø–æ–ª–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ —Ä–µ–º–æ–Ω—Ç–∞ (repair_days: 0‚Üí180‚Üí0‚Üí180...)
- ‚úÖ 20 —Å–±—Ä–æ—Å–æ–≤ repair_days‚Üí0 (–ø–æ 1 –Ω–∞ —Ü–∏–∫–ª)
- ‚úÖ 147 —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π assembly_trigger (7 –∞–≥–µ–Ω—Ç–æ–≤ √ó 21 —Ä–∞–∑ = 7√óday0 + 7√ó20—Ü–∏–∫–ª–æ–≤)

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- ‚úÖ repair_days <= repair_time (–Ω–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π)
- ‚úÖ assembly_trigger=1 —Ä–æ–≤–Ω–æ 1 –¥–µ–Ω—å –∑–∞ —Ü–∏–∫–ª (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- ‚úÖ –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ repair_days==repair_time (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç–∏:** –≠—Ç–æ –û–ñ–ò–î–ê–ï–ú–û–ï –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–µ–∑ state_manager_repair. –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ intent=5 –º–æ–¥—É–ª—å state_manager –ø–µ—Ä–µ–≤–µ–¥–µ—Ç –∞–≥–µ–Ω—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ reserve, –∏ —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—Å—è.

---

#### –õ–æ–≥–∏–∫–∞ state_5 (reserve) ‚Äî –†–µ–∑–µ—Ä–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏ –≤ —Ä–µ–∑–µ—Ä–≤–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞.

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- –ê–≥–µ–Ω—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –≤–≤–æ–¥—É –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é
- –ò–º–µ—é—Ç –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å serviceable

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ intent:**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è intent=2 (–≤—Å–µ–≥–¥–∞, –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö)

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ intent:**
- intent=2: –ê–≥–µ–Ω—Ç —Å—Ç—Ä–µ–º–∏—Ç—Å—è –≤ operations (—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º P2 –≤ –∫–∞—Å–∫–∞–¥–Ω–æ–º –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** –ú–æ–¥—É–ª—å –Ω–µ –∏–º–µ–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤. –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç intent=2 –¥–ª—è –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

#### –õ–æ–≥–∏–∫–∞ state_6 (storage) ‚Äî –•—Ä–∞–Ω–µ–Ω–∏–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏ –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ (—É—Ç–∏–ª–∏–∑–∞—Ü–∏—è, —Å–ø–∏—Å–∞–Ω–∏–µ).

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- –ê–≥–µ–Ω—Ç—ã –≤—ã–≤–µ–¥–µ–Ω—ã –∏–∑ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ù–ï–ò–ó–ú–ï–ù–Ø–ï–ú–û–ï (S6 immutable)
- –ê–≥–µ–Ω—Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç storage

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ intent:**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è intent=6 (–≤—Å–µ–≥–¥–∞, –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö)

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ intent:**
- intent=6: –ê–≥–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤ storage –Ω–∞–≤—Å–µ–≥–¥–∞

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç S6:** –ê–≥–µ–Ω—Ç—ã, –ø–æ–ø–∞–≤—à–∏–µ –≤ storage (–ø–æ –ª—é–±–æ–π –ø—Ä–∏—á–∏–Ω–µ: BR, LL, partout), –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–º –¥–æ –∫–æ–Ω—Ü–∞ —Å–∏–º—É–ª—è—Ü–∏–∏. –≠—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤ validation.md.

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** –ú–æ–¥—É–ª—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ intent –∞–≥–µ–Ω—Ç–æ–≤ –≤ storage –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–µ—Ç—Å—è 6, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –ª—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –¥—Ä—É–≥–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

### –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è setInitialState/setEndState

1. **–í RTC —Ñ—É–Ω–∫—Ü–∏—è—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:**
   - **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º** `setInitialState/setEndState` (—Ç–æ–ª—å–∫–æ intent!)
   
2. **–í State Managers:**
   - `setInitialState(state_name)` ‚Äî —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
   - `setEndState(state_name)` ‚Äî —Ü–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∞
   - `return flamegpu::ALIVE` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   - `return flamegpu::DEAD` ‚Äî –∞–≥–µ–Ω—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

## –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–±–æ—Ç—ã —Å MacroProperty MP5

### 1. –û–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –º–æ–¥–µ–ª–∏ (—Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–º–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏):
```python
# MAX_FRAMES –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
from model_build import MAX_FRAMES, MAX_DAYS, MAX_SIZE, set_max_frames_from_data
# –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
set_max_frames_from_data(frames_count_from_data)
# –ó–∞—Ç–µ–º –≤ –º–æ–¥–µ–ª–∏:
e.newMacroPropertyUInt32("mp5_lin", MAX_SIZE)
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ HostFunction:
```python
class HF_InitMP5(fg.HostFunction):
    def __init__(self, data: list[int], frames: int, days: int):
        super().__init__()
        self.data = data
        self.frames = frames
        self.days = days

    def run(self, FLAMEGPU):
        mp = FLAMEGPU.environment.getMacroPropertyUInt32("mp5_lin")
        for d in range(self.days + 1):
            for f in range(self.frames):
                src_idx = d * self.frames + f
                dst_idx = d * MAX_FRAMES + f  # –í–∞–∂–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º MAX_FRAMES
                if src_idx < len(self.data):
                    mp[dst_idx] = self.data[src_idx]
```

### 3. –ß—Ç–µ–Ω–∏–µ –≤ RTC (—Å —Ä–∞–∑–º–µ—Ä–∞–º–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏):
```cuda
const unsigned int base = day * ${MAX_FRAMES}u + frame_idx;  
auto mp = FLAMEGPU->environment.getMacroProperty<unsigned int, ${MAX_SIZE}u>("mp5_lin");
const unsigned int value = mp[base];
```
–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: `${MAX_FRAMES}` –∏ `${MAX_SIZE}` –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ RTC –∫–æ–¥–∞ –∏–∑ Python.

## –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (25-09-2025)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã V2
1. **rtc_state_2_operations**: –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è operations —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ 2‚Üí2, 2‚Üí4, 2‚Üí6
2. **state_manager_operations**: –¢—Ä–µ—Ö—Å–ª–æ–π–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å RTC conditions
3. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è MP5**: `step_day * MAX_FRAMES + idx` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –≤–µ–∑–¥–µ
4. **Intent consistency**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ intent_state –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è V2
```
# –ü–æ—à–∞–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
Step N: counts inactive=X, operations=Y, serviceable=Z, repair=A, reserve=B, storage=C

# –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è intent (–¥–ª—è operations)
[Day N | date=YYYY-MM-DD] AC 12345 idx=5: intent 2->4 (operations) sne=X, ppr=Y, dt=A, dn=B, s_next=C, p_next=D, ll=E, oh=F, br=G

# –ü–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
[Step N] AC 12345: TRANSITION operations -> repair (intent=4), sne=X, oh=Y, br=Z
[Step N] AC 12345: TRANSITION operations -> storage (intent=6), sne=X, ppr=Y, ll=Z, oh=A, br=B
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∑–∞ 3650 –¥–Ω–µ–π
- operations ‚Üí repair: 90 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (—É—Å–ª–æ–≤–∏–µ: ppr ‚â• oh AND sne < br)
- operations ‚Üí storage: 62 –ø–µ—Ä–µ—Ö–æ–¥–∞ (57 –ø–æ BR, 5 –ø–æ LL)
- –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: operations=2, repair=97, storage=62

---

## V2 Orchestrator Refactoring (30-09-2025)

### –¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–ü—Ä–æ–±–ª–µ–º—ã `sim_master` (–º–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)**:
1. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ NVRTC –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–ø–∞–≤–Ω–∞
2. –ö–æ—Å—Ç—ã–ª–∏ –≤ –∑–∞–≥—Ä—É–∑–∫–µ MP5 (–æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
3. –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–æ–¥ –±–æ–ª—å—à–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (~640 —Å—Ç—Ä–æ–∫ orchestrator)
4. –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (—Ä–∞–±–æ—Ç–∞ —Å `Dict[str, object]`)

**–†–µ—à–µ–Ω–∏–µ: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ V2**
- –ú–æ–¥—É–ª—å–Ω–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è orchestrator –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- Strategy Pattern –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ (MP5, –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
- Adapter Pattern –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç –ë–î
- Typed API –≤–º–µ—Å—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å —á–∏—Å—Ç—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
code/sim_v2/
‚îú‚îÄ‚îÄ orchestrator_v2.py          (287 —Å—Ç—Ä–æ–∫, -55% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
‚îÇ
‚îú‚îÄ‚îÄ components/                  (5 –º–æ–¥—É–ª–µ–π, 1387 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ agent_population.py     (336 —Å—Ç—Ä–æ–∫) ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ telemetry_collector.py  (209 —Å—Ç—Ä–æ–∫) ‚Äî —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ mp5_strategy.py         (189 —Å—Ç—Ä–æ–∫) ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ MP5
‚îÇ   ‚îú‚îÄ‚îÄ data_adapters.py        (283 —Å—Ç—Ä–æ–∫–∏) ‚Äî –∏–∑–æ–ª—è—Ü–∏—è –æ—Ç —Å—Ö–µ–º—ã –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ validation_rules.py     (370 —Å—Ç—Ä–æ–∫) ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ
‚îî‚îÄ‚îÄ rtc_modules/                 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    ‚îú‚îÄ‚îÄ rtc_state_2_operations.py
    ‚îú‚îÄ‚îÄ rtc_quota_ops_excess.py
    ‚îú‚îÄ‚îÄ rtc_states_stub.py
    ‚îî‚îÄ‚îÄ rtc_state_manager_*.py
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã V2

#### 1. AgentPopulation (agent_population.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ü–∏–π –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ MP3 –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ States (inactive/operations/serviceable/repair/reserve/storage)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ (idx, aircraft_number, status_id, sne, ppr, ll, oh, br)
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤ LL/OH/BR –ø–æ –∫–∞–¥—Ä–∞–º –∏–∑ MP1

**API**:
```python
class AgentPopulationBuilder:
    def __init__(self, env_data: Union[Dict, EnvDataAdapter])
    def populate_agents(self, simulation: fg.CUDASimulation, agent_def: fg.AgentDescription)
    def _build_norms_by_frame(self) -> Tuple[List[int], List[int], List[int]]
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–Ω—ë—Ä–æ–≤ —Å `group_by ‚àà {1,2}` (~286 –±–æ—Ä—Ç–æ–≤ –∏–∑ ~7113 —Å—Ç—Ä–æ–∫ MP3)
- –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤ (fail-fast –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ OH/BR)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–ø–∞–≤–Ω–∞
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `assembly_trigger` –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ –≤ repair

#### 2. TelemetryCollector (telemetry_collector.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø–æ —à–∞–≥–∞–º —Å–∏–º—É–ª—è—Ü–∏–∏ (state counts, intent changes)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (step times, p50/p95/max)

**API**:
```python
class TelemetryCollector:
    def __init__(self, simulation, agent_def, version_date_ord,
                 enable_state_counts=False, enable_intent_tracking=True)
    def before_simulation(self)
    def track_step(self, step: int) -> float
    def get_timing_summary(self) -> Dict[str, float]
    def get_state_counts(self) -> Dict[str, int]
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (state counts, intent tracking)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (p50, p95, max)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏–∑ operations (2‚Üí3, 2‚Üí4, 2‚Üí6)
- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –ª–æ–≥–æ–≤ (`date=YYYY-MM-DD`)

#### 3. MP5Strategy (mp5_strategy.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MP5 (host-only, RTC-copy, hybrid)
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö MP5 (–æ–±—Ä–µ–∑–∫–∞, –ø–∞–¥–¥–∏–Ω–≥ D+1)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è HostFunction –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ MP5

**API**:
```python
class MP5Strategy:                         # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
    def prepare_data(self) -> List[int]
    def register(self, model: fg.ModelDescription)

class HostOnlyMP5Strategy(MP5Strategy):   # –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    # Host-only –∑–∞–≥—Ä—É–∑–∫–∞ –±–µ–∑ RTC-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

class MP5StrategyFactory:                  # –§–∞–±—Ä–∏–∫–∞
    @staticmethod
    def create(strategy_name: str, ...) -> MP5Strategy
```

**–ò—Å—Ç–æ—Ä–∏—è —Ä–µ—à–µ–Ω–∏–π**:
- **V1** (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞): RTC-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `mp5_src ‚Üí mp5_lin` ‚Üí NVRTC –æ—à–∏–±–∫–∏ –ø—Ä–∏ `DAYS‚â•90`
- **V2** (—Ç–µ–∫—É—â–∞—è): Host-only –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤ `mp5_lin` (—Å—Ç–∞–±–∏–ª—å–Ω–æ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `DAYS=3650+`)

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- Strategy Pattern –¥–ª—è –±—É–¥—É—â–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (RTC-copy, Hybrid)
- –§–ª–∞–≥ `initialized` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω —Ä–∞–∑** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ MP5 —á–µ—Ä–µ–∑ `DimensionValidator`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ D+1 –ø–∞–¥–¥–∏–Ω–≥–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è `daily_next`

#### 4. DataAdapters (data_adapters.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ ClickHouse –≤ –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- –ò–∑–æ–ª—è—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `env_data`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è

**API**:
```python
class EnvDataAdapter:
    @property
    def version(self) -> VersionInfo
    @property
    def frames(self) -> FramesInfo
    @property
    def dimensions(self) -> SimulationDimensions
    @property
    def mp1(self) -> MP1Data
    @property
    def mp3(self) -> MP3Data
    @property
    def mp4(self) -> MP4Data
    @property
    def mp5(self) -> MP5Data
    def get_raw(self, key: str, default=None)
```

**–î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏** (dataclasses):
- `VersionInfo` ‚Äî –≤–µ—Ä—Å–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞ (date_ordinal, version_id)
- `FramesInfo` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–¥—Ä–∞—Ö —Å –º–µ—Ç–æ–¥–∞–º–∏ (`is_reserved`, `get_aircraft_number`)
- `SimulationDimensions` ‚Äî —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `MP1Data` ‚Äî –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –º–µ—Ç–æ–¥–∞–º–∏ (`get_oh`, `get_br`, `get_ll`)
- `MP3Data`, `MP4Data`, `MP5Data` ‚Äî —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- Typed API –≤–º–µ—Å—Ç–æ `Dict[str, object]`
- Lazy loading —á–µ—Ä–µ–∑ `@property` (–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É)
- Fail-fast –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Å–∏—Å—Ç–µ–º—ã
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å raw dict –∏ –∞–¥–∞–ø—Ç–µ—Ä–æ–º)

#### 5. ValidationRules (validation_rules.py)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏ (—Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏, —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–µ—Ä–µ—Ö–æ–¥—ã)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª (LL/OH/BR –ª–∏–º–∏—Ç—ã, –∫–≤–æ—Ç—ã)
- –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã)
- Fail-fast –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —ç—Ç–∞–ø–∞—Ö

**API**:
```python
class DimensionValidator:
    @staticmethod
    def validate_frames_days(frames, days) -> ValidationResult
    @staticmethod
    def validate_mp5_size(mp5_data, frames, days) -> ValidationResult

class StateTransitionValidator:
    @staticmethod
    def validate_transition(from_state, to_state, context=None) -> ValidationResult

class InvariantValidator:
    @staticmethod
    def validate_s6_immutable(...) -> ValidationResult
    @staticmethod
    def validate_delta_sne_equals_sum_dt(...) -> ValidationResult

class DataQualityValidator:
    @staticmethod
    def validate_no_negative_values(...) -> ValidationResult
    @staticmethod
    def validate_norms_present(ll, oh, br, ...) -> ValidationResult

class ValidationSuite:                     # –ù–∞–±–æ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–π
    def validate_dimensions(...) -> ValidationResult
    def has_failures(include_warnings=False) -> bool
    def get_summary() -> str
```

**–£—Ä–æ–≤–Ω–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**:
- `CRITICAL` ‚Äî –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–∏–º—É–ª—è—Ü–∏—é
- `WARNING` ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–æ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç
- `INFO` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (2‚Üí4: `ppr_next‚â•oh AND sne_next<br`)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
- –°–≤—è–∑—å —Å `docs/validation.md` (–∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–∏–ª)
- –ì–∏–±–∫–∏–π strict mode (warnings ‚Üí errors)

### –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | Œî |
|---------|----|----|---|
| **orchestrator_v2.py** | 640 —Å—Ç—Ä–æ–∫ | 287 —Å—Ç—Ä–æ–∫ | **-353 —Å—Ç—Ä–æ–∫–∏ (-55%)** |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π** | 1 –º–æ–Ω–æ–ª–∏—Ç | 6 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ | **+5 –º–æ–¥—É–ª–µ–π** |
| **–û–±—â–∏–π –∫–æ–¥** | 640 —Å—Ç—Ä–æ–∫ | 1674 —Å—Ç—Ä–æ–∫–∏ | **+1034 —Å—Ç—Ä–æ–∫–∏ (+162%)** |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** |
| **–¢–∏–ø–∏–∑–∞—Ü–∏—è** | `Dict[str, object]` | Dataclasses | **Typed API** |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ V2

#### –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å
- –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å (SRP)
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –õ–µ–≥–∫–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π/–≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤

#### –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
- Strategy Pattern: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ MP5 (RTC-copy, Hybrid)
- Adapter Pattern: –∏–∑–æ–ª—è—Ü–∏—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã –ë–î
- –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

#### –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- Fail-fast –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Å–∏—Å—Ç–µ–º—ã
- Typed API: –æ—à–∏–±–∫–∏ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∞ –Ω–µ runtime
- –°—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (S6 immutable, Œîsne=sum(dt))

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏: —Ç–µ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ –∂–µ –º–µ—Ç—Ä–∏–∫–∏ (~7-10–º—Å p50, ~50-60–º—Å p95)
- MP5 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω —Ä–∞–∑** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤)
- Lazy loading –≤ –∞–¥–∞–ø—Ç–µ—Ä–∞—Ö (–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
from sim_env_setup import prepare_env_arrays, get_client
from orchestrator_v2 import V2Orchestrator

env_data = prepare_env_arrays(get_client())
orchestrator = V2Orchestrator(env_data, enable_mp2=True, clickhouse_client=client)

# 2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å –º–æ–¥—É–ª—è–º–∏
orchestrator.build_model([
    'state_2_operations',
    'quota_ops_excess',
    'states_stub',
    'state_manager_operations',
    'state_manager_repair',
    'state_manager_storage'
])

# 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏
orchestrator.create_simulation()

# 4. –ó–∞–ø—É—Å–∫ –Ω–∞ N —à–∞–≥–æ–≤
orchestrator.run(steps=3650)

# 5. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
results = orchestrator.get_results()
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

```python
# –¢–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è
from components import ValidationSuite, DimensionValidator

suite = ValidationSuite(strict=False)
result = suite.validate_dimensions(frames=286, days=365, mp5_data=mp5_data)
if not result:
    raise ValueError(result.message)

# –¢–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö
from components import EnvDataAdapter

adapter = EnvDataAdapter(env_data)
print(f"Frames: {adapter.dimensions.frames_total}")
print(f"Days: {adapter.dimensions.days_total}")
oh_value = adapter.mp1.get_oh(partseqno=12345, group_by=2)

# –¢–æ–ª—å–∫–æ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è
from components import TelemetryCollector

telemetry = TelemetryCollector(simulation, agent_def, version_date_ord)
telemetry.before_simulation()
for step in range(steps):
    telemetry.track_step(step)
print(telemetry.get_summary())
```

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Å raw `Dict[str, object]`, —Ç–∞–∫ –∏ —Å `EnvDataAdapter`
- **RTC –º–æ–¥—É–ª–∏**: –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
- **–ë–î —Å—Ö–µ–º–∞**: –ê–¥–∞–ø—Ç–µ—Ä –∏–∑–æ–ª–∏—Ä—É–µ—Ç –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `prepare_env_arrays`
- **GPU –ø–∞–º—è—Ç—å**: –ù–µ –æ—á–∏—â–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–µ–¥–∏–Ω—ã–π Transform+Load pipeline –Ω–∞ Flame GPU)

### –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (P1)**:
- ~~AgentPopulation~~ ‚úÖ
- ~~TelemetryCollector~~ ‚úÖ  
- ~~MP5Strategy~~ ‚úÖ
- ~~DataAdapters~~ ‚úÖ
- ~~ValidationRules~~ ‚úÖ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (P2)**:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–π –≤ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é (runtime –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–∞ –¥–ª—è MP6/MP7 (–±—É–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (P3, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:
- –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è RTC –≤ `rtc_modules/` –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –û–±—â–∏–µ CUDA —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `rtc_common.py`
- Hybrid MP5 Strategy (–∫–æ–º–±–∏–Ω–∞—Ü–∏—è host + RTC)

---

## V2: –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RTC –ø–∞–π–ø–ª–∞–π–Ω–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 10-10-2025)

### –§–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –í–∞—Ä–∏–∞–Ω—Ç–æ–º B

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **Production Ready** (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 3650 –¥–Ω—è—Ö)

### –ü–æ—Ä—è–¥–æ–∫ –º–æ–¥—É–ª–µ–π –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û: spawn_v2 –î–û–õ–ñ–ï–ù –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–º –º–æ–¥—É–ª–µ–º –ø–µ—Ä–µ–¥ MP2 export!**

–ù–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è –∏ –Ω–∞—á–∏–Ω–∞—é—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è.

```
1. state_2_operations        ‚Äî –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã sne/ppr + —É—Å—Ç–∞–Ω–æ–≤–∫–∞ intent=2
2. states_stub               ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ intent –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π (–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç serviceable ‚Üí intent=2)
3. count_ops                 ‚Äî –ø–æ–¥—Å—á—ë—Ç –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2 –≤ operations –∏ state=serviceable
4. quota_ops_excess          ‚Äî –¥–µ–º–æ—É—Ç (operations ‚Üí serviceable, oldest first)
5. quota_promote_serviceable ‚Äî –ø—Ä–æ–º–æ—É—Ç P1 (serviceable ‚Üí operations, youngest first)
6. quota_promote_reserve     ‚Äî –ø—Ä–æ–º–æ—É—Ç P2 (reserve ‚Üí operations, youngest first)
7. quota_promote_inactive    ‚Äî –ø—Ä–æ–º–æ—É—Ç P3 (inactive ‚Üí operations, youngest first)
8. state_manager_serviceable ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ 3‚Üí2 (serviceable ‚Üí operations)
9. state_manager_operations  ‚Äî –ø–µ—Ä–µ—Ö–æ–¥—ã –∏–∑ operations (2‚Üí2, 2‚Üí3, 2‚Üí4, 2‚Üí6)
10. state_manager_inactive   ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ 1‚Üí1 (inactive ‚Üí inactive)
11. state_manager_repair     ‚Äî –ø–µ—Ä–µ—Ö–æ–¥—ã –∏–∑ repair (4‚Üí4, 4‚Üí5)
12. state_manager_reserve    ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ 5‚Üí5 (reserve ‚Üí reserve)
13. state_manager_storage    ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ 6‚Üí6 (storage ‚Üí storage)
14. spawn_v2                 ‚Äî ‚ö†Ô∏è —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –í –ö–û–ù–¶–ï!)
15. MP2 export               ‚Äî –≤—ã–≥—Ä—É–∑–∫–∞ –≤ –°–£–ë–î (–µ—Å–ª–∏ --enable-mp2)
```

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```bash
python3 orchestrator_v2.py \
  --modules state_2_operations states_stub count_ops \
            quota_ops_excess quota_promote_serviceable quota_promote_reserve quota_promote_inactive \
            state_manager_operations state_manager_serviceable state_manager_inactive \
            state_manager_repair state_manager_reserve state_manager_storage \
            spawn_v2 \
  --steps 3650 --enable-mp2 --drop-table
```

**–ü–æ–ª–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞):**

–°–º–æ—Ç—Ä–∏ `docs/README.md` (—Ä–∞–∑–¥–µ–ª "–ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ V2"), —Ç–∞–º –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –æ—á–∏—Å—Ç–∫–æ–π `__pycache__`.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### 1. **–í–∞—Ä–∏–∞–Ω—Ç B: count_ops —Å—á–∏—Ç–∞–µ—Ç –ø–æ intent=2**

**–î–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```cpp
// count_ops —Å—á–∏—Ç–∞–ª –í–°–ï–• –∞–≥–µ–Ω—Ç–æ–≤ –≤ state=operations
ops_count[idx].exchange(1u);  // ‚ùå –í–∫–ª—é—á–∞—è —Ç–µ—Ö, –∫—Ç–æ –∏–¥—ë—Ç –≤ —Ä–µ–º–æ–Ω—Ç!
```

**–ü–æ—Å–ª–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```cpp
// count_ops —Å—á–∏—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2
const unsigned int intent = FLAMEGPU->getVariable<unsigned int>("intent_state");
if (intent == 2u) {  // ‚úÖ –•–æ—Ç—è—Ç –±—ã—Ç—å –≤ operations
    ops_count[idx].exchange(1u);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–ª–∞–Ω—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–µ —É—á–∏—Ç—ã–≤–∞—è –∞–≥–µ–Ω—Ç–æ–≤, —É—Ö–æ–¥—è—â–∏—Ö –≤ —Ä–µ–º–æ–Ω—Ç (intent=4) –∏–ª–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (intent=6).

#### 2. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏**

**–î–µ–º–æ—É—Ç (–∏–∑–±—ã—Ç–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ –≤ operations):**
```cpp
// quota_ops_excess
Curr = sum(ops_count)  // –ê–≥–µ–Ω—Ç—ã —Å intent=2
Balance = Curr - Target
if (Balance > 0) {
    K = Balance
    // –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ: oldest first (–ø–æ mfg_date)
    if (rank < K) {
        intent_state = 3u;  // –î–µ–º–æ—É–Ω—Ç –≤ serviceable
    }
}
```

**–ü—Ä–æ–º–æ—É—Ç (–¥–µ—Ñ–∏—Ü–∏—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ operations):**
```cpp
// quota_promote_serviceable (P1)
Curr = sum(ops_count)
Used = 0  // –ü–µ—Ä–≤—ã–π —Å–ª–æ–π
Deficit = Target - (Curr + Used)
if (Deficit > 0) {
    K = Deficit
    // –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ: youngest first (–ø–æ mfg_date) 
    if (rank < K) {
        intent_state = 2u;  // –ü—Ä–æ–º–æ—É—Ç –≤ operations
        approve_s3[idx] = 1u;  // –ü–æ–º–µ—á–∞–µ–º –¥–ª—è P2
    }
}

// quota_promote_reserve (P2)
Curr = sum(ops_count)
Used = sum(approve_s3)  // –£—á–∏—Ç—ã–≤–∞–µ–º P1
Deficit = Target - (Curr + Used)
// ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ P1

// quota_promote_inactive (P3)
Curr = sum(ops_count)
Used = sum(approve_s3 + approve_s5)  // P1 + P2
Deficit = Target - (Curr + Used)
// ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ P1
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
1. **P1:** serviceable ‚Üí operations (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
2. **P2:** reserve ‚Üí operations
3. **P3:** inactive ‚Üí operations (—Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 3. **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ mfg_date**

**–î–µ–º–æ—É—Ç (oldest first):**
- –°—Ç–∞—Ä—ã–µ –∞–≥–µ–Ω—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ operations –ø–µ—Ä–≤—ã–º–∏
- –ö—Ä–∏—Ç–µ—Ä–∏–π: `mfg_date < my_mfg_date` ‚Üí rank++

**–ü—Ä–æ–º–æ—É—Ç (youngest first):**
- –ú–æ–ª–æ–¥—ã–µ –∞–≥–µ–Ω—Ç—ã –ø—Ä–æ–º–æ—É—Ç—è—Ç—Å—è –≤ operations –ø–µ—Ä–≤—ã–º–∏
- –ö—Ä–∏—Ç–µ—Ä–∏–π: `mfg_date > my_mfg_date` ‚Üí rank++

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—É—Ñ–µ—Ä—ã:**
```cpp
// –î–µ–º–æ—É—Ç: —Ç–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç—ã –≤ operations
auto ops_count = FLAMEGPU->environment.getMacroProperty<...>("mi17_ops_count");
if (ops_count[i] != 1u) continue;  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ-operations

// –ü—Ä–æ–º–æ—É—Ç P1: —Ç–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç—ã –≤ serviceable
auto svc_count = FLAMEGPU->environment.getMacroProperty<...>("mi17_svc_count");
if (svc_count[i] != 1u) continue;  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ-serviceable
```

#### 4. **Intent-based –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π**

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ intent (state_2_operations):**
```cpp
const unsigned int sne_next = sne + dn;
const unsigned int ppr_next = ppr + dn;

if (ppr_next >= oh && sne_next < br) {
    intent_state = 4u;  // –•–æ—Ç–∏–º –≤ —Ä–µ–º–æ–Ω—Ç
} else if (sne_next >= ll) {
    intent_state = 6u;  // –•–æ—Ç–∏–º –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
} else {
    intent_state = 2u;  // –û—Å—Ç–∞—ë–º—Å—è –≤ operations
}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (state_manager_operations):**
```cpp
const unsigned int intent = FLAMEGPU->getVariable<unsigned int>("intent_state");

if (intent == 4u) {
    // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–º–æ–Ω—Ç
    FLAMEGPU->setInitialState("operations");
    FLAMEGPU->setEndState("repair");
} else if (intent == 6u) {
    // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
    FLAMEGPU->setInitialState("operations");
    FLAMEGPU->setEndState("storage");
} else if (intent == 3u) {
    // –î–µ–º–æ—É–Ω—Ç –≤ serviceable
    FLAMEGPU->setInitialState("operations");
    FLAMEGPU->setEndState("serviceable");
}
```

### MacroProperty –±—É—Ñ–µ—Ä—ã

**–î–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –∞–≥–µ–Ω—Ç–æ–≤:**
- `mi8_ops_count[286]` ‚Äî —Ñ–ª–∞–≥–∏ –∞–≥–µ–Ω—Ç–æ–≤ Mi-8 –≤ operations —Å intent=2
- `mi17_ops_count[286]` ‚Äî —Ñ–ª–∞–≥–∏ –∞–≥–µ–Ω—Ç–æ–≤ Mi-17 –≤ operations —Å intent=2
- `mi8_svc_count[286]` ‚Äî —Ñ–ª–∞–≥–∏ –∞–≥–µ–Ω—Ç–æ–≤ Mi-8 –≤ serviceable
- `mi17_svc_count[286]` ‚Äî —Ñ–ª–∞–≥–∏ –∞–≥–µ–Ω—Ç–æ–≤ Mi-17 –≤ serviceable

**–î–ª—è –∫–∞—Å–∫–∞–¥–∞ –ø—Ä–æ–º–æ—É—Ç–∞:**
- `mi8_approve[286]` ‚Äî –¥–µ–º–æ—É–Ω—Ç Mi-8
- `mi17_approve[286]` ‚Äî –¥–µ–º–æ—É–Ω—Ç Mi-17
- `mi8_approve_s3[286]` ‚Äî –ø—Ä–æ–º–æ—É—Ç P1 Mi-8 (serviceable)
- `mi17_approve_s3[286]` ‚Äî –ø—Ä–æ–º–æ—É—Ç P1 Mi-17 (serviceable)
- `mi8_approve_s5[286]` ‚Äî –ø—Ä–æ–º–æ—É—Ç P2 Mi-8 (reserve)
- `mi17_approve_s5[286]` ‚Äî –ø—Ä–æ–º–æ—É—Ç P2 Mi-17 (reserve)
- `mi8_approve_s1[286]` ‚Äî –ø—Ä–æ–º–æ—É—Ç P3 Mi-8 (inactive)
- `mi17_approve_s1[286]` ‚Äî –ø—Ä–æ–º–æ—É—Ç P3 Mi-17 (inactive)

### –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞

```bash
python3 code/sim_v2/orchestrator_v2.py \
  --modules state_2_operations count_ops quota_ops_excess \
            quota_promote_serviceable quota_promote_reserve \
            quota_promote_inactive \
            state_manager_operations state_manager_serviceable state_manager_inactive \
            state_manager_repair state_manager_reserve state_manager_storage \
            spawn_v2 \
  --steps 3650 \
  --enable-mp2 \
  --drop-table
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (3650 –¥–Ω–µ–π)

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| GPU –≤—Ä–µ–º—è | 54.91—Å |
| –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è/—à–∞–≥ | 13.9–º—Å |
| MP2 —Å—Ç—Ä–æ–∫ | 1,042,318 |
| –ê–≥–µ–Ω—Ç—ã | 286 (279 + 7 spawn) |
| Serviceable | 0 (—Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ—Å–ª–µ Day 550) |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | p50=10.8–º—Å, p95=14.6–º—Å |

**–ù–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã (spawn Day 226):**
- Day 226: state=serviceable, intent=2 ‚úÖ –†–æ–∂–¥–µ–Ω–∏–µ
- Day 227: state=operations, intent=2 ‚úÖ –ü—Ä–æ–º–æ—É—Ç —á–µ—Ä–µ–∑ –∫–≤–æ—Ç—É
- Day 228: state=operations, sne=83 ‚úÖ –ù–∞—á–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å
- Day 3649: state=reserve, sne=269,977 ‚úÖ –ü–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** `docs/count_ops_variant_b_10-10-2025.md`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** `docs/variant_b_results_10-10-2025.md`
- **–°—Ö–µ–º–∞ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** `docs/quota_flow_complete_10-10-2025.md`
- **–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä count_ops:** `docs/count_ops_detailed_10-10-2025.md`

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

1. ‚úÖ **count_ops –ø–æ intent=2** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. ‚úÖ **–ü–æ—Ä—è–¥–æ–∫ –º–æ–¥—É–ª–µ–π** ‚Äî state_2_operations ‚Üí count_ops
3. ‚úÖ **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ mfg_date** ‚Äî oldest/youngest first
4. ‚úÖ **–ö–∞—Å–∫–∞–¥–Ω–æ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî P1‚ÜíP2‚ÜíP3 —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –æ—Å—Ç–∞—Ç–∫–∞
5. ‚úÖ **Spawn –≤ –∫–æ–Ω—Ü–µ** ‚Äî –Ω–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã –≤ serviceable –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω: 10-10-2025*  
*–ê–≤—Ç–æ—Ä: V2 Refactoring Team + Variant B Implementation*

#### –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

1. ‚úÖ state_2_operations ‚Äî –ü–†–û–í–ï–†–ï–ù–û (13.10.2025)
2. ‚úÖ states_stub ‚Äî –ü–†–û–í–ï–†–ï–ù–û (14.10.2025)
3. ‚úÖ count_ops ‚Äî –ü–†–û–í–ï–†–ï–ù–û (15.10.2025)
4. ‚úÖ quota_ops_excess ‚Äî –ü–†–û–í–ï–†–ï–ù–û (16.10.2025)
5. ‚úÖ quota_promote_serviceable ‚Äî –ü–†–û–í–ï–†–ï–ù–û (17.10.2025)
6. ‚úÖ quota_promote_reserve ‚Äî –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û –≤ Full Pipeline (17.10.2025)
7. ‚úÖ quota_promote_inactive ‚Äî –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û –≤ Full Pipeline (17.10.2025)
8. ‚úÖ state_manager_serviceable ‚Äî –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û –≤ Full Pipeline (17.10.2025)
9. ‚úÖ state_manager_operations ‚Äî –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û –≤ Full Pipeline (17.10.2025)
10. ‚úÖ state_manager_repair ‚Äî –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û –≤ Full Pipeline (17.10.2025)
11. ‚úÖ state_manager_storage ‚Äî –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û –≤ Full Pipeline (17.10.2025)

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–° (17.10.2025)

### ‚úÖ –ü–û–õ–ù–´–ô –ü–ê–ô–ü–õ–ê–ô–ù –í–ê–õ–ò–î–ò–†–û–í–ê–ù –ò –ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** 11 –∞–∫—Ç–∏–≤–Ω—ã—Ö RTC –º–æ–¥—É–ª–µ–π  
**–ü–µ—Ä–∏–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 3650 –¥–Ω–µ–π (10 –ª–µ—Ç)  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–ï–õ–Å–ù–´–ï –¢–ï–°–¢–´  
**–°—Ç–∞—Ç—É—Å:** üöÄ **–ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£**

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|--------|--------|
| Conservation Law (279‚Üí279) | ‚úÖ | –ù–µ—Ç –ø–æ—Ç–µ—Ä—å/—Å–æ–∑–¥–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤ |
| Repair Completion (141/141) | ‚úÖ | 100% —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ |
| Quota Balance (–¥–µ–º–æ—É—Ç = –ø—Ä–æ–º–æ—É—Ç) | ‚úÖ | 16 = 16 |
| State Transitions (325 –≤—Å–µ–≥–æ) | ‚úÖ | –í—Å–µ –ø–æ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º |
| Intent Consistency | ‚úÖ | state –∏ intent_state —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã |
| Ranking Correctness (Demount) | ‚úÖ | Oldest first (–ø–æ mfg_date) |
| Ranking Correctness (Promote) | ‚úÖ | Youngest first (–ø–æ mfg_date) |
| MP5 Integrity | ‚úÖ | 1,144,286 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| Compile Errors | ‚úÖ | 0 –æ—à–∏–±–æ–∫ |
| Runtime Errors | ‚úÖ | 0 –æ—à–∏–±–æ–∫ |
| Performance (18.3 –º—Å/–¥–µ–Ω—å) | ‚úÖ | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ |
| MP2 Export (1,018,350 rows) | ‚úÖ | –ë–µ–∑ –ø–æ—Ç–µ—Ä—å |

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **validation.md** ‚Äî –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π  
- **TRANSITIONS_REPORT_10YEARS.md** ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ 325 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∑–∞ 10 –ª–µ—Ç  
- **BLOCKS_INTERPRETATION_GUIDE.md** ‚Äî –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤  
- **README.md** ‚Äî –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞ –∏ –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç  
- **changelog.md** ‚Äî –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞  

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω: 17-10-2025*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ï–õ–Å–ù–´–ï –¢–ï–°–¢–´ ‚Äî –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£*

---

# RTC Pipeline Architecture v2 (State-Based, 16.10.2025)

## –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å holding states

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è holding states
–ê–≥–µ–Ω—Ç—ã –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö (`serviceable`, `reserve`, `inactive`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç **holding intent** –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –æ–∂–∏–¥–∞–Ω–∏—è:
- `serviceable&intent=3` ‚Äî –∂–¥—É—Ç —Ä–µ—à–µ–Ω–∏—è –ø–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é –≤ operations (—Ö–æ–ª–¥–∏–Ω–≥)
- `reserve&intent=5` ‚Äî –∂–¥—É—Ç —Å–ø—Ä–æ—Å–∞ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ö–æ–ª–¥–∏–Ω–≥)
- `inactive&intent=1` ‚Äî –∂–¥—É—Ç —Ä–∞–∑–º–æ—Ä–æ–∑–∫–∏ –ø—Ä–∏ `step_day >= repair_time` (–∑–∞–º–æ—Ä–æ–∑–∫–∞)

### –ü–æ–ª–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –º–æ–¥—É–ª–µ–π (14 —Å–ª–æ—ë–≤)

| –°–ª–æ–π | –ú–æ–¥—É–ª—å | –§—É–Ω–∫—Ü–∏—è | –¢—Ä–∞–Ω–∑–∏—Ü–∏–∏ |
|------|--------|---------|-----------|
| 1 | `state_2_operations` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ operations | 2‚Üí2, 2‚Üí3, 2‚Üí4, 2‚Üí6 (–ø—Ä–æ–≤–µ—Ä–∫–∞ LL/OH/BR) |
| 2 | `states_stub` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ holding intents | 1‚Üíintent=1, 3‚Üíintent=3, 4‚Üíintent=4, 5‚Üíintent=5, 6‚Üíintent=6 |
| 3 | `count_ops` | –ü–æ–¥—Å—á—ë—Ç operations&intent=2 | –ó–∞–ø–∏—Å—å –≤ MacroProperty –±—É—Ñ–µ—Ä—ã (mi8_ops_count, mi17_ops_count) |
| 4 | `quota_ops_excess` | –î–µ–º–æ—É—Ç –∏–∑–±—ã—Ç–∫–∞ –∏–∑ operations | 2‚Üí3 —Å intent=3 (—Ö–æ–ª–¥–∏–Ω–≥) –¥–ª—è –¥–µ–º–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ |
| 5 | `quota_promote_serviceable` | –ü—Ä–æ–º–æ—É—Ç –∏–∑ serviceable (P1) | 3‚Üí2 –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö (—Ç–æ–ø-K –ø–æ mfg_date) |
| 6 | `quota_promote_reserve` | –ü—Ä–æ–º–æ—É—Ç –∏–∑ reserve (P2) | 5‚Üí2 –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö (—Ç–æ–ø-K –ø–æ mfg_date) |
| 7 | `quota_promote_inactive` | –ü—Ä–æ–º–æ—É—Ç –∏–∑ inactive (P3) | 1‚Üí2 –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ step_day >= repair_time) |
| 8 | `state_manager_operations` | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏–∑ operations | 2‚Üí2, 2‚Üí3 (intent=3), 2‚Üí4, 2‚Üí6, 3‚Üí2, 5‚Üí2, 1‚Üí2 |
| 9 | `state_manager_serviceable` | –•–æ–ª–¥–∏–Ω–≥ –≤ serviceable | 3‚Üí3 –¥–ª—è intent=3 (–æ—Å—Ç–∞—é—Ç—Å—è –≤ —Ö–æ–ª–¥–∏–Ω–≥–µ) |
| 10 | `state_manager_inactive` | –•–æ–ª–¥–∏–Ω–≥ –≤ inactive | 1‚Üí1 –¥–ª—è intent=1 (–æ—Å—Ç–∞—é—Ç—Å—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã) |
| 11 | `state_manager_repair` | –°–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ | 4‚Üí4, 4‚Üí5 (—Å intent=5 –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ) |
| 12 | `state_manager_reserve` | –•–æ–ª–¥–∏–Ω–≥ –≤ reserve | 5‚Üí5 –¥–ª—è intent=5 (–æ—Å—Ç–∞—é—Ç—Å—è –≤ —Ö–æ–ª–¥–∏–Ω–≥–µ) |
| 13 | `state_manager_storage` | –ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ | 6‚Üí6 (immutable) |
| 14 | `spawn_v2` | –†–æ–∂–¥–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ | –°–æ–∑–¥–∞–Ω–∏–µ –≤ serviceable&intent=3 |

### –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ intent

| –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | Intent | –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | Intent | –£—Å–ª–æ–≤–∏–µ | –ú–æ–¥—É–ª—å |
|-------------------|--------|-------------------|--------|---------|--------|
| operations | 2 | operations | 2 | –û—Å—Ç–∞—Ç–æ–∫ –∏–∑ quota | state_manager_operations |
| operations | 2 | serviceable | 3 | –î–µ–º–æ—É—Ç quota | state_manager_operations |
| operations | 2 | repair | 4 | OH –ø—Ä–µ–≤—ã—à–µ–Ω | state_manager_operations |
| operations | 2 | storage | 6 | LL –∏–ª–∏ BR –ø—Ä–µ–≤—ã—à–µ–Ω—ã | state_manager_operations |
| serviceable | 3 | operations | 2 | –í—ã–±—Ä–∞–Ω quota_promote | state_manager_operations |
| serviceable | 3 | serviceable | 3 | –ù–µ –≤—ã–±—Ä–∞–Ω (—Ö–æ–ª–¥–∏–Ω–≥) | state_manager_serviceable |
| reserve | 5 | operations | 2 | –í—ã–±—Ä–∞–Ω quota_promote (P2) | state_manager_operations |
| reserve | 5 | reserve | 5 | –ù–µ –≤—ã–±—Ä–∞–Ω (—Ö–æ–ª–¥–∏–Ω–≥) | state_manager_reserve |
| inactive | 1 | operations | 2 | –í—ã–±—Ä–∞–Ω quota_promote (P3) + step_day >= repair_time | state_manager_operations |
| inactive | 1 | inactive | 1 | –ù–µ –≥–æ—Ç–æ–≤ –∏–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω (–∑–∞–º–æ—Ä–æ–∑–∫–∞) | state_manager_inactive |
| repair | 4 | repair | 4 | –†–µ–º–æ–Ω—Ç –∏–¥–µ—Ç | state_manager_repair |
| repair | 4 | reserve | 5 | –†–µ–º–æ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω | state_manager_repair |
| storage | 6 | storage | 6 | Immutable | state_manager_storage |
| (–Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ) | 3 | serviceable | 3 | Spawn —Å–æ–∑–¥–∞–Ω–∏–µ | spawn_v2 |

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ

```
1. state_2_operations        ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è operations
2. states_stub               ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ holding intents (1,3,4,5,6)
3. count_ops                 ‚Äî –ø–æ–¥—Å—á–µ—Ç operations&intent=2
4. quota_ops_excess          ‚Äî –¥–µ–º–æ—É—Ç –∏–∑–±—ã—Ç–∫–∞ (2‚Üí3, intent=3)
5. quota_promote_serviceable ‚Äî –≤—ã–±–æ—Ä –¥–ª—è P1 (3‚Üí2)
6. quota_promote_reserve     ‚Äî –≤—ã–±–æ—Ä –¥–ª—è P2 (5‚Üí2)
7. quota_promote_inactive    ‚Äî –≤—ã–±–æ—Ä –¥–ª—è P3 (1‚Üí2)
8. state_manager_operations  ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ 2‚Üí2, 2‚Üí3, 2‚Üí4, 2‚Üí6, 3‚Üí2, 5‚Üí2, 1‚Üí2
9. state_manager_serviceable ‚Äî —Ö–æ–ª–¥–∏–Ω–≥ 3‚Üí3
10. state_manager_inactive   ‚Äî —Ö–æ–ª–¥–∏–Ω–≥ 1‚Üí1
11. state_manager_repair     ‚Äî 4‚Üí4, 4‚Üí5 —Å intent=5
12. state_manager_reserve    ‚Äî —Ö–æ–ª–¥–∏–Ω–≥ 5‚Üí5
13. state_manager_storage    ‚Äî immutable 6‚Üí6
14. spawn_v2                 ‚Äî —Ä–æ–∂–¥–µ–Ω–∏–µ –≤ serviceable&intent=3
```

### –í–∞–∂–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

1. **Atomicity –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:** State –∏ intent –º–µ–Ω—è—é—Ç—Å—è –í–ú–ï–°–¢–ï –≤ state_manager —Å–ª–æ–µ
2. **–•–æ–ª–¥–∏–Ω–≥ –∑–∞—â–∏—Ç–∞:** `states_stub` –ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç intent=3/5/1 –µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. **–î–µ–º–æ—É—Ç —Ö–æ–ª–¥–∏–Ω–≥:** –î–µ–º–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ intent=3 –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è `state_manager_serviceable`
4. **–°–ø–∞–≤–Ω —Ö–æ–ª–¥–∏–Ω–≥:** –ù–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã —Ä–æ–∂–¥–∞—é—Ç—Å—è –≤ serviceable&intent=3, –∂–¥—É—Ç quota_promote
5. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã P1-P3:** P1 (serviceable), P2 (reserve), P3 (inactive) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ (3650 –¥–Ω–µ–π)

- ‚úÖ –ù–µ—Ç "bouncing" –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- ‚úÖ Holding states —Å—Ç–∞–±–∏–ª—å–Ω—ã (24 –≤ serviceable, 116 –≤ inactive, 123 –≤ reserve)
- ‚úÖ –ù–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–æ–∂–¥–∞—é—Ç—Å—è –≤ —Ö–æ–ª–¥–∏–Ω–≥–µ
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 212.45 —Å–µ–∫ –Ω–∞ GPU

---

## üìä –ü–æ–ª–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (state, intent) ‚Äî v3 (18.10.2025)

### –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø

**–ù–µ–¥–µ–ª–∏–º–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –¥–≤–∏–∂–µ–Ω–∏—è:** `(state, intent)` ‚Äî –ø–∞—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—Å–µ–≥–¥–∞ –¥–≤–∏–∂–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ.

- **–î–û state_manager —Å–ª–æ—ë–≤:** –ú–æ–¥—É–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç **–°–£–î–¨–ë–£** —á–µ—Ä–µ–∑ `intent_state` (–∫–≤–æ—Ç–∞, –¥–µ–º–æ—É—Ç, –ø—Ä–æ–º–æ—É—Ç, —Å—Ç–∞—Ç—É—Å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
- **–í state_manager —Å–ª–æ—è—Ö:** –ú–æ–¥—É–ª–∏ **–§–ò–ö–°–ò–†–£–Æ–¢** –ø–µ—Ä–µ—Ö–æ–¥ `state`, `intent` **–æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º**
- **–í—Å–µ–≥–¥–∞ –æ–ø–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–æ–π:** `(state, intent)` ‚Äî —ç—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞

### –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

| –°–õ–û–ô | –í–•–û–î–Ø–©–ê–Ø –ü–ê–†–ê | –í–´–•–û–î–Ø–©–ê–Ø –ü–ê–†–ê | –ú–ï–ù–Ø–ï–¢–°–Ø / –£–°–õ–û–í–ò–ï |
|------|---|---|---|
| **state_2_operations** | (ops, 2) | (ops, 2)/(ops, 4)/(ops, 6) | intent –ø–æ LL/OH/BR –ø—Ä–æ–≤–µ—Ä–∫–∞–º |
| **states_stub** | (inactive, 1) | (inactive, 1) | intent = 1 (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º) |
| | (serviceable, 3) | (serviceable, 3) | intent = 3 (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º) |
| | (repair, 4) | (repair, 4) | intent = 4 –µ—Å–ª–∏ repair_days < repair_time |
| | | (repair, 5) | intent = 5 –µ—Å–ª–∏ repair_days == repair_time |
| | (reserve, 5) | (reserve, 5) | intent = 5 (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º) |
| | (storage, 6) | (storage, 6) | intent = 6 (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º) |
| **quota_ops_excess** | (ops, 2) | (ops, 3) | intent: 2‚Üí3 —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ—Ç–∏—Ä—É–µ–º—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ |
| **quota_promote_serviceable** (P1) | (serviceable, 3) | (serviceable, 2) | intent: 3‚Üí2 –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω, –∏–Ω–∞—á–µ –æ—Å—Ç–∞—ë—Ç—Å—è 3 |
| **quota_promote_reserve** (P2) | (reserve, 5) | (reserve, 2) | intent: 5‚Üí2 –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω, –∏–Ω–∞—á–µ –æ—Å—Ç–∞—ë—Ç—Å—è 5 |
| **quota_promote_inactive** (P3) | (inactive, 1) | (inactive, 2) | intent: 1‚Üí2 –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω, –∏–Ω–∞—á–µ –æ—Å—Ç–∞—ë—Ç—Å—è 1 |
| **state_manager_operations** | (ops, 2) | (ops, 2) | state –æ—Å—Ç–∞—ë—Ç—Å—è, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| | (ops, 3) | (svc, 3) | state: ops‚Üísvc, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| | (ops, 4) | (repair, 4) | state: ops‚Üírepair, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| | (ops, 6) | (storage, 6) | state: ops‚Üístorage, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| | (svc, 2) | (ops, 2) | state: svc‚Üíops, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| | (reserve, 2) | (ops, 2) | state: reserve‚Üíops, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| | (inactive, 2) | (ops, 2) | state: inactive‚Üíops, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| **state_manager_serviceable** | (svc, 3) | (svc, 3) | –Ω–∏—á–µ–≥–æ (—Ö–æ–ª–¥–∏–Ω–≥) |
| **state_manager_inactive** | (inactive, 1) | (inactive, 1) | –Ω–∏—á–µ–≥–æ (—Ö–æ–ª–¥–∏–Ω–≥) |
| **state_manager_repair** | (repair, 4) | (repair, 4) | –Ω–∏—á–µ–≥–æ (–∏–¥–µ—Ç —Ä–µ–º–æ–Ω—Ç) |
| | (repair, 5) | (reserve, 5) | state: repair‚Üíreserve, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω |
| **state_manager_reserve** | (reserve, 5) | (reserve, 5) | –Ω–∏—á–µ–≥–æ (—Ö–æ–ª–¥–∏–Ω–≥) |
| **state_manager_storage** | (storage, 6) | (storage, 6) | –Ω–∏—á–µ–≥–æ (immutable) |
| **spawn_v2** | (NEW) | (serviceable, 3) | –Ω–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã —Ä–æ–∂–¥–∞—é—Ç—Å—è –≤ —Ö–æ–ª–¥–∏–Ω–≥–µ |

### –ö–ª—é—á–µ–≤—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º:** –ù–µ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π ‚Äî –∫–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ –≤ –∏–∑–≤–µ—Å—Ç–Ω–æ–π –ø–∞—Ä–µ (state, intent)
2. **–•–æ–ª–¥–∏–Ω–≥–∏:** –ê–≥–µ–Ω—Ç—ã –≤ `(serviceable, 3)`, `(reserve, 5)`, `(inactive, 1)` –∂–¥—É—Ç —Ä–µ—à–µ–Ω–∏—è –æ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Å—É–¥—å–±–µ
3. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** state –∏ intent –º–µ–Ω—è—é—Ç—Å—è **–≤–º–µ—Å—Ç–µ** –≤ –æ–¥–Ω–æ–π RTC —Ñ—É–Ω–∫—Ü–∏–∏ state_manager
4. **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å:** –ü–µ—Ä–µ—Ö–æ–¥ –∏–∑ (A, i) –≤ (B, i) ‚Äî –µ–¥–∏–Ω–∞—è –Ω–µ–¥–µ–ª–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
5. **–ü–µ—Ä–µ–∑–∞–ø–∏—Å—å intent:** `states_stub` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç intent –¥–ª—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Ç–∞ (—Å—É–¥—å–±–∞):**
- `state_2_operations`: –ü—Ä–æ–≤–µ—Ä–∫–∞ LL/OH/BR ‚Üí intent ‚àà {2, 4, 6}
- `states_stub`: –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ intent –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é ‚Üí intent ‚àà {1, 3, 4, 5, 6}
- `quota_ops_excess`: –î–µ–º–æ—É—Ç ‚Üí intent: 2‚Üí3
- `quota_promote_*`: –í—ã–±–æ—Ä –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ ‚Üí intent: X‚Üí2 (–¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö)

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (—Ñ–∏–∫—Å–∞—Ü–∏—è):**
- `state_manager_*`: –°–º–µ–Ω–∞ state, intent –Ω–µ–∏–∑–º–µ–Ω–µ–Ω

**–•–æ–ª–¥–∏–Ω–≥–∏ (–æ–∂–∏–¥–∞–Ω–∏–µ):**
- `state_manager_serviceable`: (svc, 3) ‚Üí (svc, 3)
- `state_manager_inactive`: (inactive, 1) ‚Üí (inactive, 1)
- `state_manager_reserve`: (reserve, 5) ‚Üí (reserve, 5)

---

## üêõ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (21.10.2025)

### 2. active_trigger: –°–±—Ä–æ—Å –≤–æ –≤—Å–µ—Ö –ø—É—Ç—è—Ö –≤—ã—Ö–æ–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** `active_trigger` –¥–æ–ª–∂–µ–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ `inactive ‚Üí operations` (1‚Üí2) –∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å. –°–±—Ä–æ—Å –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `rtc_apply_2_to_2` (staying in operations), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ –∞–≥–µ–Ω—Ç—ã, –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ 1‚Üí2‚Üí4 (inactive ‚Üí operations ‚Üí repair), –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω —Å–±—Ä–æ—Å –≤–æ **–≤—Å–µ** —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏–∑ `operations`:
- `rtc_apply_2_to_2` (operations ‚Üí operations)
- `rtc_apply_2_to_3` (operations ‚Üí serviceable)
- `rtc_apply_2_to_4` (operations ‚Üí repair)
- `rtc_apply_2_to_6` (operations ‚Üí storage)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:**
> **–°–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤/—Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤–æ –í–°–ï–• –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—É—Ç—è—Ö –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è.**
> 
> –ù–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ —Ç–æ, —á—Ç–æ –∞–≥–µ–Ω—Ç –ø—Ä–æ–π–¥–µ—Ç —á–µ—Ä–µ–∑ "–æ—Å–Ω–æ–≤–Ω–æ–π" –ø—É—Ç—å. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –ª—é–±–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

**–ö–æ–¥:**
```cpp
// ‚úÖ –ö–†–ò–¢–ò–ß–ù–û: –°–±—Ä–æ—Å active_trigger –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∏–∑ operations
unsigned int active_trigger = FLAMEGPU->getVariable<unsigned int>("active_trigger");
if (active_trigger == 1u) {
    FLAMEGPU->setVariable<unsigned int>("active_trigger", 0u);
}
```

**–§–∞–π–ª—ã:** `code/sim_v2/rtc_state_manager_operations.py`

### 1. quota_target: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ Python

### –ü—Ä–æ–±–ª–µ–º–∞: quota_target –æ–±–Ω—É–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ RTC

**–ß—Ç–æ –±—ã–ª–æ:**
- `rtc_log_mp4_targets` (RTC —Ñ—É–Ω–∫—Ü–∏—è) –∑–∞–ø–∏—Å—ã–≤–∞–ª–∞ —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–≤–æ—Ç –≤ `mp2_mp4_target_mi8/mi17`
- –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤
- –ù–∞ –¥–µ–Ω—å 361 –≤—Å–µ –∞–≥–µ–Ω—Ç—ã Mi-17 –º–µ–Ω—è–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∞—Å—å ‚Üí –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–Ω—É–ª—è–ª–∏—Å—å

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
- –¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é –∏–∑ `mp4_ops_counter`** –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Python –ø—Ä–∏ –¥—Ä–µ–Ω–∞–∂–µ –≤ –°–£–ë–î
- –ú–µ—Ç–æ–¥ `_get_mp4_target()` –≤ `mp2_drain_host.py` –ø—Ä–∏–º–µ–Ω—è–µ—Ç `safe_day` –ª–æ–≥–∏–∫—É
- `rtc_log_mp4_targets` –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ DEPRECATED (–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:**
> **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (per-day) –ù–ï –¥–æ–ª–∂–Ω—ã –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ RTC —Ñ—É–Ω–∫—Ü–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤!**
> 
> RTC —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –≤—ã—á–∏—Å–ª—è—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Python (HostFunction –∏–ª–∏ –ø—Ä–∏ –¥—Ä–µ–Ω–∞–∂–µ).

**–§–∞–π–ª—ã:**
- `code/sim_v2/mp2_drain_host.py` ‚Äî –º–µ—Ç–æ–¥ `_get_mp4_target()`
- `code/sim_v2/rtc_quota_count_ops.py` ‚Äî DEPRECATED –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- ‚úÖ –¢–µ—Å—Ç 365 –¥–Ω–µ–π: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –¢–µ—Å—Ç 3650 –¥–Ω–µ–π: –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å

---

## üîß GPU –ü–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥: active_trigger ‚Üí repair history (23.10.2025)

### 4. mp2_postprocess_active: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–µ–º–æ–Ω—Ç–∞ –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ inactive ‚Üí operations (1‚Üí2) –∞–≥–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç "–º–≥–Ω–æ–≤–µ–Ω–Ω–æ", –Ω–æ —Ä–µ–∞–ª—å–Ω–æ –æ–Ω –ø—Ä–æ—à—ë–ª —á–µ—Ä–µ–∑ —Ä–µ–º–æ–Ω—Ç –¥–ª–∏–Ω–æ–π `repair_time` –¥–Ω–µ–π. –ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ MP2 –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º.

**–†–µ—à–µ–Ω–∏–µ: GPU –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ export_phase –º–µ—Ö–∞–Ω–∏–∑–º**

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ (3650 —à–∞–≥–æ–≤) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ–¥–∏–Ω —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π —à–∞–≥** —Å `export_phase=2`, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è RTC –º–æ–¥—É–ª—å `mp2_postprocess_active`.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```cpp
// RTC —Ñ—É–Ω–∫—Ü–∏—è (—Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–ª—è –ö–ê–ñ–î–û–ì–û —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ)
FLAMEGPU_AGENT_FUNCTION(rtc_mp2_postprocess_active_operations, ...) {
    // –†–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –ø—Ä–∏ export_phase=2
    const unsigned int phase = FLAMEGPU->environment.getProperty<unsigned int>("export_phase");
    if (phase != 2u) return flamegpu::ALIVE;
    
    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≥–µ–Ω—Ç–∞
    const unsigned int R = FLAMEGPU->getVariable<unsigned int>("repair_time");
    const unsigned int A = FLAMEGPU->getVariable<unsigned int>("assembly_time");
    
    // –ü–æ–ª—É—á–∞–µ–º MP2 MacroProperty –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
    auto mp2_active_trigger = FLAMEGPU->environment.getMacroProperty<unsigned int, MP2_SIZE>("mp2_active_trigger");
    auto mp2_state = FLAMEGPU->environment.getMacroProperty<unsigned int, MP2_SIZE>("mp2_state");
    auto mp2_repair_days = FLAMEGPU->environment.getMacroProperty<unsigned int, MP2_SIZE>("mp2_repair_days");
    auto mp2_assembly_trigger = FLAMEGPU->environment.getMacroProperty<unsigned int, MP2_SIZE>("mp2_assembly_trigger");
    auto mp2_transition_1_to_4 = FLAMEGPU->environment.getMacroProperty<unsigned int, MP2_SIZE>("mp2_transition_1_to_4");
    auto mp2_transition_4_to_2 = FLAMEGPU->environment.getMacroProperty<unsigned int, MP2_SIZE>("mp2_transition_4_to_2");
    
    // –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏—è active_trigger=1
    for (unsigned int d_event = 0; d_event < days_total; d_event++) {
        if (mp2_active_trigger[d_event * MAX_FRAMES + idx] == 1u) {
            // –í—ã—á–∏—Å–ª—è–µ–º –æ–∫–Ω–æ —Ä–µ–º–æ–Ω—Ç–∞ [s..e]
            unsigned int s = max(0, d_event - R);
            unsigned int e = d_event - 1;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ–∫–Ω–æ
            for (unsigned int d = s; d <= e; d++) {
                unsigned int pos = d * MAX_FRAMES + idx;
                mp2_state[pos].exchange(4u);  // state = repair
                mp2_repair_days[pos].exchange(d - s + 1);  // 1..R
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º assembly_trigger
            if (d_event >= A) {
                mp2_assembly_trigger[(d_event - A) * MAX_FRAMES + idx].exchange(1u);
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º transition —Ñ–ª–∞–≥–∏
            mp2_transition_1_to_4[s * MAX_FRAMES + idx].exchange(1u);  // –ù–∞—á–∞–ª–æ —Ä–µ–º–æ–Ω—Ç–∞
            mp2_transition_4_to_2[d_event * MAX_FRAMES + idx].exchange(1u);  // –í—ã—Ö–æ–¥
            
            break;  // –û–¥–∏–Ω –∞–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ
        }
    }
}
```

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ—Ç–∞–ª–∏:**

1. **6 RTC —Ñ—É–Ω–∫—Ü–∏–π** (–ø–æ –æ–¥–Ω–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è):
   - `rtc_mp2_postprocess_active_inactive`
   - `rtc_mp2_postprocess_active_operations`
   - `rtc_mp2_postprocess_active_serviceable`
   - `rtc_mp2_postprocess_active_repair`
   - `rtc_mp2_postprocess_active_reserve`
   - `rtc_mp2_postprocess_active_storage`
   
   > **–í–ê–ñ–ù–û:** FLAME GPU –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –∞–≥–µ–Ω—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º —á–µ—Ä–µ–∑ `setInitialState/setEndState`!

2. **–°–±—Ä–æ—Å PPR –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ 1‚Üí2:**
   –í `rtc_state_manager_operations.py` (—Ñ—É–Ω–∫—Ü–∏—è `rtc_apply_1_to_2`):
   ```cpp
   FLAMEGPU->setVariable<unsigned int>("ppr", 0u);
   ```
   –ë–µ–∑ —ç—Ç–æ–≥–æ –∞–≥–µ–Ω—Ç —Å—Ä–∞–∑—É —É—Ö–æ–¥–∏–ª –±—ã –≤ —Ä–µ–º–æ–Ω—Ç, —Ç.–∫. PPR –±—ã–ª –Ω–∞–∫–æ–ø–ª–µ–Ω –¥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞.

3. **export_phase –º–µ—Ö–∞–Ω–∏–∑–º:**
   - `0` = –æ–±—ã—á–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è
   - `2` = –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ MP2
   - –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `simulation.setEnvironmentPropertyUInt("export_phase", 2)`

4. **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—à–ª—ã—Ö –¥–Ω–µ–π:**
   RTC —Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ **–ª—é–±–æ–º—É –¥–Ω—é** –≤ MP2 —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å `pos = day * MAX_FRAMES + idx`.

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ orchestrator_v2.py:**

```python
# –ü–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
if self.enable_mp2_postprocess:
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º export_phase=2
    self.simulation.setEnvironmentPropertyUInt("export_phase", 2)
    # –û–¥–∏–Ω —à–∞–≥ –¥–ª—è –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞
    self.simulation.step()
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
    self.simulation.setEnvironmentPropertyUInt("export_phase", 0)
    # –§–∏–Ω–∞–ª—å–Ω—ã–π –¥—Ä–µ–Ω–∞–∂
    self.simulation.step()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã (3650 –¥–Ω–µ–π):**
- 23 —Å–æ–±—ã—Ç–∏—è `active_trigger=1` –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- 23 –æ–∫–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ (–ø–æ 180 –¥–Ω–µ–π –∫–∞–∂–¥–æ–µ)
- 23 `assembly_trigger` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- 46 transition —Ñ–ª–∞–≥–æ–≤ (23√ó1‚Üí4 + 23√ó4‚Üí2)
- –í—Ä–µ–º—è –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞: **0.02—Å** (overhead ~0.02%)

**–§–∞–π–ª—ã:**
- `code/sim_v2/rtc_mp2_postprocess_active.py` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞
- `code/sim_v2/rtc_state_manager_operations.py` ‚Äî —Å–±—Ä–æ—Å PPR
- `code/sim_v2/mp2_drain_host.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ export_phase

---

## ‚ö° –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: Transition Detection (23.10.2025)

### 3. compute_transitions: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ Python –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ (—É—Å–∫–æ—Ä–µ–Ω–∏–µ 4.6x)

**–ü—Ä–æ–±–ª–µ–º–∞:** Transition —Ñ–ª–∞–≥–∏ (–ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏) –≤—ã—á–∏—Å–ª—è–ª–∏—Å—å —á–µ—Ä–µ–∑ Python –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫—É –ü–û–°–õ–ï –≤—ã–≥—Ä—É–∑–∫–∏ MP2 –≤ ClickHouse. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫:
- 987 UPDATE –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ ClickHouse
- ~203 —Å–µ–∫—É–Ω–¥—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞ 3650 –¥–Ω–µ–π)
- –û–±—â–µ–µ –≤—Ä–µ–º—è: ~518 —Å–µ–∫—É–Ω–¥ (314—Å GPU + 203—Å –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ + –¥—Ä–µ–Ω–∞–∂)

**–†–µ—à–µ–Ω–∏–µ: GPU-side –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å—å—é –≤ MacroProperty**

RTC —Å–ª–æ–π `compute_transitions` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ü–ï–†–ï–î** `state_managers` –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç transition —Ñ–ª–∞–≥–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ MacroProperty:

```cpp
// –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ MP2
const unsigned int pos = step_day * MAX_FRAMES + idx;

// –ü–æ–ª—É—á–∞–µ–º MacroProperty –¥–ª—è transition —Ñ–ª–∞–≥–æ–≤
auto mp2_transition_2_to_4 = FLAMEGPU->environment.getMacroProperty<unsigned int, MP2_SIZE>("mp2_transition_2_to_4");
// ... –µ—â–µ 8 MacroProperty –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

// –ï—Å–ª–∏ state ‚â† intent ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥
if (state == 2u && intent == 4u) {  // operations ‚Üí repair
    mp2_transition_2_to_4[pos].exchange(1u);
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:**

> **Transition detection –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ü–ï–†–ï–î state_managers, –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É `state` –∏ `intent_state`!**
> 
> - `state` = —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–¥–µ–Ω—å D-1, –∏–∑ StateName)
> - `intent_state` = –±—É–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–¥–µ–Ω—å D, –∏–∑ agent variable)
> - –ï—Å–ª–∏ `state ‚â† intent` ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –≤ MP2
> - –ó–∞—Ç–µ–º `state_managers` –ø—Ä–∏–º–µ–Ω—è—é—Ç `intent ‚Üí state`
> 
> –ï—Å–ª–∏ –±—ã `compute_transitions` –±—ã–ª –ü–û–°–õ–ï state_managers, —Ç–æ `state` —É–∂–µ –∏–∑–º–µ–Ω–∏–ª—Å—è –±—ã –∏ —Ä–∞–∑–Ω–∏—Ü—ã –Ω–µ –±—ã–ª–æ –±—ã!

**–ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ—ë–≤ (–∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–µ–Ω):**
```
quota_modules ‚Üí compute_transitions ‚Üí state_managers ‚Üí mp2_writer
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **`code/sim_v2/rtc_compute_transitions.py`:**
   - –£–±—Ä–∞–Ω—ã `setVariable("transition_X_to_Y", ...)` (agent variables –Ω–µ –Ω—É–∂–Ω—ã)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ —á—Ç–µ–Ω–∏–µ 9 MacroProperty: `mp2_transition_2_to_4`, –∏ —Ç.–¥.
   - –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `.exchange(1u)`
   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏: `pos = step_day * MAX_FRAMES + idx`

2. **`code/sim_v2/mp2_drain_host.py`:**
   - **–£–¥–∞–ª—ë–Ω** –º–µ—Ç–æ–¥ `_compute_transitions_sql()` (—Ü–µ–ª–∏–∫–æ–º, ~100 —Å—Ç—Ä–æ–∫)
   - **–£–¥–∞–ª—ë–Ω** –≤—ã–∑–æ–≤ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑ `run()`
   - Transition —Ñ–ª–∞–≥–∏ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ MacroProperty (–∫–æ–¥ —É–∂–µ –±—ã–ª –≥–æ—Ç–æ–≤)

3. **`code/sim_v2/components/base_model.py`:**
   - Agent variables `transition_X_to_Y` –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã (–Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã (3650 –¥–Ω–µ–π, 1,039,632 —Å—Ç—Ä–æ–∫):**

- **–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:** ~518 —Å–µ–∫—É–Ω–¥ (314—Å GPU + 203—Å Python + –¥—Ä–µ–Ω–∞–∂)
- **–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:** 112 —Å–µ–∫—É–Ω–¥ (111.88—Å GPU+–¥—Ä–µ–Ω–∞–∂)
- **–£–°–ö–û–†–ï–ù–ò–ï: 4.6x (462%!)**

**Transition —Ñ–ª–∞–≥–∏ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å):**
- 2‚Üí4 (ops‚Üírepair): 194
- 2‚Üí6 (ops‚Üístorage): 32  
- 2‚Üí3 (ops‚Üíserviceable): 173
- 3‚Üí2 (serviceable‚Üíops): 179
- 5‚Üí2 (reserve‚Üíops): 188
- 4‚Üí5 (repair‚Üíreserve): 198
- **–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: 987** ‚úÖ

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- ‚úÖ –¢–µ—Å—Ç 50 –¥–Ω–µ–π: 11 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- ‚úÖ –¢–µ—Å—Ç 300 –¥–Ω–µ–π: 63 –ø–µ—Ä–µ—Ö–æ–¥–∞
- ‚úÖ –¢–µ—Å—Ç 3650 –¥–Ω–µ–π: 987 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏ TRANSITION

**–§–∞–π–ª—ã:**
- `code/sim_v2/rtc_compute_transitions.py` ‚Äî RTC –º–æ–¥—É–ª—å (GPU-side –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ)
- `code/sim_v2/mp2_drain_host.py` ‚Äî —É–¥–∞–ª–µ–Ω–∞ Python –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞
- `code/sim_v2/rtc_mp2_writer.py` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ MacroProperty (—É–∂–µ –±—ã–ª–æ)

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω: 23-10-2025*  
*–¢–∏–ø: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ + –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥—Ñ–∏–∫—Å—ã + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ + GPU –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥*
