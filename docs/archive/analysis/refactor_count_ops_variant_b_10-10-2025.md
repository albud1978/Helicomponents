# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ count_ops ‚Äî –í–∞—Ä–∏–∞–Ω—Ç B

**–î–∞—Ç–∞:** 10.10.2025  
**–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á—ë—Ç–∞ –∞–≥–µ–Ω—Ç–æ–≤ —Å —É—á—ë—Ç–æ–º `intent_state` –≤–º–µ—Å—Ç–æ `state`

---

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### ‚úÖ **1. –ß—Ç–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤ –∏–∑ MP**
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```cpp
// –ü–æ–¥—Å—á—ë—Ç Curr (operations)
auto ops_count = FLAMEGPU->environment.getMacroProperty<unsigned int, 286u>("mi17_ops_count");
for (unsigned int i = 0u; i < frames; ++i) {
    if (ops_count[i] == 1u) ++curr;
}

const int balance = (int)curr - (int)target;  // –î–ª—è demotion
```

### ‚úÖ **2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø–æ mfg_date**
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
- **Demotion (operations):** oldest first
- **Promotion (serviceable/reserve/inactive):** youngest first

### ‚úÖ **3. –ü–µ—Ä–µ–¥–∞—á–∞ –æ—Å—Ç–∞—Ç–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏**
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –±—É—Ñ–µ—Ä—ã `approve_s3`, `approve_s5`, `approve_s1`:

```cpp
// P1 (serviceable)
used = 0u;  // –ü–µ—Ä–≤—ã–π —Å–ª–æ–π, –Ω–µ—Ç –ø—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤

// P2 (reserve)
auto approve_s3 = FLAMEGPU->environment.getMacroProperty<unsigned int, 286u>("mi17_approve_s3");
for (unsigned int i = 0u; i < frames; ++i) {
    if (approve_s3[i] == 1u) ++used;  // –£—á–∏—Ç—ã–≤–∞–µ–º P1
}

// P3 (inactive)
auto approve_s3 = ...;
auto approve_s5 = ...;
for (unsigned int i = 0u; i < frames; ++i) {
    if (approve_s3[i] == 1u) ++used;  // P1
    if (approve_s5[i] == 1u) ++used;  // P2
}

deficit = target - (curr + used);  // ‚úÖ –û—Å—Ç–∞—Ç–æ–∫ –±–∞–ª–∞–Ω—Å–∞
```

---

## üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å (–í–∞—Ä–∏–∞–Ω—Ç B)

### 1Ô∏è‚É£ **–ü–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ –º–æ–¥—É–ª–∏**

**–ë—ã–ª–æ:**
```
1. count_ops          ‚Üí –°—á–∏—Ç–∞–µ–º –ø–æ state
2. state_2_operations ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º intent=2
3. –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ       ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—á—ë—Ç—á–∏–∫–∏
```

**–°—Ç–∞–Ω–µ—Ç:**
```
1. state_2_operations ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º intent=2 (+ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã)
2. count_ops          ‚Üí –°—á–∏—Ç–∞–µ–º –ø–æ intent
3. –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ       ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏
```

### 2Ô∏è‚É£ **–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å count_ops: —Å—á–∏—Ç–∞—Ç—å –ø–æ intent –≤–º–µ—Å—Ç–æ state**

#### **–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):**
```cpp
// count_ops ‚Äî —Å–ª–æ–π –¥–ª—è operations
rtc_func.setInitialState("operations")  // ‚ùå –§–∏–ª—å—Ç—Ä –ø–æ state
rtc_func.setEndState("operations")

// –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç—ã —Å state=operations –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é
```

#### **–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):**
```cpp
// count_ops ‚Äî —Å–ª–æ–π –¥–ª—è –í–°–ï–• –∞–≥–µ–Ω—Ç–æ–≤
rtc_func.setInitialState("ALL_STATES")  // ‚úÖ –í—Å–µ –∞–≥–µ–Ω—Ç—ã

// –í–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏:
const unsigned int intent = FLAMEGPU->getVariable<unsigned int>("intent_state");
if (intent == 2u) {  // ‚úÖ –•–æ—Ç—è—Ç –±—ã—Ç—å –≤ operations
    if (group_by == 1u) {
        auto ops_count = FLAMEGPU->environment.getMacroProperty<unsigned int, 286u>("mi8_ops_count");
        ops_count[idx].exchange(1u);
    } else if (group_by == 2u) {
        auto ops_count = FLAMEGPU->environment.getMacroProperty<unsigned int, 286u>("mi17_ops_count");
        ops_count[idx].exchange(1u);
    }
}
```

---

## üîÑ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### **–î–µ–Ω—å N (–∫–æ–Ω–µ—Ü –¥–Ω—è):**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. state_2_operations (operations)                           ‚îÇ
‚îÇ    ‚îú‚îÄ –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º sne += mp5                             ‚îÇ
‚îÇ    ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –≤ repair (ppr >= oh)                ‚îÇ
‚îÇ    ‚îî‚îÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º intent=2 (—Ö–æ—Ç–∏–º –æ—Å—Ç–∞—Ç—å—Å—è –≤ operations)  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 2. count_ops (ALL –∞–≥–µ–Ω—Ç—ã)                                    ‚îÇ
‚îÇ    ‚îú‚îÄ –û–±–Ω—É–ª—è–µ–º –±—É—Ñ–µ—Ä—ã (idx=0)                               ‚îÇ
‚îÇ    ‚îî‚îÄ –°—á–∏—Ç–∞–µ–º –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ intent:                            ‚îÇ
‚îÇ       ‚îú‚îÄ intent=2 ‚Üí mi8/mi17_ops_count[idx] = 1            ‚îÇ
‚îÇ       ‚îî‚îÄ (–¥—Ä—É–≥–∏–µ intent –Ω–µ —Å—á–∏—Ç–∞–µ–º –≤ ops_count)             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 3. quota_ops_excess (operations, intent=2)                   ‚îÇ
‚îÇ    ‚îú‚îÄ –°—á–∏—Ç–∞–µ–º: curr = sum(ops_count)                        ‚îÇ
‚îÇ    ‚îú‚îÄ balance = curr - target                               ‚îÇ
‚îÇ    ‚îî‚îÄ –ï—Å–ª–∏ balance > 0:                                      ‚îÇ
‚îÇ       ‚îî‚îÄ K oldest: intent=2 ‚Üí intent=3 (–¥–µ–º–æ—É–Ω—Ç)           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 4. quota_promote_serviceable (serviceable, intent=2)         ‚îÇ
‚îÇ    ‚îú‚îÄ curr = sum(ops_count)  // –£–∂–µ —Å —É—á—ë—Ç–æ–º –¥–µ–º–æ—É–Ω—Ç–∞      ‚îÇ
‚îÇ    ‚îú‚îÄ used = 0  // –ü–µ—Ä–≤—ã–π –ø—Ä–æ–º–æ—É—Ç —Å–ª–æ–π                      ‚îÇ
‚îÇ    ‚îú‚îÄ deficit = target - (curr + used)                      ‚îÇ
‚îÇ    ‚îî‚îÄ –ï—Å–ª–∏ deficit > 0:                                      ‚îÇ
‚îÇ       ‚îú‚îÄ K youngest: intent=2 (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º)               ‚îÇ
‚îÇ       ‚îî‚îÄ approve_s3[idx] = 1                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 5. quota_promote_reserve (reserve, intent=2)                 ‚îÇ
‚îÇ    ‚îú‚îÄ curr = sum(ops_count)                                 ‚îÇ
‚îÇ    ‚îú‚îÄ used = sum(approve_s3)  // –£—á–∏—Ç—ã–≤–∞–µ–º P1              ‚îÇ
‚îÇ    ‚îú‚îÄ deficit = target - (curr + used)                      ‚îÇ
‚îÇ    ‚îî‚îÄ –ï—Å–ª–∏ deficit > 0:                                      ‚îÇ
‚îÇ       ‚îú‚îÄ K youngest: intent=2                               ‚îÇ
‚îÇ       ‚îî‚îÄ approve_s5[idx] = 1                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 6. quota_promote_inactive (inactive, intent=2)               ‚îÇ
‚îÇ    ‚îú‚îÄ curr = sum(ops_count)                                 ‚îÇ
‚îÇ    ‚îú‚îÄ used = sum(approve_s3 + approve_s5)  // P1 + P2      ‚îÇ
‚îÇ    ‚îú‚îÄ deficit = target - (curr + used)                      ‚îÇ
‚îÇ    ‚îî‚îÄ –ï—Å–ª–∏ deficit > 0:                                      ‚îÇ
‚îÇ       ‚îú‚îÄ K youngest: intent=2                               ‚îÇ
‚îÇ       ‚îî‚îÄ approve_s1[idx] = 1                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 7. states_stub (–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ states)                        ‚îÇ
‚îÇ    ‚îî‚îÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º intent –ø–æ —Ç–µ–∫—É—â–µ–º—É state                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 8-11. state_managers (–≤—Å–µ states)                            ‚îÇ
‚îÇ    ‚îî‚îÄ –í—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ intent                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### **1. count_ops —Ç–µ–ø–µ—Ä—å —Å—á–∏—Ç–∞–µ—Ç –ø–æ intent, –∞ –Ω–µ state**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `ops_count[idx] = 1` ‚Üí –∞–≥–µ–Ω—Ç **—Ö–æ—á–µ—Ç** –±—ã—Ç—å –≤ operations (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ state)
- –ê–≥–µ–Ω—Ç—ã –≤ `serviceable` —Å `intent=2` —Ç–æ–∂–µ –≤–æ–π–¥—É—Ç –≤ —Å—á—ë—Ç—á–∏–∫
- –ê–≥–µ–Ω—Ç—ã –≤ `operations` —Å `intent=3` (–¥–µ–º–æ—É–Ω—Ç–Ω—É—Ç—ã–µ) –ù–ï –≤–æ–π–¥—É—Ç

### **2. –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∂–µ–ª–∞–Ω–∏–µ–º –∞–≥–µ–Ω—Ç–æ–≤**

**–õ–æ–≥–∏–∫–∞:**
```
Curr = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2 (—Ö–æ—Ç—è—Ç –≤ operations)
  ‚îú‚îÄ –ë—ã–ª–∏ –≤ operations + —Ö–æ—Ç—è—Ç –æ—Å—Ç–∞—Ç—å—Å—è
  ‚îî‚îÄ –ë—ã–ª–∏ –≤ serviceable/reserve/inactive + —Ö–æ—Ç—è—Ç –ø—Ä–æ–º–æ—É—Ç–Ω—É—Ç—å—Å—è

Balance/Deficit —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç –ñ–ï–õ–ê–ù–ò–ô, –∞ –Ω–µ –æ—Ç —Ñ–∞–∫—Ç–æ–≤
```

### **3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã mfg_date —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**

**–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- **Demotion:** oldest first —Å—Ä–µ–¥–∏ `intent=2` –≤ operations
- **Promotion:** youngest first —Å—Ä–µ–¥–∏ `intent=2` –≤ serviceable/reserve/inactive

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ state –≤ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–∏

**–í–æ–ø—Ä–æ—Å:** –ï—Å–ª–∏ count_ops —Å—á–∏—Ç–∞–µ—Ç **–≤—Å–µ—Ö** —Å `intent=2`, –∫–∞–∫ —Ä–∞–∑–ª–∏—á–∏—Ç—å:
- –ê–≥–µ–Ω—Ç–æ–≤ –≤ `operations` —Å `intent=2` (–¥–ª—è demotion)
- –ê–≥–µ–Ω—Ç–æ–≤ –≤ `serviceable` —Å `intent=2` (–¥–ª—è promotion)

**–†–µ—à–µ–Ω–∏–µ 1 (–ø—Ä–æ—Å—Ç–æ–µ):** –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `state` –≤—Ä—É—á–Ω—É—é:

```cpp
// –í quota_ops_excess (demotion)
const unsigned int my_state = FLAMEGPU->getVariable<unsigned int>("state");
if (my_state != 2u) {
    return flamegpu::ALIVE;  // –¢–æ–ª—å–∫–æ operations —É—á–∞—Å—Ç–≤—É—é—Ç –≤ demotion
}

// –î–∞–ª–µ–µ: —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ mfg_date —Å—Ä–µ–¥–∏ operations
```

**–†–µ—à–µ–Ω–∏–µ 2 (—Å–ª–æ–∂–Ω–æ–µ):** –û—Ç–¥–µ–ª—å–Ω—ã–µ –±—É—Ñ–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ state:
- `mi17_ops_intent2_count[idx]` ‚Äî –≤ operations —Å intent=2
- `mi17_svc_intent2_count[idx]` ‚Äî –≤ serviceable —Å intent=2

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞

```
state_2_operations:
  ‚îú‚îÄ –ê–≥–µ–Ω—Ç—ã –≤ operations —Ä–∞–±–æ—Ç–∞—é—Ç (sne += mp5)
  ‚îî‚îÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç intent=2

count_ops:
  ‚îî‚îÄ –°—á–∏—Ç–∞–µ–º –í–°–ï–• –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2
     ‚Üí ops_count[idx] = 1 (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç state)

quota_ops_excess (operations):
  ‚îú‚îÄ –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ state=operations (–≤—Ä—É—á–Ω—É—é)
  ‚îú‚îÄ Curr = sum(ops_count WHERE state=operations)
  ‚îî‚îÄ –î–µ–º–æ—É–Ω—Ç K oldest: intent=2 ‚Üí intent=3

quota_promote_serviceable (serviceable):
  ‚îú‚îÄ –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ state=serviceable (–≤—Ä—É—á–Ω—É—é)
  ‚îú‚îÄ Curr = sum(ops_count) - –¥–µ–º–æ—É–Ω—É—Ç—ã—Ö
  ‚îî‚îÄ –ü—Ä–æ–º–æ—É—Ç K youngest: intent=2 (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º)
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –í–∞—Ä–∏–∞–Ω—Ç–∞ B

1. **–õ–æ–≥–∏—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:** –°–Ω–∞—á–∞–ª–∞ intent, –ø–æ—Ç–æ–º —Å—á—ë—Ç
2. **–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–∏—Ç –∂–µ–ª–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤
3. **–ö–∞—Å–∫–∞–¥ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏:** –û—Å—Ç–∞—Ç–æ–∫ –¥–µ—Ñ–∏—Ü–∏—Ç–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –º–µ–∂–¥—É P1‚ÜíP2‚ÜíP3
4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã mfg_date:** –†–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –∫–∞–∂–¥–æ–º —Å–ª–æ–µ

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å orchestrator_v2.py:**
   - –ü–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ `count_ops` ‚Üî `state_2_operations`

2. **–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å rtc_quota_count_ops.py:**
   - –°–ª–æ–π 2 (count_ops): —É–±—Ä–∞—Ç—å `setInitialState("operations")`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –∞–≥–µ–Ω—Ç—ã
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `intent_state == 2u`
   - –£–±—Ä–∞—Ç—å —Å–ª–æ–π 3 (count_serviceable) ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω

3. **–û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª–∏ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –î–æ–±–∞–≤–∏—Ç—å —Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É `state` –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–π (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
   - –£—Ç–æ—á–Ω–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü—Ä–æ–≥–æ–Ω –Ω–∞ 3650 –¥–Ω–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Day 226-230 (–Ω–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ serviceable

---

## ü§î –í–æ–ø—Ä–æ—Å –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è

**–ù—É–∂–Ω–æ –ª–∏ —Å—á–∏—Ç–∞—Ç—å serviceable –æ—Ç–¥–µ–ª—å–Ω–æ?**

–ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ `svc_count` –±—É—Ñ–µ—Ä –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å, –∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `quota_promote_serviceable` –¥–µ–ª–∞—Ç—å –ø–æ:
```cpp
if (my_state != 3u) return;  // –¢–æ–ª—å–∫–æ serviceable
// –î–∞–ª–µ–µ: —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥–∏ serviceable –ø–æ mfg_date
```

**–í–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ?**

