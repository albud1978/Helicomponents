# Правильное решение для переходов состояний в FLAME GPU

## Понимание проблемы

FLAME GPU ограничивает функции в одном слое для обеспечения корректной параллельной обработки:
- Нельзя иметь функции с общим выходным состоянием в одном слое
- Нельзя иметь функции с общим входным состоянием в одном слое

## Правильный подход

### 1. Использование промежуточных состояний

Вместо прямых переходов `1->2`, `3->2`, `5->2` используем:

```
1 -> pending_ops_from_inactive
3 -> pending_ops_from_serviceable  
5 -> pending_ops_from_reserve
2 -> pending_repair (для 2->4)
2 -> pending_storage (для 2->6)
4 -> pending_reserve (для 4->5)
```

Затем в следующем слое:
```
pending_ops_from_* -> operations
pending_repair -> repair
pending_storage -> storage
pending_reserve -> reserve
```

### 2. Использование сообщений

Агенты могут отправлять сообщения о намерении перейти в новое состояние, а специальная функция обрабатывает эти сообщения.

### 3. Разделение по временным шагам

Обрабатывать разные типы переходов в разные шаги симуляции:
- Чётные шаги: переходы в operations
- Нечётные шаги: переходы из operations

## Рекомендуемое решение для нашего случая

Использовать промежуточные состояния - это стандартный паттерн в FLAME GPU для решения таких конфликтов.
