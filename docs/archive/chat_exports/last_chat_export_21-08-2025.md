# Экспорт чата от 21-08-2025

## Основные темы чата
- Инкрементная отладка FLAME GPU RTC слоёв: repair → ops_check → main
- Исправление daily_flight и инкрементов sne/ppr для status_id=2
- Расчёт aircraft_age_years (целые годы, округление вниз)
- Введение атомарной квоты D+1 (шаг 1) через MacroProperty и ops_ticket
- Логирование квоты в simulation_metadata (seed/claimed)
- Переименование раннера в sim_master.py

## Решенные задачи
- Включён rtc_ops_check с корректным чтением дневных массивов; инкременты sne/ppr реализованы в rtc_main.
- daily_flight записывается из агентной daily_today_u32 для status_id=2.
- aircraft_age_years добавлен в экспорт MP2 (UInt8, полные годы на дату D).
- Реализована квота D+1 (инициализация из MP4(D+1), атомарный q--, ops_ticket).
- Добавлено логирование квоты в simulation_metadata.
- Удалены кэши Python (__pycache__, *.pyc).

## Проблемы и их решения
- Нули в daily_flight и sne: устранено — источники исправлены, верификация выполнена в ClickHouse агрегатами.
- NVRTC ошибка getPropertyArray: заменено на агентные daily_* переменные, совместимо с RTC.
- Несогласованность даты mfg_date: для агентов используем epoch‑days; в MP2 берём точную дату из MP3 по psn.

## Изменения в коде
- Обновлены файлы:
  - code/repair_only_model.py — добавлены RTC функции rtc_ops_check, rtc_main, rtc_quota_init, квотные поля в Environment и агенте.
  - code/sim_master.py — подготовка дневных массивов, расчёт возраста, экспорт, инициализация квоты D+1, логирование квоты.
- Переименование:
  - repair_only_runner.py → sim_master.py.

## Обновления документации
- docs/Tasktracker.md — добавлены завершённые задачи (RTC слои, возраст, квота, логирование, уборка).
- docs/changelog.md — запись за 21-08-2025: инкрементная отладка RTC и атомарная квота (шаг 1).

## Следующие шаги
- Проверка корректности квоты на большем периоде и по группам (group_by=1/2).
- Внедрение переходов 3/5→2 с учётом квоты (баланс), синхронизация с docs/transform.md.
- Расширение метрик экспорта (при необходимости вынести claimed в явные числовые поля).
