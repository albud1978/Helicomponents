# Экспорт чата от 08-09-2025

## Основные темы чата
- Интеграция спавна агентов (MI-17) в полную GPU-модель
- NVRTC/JIT ошибки в rtc_log_day и их устранение
- Перенос логгера MP2 на agent_out, отказ от MacroPropertyArray в RTC
- Extract: enricher для новых MI-17 и корректное заполнение словаря
- Жёсткие правила ETL: отсутствие «неважных этапов» и «тихих» ошибок

## Решенные задачи
- Исправлен compile-фейл NVRTC: замена (FRAMES*DAYS) на FRAMESDAYS
- rtc_log_day переписан на agent_out с setAgentOutput("MP2_ROW")
- Исправлено имя переменной asm -> asm_tr в RTC (конфликт с ключевым словом)
- Подготовлены команды smoke-прогонов для диагностики JIT

## Проблемы и их решения
- Падение NVRTC при компиляции rtc_log_day: диагностировано как несовместимость MacroPropertyArray в текущем колесе/шаблоны Jitify; временно переведено на agent_out
- Несоответствие типов/индексов в env: добавлена печать исходника RTC по HL_JIT_LOG для быстрой отладки
- Ошибка в Extract при генерации новых MI-17 в неподходящей стадии: вынесено в финальный enricher-этап

## Изменения в коде
- Обновлён `code/model_build.py`:
  - Добавлен агент `MP2_ROW` и RTC-функция `rtc_log_day` через agent_out
  - Установлен `setAgentOutput("MP2_ROW")`
  - Устранены NVRTC-проблемы с размерностями и ключевыми словами
- Скорректирован `code/sim_master.py` ранее (инициализация mfg_date, spawn-пулы, DDL sim_results)
- Обновлён `code/program_fl_direct_loader.py` и добавлен `code/program_fl_new_mi17_enricher.py`

## Обновления документации
- `docs/GPU.md`: перечень переменных агента, команды запуска, правила по mfg_date (UInt16)
- `docs/README.md`: добавлены команды smoke/long-run
- `docs/changelog.md`: зафиксированы ключевые изменения и ссылка на экспорт
- `docs/Tasktracker.md`: добавлена P1-задача «Динамическая размерность и экспорт агентов»

## Следующие шаги
- Прогон smoke 10 суток с HL_JIT_LOG=1 для верификации rtc_log_day
- Прогоны 365 и 3650 суток для обоих режимов (с/без MP2 постпроцессинга)
- Возврат к MacroProperty‑матрице для MP2, если колесо PyFLAMEGPU будет совместимо
- Продолжить интеграцию GPU‑спавна (manager→tickets) и проверку D+1 инвариантов


