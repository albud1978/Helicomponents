# States_stub Order Fix (10-10-2025)

## üîç –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ—Ä—Ü–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É operations ‚Üî serviceable

### –ü—Ä–∏–º–µ—Ä (–±–æ—Ä—Ç 22171):
```
Day 2818: operations (intent=2)
Day 2819: serviceable (intent=2) ‚Üê –î–µ–º–æ—É—Ç –∫–≤–æ—Ç–æ–π
Day 2820: operations (intent=2)  ‚Üê –ü—Ä–æ–º–æ—É—Ç —Å–Ω–æ–≤–∞
Day 2821: serviceable (intent=2) ‚Üê –î–µ–º–æ—É—Ç —Å–Ω–æ–≤–∞
...—Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è...
```

## üêõ –ü—Ä–∏—á–∏–Ω–∞

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –º–æ–¥—É–ª–µ–π:**

```
1. state_2_operations  ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç intent=2
2. count_ops
3. quota_ops_excess    ‚Üí –î–ï–ú–û–£–¢: intent=3 (–¥–ª—è 2 –±–æ—Ä—Ç–æ–≤)
4. quota_promote_*     ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç intent==2
5. states_stub         ‚Üí –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢ intent=2 ‚ùå
6. state_managers      ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
- `quota_ops_excess` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª `intent=3` (–¥–µ–º–æ—É—Ç)
- `states_stub` –ë–ï–ó–£–°–õ–û–í–ù–û –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª `intent=2` –¥–ª—è serviceable
- –ù–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –∞–≥–µ–Ω—Ç —Å–Ω–æ–≤–∞ —Ö–æ—Ç–µ–ª –≤ operations
- `quota_ops_excess` —Å–Ω–æ–≤–∞ –¥–µ–º–æ—É—Ç–∏–ª ‚Üí **–¶–ò–ö–õ**

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `states_stub` –í –ù–ê–ß–ê–õ–û, –ü–ï–†–ï–î –∫–≤–æ—Ç–∞–º–∏:**

```
1. states_stub           ‚Üê –ë–ê–ó–û–í–û–ï –∂–µ–ª–∞–Ω–∏–µ
2. state_2_operations    ‚Üê –õ–æ–≥–∏–∫–∞ operations
3. count_ops             ‚Üê –ü–æ–¥—Å—á—ë—Ç curr
4. quota_ops_excess      ‚Üê –ö–û–†–†–ï–ö–¢–ò–†–û–í–ö–ê: –¥–µ–º–æ—É—Ç
5. quota_promote_*       ‚Üê –ö–û–†–†–ï–ö–¢–ò–†–û–í–ö–ê: –ø—Ä–æ–º–æ—É—Ç
6. state_managers        ‚Üê –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
7. spawn_v2              ‚Üê –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
```

## üéØ –õ–æ–≥–∏–∫–∞

### 1. states_stub —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ë–ê–ó–û–í–û–ï –∂–µ–ª–∞–Ω–∏–µ:
- `inactive` ‚Üí `intent=2` (–µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π)
- `serviceable` ‚Üí `intent=2` (—Ö–æ—á–µ—Ç –≤ operations)
- `reserve` ‚Üí `intent=2` (—Ö–æ—á–µ—Ç –≤ operations)
- `repair` ‚Üí `intent=4` (–æ—Å—Ç–∞—ë—Ç—Å—è) –∏–ª–∏ `intent=5` (‚Üí reserve)
- `storage` ‚Üí `intent=6` (–æ—Å—Ç–∞—ë—Ç—Å—è)

### 2. –ö–≤–æ—Ç—ã –ö–û–†–†–ï–ö–¢–ò–†–£–Æ–¢ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:
- `quota_ops_excess`: –ï–°–õ–ò –ø–µ—Ä–µ–∏–∑–±—ã—Ç–æ–∫ ‚Üí `intent=3` (–¥–µ–º–æ—É—Ç)
- `quota_promote_*`: –ï–°–õ–ò –¥–µ—Ñ–∏—Ü–∏—Ç ‚Üí –æ–¥–æ–±—Ä—è—é—Ç –ø—Ä–æ–º–æ—É—Ç

### 3. State managers –ø—Ä–∏–º–µ–Ω—è—é—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

### –ï—Å–ª–∏ MP4 –∫–≤–æ—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞:
```
–î–µ–Ω—å 1: 85 –±–æ—Ä—Ç–æ–≤ –≤ operations (–∫–≤–æ—Ç–∞ = 85)
–î–µ–Ω—å 2: 85 –±–æ—Ä—Ç–æ–≤ ‚Üí –±–∞–ª–∞–Ω—Å=0 ‚Üí –¥–µ–º–æ—É—Ç–∞ –ù–ï–¢
–î–µ–Ω—å 3: 85 –±–æ—Ä—Ç–æ–≤ ‚Üí –±–∞–ª–∞–Ω—Å=0 ‚Üí –¥–µ–º–æ—É—Ç–∞ –ù–ï–¢
‚úÖ –ê–≥–µ–Ω—Ç—ã –°–¢–ê–ë–ò–õ–¨–ù–´
```

### –ï—Å–ª–∏ MP4 –∫–≤–æ—Ç–∞ —Å–Ω–∏–∂–∞–µ—Ç—Å—è:
```
–î–µ–Ω—å 1: 85 –±–æ—Ä—Ç–æ–≤ (–∫–≤–æ—Ç–∞ = 85)
–î–µ–Ω—å 2: –∫–≤–æ—Ç–∞ = 83 ‚Üí –±–∞–ª–∞–Ω—Å=+2 ‚Üí –î–ï–ú–û–£–¢ 2 –±–æ—Ä—Ç–æ–≤ (intent=3)
–î–µ–Ω—å 3: 83 –±–æ—Ä—Ç–∞ (–∫–≤–æ—Ç–∞ = 83) ‚Üí –±–∞–ª–∞–Ω—Å=0 ‚Üí –¥–µ–º–æ—É—Ç–∞ –ù–ï–¢
‚úÖ –ê–≥–µ–Ω—Ç—ã –°–¢–ê–ë–ò–õ–¨–ù–´ –ø–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
1. ‚úÖ –ö–≤–æ—Ç—ã –ö–û–†–†–ï–ö–¢–ò–†–£–Æ–¢ –±–∞–∑–æ–≤–æ–µ –∂–µ–ª–∞–Ω–∏–µ, –∞ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å –Ω–∏–º
2. ‚úÖ –ù–µ—Ç —Ü–∏–∫–ª–æ–≤ –∏ –º–µ—Ä—Ü–∞–Ω–∏—è
3. ‚úÖ `intent` –≤—Å–µ–≥–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ 0)
4. ‚úÖ –ê–≥–µ–Ω—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –∫–≤–æ—Ç–µ

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è

### docs/README.md
**–ë—ã–ª–æ:**
```bash
--modules state_2_operations count_ops quota_ops_excess ... states_stub ...
```

**–°—Ç–∞–ª–æ:**
```bash
--modules states_stub state_2_operations count_ops quota_ops_excess ...
```

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞:
```bash
cd "/home/budnik_an/cube linux/cube" && \
rm -rf code/sim_v2/__pycache__ code/sim_v2/rtc_modules/__pycache__ code/sim_v2/components/__pycache__ && \
export CUDA_PATH=/usr/local/cuda-12.8 CUBE_CONFIG_PATH="/home/budnik_an/cube linux/cube" && \
python3 code/sim_v2/orchestrator_v2.py \
  --modules states_stub state_2_operations count_ops quota_ops_excess quota_promote_serviceable quota_promote_reserve quota_promote_inactive state_manager_serviceable state_manager_operations state_manager_repair state_manager_storage spawn_v2 \
  --steps 3650 \
  --enable-mp2 \
  --drop-table \
  2>&1 | cat
```

## üìù –ß—Ç–æ –¥–µ–ª–∞–µ—Ç states_stub (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ)

### –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
1. üìä –ß–∏—Ç–∞–µ—Ç MP5 (daily_today, daily_next) –¥–ª—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
2. ‚è±Ô∏è  –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç repair_days –¥–ª—è repair
3. üîÑ –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–º repair ‚Üí reserve
4. ‚úÖ –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è inactive (—Å—Ç–∞—Ä—ã–µ ‚Üí —Ö–æ—Ç—è—Ç –≤ operations)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è serviceable:
- **–ë–µ–∑—É—Å–ª–æ–≤–Ω–æ** —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `intent=2` (—Ö–æ—á–µ—Ç –≤ operations)
- **–≠—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**, –µ—Å–ª–∏ states_stub –∏–¥—ë—Ç –ü–ï–†–ï–î –∫–≤–æ—Ç–∞–º–∏
- –ö–≤–æ—Ç—ã –º–æ–≥—É—Ç –ü–ï–†–ï–ó–ê–ü–ò–°–ê–¢–¨ –Ω–∞ `intent=3` –ø—Ä–∏ –¥–µ–º–æ—É—Ç–µ

## ‚úÖ –ò—Ç–æ–≥

- [x] –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –º–æ–¥—É–ª–∏ –≤ README.md
- [x] –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –∞–Ω–∞–ª–∏–∑–æ–º
- [x] –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é: `python3 code/sim_v2/orchestrator_v2.py --modules states_stub state_2_operations count_ops quota_ops_excess quota_promote_serviceable quota_promote_reserve quota_promote_inactive state_manager_serviceable state_manager_operations state_manager_repair state_manager_storage spawn_v2 --steps 300 --enable-mp2 --drop-table`

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç (300 –¥–Ω–µ–π):** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–æ—Ä—Ç 22171 –≤ days 2818-2821
2. **–ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω (3650 –¥–Ω–µ–π):** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ä—Ü–∞–Ω–∏—è –≤–æ –≤—Å–µ–π —Å–∏–º—É–ª—è—Ü–∏–∏
3. **SQL –ø—Ä–æ–≤–µ—Ä–∫–∞:**
   ```sql
   SELECT day_u16, state, intent_state, prev_intent_state
   FROM default.sim_masterv2
   WHERE aircraft_number = 22171
     AND day_u16 BETWEEN 2818 AND 2821
   ORDER BY day_u16;
   ```
   –û–∂–∏–¥–∞–µ–º: –ø–æ—Å–ª–µ –¥–µ–º–æ—É—Ç–∞ –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ `serviceable` —Å `intent=3`

## üìå –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `docs/rtc_pipeline_architecture.md` ‚Äî —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `docs/changelog.md` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏

