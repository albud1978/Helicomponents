# LIMITER Architecture (V7 ‚Äî –û–¥–Ω–æ—Ñ–∞–∑–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

> **–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è:** V7 (14-01-2026)  
> **–§–∞–π–ª –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:** `code/sim_v2/messaging/orchestrator_limiter_v7.py`

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (14-01-2026)

### 1. Printf —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è MacroProperty (WORKAROUND)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ–∑ DEBUG printf –≤ `rtc_compute_global_min_v5` MacroProperty `program_changes_mp` –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–µ–∂–¥—É host –∏ device. V7 "–ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–µ—Ç" program_changes.

**–°–∏–º–ø—Ç–æ–º—ã:** 
- –° printf: `pc=89`, `adaptive=16` ‚Üí V7 –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ program_change
- –ë–µ–∑ printf: `pc=end_day`, `adaptive=30` ‚Üí V7 –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç program_change

**Workaround:** –û—Å—Ç–∞–≤–ª–µ–Ω DEBUG printf –Ω–∞ –ø–µ—Ä–≤—ã—Ö 3 —à–∞–≥–∞—Ö –≤ `rtc_compute_global_min_v5`:
```cpp
if (dbg_step2 < 3u) {
    printf("[RTC PC] step=%u, num_pc=%u, pc[0]=%u, pc[1]=%u, pc[2]=%u\\n", ...);
}
```

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω–æ race condition –≤ FLAME GPU MacroProperty sync.

### 2. MP2 —ç–∫—Å–ø–æ—Ä—Ç —Å step() —Ü–∏–∫–ª–æ–º (–ù–ï –†–ï–®–ï–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `while simulation.step()` (–¥–ª—è MP2 —ç–∫—Å–ø–æ—Ä—Ç–∞) `HF_SyncDayV5` –≤–∏–¥–∏—Ç –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è `current_day_mp` —á–µ–º –ø—Ä–∏ `simulation.simulate()`.

**–°–∏–º–ø—Ç–æ–º—ã:**
- `simulate()`: HF_SYNC –≤–∏–¥–∏—Ç day=89 –Ω–∞ step=8 ‚úì
- `step() loop`: HF_SYNC –≤–∏–¥–∏—Ç day=103 –Ω–∞ step=8 ‚úó

**–ü—Ä–∏—á–∏–Ω–∞:** `collect_agents_state()` –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç `getPopulationData`) –∫–∞–∫–∏–º-—Ç–æ –æ–±—Ä–∞–∑–æ–º –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ MacroProperty.

**–°–ª–µ–¥—Å—Ç–≤–∏–µ:** Day=89 –∏ –¥—Ä—É–≥–∏–µ program_changes –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –°–£–ë–î –ø—Ä–∏ MP2 —ç–∫—Å–ø–æ—Ä—Ç–µ.

**Workaround:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `simulate()` –±–µ–∑ MP2 —ç–∫—Å–ø–æ—Ä—Ç–∞, –∏–ª–∏ –ø—Ä–∏–Ω—è—Ç—å —á—Ç–æ –Ω–µ –≤—Å–µ program_changes –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∞–Ω—ã.

---

## üîë –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø V8 (–ö–ê–ù–û–ù)

> **–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è V8. –õ—é–±—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ.**

| –í–æ–ø—Ä–æ—Å | V7 | V8 | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ V8 |
|--------|-----|-----|----------------|
| **–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–º–æ–Ω—Ç–∞** | exit_date –¥–ª—è –∫–∞–∂–¥–æ–≥–æ unsvc | RepairAgent.capacity (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π) | –£–ø—Ä–æ—â–µ–Ω–∏–µ: –æ–¥–∏–Ω –≥–µ–π—Ç –≤–º–µ—Å—Ç–æ N |
| **exit_date –¥–ª—è unsvc** | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚ùå –£–î–ê–õ–Å–ù | –ó–∞–º–µ–Ω—ë–Ω –Ω–∞ capacity-–ø—Ä–æ–≤–µ—Ä–∫—É |
| **repair_days –¥–ª—è unsvc** | ‚Äî | ‚ùå –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø | unsvc –Ω–µ –¥–µ–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è |
| **unsvc –≤ min_dynamic** | ‚úÖ –î–∞ | ‚ùå –ù–ï–¢ | –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ capacity |
| **–ü—Ä–∞–≤–∏–ª–æ —Ä–µ—Å—É—Ä—Å–∞** | post-increment (`sne += dt; if sne >= ll`) | next-day dt (`if sne + dt >= ll`) | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–∞–ª—ë—Ç–∞ |
| **limiter=0** | min(1, ...) –≤ Python | **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥** (–∏–Ω–∞—á–µ EXCEPTION) | –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ |
| **limiter –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** | max(1, ...) | –†–∞–∑—Ä–µ—à—ë–Ω 0 | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å RTC |

**‚ö†Ô∏è –í–ê–ñ–ù–û: V8 –ù–ï —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω V7 –ø–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º ‚Äî —ç—Ç–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.**

---

## üìä –¢–∞–±–ª–∏—Ü–∞ RTC –º–æ–¥—É–ª–µ–π (27 —Ñ—É–Ω–∫—Ü–∏–π + –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∞–≤–Ω)

> **‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–æ—Ä—è–¥–æ–∫ = —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
> 
> –ù–æ–º–µ—Ä–∞ (#) –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç **–ø–æ—Ä—è–¥–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–ª–æ—ë–≤ –≤ –º–æ–¥–µ–ª–∏** ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ–º –ø–æ—Ä—è–¥–∫–µ. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
> 
> 1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö** ‚Äî —Å–ª–æ–π N —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–ª–æ–µ–º N-1
> 2. **Reset –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–æ–º** ‚Äî `reset_exit_date` (‚ÜíMAX) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –î–û `copy_exit_date` (atomicMin), –∏–Ω–∞—á–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞
> 3. **–ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Å—Ç—Ä–æ–≥–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ø–æ–¥—Å—á—ë—Ç ‚Üí —Ä–µ—à–µ–Ω–∏—è QM ‚Üí –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –∞–≥–µ–Ω—Ç–∞–º
> 4. **Adaptive steps** ‚Äî –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (`min_exit_date`, `min_limiter`, `program_changes`) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã –î–û `compute_global_min`

> **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
> - –§—É–Ω–∫—Ü–∏–∏ `_stay` —É–¥–∞–ª–µ–Ω—ã ‚Äî FLAME GPU –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
> - `clear_limiter_on_exit` —É–¥–∞–ª—ë–Ω ‚Äî –æ–±–Ω—É–ª–µ–Ω–∏–µ —É–∂–µ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö 2‚Üí3, 2‚Üí6, 2‚Üí7
> - `limiter_on_entry` —É–ø—Ä–æ—â—ë–Ω ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ `limiter==0` (–±–µ–∑ intent)

| # | –°–ª–æ–π | –§—É–Ω–∫—Ü–∏—è | State | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|---------|-------|----------|
| **–§–ê–ó–ê -1: –°–±–æ—Ä min_exit_date (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã —Ä–µ–º–æ–Ω—Ç–æ–≤/spawn)** |||||
| 0 | v7_reset_exit_date | `rtc_reset_exit_date_v7` | QM | `min_exit_date_mp = MAX` (—Å–±—Ä–æ—Å –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–æ–º) |
| 1 | v7_copy_exit_date_repair | `rtc_copy_exit_date_repair_v7` | 4 | `atomicMin(exit_date)` –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ repair |
| 2 | v7_copy_exit_date_spawn | `rtc_copy_exit_date_spawn_v7` | 5 | `atomicMin(exit_date)` –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ reserve |
| 2b | v7_copy_exit_date_unsvc | `rtc_copy_exit_date_unsvc_v7` | 7 | ‚ö†Ô∏è **V8: –£–î–ê–õ–Å–ù** ‚Äî unsvc –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ min_dynamic |
| **–§–ê–ó–ê 0: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã** |||||
| 3 | v7_repair_to_svc | `rtc_repair_to_svc_v7` | 4‚Üí3 | –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–º–æ–Ω—Ç–∞ –ø—Ä–∏ `current_day >= exit_date`, PPR=0 |
| 4 | v7_spawn_to_ops | `rtc_spawn_to_ops_v7` | 5‚Üí2 | Spawn –ø—Ä–∏ `current_day >= exit_date` |
| **–§–ê–ó–ê 1: Operations ‚Äî –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º** |||||
| 5 | v7_ops_increment | `rtc_ops_increment_v7` | 2‚Üí2 | `sne += dt`, `ppr += dt`, `limiter -= adaptive` (3 —Å—á—ë—Ç—á–∏–∫–∞ –≤ 1 –ø—Ä–æ—Ö–æ–¥) |
| 6 | v7_ops_to_storage | `rtc_ops_to_storage_v7` | 2‚Üí6 | –ü–µ—Ä–µ—Ö–æ–¥ –µ—Å–ª–∏ `SNE >= LL` –∏–ª–∏ `(PPR >= OH AND SNE >= BR)`, `limiter=0` |
| 7 | v7_ops_to_unsvc | `rtc_ops_to_unsvc_v7` | 2‚Üí7 | –ü–µ—Ä–µ—Ö–æ–¥ –µ—Å–ª–∏ `PPR >= OH`, `limiter=0` (**V8: –±–µ–∑ exit_date**) |
| **–§–ê–ó–ê 2: –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** |||||
| 8 | v7_reset_flags | `rtc_reset_flags_v7` | all | –°–±—Ä–æ—Å `promoted=0`, `needs_demote=0` |
| 9 | v7_reset_buffers | `rtc_reset_buffers_v7` | **all** | –û–±–Ω—É–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤ –ø–æ–¥—Å—á—ë—Ç–∞ (**7 —Å–æ—Å—Ç–æ—è–Ω–∏–π**, bugfix!) |
| 10 | v7_count_agents | `rtc_count_agents_v7` | all | –ü–æ–¥—Å—á—ë—Ç –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º |
| 11 | v7_demote | `rtc_demote_v7` | QM | –î–µ–º–æ—É—Ç: ops‚Üísvc (–ø—Ä–∏ –∏–∑–±—ã—Ç–∫–µ) |
| 12 | v7_promote_p1 | `rtc_promote_p1_v7` | QM | P1: svc‚Üíops (–ø—Ä–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–µ) |
| 13 | v7_promote_p2 | `rtc_promote_p2_v7` | QM | P2: unsvc‚Üíops (**V8: —á–µ—Ä–µ–∑ RepairAgent**) |
| 14 | v7_promote_p3 | `rtc_promote_p3_v7` | QM | P3: ina‚Üíops (**V8: —á–µ—Ä–µ–∑ RepairAgent**) |
| **–§–ê–ó–ê 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–≤–æ—Ç** |||||
| 15 | v7_apply_demote | `rtc_apply_demote_v7` | 2‚Üí3 | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–µ–º–æ—É—Ç–∞, `limiter=0` |
| 16 | v7_apply_promote_p1 | `rtc_apply_promote_p1_v7` | 3‚Üí2 | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ P1 |
| 17 | v7_apply_promote_p2 | `rtc_apply_promote_p2_v7` | 7‚Üí2 | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ P2, `PPR=0` |
| 18 | v7_apply_promote_p3 | `rtc_apply_promote_p3_v7` | 1‚Üí2 | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ P3 |
| **–§–ê–ó–ê 4: –°–±–æ—Ä min_limiter (–≥–æ—Ä–∏–∑–æ–Ω—Ç—ã –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º)** |||||
| 19 | limiter_on_entry | `rtc_compute_limiter_on_entry` | 2 | –ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫ `limiter` –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ —Å `limiter==0` |
| 20 | min_limiter | `rtc_compute_min_limiter` | 2 | `atomicMin(limiter)` ‚Üí `mp_min_limiter` |
| **–§–ê–ó–ê 5: –†–∞—Å—á—ë—Ç adaptive_days –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É** |||||
| 21 | copy_limiter_v5 | `rtc_copy_limiter_v5` | 2 | –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ limiter –≤ –±—É—Ñ–µ—Ä |
| 22 | compute_global_min | `rtc_compute_global_min_v5` | QM(1) | **–ß–ò–¢–ê–ï–¢** –≤—Å–µ min ‚Üí –≤—ã—á–∏—Å–ª—è–µ—Ç `adaptive_days` (**—Ç–æ–ª—å–∫–æ group_by=1**, race condition fix) |
| 23 | reset_min | `rtc_reset_min_limiter_v5` | QM | `mp_min_limiter = MAX` (–¥–ª—è —Å–ª–µ–¥. —à–∞–≥–∞) |
| 24 | clear_limiter_v5 | `rtc_clear_limiter_v5` | non-ops | –û—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –¥–ª—è –Ω–µ-ops –∞–≥–µ–Ω—Ç–æ–≤ |
| 25 | save_adaptive | `rtc_save_adaptive_v5` | HELI | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `adaptive_days` –≤ –∞–≥–µ–Ω—Ç–∞ |
| 26 | save_adaptive_qm | `rtc_save_adaptive_v5_qm` | QM | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `adaptive_days` –≤ QM |
| 27 | update_day | `rtc_update_day_v5` | QM | `current_day += adaptive_days` |
| **–§–ê–ó–ê 6: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∞–≤–Ω** |||||
| 28 | v7_spawn_dynamic_mgr | `rtc_spawn_dynamic_mgr` | SpawnMgr | –†–∞—Å—á—ë—Ç –¥–µ—Ñ–∏—Ü–∏—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ need/base_idx |
| 29 | v7_spawn_dynamic_ticket | `rtc_spawn_dynamic_ticket` | Ticket‚Üíops | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ (agent_out) |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã V7

### –û–¥–Ω–æ—Ñ–∞–∑–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Single-Phase)

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç baseline:** –ü–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é** —á–µ—Ä–µ–∑ `setInitialState/setEndState` —Å `FunctionCondition`, –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `intent_state`.

```cpp
// V7: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ —Å FunctionCondition
FLAMEGPU_AGENT_FUNCTION_CONDITION(cond_ops_to_unsvc_v7) {
    const unsigned int ppr = FLAMEGPU->getVariable<unsigned int>("ppr");
    const unsigned int oh = FLAMEGPU->getVariable<unsigned int>("oh");
    return ppr >= oh;  // Condition: PPR >= OH
}

FLAMEGPU_AGENT_FUNCTION(rtc_ops_to_unsvc_v7, ...) {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º exit_date –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è repair_time
    const unsigned int current_day = FLAMEGPU->environment.getProperty<unsigned int>("current_day");
    const unsigned int repair_time = FLAMEGPU->environment.getProperty<unsigned int>("mi17_repair_time_const");
    FLAMEGPU->setVariable<unsigned int>("exit_date", current_day + repair_time);
    // PPR —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è ‚Äî –æ–±–Ω—É–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –≤ ops (unsvc‚Üíops)
    return flamegpu::ALIVE;
}
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: fn.setInitialState("operations"); fn.setEndState("unserviceable");
```

### –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã

–ê–≥–µ–Ω—Ç—ã –≤ `repair` (4) –∏ `reserve` (5) –∏–º–µ—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `exit_date` ‚Äî –¥–µ–Ω—å –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

- **repair ‚Üí serviceable (4‚Üí3):** –ü—Ä–∏ `current_day >= exit_date`
- **reserve ‚Üí operations (5‚Üí2):** –ü—Ä–∏ `current_day >= exit_date` (–ø–ª–∞–Ω–æ–≤—ã–π spawn)

`exit_date` –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ä–∞—Å—á—ë—Ç `adaptive_days` —á–µ—Ä–µ–∑ `min_exit_date_mp`.

### –°–æ—Å—Ç–æ—è–Ω–∏—è V7

| ID | State | –û–ø–∏—Å–∞–Ω–∏–µ |
|----|-------|----------|
| 1 | inactive | –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π (–æ–∂–∏–¥–∞–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏) |
| 2 | operations | –í —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ |
| 3 | serviceable | –ò—Å–ø—Ä–∞–≤–µ–Ω, –Ω–∞ —Å–∫–ª–∞–¥–µ |
| 4 | repair | –í —Ä–µ–º–æ–Ω—Ç–µ |
| 5 | reserve | –†–µ–∑–µ—Ä–≤ / –ø–ª–∞–Ω–æ–≤—ã–π spawn |
| 6 | storage | –•—Ä–∞–Ω–µ–Ω–∏–µ (—Å–ø–∏—Å–∞–Ω) |
| 7 | unserviceable | –ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω (PPR >= OH, –∂–¥—ë—Ç —Ä–µ–º–æ–Ω—Ç–∞) |

### –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–æ–º–æ—É—Ç–∞:**
1. **P1:** serviceable ‚Üí operations (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π)
2. **P2:** unserviceable ‚Üí operations (PPR=0)
3. **P3:** inactive ‚Üí operations (—Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π)
4. **P4:** dynamic spawn (–ø–æ–∫—É–ø–∫–∞ –≤–µ—Ä—Ç–æ–ª—ë—Ç–∞)

**V7: –û–∂–∏–¥–∞–Ω–∏–µ repair_time —á–µ—Ä–µ–∑ exit_date:**
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ `ops ‚Üí unserviceable` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `exit_date = current_day + repair_time`
- P2 –ø—Ä–æ–º–æ—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `current_day >= exit_date` –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≤ ops

**V8: –û–∂–∏–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ RepairAgent.capacity:**
- unsvc –ù–ï –∏–º–µ–µ—Ç exit_date –¥–ª—è adaptive steps
- P2/P3 –ø—Ä–æ–≤–µ—Ä—è—é—Ç: `current_day >= repair_time AND capacity >= repair_time`
- –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Üí P4 (spawn)
- –°–º. `docs/adaptive_steps_logic.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

**–î–µ–º–æ—É—Ç:** operations ‚Üí serviceable (–ø—Ä–∏ –∏–∑–±—ã—Ç–∫–µ)

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —à–∞–≥–∏

**V7:**
```
adaptive_days = min(min_limiter, days_to_program_change, days_to_exit_date)
```

**V8 (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):**
```
adaptive_days = min(min_dynamic, days_to_deterministic)
```

| V7 –ò—Å—Ç–æ—á–Ω–∏–∫ | V8 –ò—Å—Ç–æ—á–Ω–∏–∫ | –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç |
|-------------|-------------|--------------|
| `min_limiter` | `min_dynamic` | MIN(limiter) –¥–ª—è ops + repair |
| `days_to_program_change` | `deterministic_dates[]` | –û–¥–∏–Ω MacroProperty —Å–æ –≤—Å–µ–º–∏ –¥–∞—Ç–∞–º–∏ |
| `days_to_exit_date` (repair/spawn/**unsvc**) | `deterministic_dates[]` | **V8: unsvc –ù–ï —É—á–∞—Å—Ç–≤—É–µ—Ç** |

### –õ–æ–≥–∏–∫–∞ reset-—Ñ—É–Ω–∫—Ü–∏–π (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –Ω–∞ —à–∞–≥–µ N –Ω–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ repair, —Ç–æ `atomicMin` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –≤ `min_exit_date_mp` –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å —à–∞–≥–∞ N-1.

**–†–µ—à–µ–Ω–∏–µ:** Reset –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–æ–º ‚Üí MAX –æ–∑–Ω–∞—á–∞–µ—Ç "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö".

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì N                                                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  –§–ê–ó–ê -1: –°–ë–†–û–° + –°–ë–û–† min_exit_date                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ [0] reset_exit_date    ‚Üí min_exit_date_mp = 0xFFFFFFFF (MAX)       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [1] copy_exit_repair   ‚Üí –∞–≥–µ–Ω—Ç—ã repair: atomicMin(exit_date)      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [2] copy_exit_spawn    ‚Üí –∞–≥–µ–Ω—Ç—ã reserve: atomicMin(exit_date)     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –†–µ–∑—É–ª—å—Ç–∞—Ç: min_exit_date_mp = MIN(–≤—Å–µ exit_date) –∏–ª–∏ MAX          ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –§–ê–ó–ê 4: –°–ë–û–† min_limiter                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ [26] min_limiter       ‚Üí –∞–≥–µ–Ω—Ç—ã ops: atomicMin(limiter)           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –†–µ–∑—É–ª—å—Ç–∞—Ç: mp_min_limiter = MIN(–≤—Å–µ limiter) –∏–ª–∏ MAX              ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –§–ê–ó–ê 5: –í–´–ß–ò–°–õ–ï–ù–ò–ï adaptive_days                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ [28] compute_global    ‚Üí –ß–ò–¢–ê–ï–¢: mp_min_limiter, min_exit_date_mp ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                        ‚Üí –ü–ò–®–ï–¢:  adaptive_days                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [29] reset_min_limiter ‚Üí mp_min_limiter = MAX (–¥–ª—è —à–∞–≥–∞ N+1)      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–º–µ—Ä –±–µ–∑ reset (–ë–ê–ì):**
```
–®–∞–≥ 10: –ê–≥–µ–Ω—Ç A –≤ repair, exit_date=150 ‚Üí min_exit_date_mp = 150
–®–∞–≥ 11: –ê–≥–µ–Ω—Ç A –≤—ã—à–µ–ª (4‚Üí3), –Ω–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ repair
        –ë–ï–ó RESET: min_exit_date_mp = 150 (—Å—Ç–∞—Ä–æ–µ!)
        ‚Üí adaptive_days –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ = 150 - current_day
```

**–ü—Ä–∏–º–µ—Ä —Å reset (–ö–û–†–†–ï–ö–¢–ù–û):**
```
–®–∞–≥ 10: –ê–≥–µ–Ω—Ç A –≤ repair, exit_date=150 ‚Üí min_exit_date_mp = 150
–®–∞–≥ 11: RESET ‚Üí min_exit_date_mp = MAX
        –ù–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ repair ‚Üí atomicMin –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
        min_exit_date_mp = MAX ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ compute_global_min
```

**MAX = "–∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ adaptive_days"**

---

## üìÅ –§–∞–π–ª—ã V7

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `orchestrator_limiter_v7.py` | –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä V7 |
| `rtc_state_transitions_v7.py` | RTC –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π |
| `rtc_quota_v7.py` | RTC –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `rtc_spawn_dynamic_v7.py` | **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∞–≤–Ω Mi-17** |
| `rtc_limiter_v5.py` | GPU-only –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —à–∞–≥–∏ |
| `rtc_limiter_optimized.py` | –ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫ limiter |
| `base_model_messaging.py` | –ú–æ–¥–µ–ª—å –∞–≥–µ–Ω—Ç–∞ |

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã V7

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –®–∞–≥–∏ | **192** |
| –í—Ä–µ–º—è GPU | **1.85—Å** |
| –°–∫–æ—Ä–æ—Å—Ç—å | **1976 –¥–Ω–µ–π/—Å–µ–∫** |
| GPU | 100% |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | Single-phase |
| RTC —Ñ—É–Ω–∫—Ü–∏–π | **29** (27 + 2 dynamic spawn) |

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (3650 –¥–Ω–µ–π, –¥–∞—Ç–∞—Å–µ—Ç 2025-07-04):**
| State | –ê–≥–µ–Ω—Ç–æ–≤ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-------|---------|------------|
| inactive | 94 | P3 –ø—Ä–æ–º–æ—É—Ç–∏—Ç –ø–æ –¥–µ—Ñ–∏—Ü–∏—Ç—É |
| operations | **173** | Target –ø–æ–∫—Ä—ã—Ç |
| serviceable | 0 | P1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω |
| repair | 0 | –í—Å–µ –≤—ã—à–ª–∏ –∏–∑ —Ä–µ–º–æ–Ω—Ç–∞ |
| reserve | 0 | Spawn –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω |
| storage | 35 | –î–æ—Å—Ç–∏–≥–ª–∏ LL/BR |
| unserviceable | 11 | –û–∂–∏–¥–∞—é—Ç repair_time |
| **–í–°–ï–ì–û** | **313** (279 + 34 dynamic spawn) |

**Program changes:**
- –í—Å–µ–≥–æ program_changes: **92** (–∑–∞ 10 –ª–µ—Ç)
- –ü–æ–ø–∞–¥–∞—é—Ç —Ç–æ—á–Ω–æ –≤ adaptive steps: **7** (–æ—Å—Ç–∞–ª—å–Ω—ã–µ "–ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞—é—Ç—Å—è" –±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏–º–∏ limiter/exit_date —Å–æ–±—ã—Ç–∏—è–º–∏)
- –≠—Ç–æ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** ‚Äî V7 –ø—Ä—ã–≥–∞–µ—Ç –∫ –±–ª–∏–∂–∞–π—à–µ–º—É —Å–æ–±—ã—Ç–∏—é

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∞–≤–Ω Mi-17:**
- –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–ª–µ–¥–∏—Ç –∑–∞ –¥–µ—Ñ–∏—Ü–∏—Ç–æ–º Mi-17 (target vs ops_count)
- –ü—Ä–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–µ –≤—ã–¥–∞—ë—Ç "—Ç–∏–∫–µ—Ç—ã" –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- –¢–∏–∫–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç –∞–≥–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ `agent_out` –Ω–∞–ø—Ä—è–º—É—é –≤ `operations`
- –†–µ–∑–µ—Ä–≤: 50 –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ—Ç–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ (14-01-2026):**
1. **Race condition –≤ `rtc_compute_global_min`** ‚Äî —Ç–æ–ª—å–∫–æ group_by=1 (Mi-8) –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
2. **`num_program_changes` –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `setPropertyUInt` –≤ except –±–ª–æ–∫
3. **`v7_reset_buffers` –¥–ª—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π** ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è 7 —Å–æ—Å—Ç–æ—è–Ω–∏–π (–Ω–µ —Ç–æ–ª—å–∫–æ operations)

---

## üîó –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/rtc_pipeline_architecture.md` ‚Äî Baseline –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (intent-based)
- `docs/validation.md` ‚Äî –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —Ç–µ—Å—Ç—ã
- `.cursorrules` ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞

---

## üöß V8: RepairAgent + –∞–¥—Ä–µ—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–í –†–ê–ó–†–ê–ë–û–¢–ö–ï)

> **–°—Ç–∞—Ç—É—Å:** –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
> **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/adaptive_steps_logic.md`  
> **–¶–µ–ª—å:** –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ + –∞–¥—Ä–µ—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è V8 vs V7

| –ê—Å–ø–µ–∫—Ç | V7 | V8 |
|--------|-----|-----|
| unsvc –≤ min_dynamic | ‚úÖ –î–∞ (exit_date) | ‚ùå –ù–µ—Ç |
| unsvc –¥–µ–∫—Ä–µ–º–µ–Ω—Ç | ‚úÖ repair_days | ‚ùå –ù–µ –¥–µ–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è |
| P2/P3 —É—Å–ª–æ–≤–∏–µ | `current_day >= exit_date` | `current_day >= repair_time AND capacity >= repair_time` |
| –ö–≤–æ—Ç–∞ —Ä–µ–º–æ–Ω—Ç–∞ | –ß–µ—Ä–µ–∑ exit_date –∫–∞–∂–¥–æ–≥–æ unsvc | –ß–µ—Ä–µ–∑ RepairAgent.capacity |

### RepairAgent ‚Äî –Ω–æ–≤—ã–π –∞–≥–µ–Ω—Ç

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–æ—Ç–æ–π —Ä–µ–º–æ–Ω—Ç–∞ —á–µ—Ä–µ–∑ —Å—á—ë—Ç—á–∏–∫ –∞–≥—Ä–µ–≥–∞—Ç–æ-–¥–Ω–µ–π

```
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
  capacity: UInt32    // –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç–æ-–¥–Ω–∏ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞
  repair_quota: UInt16 // –î–Ω–µ–≤–Ω–∞—è –∫–≤–æ—Ç–∞ (—Å–ª–æ—Ç—ã)

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–¥–µ–Ω—å 0):
  capacity = repair_quota - count(repair)

–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç (–∫–∞–∂–¥—ã–π —à–∞–≥):
  capacity += (repair_quota - count(repair))

–°–ø–∏—Å–∞–Ω–∏–µ (–ø–æ –∫–æ–º–∞–Ω–¥–µ QuotaManager):
  capacity -= approved * repair_time
```

### –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–æ–æ–±—â–µ–Ω–∏–π (–∞–¥—Ä–µ—Å–Ω—ã–µ, –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞)

```
–°–ª–æ–π 1: RepairAgent ‚Üí QuotaManager
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç { capacity, slots = floor(capacity / repair_time) }

–°–ª–æ–π 2: QuotaManager —Ä–µ—à–∞–µ—Ç
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç current_day >= repair_time
  - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–µ—Ñ–∏—Ü–∏—Ç, approved = MIN(–¥–µ—Ñ–∏—Ü–∏—Ç, slots)
  - P2: unsvc –ø–æ idx (–ø–µ—Ä–≤—ã–µ approved)
  - P3: inactive –ø–æ idx (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª—Å—è –¥–µ—Ñ–∏—Ü–∏—Ç)
  - P4: spawn (–µ—Å–ª–∏ P2/P3 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã)

–°–ª–æ–π 3: QuotaManager ‚Üí RepairAgent
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç { to_deduct = approved * repair_time }

–°–ª–æ–π 4: RepairAgent —Å–ø–∏—Å—ã–≤–∞–µ—Ç
  - capacity -= to_deduct
```

### –ú–æ—Ç–∏–≤–∞—Ü–∏—è (–∏–∑ V7)

V7 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª—å—à–∏–µ MacroProperty –±—É—Ñ–µ—Ä—ã `promote[MAX_AGENTS]` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ä–µ—à–µ–Ω–∏–π QM ‚Üí –∞–≥–µ–Ω—Ç—ã. V8 –∑–∞–º–µ–Ω—è–µ—Ç –∏—Ö –Ω–∞ –∞–¥—Ä–µ—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è `MessageBucket`.

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π FLAME GPU

| –¢–∏–ø | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ V8 |
|-----|-----------|------------|-------------------|
| **MessageNone** | O(1) | –ë–µ–∑ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ | –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ |
| **MessageBruteForce** | O(N¬≤) | –í—Å–µ ‚Üí –í—Å–µ | ‚ùå –ó–∞–ø—Ä–µ—â—ë–Ω |
| **MessageBucket** | O(N/K) | –ü–æ –∫–ª—é—á—É | ‚úÖ –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **MessageArray** | O(1) | –ü–æ –∏–Ω–¥–µ–∫—Å—É | –í–æ–∑–º–æ–∂–Ω–æ –¥–ª—è spawn |
| **MessageSpatial** | O(K) | –ü–æ —Ä–∞–¥–∏—É—Å—É | –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ V8

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–í–û–¢–ò–†–û–í–ê–ù–ò–ï V8 (MessageBucket)                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  –°–ª–æ–π 1: –°–ë–û–† (MacroProperty ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º)                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ count_agents  ‚Üí atomicAdd —Å—á—ë—Ç—á–∏–∫–∏ –ø–æ state/group                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ collect_idx   ‚Üí –∑–∞–ø–∏—Å—å idx –≤ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è threshold     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –°–ª–æ–π 2: –†–ï–®–ï–ù–ò–Ø QM ‚Üí MessageBucket                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ QM_mi8  ‚Üí MessageBucket[key=1] = {quotas, thresholds}              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ QM_mi17 ‚Üí MessageBucket[key=2] = {quotas, thresholds}              ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –°–ª–æ–π 3: –ü–†–ò–ú–ï–ù–ï–ù–ò–ï (–∞–≥–µ–Ω—Ç—ã —á–∏—Ç–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è)                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ –ê–≥–µ–Ω—Ç—ã —á–∏—Ç–∞—é—Ç MessageBucket[—Å–≤–æ–π group_by]                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ –ë–µ—Ä—É—Ç threshold –ø–æ —Å–≤–æ–µ–º—É state                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ if (my_idx >= threshold) ‚Üí promote                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ if (my_idx < demote_threshold) ‚Üí demote                            ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –°–ª–æ–π 4: –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô SPAWN (–æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ SpawnMgr ‚Üí MessageBucket[key=100+group] = {need, base_idx}         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ SpawnTickets —á–∏—Ç–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–æ–∑–¥–∞—é—Ç –∞–≥–µ–Ω—Ç–æ–≤                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–æ–æ–±—â–µ–Ω–∏—è V8

#### 1. –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (promote/demote)

```cpp
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
MessageBucket quota_msg;
quota_msg.setBounds(1, 2);  // –∫–ª—é—á–∏ 1=Mi-8, 2=Mi-17
quota_msg.newVariable<int>("quota_s3");      // serviceable
quota_msg.newVariable<int>("quota_s7");      // unserviceable
quota_msg.newVariable<int>("quota_s5");      // inactive
quota_msg.newVariable<uint>("threshold_s3"); // min idx –¥–ª—è promote –∏–∑ s3
quota_msg.newVariable<uint>("threshold_s7"); // min idx –¥–ª—è promote –∏–∑ s7
quota_msg.newVariable<uint>("threshold_s5"); // min idx –¥–ª—è promote –∏–∑ s5
quota_msg.newVariable<uint>("demote_threshold"); // max idx –¥–ª—è demote

// QM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç
FLAMEGPU->message_out.setKey(my_group_by);  // 1 –∏–ª–∏ 2
FLAMEGPU->message_out.setVariable<int>("quota_s3", quota_serviceable);
// ...

// –ê–≥–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç
for (auto &msg : FLAMEGPU->message_in(my_group_by)) {
    uint threshold = msg.getVariable<uint>("threshold_s3");
    if (my_state == 3 && my_idx >= threshold) {
        // Promote: serviceable ‚Üí operations
    }
}
```

#### 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π spawn (–æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)

```cpp
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
MessageBucket spawn_msg;
spawn_msg.setBounds(101, 102);  // –∫–ª—é—á–∏ 101=Mi-8 spawn, 102=Mi-17 spawn
spawn_msg.newVariable<int>("need");       // —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å
spawn_msg.newVariable<uint>("base_idx");  // –±–∞–∑–æ–≤—ã–π idx –¥–ª—è –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

// SpawnMgr –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç
FLAMEGPU->message_out.setKey(100 + my_group_by);
FLAMEGPU->message_out.setVariable<int>("need", deficit);
// ...

// SpawnTicket —á–∏—Ç–∞–µ—Ç
for (auto &msg : FLAMEGPU->message_in(100 + my_group_by)) {
    int need = msg.getVariable<int>("need");
    // –°–æ–∑–¥–∞—ë–º –∞–≥–µ–Ω—Ç–æ–≤
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ V8

| –ê—Å–ø–µ–∫—Ç | V7 (MacroProperty) | V8 (MessageBucket) |
|--------|-------------------|-------------------|
| –ë—É—Ñ–µ—Ä—ã promote[idx] | MAX_AGENTS √ó 4 –±–∞–π—Ç | –ù–µ –Ω—É–∂–Ω—ã |
| –ü–µ—Ä–µ–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∏–π | –ó–∞–ø–∏—Å—å –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å | –°–æ–æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏ |
| –ú–æ–¥–µ–ª—å | –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã | –ê–≥–µ–Ω—Ç–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ |
| –ê–¥—Ä–µ—Å–∞—Ü–∏—è | –ü–æ idx –≤ –±—É—Ñ–µ—Ä–µ | –ü–æ group_by –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ |

### –†–∏—Å–∫–∏ V8

1. **–û–¥–∏–Ω QM = –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ** ‚Äî QM –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –≤—ã–∑–æ–≤
2. **Threshold –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ** ‚Äî QM –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ idx –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –∫–∞–∫ —Å MacroProperty –≤ V7

### –§–∞–π–ª—ã V8 (–ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ)

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `orchestrator_limiter_v8.py` | –ö–æ–ø–∏—è v7 —Å MessageBucket |
| `rtc_quota_v8.py` | –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `rtc_spawn_v8.py` | Spawn —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `base_model_messaging_v8.py` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MessageBucket |

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç: **365 –¥–Ω–µ–π**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å V7: ops count, transitions, spawn

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω: 15-01-2026*  
*–°—Ç–∞—Ç—É—Å V7: ‚ö†Ô∏è –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏*  
*–°—Ç–∞—Ç—É—Å V8: üöß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ*  
*–¢–µ—Å—Ç V7: 3650 –¥–Ω–µ–π, 192 —à–∞–≥–∞, 1.85—Å GPU (1976 –¥/—Å), 313 –∞–≥–µ–Ω—Ç–æ–≤*

