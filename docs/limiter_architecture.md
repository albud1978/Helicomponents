# LIMITER Architecture (V7 â€” ĞĞ´Ğ½Ğ¾Ñ„Ğ°Ğ·Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)

> **ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ:** V7 (13-01-2026)  
> **Ğ¤Ğ°Ğ¹Ğ» Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°:** `code/sim_v2/messaging/orchestrator_limiter_v7.py`

---

## ğŸ“Š Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° RTC Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (27 Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ + Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¿Ğ°Ğ²Ğ½)

> **ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**
> - Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ `_stay` ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ â€” FLAME GPU Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸
> - `clear_limiter_on_exit` ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½ â€” Ğ¾Ğ±Ğ½ÑƒĞ»ĞµĞ½Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ² Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑÑ… 2â†’3, 2â†’6, 2â†’7
> - `limiter_on_entry` ÑƒĞ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ `limiter==0` (Ğ±ĞµĞ· intent)

| # | Ğ¡Ğ»Ğ¾Ğ¹ | Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ | State | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---|------|---------|-------|----------|
| **Ğ¤ĞĞ—Ğ -1: Ğ¡Ğ±Ğ¾Ñ€ min_exit_date (Ğ´ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ñ‚Ñ‹ Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚Ğ¾Ğ²/spawn)** |||||
| 0 | v7_reset_exit_date | `rtc_reset_exit_date_v7` | QM | `min_exit_date_mp = MAX` (ÑĞ±Ñ€Ğ¾Ñ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ±Ğ¾Ñ€Ğ¾Ğ¼) |
| 1 | v7_copy_exit_date_repair | `rtc_copy_exit_date_repair_v7` | 4 | `atomicMin(exit_date)` Ğ¾Ñ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² repair |
| 2 | v7_copy_exit_date_spawn | `rtc_copy_exit_date_spawn_v7` | 5 | `atomicMin(exit_date)` Ğ¾Ñ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² reserve |
| **Ğ¤ĞĞ—Ğ 0: Ğ”ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹** |||||
| 3 | v7_repair_to_svc | `rtc_repair_to_svc_v7` | 4â†’3 | Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚Ğ° Ğ¿Ñ€Ğ¸ `current_day >= exit_date`, PPR=0 |
| 4 | v7_spawn_to_ops | `rtc_spawn_to_ops_v7` | 5â†’2 | Spawn Ğ¿Ñ€Ğ¸ `current_day >= exit_date` |
| **Ğ¤ĞĞ—Ğ 1: Operations â€” Ğ¸Ğ½ĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹ Ğ¿Ğ¾ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼** |||||
| 5 | v7_ops_increment | `rtc_ops_increment_v7` | 2â†’2 | `sne += dt`, `ppr += dt`, `limiter -= adaptive` (3 ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ° Ğ² 1 Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´) |
| 6 | v7_ops_to_storage | `rtc_ops_to_storage_v7` | 2â†’6 | ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ ĞµÑĞ»Ğ¸ `SNE >= LL` Ğ¸Ğ»Ğ¸ `SNE >= BR`, `limiter=0` |
| 7 | v7_ops_to_unsvc | `rtc_ops_to_unsvc_v7` | 2â†’7 | ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ ĞµÑĞ»Ğ¸ `PPR >= OH`, `limiter=0` (PPR ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ) |
| **Ğ¤ĞĞ—Ğ 2: ĞšĞ²Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** |||||
| 8 | v7_reset_flags | `rtc_reset_flags_v7` | all | Ğ¡Ğ±Ñ€Ğ¾Ñ `promoted=0`, `needs_demote=0` |
| 9 | v7_reset_buffers | `rtc_reset_buffers_v7` | **all** | ĞĞ±Ğ½ÑƒĞ»ĞµĞ½Ğ¸Ğµ Ğ±ÑƒÑ„ĞµÑ€Ğ¾Ğ² Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚Ğ° (**7 ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹**, bugfix!) |
| 10 | v7_count_agents | `rtc_count_agents_v7` | all | ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ÑĞ¼ |
| 11 | v7_demote | `rtc_demote_v7` | QM | Ğ”ĞµĞ¼Ğ¾ÑƒÑ‚: opsâ†’svc (Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ±Ñ‹Ñ‚ĞºĞµ) |
| 12 | v7_promote_p1 | `rtc_promote_p1_v7` | QM | P1: svcâ†’ops (Ğ¿Ñ€Ğ¸ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ) |
| 13 | v7_promote_p2 | `rtc_promote_p2_v7` | QM | P2: unsvcâ†’ops |
| 14 | v7_promote_p3 | `rtc_promote_p3_v7` | QM | P3: inaâ†’ops |
| **Ğ¤ĞĞ—Ğ 3: ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ĞºĞ²Ğ¾Ñ‚** |||||
| 15 | v7_apply_demote | `rtc_apply_demote_v7` | 2â†’3 | ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ´ĞµĞ¼Ğ¾ÑƒÑ‚Ğ°, `limiter=0` |
| 16 | v7_apply_promote_p1 | `rtc_apply_promote_p1_v7` | 3â†’2 | ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ P1 |
| 17 | v7_apply_promote_p2 | `rtc_apply_promote_p2_v7` | 7â†’2 | ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ P2, `PPR=0` |
| 18 | v7_apply_promote_p3 | `rtc_apply_promote_p3_v7` | 1â†’2 | ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ P3 |
| **Ğ¤ĞĞ—Ğ 4: Ğ¡Ğ±Ğ¾Ñ€ min_limiter (Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ñ‹ Ğ¿Ğ¾ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼)** |||||
| 19 | limiter_on_entry | `rtc_compute_limiter_on_entry` | 2 | Ğ‘Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº `limiter` Ğ´Ğ»Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ñ `limiter==0` |
| 20 | min_limiter | `rtc_compute_min_limiter` | 2 | `atomicMin(limiter)` â†’ `mp_min_limiter` |
| **Ğ¤ĞĞ—Ğ 5: Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ adaptive_days Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğº ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼Ñƒ ÑˆĞ°Ğ³Ñƒ** |||||
| 21 | copy_limiter_v5 | `rtc_copy_limiter_v5` | 2 | ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ limiter Ğ² Ğ±ÑƒÑ„ĞµÑ€ |
| 22 | compute_global_min | `rtc_compute_global_min_v5` | QM | **Ğ§Ğ˜Ğ¢ĞĞ•Ğ¢** Ğ²ÑĞµ min â†’ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ `adaptive_days` |
| 23 | reset_min | `rtc_reset_min_limiter_v5` | QM | `mp_min_limiter = MAX` (Ğ´Ğ»Ñ ÑĞ»ĞµĞ´. ÑˆĞ°Ğ³Ğ°) |
| 24 | clear_limiter_v5 | `rtc_clear_limiter_v5` | non-ops | ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ±ÑƒÑ„ĞµÑ€Ğ° Ğ´Ğ»Ñ Ğ½Ğµ-ops Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² |
| 25 | save_adaptive | `rtc_save_adaptive_v5` | HELI | Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ `adaptive_days` Ğ² Ğ°Ğ³ĞµĞ½Ñ‚Ğ° |
| 26 | save_adaptive_qm | `rtc_save_adaptive_v5_qm` | QM | Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ `adaptive_days` Ğ² QM |
| 27 | update_day | `rtc_update_day_v5` | QM | `current_day += adaptive_days` |
| **Ğ¤ĞĞ—Ğ 6: Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¿Ğ°Ğ²Ğ½** |||||
| 28 | v7_spawn_dynamic_mgr | `rtc_spawn_dynamic_mgr` | SpawnMgr | Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°, ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° need/base_idx |
| 29 | v7_spawn_dynamic_ticket | `rtc_spawn_dynamic_ticket` | Ticketâ†’ops | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² (agent_out) |

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ V7

### ĞĞ´Ğ½Ğ¾Ñ„Ğ°Ğ·Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (Single-Phase)

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾Ñ‚ baseline:** ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ **Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ** Ñ‡ĞµÑ€ĞµĞ· `setInitialState/setEndState` Ñ `FunctionCondition`, Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ `intent_state`.

```cpp
// V7: ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ñ FunctionCondition
FLAMEGPU_AGENT_FUNCTION_CONDITION(cond_ops_to_unsvc_v7) {
    const unsigned int ppr = FLAMEGPU->getVariable<unsigned int>("ppr");
    const unsigned int oh = FLAMEGPU->getVariable<unsigned int>("oh");
    return ppr >= oh;  // Condition: PPR >= OH
}

FLAMEGPU_AGENT_FUNCTION(rtc_ops_to_unsvc_v7, ...) {
    FLAMEGPU->setVariable<unsigned int>("ppr", 0u);  // PPR Ğ¾Ğ±Ğ½ÑƒĞ»ÑĞµÑ‚ÑÑ
    return flamegpu::ALIVE;
}
// Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ: fn.setInitialState("operations"); fn.setEndState("unserviceable");
```

### Ğ”ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹

ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ² `repair` (4) Ğ¸ `reserve` (5) Ğ¸Ğ¼ĞµÑÑ‚ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ `exit_date` â€” Ğ´ĞµĞ½ÑŒ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ¸Ğ· ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ:

- **repair â†’ serviceable (4â†’3):** ĞŸÑ€Ğ¸ `current_day >= exit_date`
- **reserve â†’ operations (5â†’2):** ĞŸÑ€Ğ¸ `current_day >= exit_date` (Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ñ‹Ğ¹ spawn)

`exit_date` Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ² Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ `adaptive_days` Ñ‡ĞµÑ€ĞµĞ· `min_exit_date_mp`.

### Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ V7

| ID | State | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----|-------|----------|
| 1 | inactive | ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ (Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚Ğ°Ñ†Ğ¸Ğ¸) |
| 2 | operations | Ğ’ ÑĞºÑĞ¿Ğ»ÑƒĞ°Ñ‚Ğ°Ñ†Ğ¸Ğ¸ |
| 3 | serviceable | Ğ˜ÑĞ¿Ñ€Ğ°Ğ²ĞµĞ½, Ğ½Ğ° ÑĞºĞ»Ğ°Ğ´Ğµ |
| 4 | repair | Ğ’ Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚Ğµ |
| 5 | reserve | Ğ ĞµĞ·ĞµÑ€Ğ² / Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ñ‹Ğ¹ spawn |
| 6 | storage | Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ (ÑĞ¿Ğ¸ÑĞ°Ğ½) |
| 7 | unserviceable | ĞĞµĞ¸ÑĞ¿Ñ€Ğ°Ğ²ĞµĞ½ (PPR >= OH, Ğ¶Ğ´Ñ‘Ñ‚ Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚Ğ°) |

### ĞšĞ²Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ÑƒÑ‚Ğ°:**
1. **P1:** serviceable â†’ operations (ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹)
2. **P2:** unserviceable â†’ operations (+ PPR=0)
3. **P3:** inactive â†’ operations (ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹)

**Ğ”ĞµĞ¼Ğ¾ÑƒÑ‚:** operations â†’ serviceable (Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ±Ñ‹Ñ‚ĞºĞµ)

### ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑˆĞ°Ğ³Ğ¸

```
adaptive_days = min(min_limiter, days_to_program_change, days_to_exit_date)
```

| Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº | ĞÑ‚ĞºÑƒĞ´Ğ° | Ğ§Ñ‚Ğ¾ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ |
|----------|--------|--------------|
| `min_limiter` | `mp_min_limiter[0]` | Ğ‘Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ñ€ĞµÑÑƒÑ€ÑĞ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° (LL/OH/BR) |
| `days_to_program_change` | `program_changes_mp[]` | Ğ”Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğ¾Ğ² |
| `days_to_exit_date` | `min_exit_date_mp[0]` | Ğ”Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞµĞ³Ğ¾ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ¸Ğ· Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚Ğ°/spawn |

### Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° reset-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸)

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ•ÑĞ»Ğ¸ Ğ½Ğ° ÑˆĞ°Ğ³Ğµ N Ğ½ĞµÑ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² repair, Ñ‚Ğ¾ `atomicMin` Ğ½Ğµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸ Ğ² `min_exit_date_mp` Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ñ ÑˆĞ°Ğ³Ğ° N-1.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Reset Ğ¿ĞµÑ€ĞµĞ´ ÑĞ±Ğ¾Ñ€Ğ¾Ğ¼ â†’ MAX Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ "Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…".

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ¨ĞĞ“ N                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Ğ¤ĞĞ—Ğ -1: Ğ¡Ğ‘Ğ ĞĞ¡ + Ğ¡Ğ‘ĞĞ  min_exit_date                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [0] reset_exit_date    â†’ min_exit_date_mp = 0xFFFFFFFF (MAX)       â”‚ â”‚
â”‚  â”‚ [1] copy_exit_repair   â†’ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ repair: atomicMin(exit_date)      â”‚ â”‚
â”‚  â”‚ [2] copy_exit_spawn    â†’ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ reserve: atomicMin(exit_date)     â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: min_exit_date_mp = MIN(Ğ²ÑĞµ exit_date) Ğ¸Ğ»Ğ¸ MAX          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  Ğ¤ĞĞ—Ğ 4: Ğ¡Ğ‘ĞĞ  min_limiter                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [26] min_limiter       â†’ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ ops: atomicMin(limiter)           â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: mp_min_limiter = MIN(Ğ²ÑĞµ limiter) Ğ¸Ğ»Ğ¸ MAX              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  Ğ¤ĞĞ—Ğ 5: Ğ’Ğ«Ğ§Ğ˜Ğ¡Ğ›Ğ•ĞĞ˜Ğ• adaptive_days                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [28] compute_global    â†’ Ğ§Ğ˜Ğ¢ĞĞ•Ğ¢: mp_min_limiter, min_exit_date_mp â”‚ â”‚
â”‚  â”‚                        â†’ ĞŸĞ˜Ğ¨Ğ•Ğ¢:  adaptive_days                    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ [29] reset_min_limiter â†’ mp_min_limiter = MAX (Ğ´Ğ»Ñ ÑˆĞ°Ğ³Ğ° N+1)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ±ĞµĞ· reset (Ğ‘ĞĞ“):**
```
Ğ¨Ğ°Ğ³ 10: ĞĞ³ĞµĞ½Ñ‚ A Ğ² repair, exit_date=150 â†’ min_exit_date_mp = 150
Ğ¨Ğ°Ğ³ 11: ĞĞ³ĞµĞ½Ñ‚ A Ğ²Ñ‹ÑˆĞµĞ» (4â†’3), Ğ½ĞµÑ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² repair
        Ğ‘Ğ•Ğ— RESET: min_exit_date_mp = 150 (ÑÑ‚Ğ°Ñ€Ğ¾Ğµ!)
        â†’ adaptive_days Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ = 150 - current_day
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ reset (ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ):**
```
Ğ¨Ğ°Ğ³ 10: ĞĞ³ĞµĞ½Ñ‚ A Ğ² repair, exit_date=150 â†’ min_exit_date_mp = 150
Ğ¨Ğ°Ğ³ 11: RESET â†’ min_exit_date_mp = MAX
        ĞĞµÑ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² repair â†’ atomicMin Ğ½Ğµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ
        min_exit_date_mp = MAX â†’ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² compute_global_min
```

**MAX = "Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ½Ğµ Ğ²Ğ»Ğ¸ÑĞµÑ‚ Ğ½Ğ° adaptive_days"**

---

## ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ V7

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| `orchestrator_limiter_v7.py` | Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ V7 |
| `rtc_state_transitions_v7.py` | RTC Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹ |
| `rtc_quota_v7.py` | RTC ĞºĞ²Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ |
| `rtc_spawn_dynamic_v7.py` | **Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¿Ğ°Ğ²Ğ½ Mi-17** |
| `rtc_limiter_v5.py` | GPU-only Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑˆĞ°Ğ³Ğ¸ |
| `rtc_limiter_optimized.py` | Ğ‘Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº limiter |
| `base_model_messaging.py` | ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ°Ğ³ĞµĞ½Ñ‚Ğ° |

---

## ğŸ“ˆ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ V7

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|---------|----------|
| Ğ¨Ğ°Ğ³Ğ¸ | 255 |
| Ğ’Ñ€ĞµĞ¼Ñ GPU | **1.85Ñ** |
| Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ | **1972 Ğ´Ğ½ĞµĞ¹/ÑĞµĞº** |
| GPU | 100% |
| ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° | Single-phase |
| RTC Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ | **29** (27 + 2 dynamic spawn) |

**Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° (3650 Ğ´Ğ½ĞµĞ¹, Ñ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ ÑĞ¿Ğ°Ğ²Ğ½Ğ¾Ğ¼, bugfix 13-01-2026):**
| State | ĞĞ³ĞµĞ½Ñ‚Ğ¾Ğ² | ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ |
|-------|---------|------------|
| inactive | 89 | P3 Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ÑƒÑ‚Ğ¸Ñ‚ Ğ¿Ğ¾ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ñƒ |
| operations | **175** | Target=174 (+1 Ğ·Ğ°Ğ¿Ğ°Ñ) |
| serviceable | 0 | P1 Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½ |
| repair | 0 | Ğ’ÑĞµ Ğ²Ñ‹ÑˆĞ»Ğ¸ Ğ¸Ğ· Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚Ğ° |
| reserve | 0 | Spawn Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |
| storage | 63 | Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ»Ğ¸ LL |
| unserviceable | 3 | P2 Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ |
| **Ğ’Ğ¡Ğ•Ğ“Ğ** | **330** (285 + 45 dynamic spawn) |

**Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¿Ğ°Ğ²Ğ½ Mi-17:**
- ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑĞ»ĞµĞ´Ğ¸Ñ‚ Ğ·Ğ° Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ¾Ğ¼ Mi-17 (target vs ops_count)
- ĞŸÑ€Ğ¸ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ Ğ²Ñ‹Ğ´Ğ°Ñ‘Ñ‚ "Ñ‚Ğ¸ĞºĞµÑ‚Ñ‹" Ğ½Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²
- Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· `agent_out` Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ² `operations`
- Ğ ĞµĞ·ĞµÑ€Ğ²: 50 Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑĞ»Ğ¾Ñ‚Ğ¾Ğ²
- **BUGFIX:** `curr_ops` Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ ÑƒĞ¶Ğµ Ğ·Ğ°ÑĞ¿Ğ°Ğ²Ğ½ĞµĞ½Ğ½Ñ‹Ñ… Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²

**ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ±Ğ°Ğ³Ñ„Ğ¸ĞºÑ (13-01-2026):**
- `v7_reset_buffers` Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ `operations` â†’ ĞµÑĞ»Ğ¸ `idx=0` Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸, Ğ±ÑƒÑ„ĞµÑ€Ñ‹ Ğ½Ğµ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°Ğ»Ğ¸ÑÑŒ
- Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ **Ğ²ÑĞµÑ… 7 ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹**

**Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ:**
| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | V7 (bugfix) | V7 (Ğ´Ğ¾ bugfix) | V5 |
|---------|-------------|----------------|-----|
| Ğ¨Ğ°Ğ³Ğ¸ | 255 | 255 | 332 |
| Ğ’Ñ€ĞµĞ¼Ñ GPU | 1.87Ñ | 1.85Ñ | 3.71Ñ |
| Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ | **1948 Ğ´/Ñ** | 1972 Ğ´/Ñ | 984 Ğ´/Ñ |
| operations | **175** | 180 | ~154 |
| Dynamic spawn | **45** (Ğ·Ğ° 10 Ğ»ĞµÑ‚) | 50 (Ğ·Ğ° 61 Ğ´ĞµĞ½ÑŒ) | - |
| Ğ’ÑĞµĞ³Ğ¾ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² | **330** | 335 | 285 |
| Mi-17 Î” Ğ¾Ñ‚ target | **+1** | +6 | - |

---

## ğŸ”— Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

- `docs/rtc_pipeline_architecture.md` â€” Baseline Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (intent-based)
- `docs/validation.md` â€” Ğ˜Ğ½Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ Ğ¸ Ñ‚ĞµÑÑ‚Ñ‹
- `.cursorrules` â€” ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

---

*Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½: 13-01-2026*  
*Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: âœ… ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (ĞºĞ²Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ + Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¿Ğ°Ğ²Ğ½)*  
*Ğ¢ĞµÑÑ‚: 3650 Ğ´Ğ½ĞµĞ¹, 255 ÑˆĞ°Ğ³Ğ¾Ğ², 1.87Ñ GPU (1948 Ğ´/Ñ), 330 Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² (285 + 45 spawn)*  
*Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ: Mi-8=47/47, Mi-17=128/127 â€” Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ñ‹*

