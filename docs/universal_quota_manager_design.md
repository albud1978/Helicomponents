# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–≤–æ—Ç (Universal Quota Manager)

**–î–∞—Ç–∞:** 02-10-2025  
**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  
**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–æ–¥—É–ª—å –¥–ª—è –ª—é–±—ã—Ö –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–π –≤ –º–æ–¥–µ–ª–∏

---

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞
```python
# –°–µ–π—á–∞—Å: –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª—É—á–∞—è
quota_ops_excess.py      # –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ operations (2‚Üí3 –¥–µ–º–æ—É—Ç)
quota_promote_s3.py      # –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ serviceable (3‚Üí2 –ø—Ä–æ–º–æ—É—Ç)
quota_promote_s5.py      # –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ reserve (5‚Üí2 –ø—Ä–æ–º–æ—É—Ç)
quota_promote_s1.py      # –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ inactive (1‚Üí2 –ø—Ä–æ–º–æ—É—Ç)

# –ó–∞–≤—Ç—Ä–∞: –Ω—É–∂–Ω–æ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–∞
quota_repair_limit.py    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤ repair
```

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
```python
# –û–¥–∏–Ω –º–æ–¥—É–ª—å –¥–ª—è –í–°–ï–• —Å–ª—É—á–∞–µ–≤ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
QuotaManager(
    target_state="operations",
    limit_source="mp4_ops_counter_mi8",
    demount_to="serviceable",
    promote_from=["serviceable", "reserve", "inactive"],
    priority_field="mp3_mfg_date_days",
    priority_order="oldest_first"
)

QuotaManager(
    target_state="repair",
    limit_value=50,  # –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤–º–µ—Å—Ç–æ –º–∞—Å—Å–∏–≤–∞
    demount_to="serviceable",
    promote_from=[],  # –ù–µ—Ç –ø—Ä–æ–º–æ—É—Ç–∞ –≤ —Ä–µ–º–æ–Ω—Ç
    priority_field="repair_urgency",
    priority_order="highest_first"
)
```

---

## üìã API —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–≤–æ—Ç

### –ö–ª–∞—Å—Å QuotaManager

```python
class QuotaManager:
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
    
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
    - –î–µ–º–æ—É—Ç (—Å–Ω–∏–∂–µ–Ω–∏–µ): —Ü–µ–ª–µ–≤–æ–π state ‚Üí –¥–µ–º–æ—É—Ç state
    - –ü—Ä–æ–º–æ—É—Ç (–ø–æ–≤—ã—à–µ–Ω–∏–µ): –∏—Å—Ç–æ—á–Ω–∏–∫–∏ ‚Üí —Ü–µ–ª–µ–≤–æ–π state
    - –õ—é–±—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏
    - –ù–µ—Å–∫–æ–ª—å–∫–æ group_by (Mi-8, Mi-17)
    """
    
    def __init__(self,
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 # –û–°–ù–û–í–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 target_state: str,           # –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                 
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 # –ü–ê–†–ê–ú–ï–¢–†–´ –õ–ò–ú–ò–¢–ê
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 limit_source: str = None,    # –ò–º—è PropertyArray —Å –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ –¥–Ω—è–º
                                              # –ù–∞–ø—Ä–∏–º–µ—Ä: "mp4_ops_counter_mi8"
                 limit_value: int = None,     # –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π –ª–∏–º–∏—Ç (–µ—Å–ª–∏ –Ω–µ –º–∞—Å—Å–∏–≤)
                 limit_per_group: bool = True,# –õ–∏–º–∏—Ç —Ä–∞–∑–¥–µ–ª—å–Ω–æ –¥–ª—è Mi-8 –∏ Mi-17
                 
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 # –ü–ê–†–ê–ú–ï–¢–†–´ –î–ï–ú–û–£–¢–ê (–°–ù–ò–ñ–ï–ù–ò–ï)
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 demount_enabled: bool = True,      # –†–∞–∑—Ä–µ—à—ë–Ω –ª–∏ –¥–µ–º–æ—É—Ç
                 demount_to_state: str = None,      # –ö—É–¥–∞ –¥–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å (serviceable)
                 demount_priority_field: str = None,# –ü–æ–ª–µ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏
                 demount_priority_order: str = "oldest_first",  # oldest_first | newest_first | lowest_first | highest_first
                 
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 # –ü–ê–†–ê–ú–ï–¢–†–´ –ü–†–û–ú–û–£–¢–ê (–ü–û–í–´–®–ï–ù–ò–ï)
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 promote_enabled: bool = True,           # –†–∞–∑—Ä–µ—à—ë–Ω –ª–∏ –ø—Ä–æ–º–æ—É—Ç
                 promote_from_states: List[str] = None,  # –û—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É)
                                                         # –ù–∞–ø—Ä–∏–º–µ—Ä: ["serviceable", "reserve", "inactive"]
                 promote_priority_field: str = None,     # –ü–æ–ª–µ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                 promote_priority_order: str = "fcfs",   # fcfs | oldest_first | newest_first
                 promote_conditions: Dict[str, str] = None,  # –£—Å–ª–æ–≤–∏—è –¥–ª—è –ø—Ä–æ–º–æ—É—Ç–∞ –∏–∑ –∫–∞–∂–¥–æ–≥–æ state
                                                            # {"inactive": "day > repair_time + version_date"}
                 
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 # –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´
                 # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 mask_name_prefix: str = "quota_mask",   # –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è MacroProperty –º–∞—Å–æ–∫
                 enable_logging: bool = False             # –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
    ):
        self.target_state = target_state
        self.limit_source = limit_source
        self.limit_value = limit_value
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

### –§–∞–∑—ã –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (3 —Å–ª–æ—è)

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –°–õ–û–ô 1: CLEAR MASKS                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
–û—á–∏—Å—Ç–∫–∞ –º–∞—Å–æ–∫ –¥–ª—è –≤—Å–µ—Ö group_by

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –°–õ–û–ô 2: MARK & DECIDE                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
‚îú‚îÄ> –ê–≥–µ–Ω—Ç—ã –≤ target_state –ø–æ–º–µ—á–∞—é—Ç —Å–µ–±—è
‚îú‚îÄ> –ü–æ–¥—Å—á—ë—Ç Curr –∏ Target
‚îú‚îÄ> –†–µ—à–µ–Ω–∏–µ: –î–µ–º–æ—É—Ç –∏–ª–∏ –ü—Ä–æ–º–æ—É—Ç
‚îî‚îÄ> –£—Å—Ç–∞–Ω–æ–≤–∫–∞ intent

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –°–õ–û–ô 3: APPLY (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ transitions)   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
State transitions –ø—Ä–∏–º–µ–Ω—è—é—Ç intent
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### –ü—Ä–∏–º–µ—Ä 1: –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ operations (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

```python
operations_quota = QuotaManager(
    # –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    target_state="operations",
    
    # –õ–∏–º–∏—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞ MP4
    limit_source="mp4_ops_counter",  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ _mi8 –∏ _mi17
    limit_per_group=True,
    
    # –î–µ–º–æ—É—Ç: operations ‚Üí serviceable
    demount_enabled=True,
    demount_to_state="serviceable",
    demount_priority_field="mp3_mfg_date_days",  # –ü–æ –≤–æ–∑—Ä–∞—Å—Ç—É
    demount_priority_order="oldest_first",       # –°–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ
    
    # –ü—Ä–æ–º–æ—É—Ç: serviceable ‚Üí reserve ‚Üí inactive ‚Üí operations
    promote_enabled=True,
    promote_from_states=["serviceable", "reserve", "inactive"],
    promote_priority_field=None,  # FCFS –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
    promote_priority_order="fcfs",
    promote_conditions={
        "inactive": "(day - repair_time) > version_date"  # –£—Å–ª–æ–≤–∏–µ –¥–ª—è inactive
    },
    
    # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
    mask_name_prefix="quota_ops",
    enable_logging=True
)

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 3 —Å–ª–æ—è:
# 1. quota_ops_clear
# 2. quota_ops_mark_decide
# 3. (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ state_transitions)
```

---

### –ü—Ä–∏–º–µ—Ä 2: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞ (–Ω–æ–≤—ã–π –∫–µ–π—Å)

```python
repair_quota = QuotaManager(
    # –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    target_state="repair",
    
    # –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π –ª–∏–º–∏—Ç (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–Ω—è)
    limit_value=50,  # –ú–∞–∫—Å–∏–º—É–º 50 –±–æ—Ä—Ç–æ–≤ –≤ —Ä–µ–º–æ–Ω—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    limit_per_group=True,  # –û—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è Mi-8 –∏ Mi-17
    
    # –î–µ–º–æ—É—Ç: repair ‚Üí serviceable (–µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç)
    demount_enabled=True,
    demount_to_state="serviceable",
    demount_priority_field="repair_days",      # –ü–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É —Ä–µ–º–æ–Ω—Ç–∞
    demount_priority_order="highest_first",    # –°–∞–º—ã–µ –±–ª–∏–∑–∫–∏–µ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é
    
    # –ü—Ä–æ–º–æ—É—Ç: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–≤ —Ä–µ–º–æ–Ω—Ç –Ω–µ –ø—Ä–æ–º–æ—É—Ç–∏–º)
    promote_enabled=False,
    
    # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
    mask_name_prefix="quota_repair",
    enable_logging=True
)

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 3 —Å–ª–æ—è:
# 1. quota_repair_clear
# 2. quota_repair_mark_decide
# 3. (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ state_transitions)
```

---

### –ü—Ä–∏–º–µ—Ä 3: –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞

```python
reserve_quota = QuotaManager(
    # –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    target_state="reserve",
    
    # –õ–∏–º–∏—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∏–ª–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞
    limit_source="mp4_reserve_counter",  # –ï—Å–ª–∏ –µ—Å—Ç—å –≤ MP4
    limit_value=30,  # –ò–ª–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞
    
    # –î–µ–º–æ—É—Ç: reserve ‚Üí inactive (–µ—Å–ª–∏ –∏–∑–±—ã—Ç–æ–∫)
    demount_enabled=True,
    demount_to_state="inactive",
    demount_priority_field="ppr",           # –ü–æ –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω–æ–π –Ω–∞—Ä–∞–±–æ—Ç–∫–µ
    demount_priority_order="lowest_first",  # –° –Ω–∞–∏–º–µ–Ω—å—à–µ–π –Ω–∞—Ä–∞–±–æ—Ç–∫–æ–π
    
    # –ü—Ä–æ–º–æ—É—Ç: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–≤ —Ä–µ–∑–µ—Ä–≤ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∏–∑ —Ä–µ–º–æ–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    promote_enabled=False,
    
    mask_name_prefix="quota_reserve"
)
```

---

## üîß –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

### –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```python
def register_rtc(self, model: fg.ModelDescription, agent: fg.AgentDescription):
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç RTC —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –°–õ–û–ô 1: –û–ß–ò–°–¢–ö–ê –ú–ê–°–û–ö
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    clear_code = self._generate_clear_code()
    layer_clear = model.newLayer(f"{self.mask_name_prefix}_clear")
    rtc_clear = agent.newRTCFunction(f"rtc_{self.mask_name_prefix}_clear", clear_code)
    layer_clear.addAgentFunction(rtc_clear)
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –°–õ–û–ô 2: MARK & DECIDE
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    decide_code = self._generate_decide_code()
    layer_decide = model.newLayer(f"{self.mask_name_prefix}_decide")
    rtc_decide = agent.newRTCFunction(f"rtc_{self.mask_name_prefix}_decide", decide_code)
    rtc_decide.setInitialState(self.target_state)
    rtc_decide.setEndState(self.target_state)
    layer_decide.addAgentFunction(rtc_decide)
```

---

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RTC –∫–æ–¥–∞

```python
def _generate_decide_code(self) -> str:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç RTC –∫–æ–¥ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π"""
    
    code = f"""
FLAMEGPU_AGENT_FUNCTION(rtc_{self.mask_name_prefix}_decide, ...) {{
    const unsigned int idx = FLAMEGPU->getVariable<unsigned int>("idx");
    const unsigned int group_by = FLAMEGPU->getVariable<unsigned int>("group_by");
    const unsigned int day = FLAMEGPU->getStepCounter();
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 1: –ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    unsigned int target = {self._get_limit_code()};
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 2: –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ç–µ–∫—É—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    unsigned int curr = {self._count_current_code()};
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 3: –î–µ–º–æ—É—Ç –µ—Å–ª–∏ –∏–∑–±—ã—Ç–æ–∫
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    if (curr > target) {{
        {self._generate_demount_logic()}
    }}
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 4: –ü—Ä–æ–º–æ—É—Ç –µ—Å–ª–∏ –¥–µ—Ñ–∏—Ü–∏—Ç
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    else if (curr < target) {{
        {self._generate_promote_logic()}
    }}
    
    return flamegpu::ALIVE;
}}
"""
    return code
```

---

## üé® –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏

### –†–µ–∞–ª–∏–∑—É–µ–º—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```python
class PriorityStrategy:
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏"""
    
    OLDEST_FIRST = "oldest_first"        # –ü–æ mfg_date: –º–µ–Ω—å—à–µ = —Å—Ç–∞—Ä—à–µ
    NEWEST_FIRST = "newest_first"        # –ü–æ mfg_date: –±–æ–ª—å—à–µ = –Ω–æ–≤–µ–µ
    LOWEST_FIRST = "lowest_first"        # –ü–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º—É –ø–æ–ª—é: min
    HIGHEST_FIRST = "highest_first"      # –ü–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º—É –ø–æ–ª—é: max
    FCFS = "fcfs"                        # First Come First Serve (–ø–æ idx)
    RANDOM = "random"                    # –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä (–Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω)
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏

```cpp
// –ü—Ä–∏–º–µ—Ä: OLDEST_FIRST –ø–æ mfg_date
unsigned int rank = 0u;
const unsigned int my_priority = FLAMEGPU->environment.getProperty<unsigned int>("{priority_field}", idx);

for (unsigned int i = 0u; i < frames; ++i) {{
    if (i == idx || mask[i] != 1u) continue;
    
    const unsigned int other_priority = FLAMEGPU->environment.getProperty<unsigned int>("{priority_field}", i);
    
    // OLDEST_FIRST: –º–µ–Ω—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    if (other_priority < my_priority || (other_priority == my_priority && i < idx)) {{
        ++rank;
    }}
}}

// –ï—Å–ª–∏ rank < K ‚Üí –≤—ã–±—Ä–∞–Ω
if (rank < K) {{
    FLAMEGPU->setVariable<unsigned int>("intent_state", {demount_target_state_id}u);
}}
```

---

## üîÑ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–ª—É—á–∞–π 1: –¢–µ–∫—É—â–µ–µ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ operations

```python
# –í orchestrator_v2.py:
from rtc_modules.quota_manager import QuotaManager

# –°–æ–∑–¥–∞—ë–º –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è operations
ops_quota = QuotaManager(
    target_state="operations",
    limit_source="mp4_ops_counter",  # –ú–∞—Å—Å–∏–≤ –ø–æ –¥–Ω—è–º
    limit_per_group=True,
    
    # –î–µ–º–æ—É—Ç
    demount_to_state="serviceable",
    demount_priority_field="mp3_mfg_date_days",
    demount_priority_order="oldest_first",
    
    # –ü—Ä–æ–º–æ—É—Ç (3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)
    promote_from_states=["serviceable", "reserve", "inactive"],
    promote_priority_order="fcfs",
    promote_conditions={
        "inactive": "(day - repair_time) > version_date"
    }
)

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤ –º–æ–¥–µ–ª–∏
ops_quota.register(model, agent)

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª–æ–∏:
# - quota_ops_clear
# - quota_ops_decide
```

---

### –°–ª—É—á–∞–π 2: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞ (–Ω–æ–≤—ã–π)

```python
# –ù–æ–≤—ã–π –∫–µ–π—Å: –Ω–µ –±–æ–ª—å—à–µ 50 –±–æ—Ä—Ç–æ–≤ –≤ —Ä–µ–º–æ–Ω—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

repair_quota = QuotaManager(
    target_state="repair",
    limit_value=50,  # –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞
    limit_per_group=True,  # 50 –¥–ª—è Mi-8 + 50 –¥–ª—è Mi-17
    
    # –î–µ–º–æ—É—Ç –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
    demount_to_state="serviceable",
    demount_priority_field="repair_days",
    demount_priority_order="highest_first",  # –ö—Ç–æ –±–ª–∏–∂–µ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é
    
    # –ü—Ä–æ–º–æ—É—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–≤ —Ä–µ–º–æ–Ω—Ç —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥)
    promote_enabled=False
)

repair_quota.register(model, agent)

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª–æ–∏:
# - quota_repair_clear
# - quota_repair_decide
```

---

### –°–ª—É—á–∞–π 3: –ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```python
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–æ—Ä—Ç–æ–≤ –≤ storage

storage_quota = QuotaManager(
    target_state="storage",
    limit_source="mp4_storage_capacity",  # –Å–º–∫–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ –¥–Ω—è–º
    
    # –î–µ–º–æ—É—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–∏–∑ storage –Ω–µ—Ç –≤—ã—Ö–æ–¥–∞)
    demount_enabled=False,
    
    # –ü—Ä–æ–º–æ—É—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–≤ storage —á–µ—Ä–µ–∑ LL/BR –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    promote_enabled=False
)

# –≠—Ç–æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, –Ω–æ –Ω–µ –º–µ–Ω—è–µ—Ç intent
# –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### 1. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

```python
# –ë—ã–ª–æ: 4 –º–æ–¥—É–ª—è √ó ~400 —Å—Ç—Ä–æ–∫ = 1600 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
quota_ops_excess.py
quota_promote_s3.py
quota_promote_s5.py
quota_promote_s1.py

# –°—Ç–∞–Ω–µ—Ç: 1 –º–æ–¥—É–ª—å √ó ~600 —Å—Ç—Ä–æ–∫ = 600 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
quota_manager.py  # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π

# + –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: 4 √ó 20 —Å—Ç—Ä–æ–∫ = 80 —Å—Ç—Ä–æ–∫

# –ò–¢–û–ì–û: 680 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 1600 (-58%)
```

---

### 2. –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö –∫–µ–π—Å–æ–≤

```python
# –ù–æ–≤—ã–π –∫–µ–π—Å: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ serviceable
serviceable_quota = QuotaManager(
    target_state="serviceable",
    limit_value=100,  # –ù–µ –±–æ–ª—å—à–µ 100 –∏—Å–ø—Ä–∞–≤–Ω—ã—Ö
    demount_to_state="inactive",
    demount_priority_order="fcfs",
    promote_enabled=False
)

# –î–æ–±–∞–≤–∏–ª–∏ 5 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è!
```

---

### 3. –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

```python
# –í—Å–µ –∫–≤–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ª–æ–≥–∏–∫—É
# –û—à–∏–±–∫—É –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –û–î–ù–û–ú –º–µ—Å—Ç–µ

# –ï–¥–∏–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
if (enable_logging):
    printf("[QUOTA %s Day %u] Curr=%u, Target=%u, K=%u\n", 
           target_state, day, curr, target, K);
```

---

### 4. –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –¢–µ—Å—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ = —Ç–µ—Å—Ç –í–°–ï–• –∫–≤–æ—Ç
def test_quota_manager_demount():
    qm = QuotaManager(target_state="test", limit_value=10, ...)
    # –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –¥–µ–º–æ—É—Ç–∞
    
def test_quota_manager_promote():
    qm = QuotaManager(target_state="test", limit_value=20, ...)
    # –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–º–æ—É—Ç–∞

# –ù–µ –Ω—É–∂–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è!
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
code/sim_v2/rtc_modules/
‚îú‚îÄ‚îÄ quota_manager/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ quota_manager.py          # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å
‚îÇ   ‚îú‚îÄ‚îÄ priority_strategies.py    # –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ code_generator.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RTC –∫–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ validators.py             # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

---

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è orchestrator

```python
# –í base_model.py –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:
def add_quota_manager(self, config: dict):
    """–î–æ–±–∞–≤–ª—è–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–≤–æ—Ç"""
    qm = QuotaManager(**config)
    qm.register(self.model, self.agent)

# –í orchestrator_v2.py:
orchestrator.base_model.add_quota_manager({
    "target_state": "operations",
    "limit_source": "mp4_ops_counter",
    "demount_to_state": "serviceable",
    "promote_from_states": ["serviceable", "reserve", "inactive"],
    ...
})

orchestrator.base_model.add_quota_manager({
    "target_state": "repair",
    "limit_value": 50,
    "demount_to_state": "serviceable",
    ...
})
```

---

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (—Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|-----|----------|--------|
| `target_state` | str | –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è | "operations", "repair" |
| `limit_source` | str | PropertyArray —Å –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ –¥–Ω—è–º | "mp4_ops_counter_mi8" |
| `limit_value` | int | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π –ª–∏–º–∏—Ç | 50 |
| `limit_per_group` | bool | –†–∞–∑–¥–µ–ª—å–Ω–æ –¥–ª—è Mi-8/Mi-17 | True |
| `demount_enabled` | bool | –†–∞–∑—Ä–µ—à—ë–Ω –ª–∏ –¥–µ–º–æ—É—Ç | True |
| `demount_to_state` | str | –ö—É–¥–∞ –¥–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å | "serviceable" |
| `demount_priority_field` | str | –ü–æ–ª–µ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ | "mp3_mfg_date_days" |
| `demount_priority_order` | str | –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ | "oldest_first" |
| `promote_enabled` | bool | –†–∞–∑—Ä–µ—à—ë–Ω –ª–∏ –ø—Ä–æ–º–æ—É—Ç | True |
| `promote_from_states` | List[str] | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É | ["serviceable", "reserve"] |
| `promote_priority_field` | str | –ü–æ–ª–µ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ | None (FCFS) |
| `promote_priority_order` | str | –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ | "fcfs" |
| `promote_conditions` | Dict[str,str] | –£—Å–ª–æ–≤–∏—è –¥–ª—è –ø—Ä–æ–º–æ—É—Ç–∞ | {"inactive": "day > repair_time"} |
| `mask_name_prefix` | str | –ü—Ä–µ—Ñ–∏–∫—Å –º–∞—Å–æ–∫ | "quota_ops" |
| `enable_logging` | bool | –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | True |

---

## üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–ª–æ—ë–≤

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
```
–ö–≤–æ—Ç—ã –¥–ª—è operations: 3 —Å–ª–æ—è
–ö–≤–æ—Ç—ã –¥–ª—è repair:     3 —Å–ª–æ—è (–±—É–¥—É—â–µ–µ)
–ö–≤–æ—Ç—ã –¥–ª—è reserve:    3 —Å–ª–æ—è (–±—É–¥—É—â–µ–µ)
–ö–≤–æ—Ç—ã –¥–ª—è storage:    3 —Å–ª–æ—è (–±—É–¥—É—â–µ–µ)

= 12 —Å–ª–æ—ë–≤ –Ω–∞ –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### –° —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
```
QuotaManager –¥–ª—è operations: 3 —Å–ª–æ—è
QuotaManager –¥–ª—è repair:     3 —Å–ª–æ—è
QuotaManager –¥–ª—è reserve:    3 —Å–ª–æ—è
QuotaManager –¥–ª—è storage:    3 —Å–ª–æ—è

= 12 —Å–ª–æ—ë–≤, –ù–û:
- –û–¥–∏–Ω –º–æ–¥—É–ª—å –≤–º–µ—Å—Ç–æ 4
- –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ
- –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ –∫–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º!**

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–µ–º–æ—É—Ç–∞ (—Å–Ω–∏–∂–µ–Ω–∏–µ –∏–∑ target_state)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–º–æ—É—Ç–∞ (–ø–æ–≤—ã—à–µ–Ω–∏–µ –≤ target_state)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (oldest, newest, fcfs, highest, lowest)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Å–ª–æ–≤–∏–π –ø—Ä–æ–º–æ—É—Ç–∞ (–¥–ª—è inactive –∏ —Ç.–¥.)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö group_by (Mi-8, Mi-17)
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç—ã

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–æ–≥–æ RTC –∫–æ–¥–∞
- [ ] –°–æ–±–ª—é–¥–µ–Ω–∏–µ FLAME GPU –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- [ ] –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å (–µ–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å)
- [ ] –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ù–µ –±–æ–ª–µ–µ 3 —Å–ª–æ—ë–≤ –Ω–∞ –æ–¥–Ω—É –∫–≤–æ—Ç—É
- [ ] –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç (–±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ—Ö–æ–¥–æ–≤)
- [ ] –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MacroProperty

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü—Ä–æ—Ç–æ—Ç–∏–ø –¥–ª—è operations
- [ ] –í—ã–¥–µ–ª–∏—Ç—å –æ–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ `rtc_quota_ops_excess.py`
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `QuotaManager` —Å –±–∞–∑–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é RTC –∫–æ–¥–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ operations (—Å—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π)

### –≠—Ç–∞–ø 2: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: oldest_first, newest_first, fcfs
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é priority_field
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º

### –≠—Ç–∞–ø 3: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–º–æ—É—Ç–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–º–æ—É—Ç–∞ (promote_conditions)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ serviceable‚Üíoperations

### –≠—Ç–∞–ø 4: –ù–æ–≤—ã–µ –∫–µ–π—Å—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ repair (–ª–∏–º–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ —Ç–µ–∫—É—â–∏–µ quota –º–æ–¥—É–ª–∏ –Ω–∞ QuotaManager
- [ ] –û–±–Ω–æ–≤–∏—Ç—å orchestrator_v2
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑–æ–≤—É—é –º–æ–¥–µ–ª—å
- [ ] –ü–æ–ª–Ω–æ–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üéØ –ß—Ç–æ –¥—É–º–∞–µ—à—å?

### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è:

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–æ–º–æ—É—Ç–∞:**
   - –ù—É–∂–Ω–æ –ª–∏ —Ä–∞–∑–¥–µ–ª—è—Ç—å promote –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ—ë–≤ (–ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º)?
   - –ò–ª–∏ –º–æ–∂–Ω–æ –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏?

2. **–£—á—ë—Ç group_by:**
   - –í—Å–µ–≥–¥–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ –¥–ª—è Mi-8 –∏ Mi-17?
   - –ò–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `limit_per_group`?

3. **–£—Å–ª–æ–≤–∏—è –ø—Ä–æ–º–æ—É—Ç–∞:**
   - –ö–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –≤ RTC?
   - –ß–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫—É –∫–æ–¥–∞ –∏–ª–∏ —á–µ—Ä–µ–∑ Environment properties?

4. **MacroProperty –¥–ª—è –º–∞—Å–æ–∫:**
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `mi8_approve/mi17_approve`?
   - –ò–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–≤–æ—Ç—ã?

5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–æ–¥—É–ª–∏ –∫–∞–∫ deprecated?
   - –ò–ª–∏ —Å—Ä–∞–∑—É –∑–∞–º–µ–Ω–∏—Ç—å?

---

**–ê–≤—Ç–æ—Ä:** AI Agent (Cursor)  
**–î–∞—Ç–∞:** 02-10-2025  
**–°—Ç–∞—Ç—É—Å:** –ö–æ–Ω—Ü–µ–ø—Ç –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è






