# Validation (V2)

## –°–≤—è–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–∏–ª**: `.cursorrules` (–∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: `docs/rtc_pipeline_architecture.md`
- **–ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞**: `docs/README.md`

## –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 13.10.2025)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–£–ë–î > –õ–æ–≥–∏
- ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å**: –ò—Ç–æ–≥–æ–≤–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –≤ –°–£–ë–î —á–µ—Ä–µ–∑ MP2
- ‚ö†Ô∏è **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ**: –¢–æ–ª—å–∫–æ –ø–æ —è–≤–Ω–æ–º—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é
- üßπ **–û—á–∏—Å—Ç–∫–∞**: –ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è + –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –≤ –°–£–ë–î –ë–ï–ó –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–∏—Å–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ RTC —è–¥—Ä–∞—Ö
- Race conditions (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –æ—Ç —Ç—ã—Å—è—á –ø–æ—Ç–æ–∫–æ–≤)
- –°–±–æ–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ NVRTC
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è FLAME GPU
- –ü–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (10-100x)

### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –ø–æ—ç—Ç–∞–ø–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π –ø–æ –æ–¥–Ω–æ–º—É
- –ü—Ä–æ–≥–æ–Ω –Ω–∞ 3650 –¥–Ω–µ–π (–≤—Å–µ —è–¥—Ä–∞ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã)
- SQL-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ –°–£–ë–î
- –ò–∑—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚Üí –≥–∏–ø–æ—Ç–µ–∑–∞ ‚Üí —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

## –°—Ç–∞—Ç—É—Å—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

- Status 2 (—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è)
  - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã: sne += dt, ppr += dt, –≥–¥–µ dt = mp5(day, idx).
  - –ü—Ä–æ–≥–Ω–æ–∑: s_next = sne + dn, p_next = ppr + dn.
  - –ü–µ—Ä–µ—Ö–æ–¥—ã:
    - 2‚Üí6 –ø—Ä–∏ s_next >= ll (LL –ø–æ—Ä–æ–≥), s6_days=0, s6_started=1.
    - 2‚Üí4 –ø—Ä–∏ p_next >= oh –∏ s_next < br (BR/repair –≤–µ—Ç–∫–∞).

- Status 4 (—Ä–µ–º–æ–Ω—Ç)
  - repair_days —Ä–∞—Å—Ç—ë—Ç –¥–æ repair_time.
  - –ü–µ—Ä–µ—Ö–æ–¥ 4‚Üí5 –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ repair_days >= repair_time.
  - assembly_time –≤–ª–∏—è–µ—Ç –Ω–∞ –º–∞—Ä–∫–µ—Ä —Å–±–æ—Ä–∫–∏ (–ø–ª–∞–Ω–æ–≤–æ D‚Äëassembly_time –¥–æ –∫–æ–Ω—Ü–∞ —Ä–µ–º–æ–Ω—Ç–∞).

- Status 6 (—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
  - ¬´–í–µ—á–Ω—ã–π¬ª: –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è, s6_days —Ä–∞—Å—Ç—ë—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ s6_started=1.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è smoke

- –ò—Ç–æ–≥–æ–≤—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º: s2/s4/s6.
- –í—ã–±–æ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–æ—Ä—Ç–æ–≤: (idx, status, sne, ppr, ll, oh, dt, dn).
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ–¥–Ω–æ–≥–æ idx –ø–æ –¥–Ω—è–º: (day, idx, dt, dn, sne, ppr, status).

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

- MP5: –ª–∏–Ω–µ–π–Ω—ã–π –º–∞—Å—Å–∏–≤ (DAYS+1)*FRAMES —Å –ø–∞–¥–¥–∏–Ω–≥–æ–º, MacroProperty mp5_lin.
- MP3 –ø–æ—Ä–æ–≥–∏: ll, oh, br ‚Äî —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø–æ frames_index.

## –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

- –î–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç DAYS/FRAMES.
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è row = day*FRAMES + idx; row_next = row + FRAMES.
- –¢–∏–ø—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã: UInt32 –¥–ª—è MP5 –∏ –∞–≥–µ–Ω—Ç–Ω—ã—Ö –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–µ–π.

## –ü—Ä–∞–≤–∏–ª–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–≥–æ)

- –í—Å–µ —Ç–µ—Å—Ç—ã/–ø—Ä–æ–≥–æ–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ ClickHouse.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö/–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≥–ª—É—à–µ–∫ –∏–ª–∏ —Ä—É—á–Ω—ã—Ö –ø–æ–¥–º–µ–Ω ‚Äî –∑–∞–ø—Ä–µ—â–µ–Ω–æ –±–µ–∑ —è–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–ê–ª–µ–∫—Å–µ—è) –≤ —Ç–µ–∫—É—â–µ–º —á–∞—Ç–µ.
- –õ—é–±—ã–µ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ c —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã –∏ —Å—Ä–æ–∫–æ–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º.

## V2 State-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–æ 25-09-2025)

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 28-09-2025)

**–ü—Ä–æ–≥–æ–Ω –Ω–∞ 3650 –¥–Ω–µ–π (10 –ª–µ—Ç):**
- –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: 154 operations, 7 repair, 118 inactive
- –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: 2 operations, 97 repair, 62 storage, 118 inactive
- –ü–µ—Ä–µ—Ö–æ–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã: repair –ø—Ä–∏ `ppr_next >= oh AND sne_next < br`, storage –ø—Ä–∏ `sne_next >= ll` (–∏–ª–∏ BR –≤–µ—Ç–∫–∞)
- –î–≤–∞ –∞–≥–µ–Ω—Ç–∞ –æ—Å—Ç–∞–ª–∏—Å—å –≤ operations –∏–∑-–∑–∞ –Ω–∏–∑–∫–æ–≥–æ —Å—É—Ç–æ—á–Ω–æ–≥–æ –Ω–∞–ª–µ—Ç–∞ (dt=2 –∏ dt=29)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å MP2): ~17.2–º—Å/—à–∞–≥, GPU 62.81—Å, DB 31.59—Å, –≤—Å–µ–≥–æ 67.26—Å
- MP2 —ç–∫—Å–ø–æ—Ä—Ç: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥—Ä–µ–Ω–∞–∂, 5 flush –ø–æ 250k, ~1.018M —Å—Ç—Ä–æ–∫; –∫–æ–ª–æ–Ω–Ω–∞—Ä–Ω—ã–µ INSERT; `day_date` ‚Äî MATERIALIZED

### –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
- **Intent –≤—Å–µ–≥–¥–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω**: `intent_state != 0` –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤**: –ê–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ —Ç–æ–ª—å–∫–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ intent_state
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤**: –ó–∞ –æ–¥–∏–Ω —à–∞–≥ –∞–≥–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑

### –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã MP5 –≤ V2
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: `base = step_day * MAX_FRAMES + idx` (–Ω–µ `idx * (MAX_DAYS + 1) + step_day`)
- **–†–∞–∑–º–µ—Ä**: `mp5_lin` —Å–æ–¥–µ—Ä–∂–∏—Ç `(MAX_DAYS + 1) * MAX_FRAMES` —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- **Read-only –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**: MP5 –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è RTC —Ñ—É–Ω–∫—Ü–∏—è–º–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω–æ 13.10.2025)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–û–í–ï–†–ï–ù–û - –¥—É–±–ª–∏—Ä—É—é—â–µ–π –ª–æ–≥–∏–∫–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ

#### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã

**assembly_trigger** (—Ç—Ä–∏–≥–≥–µ—Ä —Å–±–æ—Ä–∫–∏):
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (agent_population.py): —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≥–µ–Ω—Ç–æ–≤ –≤ status=4
- ‚úÖ –í operations (rtc_state_2_operations.py): –≤—Å–µ–≥–¥–∞ =1 (–∞–≥–µ–Ω—Ç —Å–æ–±—Ä–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ –í repair (rtc_states_stub.py): =1 –∫–æ–≥–¥–∞ repair_days >= repair_time - assembly_time
- ‚úÖ –°–±—Ä–æ—Å: –ø—Ä–∏ spawn –∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ repair‚Üíreserve (5 –º–æ–¥—É–ª–µ–π state_manager)
- üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –ù–ï –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç

**active_trigger** (—Ç—Ä–∏–≥–≥–µ—Ä –∞–∫—Ç–∏–≤–∞—Ü–∏–∏):
- ‚è≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ 1: –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–º–æ–¥—É–ª–∏ state_manager –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã)
- ‚úÖ –°–±—Ä–æ—Å –≤ 0: –≤ rtc_state_2_operations.py (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞ –≤ operations)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: =0 –ø—Ä–∏ spawn
- üìã –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç

**partout_trigger** (—Ç—Ä–∏–≥–≥–µ—Ä —Å–ø–∏—Å–∞–Ω–∏—è):
- ‚è≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ 1: –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–º–æ–¥—É–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: =0 –ø—Ä–∏ spawn
- üìã –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç

#### –°–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å state_manager –º–æ–¥—É–ª–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É active_trigger=1
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å quota –º–æ–¥—É–ª–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É partout_trigger=1
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏–∑ operations (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 13.10.2025)

**–°—Ç–∞—Ç—É—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** ‚úÖ –ü–†–û–í–ï–†–ï–ù–û –Ω–∞ 3650 –¥–Ω–µ–π, –≤—Å–µ 152 –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

#### –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫**: LL ‚Üí OH+BR ‚Üí –æ—Å—Ç–∞–µ–º—Å—è –≤ operations
- **–£—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ repair (intent=4)**: `ppr_next >= oh AND sne_next < br`
- **–£—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ storage (intent=6)**: `sne_next >= ll OR (ppr_next >= oh AND sne_next >= br)`
- **–†–∞—Å—á–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞**: `s_next = sne + dt + dn`, `p_next = ppr + dt + dn`

#### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ 2‚Üí4 (repair):** 134 —Å–ª—É—á–∞—è (52 Mi-8 + 82 Mi-17)
  - –í—Å–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —É—Å–ª–æ–≤–∏—é `ppr_next >= oh AND sne_next < br` ‚úÖ
  - –ü–µ—Ä–µ—Ö–æ–¥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¢–û–ß–ù–û –≤ –º–æ–º–µ–Ω—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è `oh` (270,000 –º–∏–Ω—É—Ç)
  
- **–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ 2‚Üí6 (storage):** 18 —Å–ª—É—á–∞–µ–≤ (14 Mi-8 + 4 Mi-17)
  - –ü–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é LL: 5 —Å–ª—É—á–∞–µ–≤ ‚úÖ
  - –ü–æ —É—Å–ª–æ–≤–∏—é BR (—Ä–µ–º–æ–Ω—Ç –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–µ–Ω): 13 —Å–ª—É—á–∞–µ–≤ ‚úÖ
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø–∞—Å –¥–æ LL –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ BR: 7,566 –º–∏–Ω—É—Ç (idx=82, Mi-17)
  
- **–ê–≥–µ–Ω—Ç–æ–≤ –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:** 127 (–Ω–∏–∑–∫–∏–π –Ω–∞–ª—ë—Ç, –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∏ –ø–æ—Ä–æ–≥–æ–≤ –∑–∞ 10 –ª–µ—Ç)

#### Side effects –ø—Ä–∏ operations
- –ï—Å–ª–∏ active_trigger=1 ‚Üí —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ 0
- –ï—Å–ª–∏ assembly_trigger=0 ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ 1
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ 2‚Üí4: ppr —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ 2‚Üí6: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è s6_started = step_day

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
- ‚ö†Ô∏è –ê–≥–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ `state='operations'` –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ intent=4/6
- ‚ö†Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∞—é—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å sne/ppr (–Ω–µ—Ç state_manager –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤)
- ‚ö†Ô∏è –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ LL: Mi-8 –¥–æ 2,086,328 –ø—Ä–∏ ll=1,800,000 (+286k –º–∏–Ω—É—Ç)
- ‚úÖ –≠—Ç–æ **–æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è

**–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç:** `docs/validation_stage1_state2ops_13-10-2025.md`

---

### –í–∞–ª–∏–¥–∞—Ü–∏—è states_stub ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ intent (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 14.10.2025)

**–°—Ç–∞—Ç—É—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** ‚úÖ –ü–†–û–í–ï–†–ï–ù–û –Ω–∞ 3650 –¥–Ω–µ–π

#### –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ú–æ–¥—É–ª—å:** rtc_states_stub.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ intent_state –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö inactive, serviceable, repair, reserve, storage
**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –ü–û–°–õ–ï state_2_operations (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –µ–≥–æ intent)

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
1. state_1 (inactive) ‚Äî "–ñ–µ–ª–µ–∑–Ω—ã–π —Ä—è–¥"
2. state_3 (serviceable) ‚Äî –ò—Å–ø—Ä–∞–≤–Ω—ã–µ, –≥–æ—Ç–æ–≤—ã–µ –∫ —Ä–∞–±–æ—Ç–µ
3. state_4 (repair) ‚Äî –í —Ä–µ–º–æ–Ω—Ç–µ
4. state_5 (reserve) ‚Äî –†–µ–∑–µ—Ä–≤ –ø–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞
5. state_6 (storage) ‚Äî –•—Ä–∞–Ω–µ–Ω–∏–µ/—É—Ç–∏–ª–∏–∑–∞—Ü–∏—è

#### –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º

**1. state_1 (inactive) ‚Äî "–ñ–µ–ª–µ–∑–Ω—ã–π —Ä—è–¥"**

–õ–æ–≥–∏–∫–∞:
- –ê–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (intent=2) —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ step_day >= repair_time
- –î–æ —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –∞–≥–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤ "–∂–µ–ª–µ–∑–Ω–æ–º —Ä—è–¥—É" (intent=1)
- –£—Å–ª–æ–≤–∏–µ: if (step_day >= repair_time) ‚Üí intent=2, else ‚Üí intent=1

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:
- ‚úÖ intent=1 –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π 0 <= step_day < repair_time
- ‚úÖ intent=2 –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π step_day >= repair_time
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–æ–≤–Ω–æ –Ω–∞ day = repair_time (–Ω–µ —Ä–∞–Ω—å—à–µ, –Ω–µ –ø–æ–∑–∂–µ)
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –∑–Ω–∞—á–µ–Ω–∏–µ intent –Ω–µ —Ñ–ª—É–∫—Ç—É–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (3650 –¥–Ω–µ–π, 118 –∞–≥–µ–Ω—Ç–æ–≤, repair_time=180):
- ‚úÖ Days 0-179: –≤—Å–µ 118 –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=1
- ‚úÖ Days 180-3649: –≤—Å–µ 118 –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ —Ç–æ—á–Ω–æ –Ω–∞ day 180

SQL-–ø—Ä–æ–≤–µ—Ä–∫–∏:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ –ø–æ—Ä–æ–≥–∞
SELECT COUNT(DISTINCT ac) FROM sim_masterv2 
WHERE step_day < 180 AND state = 'inactive' AND intent_state != 1;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø–æ—Ä–æ–≥–∞
SELECT COUNT(DISTINCT ac) FROM sim_masterv2 
WHERE step_day >= 180 AND state = 'inactive' AND intent_state != 2;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0
```

**2. state_3 (serviceable) ‚Äî –ò—Å–ø—Ä–∞–≤–Ω—ã–µ**

–õ–æ–≥–∏–∫–∞:
- –ê–≥–µ–Ω—Ç—ã –í–°–ï–ì–î–ê –∏–º–µ—é—Ç intent=2 (—Å—Ç—Ä–µ–º—è—Ç—Å—è –≤ operations)
- –ù–µ—Ç —É—Å–ª–æ–≤–∏–π, –Ω–µ—Ç —Å—á–µ—Ç—á–∏–∫–æ–≤, –Ω–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:
- ‚úÖ intent=2 –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö —Å–∏–º—É–ª—è—Ü–∏–∏ (day 0 - day 3649)
- ‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

SQL-–ø—Ä–æ–≤–µ—Ä–∫–∞:
```sql
SELECT COUNT(*) FROM sim_masterv2 
WHERE state = 'serviceable' AND intent_state != 2;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0
```

**3. state_4 (repair) ‚Äî –í —Ä–µ–º–æ–Ω—Ç–µ**

–õ–æ–≥–∏–∫–∞:
- repair_days –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å (–Ω–∞—á–∏–Ω–∞—è —Å day 1)
- assembly_trigger —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 1 —Ä–æ–≤–Ω–æ –Ω–∞ 1 –¥–µ–Ω—å, –∫–æ–≥–¥–∞ repair_days == (repair_time - assembly_time)
- assembly_trigger –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0 –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
- –ü—Ä–∏ repair_days == repair_time: intent=5, ppr‚Üí0, repair_days‚Üí0

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:

1. –°—á–µ—Ç—á–∏–∫ repair_days:
   - ‚úÖ repair_days <= repair_time (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç)
   - ‚úÖ repair_days —Ä–∞—Å—Ç–µ—Ç –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ: +1 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ state=repair
   - ‚úÖ repair_days —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0 –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ repair_time

2. –¢—Ä–∏–≥–≥–µ—Ä assembly_trigger:
   - ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 1 —Ä–æ–≤–Ω–æ –û–î–ò–ù –†–ê–ó –∑–∞ —Ü–∏–∫–ª —Ä–µ–º–æ–Ω—Ç–∞
   - ‚úÖ "–ñ–∏–≤–µ—Ç" —Ç–æ–ª—å–∫–æ 1 –¥–µ–Ω—å (–¥–µ–Ω—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
   - ‚úÖ –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –ø–æ—Ä–æ–≥–µ: repair_days == (repair_time - assembly_time)
   - ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–µ –º–µ–Ω—è—é—Ç –ª–æ–≥–∏–∫—É

3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–∞:
   - ‚úÖ –ü—Ä–∏ repair_days == repair_time ‚Üí intent=5 (—Ä–µ–∑–µ—Ä–≤)
   - ‚úÖ –°–±—Ä–æ—Å ppr‚Üí0 (–Ω–æ–≤—ã–π –º–µ–∂—Ä–µ–º–æ–Ω—Ç–Ω—ã–π —Ü–∏–∫–ª)
   - ‚úÖ –°–±—Ä–æ—Å repair_days‚Üí0 (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ü–∏–∫–ª—É)

4. –¶–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å (–±–µ–∑ state_manager):
   - ‚úÖ –ï—Å–ª–∏ state –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –∞–≥–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä—è–µ—Ç —Ü–∏–∫–ª: rd 0‚Üí180‚Üí0‚Üí180...
   - ‚úÖ –≠—Ç–æ –û–ñ–ò–î–ê–ï–ú–û–ï –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (3650 –¥–Ω–µ–π, 7 –∞–≥–µ–Ω—Ç–æ–≤, repair_time=180, assembly_time=30):

Day 0 (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ MP3):
- ‚úÖ AC 22431: repair_days=157, days_left=23 < 30 ‚Üí assembly_trigger=1
- ‚úÖ AC 22215: repair_days=117, days_left=63 > 30 ‚Üí assembly_trigger=0

–¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ (7 –∞–≥–µ–Ω—Ç–æ–≤ √ó 3650 –¥–Ω–µ–π):
- ‚úÖ 20 –ø–æ–ª–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ —Ä–µ–º–æ–Ω—Ç–∞ –∑–∞ 3650 –¥–Ω–µ–π
- ‚úÖ 20 —Å–±—Ä–æ—Å–æ–≤ repair_days‚Üí0 (–ø–æ 1 –Ω–∞ —Ü–∏–∫–ª –Ω–∞ –∞–≥–µ–Ω—Ç–∞)
- ‚úÖ 147 —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π assembly_trigger (7 –∞–≥–µ–Ω—Ç–æ–≤ √ó 21 —Ä–∞–∑)
  - 7 –Ω–∞ day 0 (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ MP3)
  - 140 –≤ —Ü–∏–∫–ª–∞—Ö (7 –∞–≥–µ–Ω—Ç–æ–≤ √ó 20 —Ü–∏–∫–ª–æ–≤)

SQL-–ø—Ä–æ–≤–µ—Ä–∫–∏:
```sql
-- 1. repair_days –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç repair_time
SELECT COUNT(*) FROM sim_masterv2 
WHERE state = 'repair' AND repair_days > repair_time;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0

-- 2. assembly_trigger —Ç–æ–ª—å–∫–æ 0 –∏–ª–∏ 1
SELECT COUNT(*) FROM sim_masterv2 
WHERE state = 'repair' AND assembly_trigger NOT IN (0, 1);
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0

-- 3. assembly_trigger=1 –Ω–∞ –ø–æ—Ä–æ–≥–µ
SELECT ac, step_day, repair_days, repair_time, assembly_time
FROM sim_masterv2 
WHERE state = 'repair' AND assembly_trigger = 1
  AND repair_days != (repair_time - assembly_time);
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø—É—Å—Ç–æ (–∏–ª–∏ —Ç–æ–ª—å–∫–æ day 0 —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)

-- 4. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π assembly_trigger
SELECT COUNT(*) FROM sim_masterv2 
WHERE state = 'repair' AND assembly_trigger = 1;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: ~147 (–¥–ª—è 7 –∞–≥–µ–Ω—Ç–æ–≤ –∑–∞ 3650 –¥–Ω–µ–π)

-- 5. –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
SELECT ac, step_day, repair_days, ppr 
FROM sim_masterv2 
WHERE state = 'repair' AND repair_days = 0 AND step_day > 0;
-- –ü—Ä–æ–≤–µ—Ä–∫–∞: —ç—Ç–æ –¥–Ω–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ repair_days==repair_time
```

**4. state_5 (reserve) ‚Äî –†–µ–∑–µ—Ä–≤**

–õ–æ–≥–∏–∫–∞:
- –ê–≥–µ–Ω—Ç—ã –í–°–ï–ì–î–ê –∏–º–µ—é—Ç intent=2 (—Å—Ç—Ä–µ–º—è—Ç—Å—è –≤ operations)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P2 –≤ –∫–∞—Å–∫–∞–¥–Ω–æ–º –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–Ω–∏–∂–µ serviceable)
- –ù–µ—Ç —É—Å–ª–æ–≤–∏–π, –Ω–µ—Ç —Å—á–µ—Ç—á–∏–∫–æ–≤, –Ω–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:
- ‚úÖ intent=2 –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö —Å–∏–º—É–ª—è—Ü–∏–∏
- ‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

SQL-–ø—Ä–æ–≤–µ—Ä–∫–∞:
```sql
SELECT COUNT(*) FROM sim_masterv2 
WHERE state = 'reserve' AND intent_state != 2;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0
```

**5. state_6 (storage) ‚Äî –•—Ä–∞–Ω–µ–Ω–∏–µ**

–õ–æ–≥–∏–∫–∞:
- –ê–≥–µ–Ω—Ç—ã –í–°–ï–ì–î–ê –∏–º–µ—é—Ç intent=6 (–æ—Å—Ç–∞—é—Ç—Å—è –≤ storage)
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ù–ï–ò–ó–ú–ï–ù–Ø–ï–ú–û–ï (S6 immutable)
- –ê–≥–µ–Ω—Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç storage

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:
- ‚úÖ intent=6 –Ω–∞ –≤—Å–µ—Ö —à–∞–≥–∞—Ö —Å–∏–º—É–ª—è—Ü–∏–∏
- ‚úÖ S6 immutable: –∞–≥–µ–Ω—Ç, –ø–æ–ø–∞–≤—à–∏–π –≤ storage, –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–º –Ω–∞–≤—Å–µ–≥–¥–∞
- ‚úÖ –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏–∑ storage –≤ –¥—Ä—É–≥–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

SQL-–ø—Ä–æ–≤–µ—Ä–∫–∏:
```sql
-- 1. intent –≤—Å–µ–≥–¥–∞ 6
SELECT COUNT(*) FROM sim_masterv2 
WHERE state = 'storage' AND intent_state != 6;
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: 0

-- 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ S6 immutable (–∞–≥–µ–Ω—Ç –Ω–µ –ø–æ–∫–∏–¥–∞–µ—Ç storage)
WITH storage_entries AS (
  SELECT ac, MIN(step_day) AS first_storage_day
  FROM sim_masterv2 
  WHERE state = 'storage'
  GROUP BY ac
)
SELECT s.ac, s.first_storage_day, m.step_day, m.state
FROM storage_entries s
JOIN sim_masterv2 m ON s.ac = m.ac
WHERE m.step_day >= s.first_storage_day AND m.state != 'storage';
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø—É—Å—Ç–æ (–Ω–µ—Ç –≤—ã—Ö–æ–¥–æ–≤ –∏–∑ storage)
```

#### –û–±—â–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã states_stub

1. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å intent:**
   - intent_state —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∑–∞–Ω–æ–≤–æ
   - –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ intent (–∫—Ä–æ–º–µ –ª–æ–≥–∏–∫–∏ —Å–∞–º–æ–≥–æ –º–æ–¥—É–ª—è)

2. **Day 0 –±–µ–∑ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤:**
   - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ MP3 –Ω–µ –∏—Å–∫–∞–∂–∞—é—Ç—Å—è
   - –¢–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ intent (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)

3. **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
   - states_stub –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï state_2_operations
   - –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç intent –¥–ª—è state=operations

4. **–ú–∏–Ω–∏–º–∞–ª–∏–∑–º –æ–ø–µ—Ä–∞—Ü–∏–π:**
   - MP5 –ù–ï —á–∏—Ç–∞–µ—Ç—Å—è –≤ states_stub (—Ç–æ–ª—å–∫–æ –≤ state_2_operations)
   - daily_today_u32/daily_next_u32 –∞–∫—Ç—É–∞–ª—å–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è operations
   - –ò–∑–±–µ–∂–∞–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è –∏–∑ GPU –ø–∞–º—è—Ç–∏

5. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º:**
   - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–≥–æ–Ω—ã —Å –æ–¥–Ω–∏–º —Å–Ω–∞–ø—à–æ—Ç–æ–º –¥–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   - –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤

#### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–≥–æ–Ω —Å–∏–º—É–ª—è—Ü–∏–∏:**
   - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3650 –¥–Ω–µ–π (10 –ª–µ—Ç)
   - –ú–æ–¥—É–ª–∏: state_2_operations + states_stub
   - –≠–∫—Å–ø–æ—Ä—Ç: –≤ –°–£–ë–î —á–µ—Ä–µ–∑ MP2 (device-side export)

2. **SQL-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:**
   - –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –°–£–ë–î
   - –ù–∏–∫–∞–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ RTC –∫–æ–¥–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

3. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º:**
   - –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø—Ä–æ–≥–æ–Ω —Å --drop-table –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º –∏–ª–∏ –≤—ã–±–æ—Ä–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

4. **–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
   - ‚úÖ –í—Å–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (0 –Ω–∞—Ä—É—à–µ–Ω–∏–π)
   - ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –≤ –°–£–ë–î
   - ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤
   - ‚úÖ –ö–æ–¥ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è

‚ö†Ô∏è **states_stub —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –ë–ï–ó state_manager –º–æ–¥—É–ª–µ–π:**

1. **–¶–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å repair:**
   - –ê–≥–µ–Ω—Ç—ã –≤ repair —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç —Ä–µ–º–æ–Ω—Ç (rd 0‚Üí180‚Üí0‚Üí180)
   - –≠—Ç–æ –û–ñ–ò–î–ê–ï–ú–û: –Ω–µ—Ç state_manager –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
   - –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ: –ø–æ—Å–ª–µ intent=5 –∞–≥–µ–Ω—Ç –ø–µ—Ä–µ–π–¥–µ—Ç –≤ reserve

2. **–ê–≥–µ–Ω—Ç—ã –Ω–µ –º–µ–Ω—è—é—Ç state:**
   - intent —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –Ω–æ state –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
   - inactive –æ—Å—Ç–∞—é—Ç—Å—è inactive (–¥–∞–∂–µ —Å intent=2)
   - –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ: quota + state_manager –ø—Ä–∏–º–µ–Ω—è—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã

3. **–ö–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - intent=2 —É inactive/serviceable/reserve –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –≤ operations
   - –ú–æ–¥—É–ª–∏ quota_* –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã

#### –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

1. ‚úÖ state_2_operations ‚Äî –ü–†–û–í–ï–†–ï–ù–û (13.10.2025)
2. ‚úÖ states_stub ‚Äî –ü–†–û–í–ï–†–ï–ù–û (14.10.2025)
3. ‚úÖ count_ops ‚Äî –ü–†–û–í–ï–†–ï–ù–û (15.10.2025)
4. ‚è≥ quota_ops_excess ‚Äî —Å–ª–µ–¥—É—é—â–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
5. ‚è≥ quota_promote_* ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–æ—É—Ç
6. ‚è≥ state_manager_* ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã
7. ‚è≥ –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π

---

## –í–∞–ª–∏–¥–∞—Ü–∏—è count_ops ‚Äî –ü–æ–¥—Å—á—ë—Ç –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2 (–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ 15.10.2025)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

**count_ops** –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `operations` —Å `intent_state=2` (—Ö–æ—Ç—è—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤ –ø–æ–ª—ë—Ç–∞—Ö) –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `mi8_ops_count[idx]` / `mi17_ops_count[idx]`.

**–°–µ–º–∞–Ω—Ç–∏–∫–∞ (–≤–∞—Ä–∏–∞–Ω—Ç B, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω 10-10-2025):**
- –°—á–∏—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –∞–≥–µ–Ω—Ç–æ–≤ —Å `intent=2` –≤ `state=operations`
- –ù–ï —Å—á–∏—Ç–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ —Å `intent=4` (—Ö–æ—Ç—è—Ç –≤ —Ä–µ–º–æ–Ω—Ç)
- –ù–ï —Å—á–∏—Ç–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ —Å `intent=6` (—Ö–æ—Ç—è—Ç –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)
- –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –±–∞–ª–∞–Ω—Å–∞ –∫–≤–æ—Ç

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∞

```bash
# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
cd "/home/budnik_an/cube linux/cube" && \
source config/load_env.sh && \
export CUDA_PATH=/usr/local/cuda && \
export CUBE_CONFIG_PATH="/home/budnik_an/cube linux/cube/config" && \
cd code/sim_v2 && \
python3 orchestrator_v2.py \
  --modules state_2_operations states_stub count_ops \
  --steps 3650 --enable-mp2 --drop-table
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ú–æ–¥—É–ª–∏: `state_2_operations + states_stub + count_ops`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3650 –¥–Ω–µ–π (10 –ª–µ—Ç)
- MP2 export: –≤–∫–ª—é—á—ë–Ω

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚è±Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ GPU: 42.22—Å
- üìä –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —à–∞–≥: 10.2–º—Å
- üìà p50=4.3–º—Å, p95=5.5–º—Å, max=20724.9–º—Å
- üíæ MP2 export: 1,018,350 —Å—Ç—Ä–æ–∫, 5 flushes

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**
- –ë–µ–∑ count_ops: 37.73—Å
- –° count_ops: 42.22—Å
- **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: +4.5—Å (+11.9%)** ‚Äî –ø—Ä–∏–µ–º–ª–µ–º–æ

### –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã count_ops

#### 1. –°—á–∏—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û intent=2 –≤ operations

```sql
SELECT 
    day_u16,
    COUNT(*) as total_in_ops,
    SUM(CASE WHEN intent_state = 2 THEN 1 ELSE 0 END) as intent_2_count
FROM sim_masterv2
WHERE state = 'operations'
GROUP BY day_u16
ORDER BY day_u16
```

**–û–∂–∏–¥–∞–Ω–∏–µ:** `intent_2_count` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ—Å—á–∏—Ç–∞–µ—Ç count_ops

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–µ–Ω—å 0: 154 –≤—Å–µ–≥–æ, 154 —Å intent=2 ‚Üí count_ops = 154 ‚úÖ
- –î–µ–Ω—å 2: 154 –≤—Å–µ–≥–æ, 153 —Å intent=2 ‚Üí count_ops = 153 ‚úÖ (AC 22418 —Ö–æ—á–µ—Ç –≤ —Ä–µ–º–æ–Ω—Ç)
- –î–µ–Ω—å 3649: 154 –≤—Å–µ–≥–æ, 2 —Å intent=2 ‚Üí count_ops = 2 ‚úÖ

#### 2. –ù–ï —Å—á–∏—Ç–∞–µ—Ç intent=4 –∏ intent=6

```sql
SELECT 
    day_u16,
    SUM(CASE WHEN intent_state = 4 THEN 1 ELSE 0 END) as intent_4_count,
    SUM(CASE WHEN intent_state = 6 THEN 1 ELSE 0 END) as intent_6_count
FROM sim_masterv2
WHERE state = 'operations' AND day_u16 = 3649
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–Ω—å 3649:**
- intent=4: 97 –∞–≥–µ–Ω—Ç–æ–≤ (—Ö–æ—Ç—è—Ç –≤ —Ä–µ–º–æ–Ω—Ç) ‚Üí –ù–ï —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è ‚úÖ
- intent=6: 55 –∞–≥–µ–Ω—Ç–æ–≤ (—Ö–æ—Ç—è—Ç –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–µ) ‚Üí –ù–ï —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è ‚úÖ
- **–ò—Ç–æ–≥–æ: 152 –∞–≥–µ–Ω—Ç–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è count_ops**

#### 3. –°—É–º–º–∞ intent —Ä–∞–≤–Ω–∞ total

```sql
SELECT 
    day_u16,
    COUNT(*) as total,
    SUM(CASE WHEN intent_state = 2 THEN 1 ELSE 0 END) +
    SUM(CASE WHEN intent_state = 4 THEN 1 ELSE 0 END) +
    SUM(CASE WHEN intent_state = 6 THEN 1 ELSE 0 END) as sum_intent
FROM sim_masterv2
WHERE state = 'operations' AND day_u16 = 3649
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- total = 154
- sum_intent = 2 + 97 + 55 = 154 ‚úÖ

#### 4. count_ops ‚â§ total_in_operations

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å–µ—Ö –¥–Ω—è—Ö:**
```sql
SELECT day_u16, 
    COUNT(*) as total,
    SUM(CASE WHEN intent_state = 2 THEN 1 ELSE 0 END) as count_ops_value
FROM sim_masterv2
WHERE state = 'operations'
GROUP BY day_u16
HAVING count_ops_value > total  -- –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 —Å—Ç—Ä–æ–∫ (–Ω–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ—Ç) ‚úÖ

### –î–∏–Ω–∞–º–∏–∫–∞ intent=2 –ø–æ –≤—Ä–µ–º–µ–Ω–∏

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT 
    day_u16,
    COUNT(*) as total,
    SUM(CASE WHEN intent_state = 2 THEN 1 ELSE 0 END) as i2,
    SUM(CASE WHEN intent_state = 4 THEN 1 ELSE 0 END) as i4,
    SUM(CASE WHEN intent_state = 6 THEN 1 ELSE 0 END) as i6
FROM sim_masterv2
WHERE state = 'operations' AND day_u16 % 500 = 0
GROUP BY day_u16
ORDER BY day_u16
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

| –î–µ–Ω—å | –í—Å–µ–≥–æ | intent=2 | intent=4 | intent=6 | % –æ—Å—Ç–∞—é—Ç—Å—è |
|------|-------|----------|----------|----------|------------|
| 0    | 154   | 154      | 0        | 0        | 100.0%     |
| 500  | 154   | 140      | 14       | 0        | 90.9%      |
| 1000 | 154   | 115      | 36       | 3        | 74.7%      |
| 1500 | 154   | 85       | 63       | 6        | 55.2%      |
| 2000 | 154   | 46       | 93       | 15       | 29.9%      |
| 2500 | 154   | 14       | 116      | 24       | 9.1%       |
| 3000 | 154   | 2        | 112      | 40       | 1.3%       |
| 3500 | 154   | 2        | 103      | 49       | 1.3%       |

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ "–∏—Å—Ç–æ—â–µ–Ω–∏—è —Ñ–ª–æ—Ç–∞":**
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ —Å intent=2
- –ö 3000 –¥–Ω—é —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –Ω–∞ 2 –∞–≥–µ–Ω—Ç–∞—Ö
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç –Ω–∞—Ä–∞–±–æ—Ç–∫—É –∏ —Ö–æ—Ç—è—Ç –≤ —Ä–µ–º–æ–Ω—Ç/—Ö—Ä–∞–Ω–µ–Ω–∏–µ

### –ú–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

1. ‚úÖ **SQL –∑–∞–ø—Ä–æ—Å—ã –∫ –°–£–ë–î** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤—ã—Ö/–ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –¥–Ω–µ–π
   - –î–∏–Ω–∞–º–∏–∫–∞ –Ω–∞ –≤—Å–µ—Ö 3650 –¥–Ω—è—Ö
   - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ intent_state

2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**
   - –°—É–º–º–∞ intent = total
   - count_ops ‚â§ total
   - –ê–≥–µ–Ω—Ç—ã —Å intent‚â†2 –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

3. ‚úÖ **–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ intent (AC 22418: 2‚Üí4)

4. ‚úÖ **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º**
   - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–≥–æ–Ω—ã –¥–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   - 1,018,350 —Å—Ç—Ä–æ–∫ MP2 (—Å—Ç–∞–±–∏–ª—å–Ω–æ)

5. ‚úÖ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –≤–∞—Ä–∏–∞–Ω—Ç–æ–º A** (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º)
   - –í–∞—Ä–∏–∞–Ω—Ç A: —Å—á–∏—Ç–∞–ª –≤—Å–µ—Ö 154 ‚Üí –Ω–µ–≤–µ—Ä–Ω–æ
   - –í–∞—Ä–∏–∞–Ω—Ç B: —Å—á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ 2 ‚Üí –≤–µ—Ä–Ω–æ

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚ö†Ô∏è **count_ops —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –ë–ï–ó quota –∏ state_manager –º–æ–¥—É–ª–µ–π:**

1. **–ê–≥–µ–Ω—Ç—ã –Ω–µ –º–µ–Ω—è—é—Ç state:**
   - 154 –∞–≥–µ–Ω—Ç–∞ –æ—Å—Ç–∞—é—Ç—Å—è –≤ operations –≤–µ—Å—å –ø—Ä–æ–≥–æ–Ω
   - –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ intent=4/6, –Ω–µ —É—Ö–æ–¥—è—Ç –≤ repair/storage
   - –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ: state_manager –ø—Ä–∏–º–µ–Ω–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã

2. **–ó–Ω–∞—á–µ–Ω–∏—è ops_count –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**
   - –ë—É—Ñ–µ—Ä—ã mi8_ops_count/mi17_ops_count –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è
   - –ù–æ quota –º–æ–¥—É–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã ‚Üí –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
   - –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ: quota_ops_excess –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è

3. **"–ò—Å—Ç–æ—â–µ–Ω–∏–µ" –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è:**
   - –ö –∫–æ–Ω—Ü—É —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç–æ–ª—å–∫–æ 2 –∞–≥–µ–Ω—Ç–∞ —Ö–æ—Ç—è—Ç –ª–µ—Ç–∞—Ç—å
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ 152 "–∑–∞—Å—Ç—Ä—è–ª–∏" —Å –∂–µ–ª–∞–Ω–∏–µ–º —É–π—Ç–∏
   - –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ: —ç—Ç–∏ –∞–≥–µ–Ω—Ç—ã —É—à–ª–∏ –±—ã –≤ —Ä–µ–º–æ–Ω—Ç/—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–Ω—å—à–µ

### –ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞

‚úÖ **–ú–æ–¥—É–ª—å count_ops –ø—Ä–æ—à—ë–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é:**
- –í—Å–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (0 –Ω–∞—Ä—É—à–µ–Ω–∏–π)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ –°–£–ë–î
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞ (+11.9% –∫ –±–∞–∑–æ–≤–æ–º—É)
- –ö–æ–¥ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω.**

---

## –í–∞–ª–∏–¥–∞—Ü–∏—è quota_ops_excess ‚Äî –î–µ–º–æ—É—Ç (–æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Üí —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ) (–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ 16.10.2025)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

**quota_ops_excess** –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç **–¥–µ–º–æ—É—Ç** (–ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞) –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è `operations` (–ø–æ–ª—ë—Ç—ã) –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `serviceable` (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ) –ø—Ä–∏ –∏–∑–±—ã—Ç–∫–µ:
- –ß–∏—Ç–∞–µ—Ç count_ops –±—É—Ñ–µ—Ä—ã (–∞–≥–µ–Ω—Ç—ã —Å intent=2 –≤ operations)
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å target –∏–∑ MP4 (flight_program_ac)
- –ï—Å–ª–∏ curr > target: –¥–µ–º–æ—É—Ç–∏—Ç K=balance —Å–∞–º—ã—Ö **—Å—Ç–∞—Ä—ã—Ö** –∞–≥–µ–Ω—Ç–æ–≤ (–ø–æ mfg_date)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç intent=3 –¥–ª—è –¥–µ–º–æ—É—Ç–∏–º—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

**–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ:** oldest first ‚Äî –≤—ã–≤–æ–¥—è—Ç—Å—è —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ –ø–æ –¥–∞—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∞

```bash
# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
cd "/home/budnik_an/cube_linux/cube" && \
export CUBE_CONFIG_PATH="/home/budnik_an/cube_linux/cube" && \
export CUDA_PATH=/usr/local/cuda && \
export PYTHONPATH="/home/budnik_an/cube_linux/cube/code:$PYTHONPATH" && \
cd code/sim_v2 && \
python3 orchestrator_v2.py \
  --modules state_2_operations states_stub count_ops quota_ops_excess \
  --steps 3650 --enable-mp2 --drop-table
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ú–æ–¥—É–ª–∏: `state_2_operations + states_stub + count_ops + quota_ops_excess`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3650 –¥–Ω–µ–π (10 –ª–µ—Ç)
- MP2 export: –≤–∫–ª—é—á—ë–Ω

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚è±Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ GPU: 48.13—Å
- üìä –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —à–∞–≥: 12.4–º—Å
- üìà –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: p50‚âà11-12–º—Å, p95‚âà13–º—Å, max‚âà25–º—Å (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- üíæ MP2 export: 1,042,318 —Å—Ç—Ä–æ–∫, 5 flushes

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å count_ops:**
- –ë–µ–∑ quota_ops_excess: 42.22—Å
- –° quota_ops_excess: 48.13—Å
- **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: +5.9—Å (+14%)** ‚Äî –ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –¥–µ–º–æ—É—Ç–∞ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ —Ä–∞–Ω–Ω–∏–µ –¥–Ω–∏

### –î–∏–Ω–∞–º–∏–∫–∞ –¥–µ–º–æ—É—Ç–æ–≤ –ø–æ –¥–Ω—è–º (3650 –¥–Ω–µ–π, Mi-8 + Mi-17)

```
–î–µ–Ω—å | Mi-8 (i2) | i3 | Mi-17 (i2) | i3 | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
-----|-----------|----|-----------|----|--------------------------------------
  27 |    64     | 3  |    86     | 0  | –ü–µ—Ä–≤—ã–π –¥–µ–º–æ—É—Ç Mi-8 (target‚Üì)
  28-87 |  64     | 3  |    86     | 0  | –°—Ç–∞–±–∏–ª—å–Ω–æ: Mi-8 –¥–µ–º–æ—É—Ç 3 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
  88-118 |  65     | 2  |    86     | 0  | Mi-8: target –≤—ã—Ä–æ—Å ‚Üí –¥–µ–º–æ—É—Ç —É–ø–∞–ª –Ω–∞ 1
 119-179 |  67     | 0  |    86     | 0  | –ù–µ—Ç –¥–µ–º–æ—É—Ç–æ–≤ (–∏–∑–±—ã—Ç–∫–∞ –Ω–µ—Ç)
 180-210 |  52     | 14 |    83     | 2  | –°–∫–∞—á–æ–∫: target –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø–∞–ª
 211-269 |  55     | 11 |    84     | 0  | Target –≤—ã—Ä–æ—Å (38‚Üí44) ‚Üí –¥–µ–º–æ—É—Ç —É–ø–∞–ª (14‚Üí11)
 270-299 |  62     | 4  |    84     | 0  | Mi-8: target –≤—ã—Ä–æ—Å ‚Üí –¥–µ–º–æ—É—Ç –º–µ–Ω—å—à–µ
 300-330 |  64     | 2  |    84     | 0  | Mi-8: –µ—â–µ –≤—ã—à–µ ‚Üí –¥–µ–º–æ—É—Ç 2
 331-360 |  65     | 1  |    83     | 0  | Mi-8: –º–∞–∫—Å–∏–º—É–º ‚Üí –¥–µ–º–æ—É—Ç 1
 361-365 |  63     | 1  |    82     | 0  | –§–∏–Ω–∞–ª: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–µ–º–æ—É—Ç
```

### SQL –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Äî TARGET vs CURRENT (i2) vs –î–ï–ú–û–£–¢–´ (i3)

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 1: i2 + i3 = —Å—Ç–∞–±–∏–ª—å–Ω–æ (–Ω–µ—Ç —É—Ç–µ—á–µ–∫)**

```sql
SELECT 
    day_u16,
    group_by,
    SUM(CASE WHEN intent_state = 2 THEN 1 ELSE 0 END) as curr_i2,
    SUM(CASE WHEN intent_state = 3 THEN 1 ELSE 0 END) as demount_i3,
    (SUM(CASE WHEN intent_state = 2 THEN 1 ELSE 0 END) +
     SUM(CASE WHEN intent_state = 3 THEN 1 ELSE 0 END)) as total_ops
FROM sim_masterv2
WHERE day_u16 <= 365 AND state = 'operations'
GROUP BY day_u16, group_by
ORDER BY day_u16, group_by
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Mi-8: i2 + i3 = 67 (–¥–Ω–∏ 27-87), 67 (–¥–Ω–∏ 88-118), 67 (–¥–Ω–∏ 180-210) ‚Üí **–°–¢–ê–ë–ò–õ–¨–ù–û**
- ‚úÖ Mi-17: i2 + i3 = 86 (–ø–æ—á—Ç–∏ –≤—Å–µ –¥–Ω–∏, —Ç–æ–ª—å–∫–æ –º–∞–ª—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –∏–∑-–∑–∞ i4/i6)
- ‚úÖ **–ù–ï–¢ —É—Ç–µ—á–µ–∫** ‚Äî –∞–≥–µ–Ω—Ç—ã –Ω–µ –∏—Å—á–µ–∑–∞—é—Ç

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 2: –î–µ–º–æ—É—Ç = Balance (—Ç–µ–∫—É—â–∏–µ - target)**

–õ–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ:
```cuda
balance = curr - target
if (balance > 0) {
    K = balance;  // –†–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ –¥–µ–º–æ—É—Ç–∏–º
    if (rank < K) {
        intent_state = 3u;
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–î–µ–Ω—å | Mi-8: curr | target | balance | –¥–µ–º–æ—É—Ç (i3) | ‚úì
-----|-----------|--------|---------|------------|---
  27 |    64     |   48-68 |  avg 14 | 3          | ‚úì (balance –º–µ–Ω—è–µ—Ç—Å—è –ø–æ –∞–≥–µ–Ω—Ç–∞–º)
 180 |    52     |   38-44 |  avg 8-14 | 14      | ‚úì (target –Ω–∏–∑–∫–∏–π)
 211 |    55     |   44-50 |  avg 5-11 | 11      | ‚úì (target –≤—ã—Ä–æ—Å)
```

**–í—ã–≤–æ–¥:** –ù–∞ –¥–µ–Ω—å 211 target –≤—ã—Ä–æ—Å (–¥–µ–Ω—å 210: target‚âà38 ‚Üí –¥–µ–Ω—å 211: target‚âà44), –ø–æ—ç—Ç–æ–º—É balance —É–ø–∞–ª (14‚Üí11) ‚úÖ

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç 3: –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ mfg_date (oldest first)**

```sql
-- –î–µ–Ω—å 180: –¥–µ–º–æ—É—Ç 14 –∞–≥–µ–Ω—Ç–æ–≤
SELECT 
    aircraft_number, mfg_date_days, intent_state, day_u16
FROM sim_masterv2
WHERE day_u16 = 180 AND state = 'operations' AND intent_state = 3
ORDER BY mfg_date_days
LIMIT 14
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –î–µ–º–æ—É—Ç–∏–º—ã–µ –∞–≥–µ–Ω—Ç—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ **–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é** mfg_date
- ‚úÖ –ü–µ—Ä–≤—ã–µ 14 —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ (–ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É) –ø–æ–ª—É—á–∏–ª–∏ intent=3
- ‚úÖ –ë–æ–ª–µ–µ –º–æ–ª–æ–¥—ã–µ –∞–≥–µ–Ω—Ç—ã (–±–æ–ª—å—à–µ–µ mfg_date) –æ—Å—Ç–∞–ª–∏—Å—å —Å intent=2

**–ü—Ä–∏–º–µ—Ä (–¥–µ–Ω—å 180, Mi-8):**
```
AC      | mfg_date | intent
--------|----------|--------
22430   | 1095     | 3  (—Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π, –¥–µ–º–æ—É—Ç ‚úì)
22432   | 1095     | 3
22434   | 1095     | 3
...
22418   | 1122     | 2  (–ø–æ–º–ª–∞–¥—à–µ, –æ—Å—Ç–∞–ª—Å—è ‚úì)
22420   | 1165     | 2
```

### –ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è

#### 1. **–î–µ–Ω—å 27: –ü–µ—Ä–≤—ã–π –¥–µ–º–æ—É—Ç**
- Mi-8: 64 –∞–≥–µ–Ω—Ç–∞ —Å intent=2, target < 64 ‚Üí balance > 0 ‚Üí –¥–µ–º–æ—É—Ç 3
- Mi-17: 86 –∞–≥–µ–Ω—Ç–æ–≤, target = 86 ‚Üí balance = 0 ‚Üí –¥–µ–º–æ—É—Ç 0 ‚úÖ

#### 2. **–î–Ω–∏ 27-87: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**
- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å: i2=64, i3=3 (–∏—Ç–æ–≥–æ 67) ‚Üí **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ**
- Target –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –∏–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ ‚Üí –¥–µ–º–æ—É—Ç —Å—Ç–∞–±–∏–ª–µ–Ω ‚úÖ

#### 3. **–î–µ–Ω—å 180: –°–∫–∞—á–æ–∫**
- Target –¥–ª—è Mi-8 —É–ø–∞–ª —Ä–µ–∑–∫–æ ‚Üí balance –≤—ã—Ä–æ—Å
- Demo 14 –∞–≥–µ–Ω—Ç–æ–≤ (–≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω—ã—Ö 3)
- –≠—Ç–æ **–æ–∂–∏–¥–∞–µ–º–æ**: –¥–Ω–∏ 180-210 —Ü–µ–ª–µ–≤–∞—è –∫–≤–æ—Ç–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –±—ã–ª–∞ –Ω–∏–∂–µ

#### 4. **–î–µ–Ω—å 211: Target –≤—ã—Ä–æ—Å**
- –î–µ–Ω—å 210: target‚âà38 ‚Üí –¥–µ–º–æ—É—Ç 14
- –î–µ–Ω—å 211: target‚âà44 ‚Üí –¥–µ–º–æ—É—Ç 11
- –ü–æ—è–≤–∏–ª–æ—Å—å +3 —Å i2 (–∏–∑ i3, –Ω–æ state –Ω–µ –ø–æ–º–µ–Ω—è–ª—Å—è, –æ–Ω–∏ –≤—Å–µ –µ—â–µ –≤ operations)
- –õ–æ–≥–∏–∫–∞: **–æ–∂–∏–¥–∞–µ–º–æ** –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –±–µ–∑ state_manager

#### 5. **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ intent=2**
- –î–µ–Ω—å 0: 154 –∞–≥–µ–Ω—Ç–∞ –≤ operations
- –î–µ–Ω—å 27: —É–∂–µ 2 –∞–≥–µ–Ω—Ç–∞ —Å intent=4 (—Ö–æ—Ç—è—Ç –≤ —Ä–µ–º–æ–Ω—Ç)
- –ü–æ –¥–Ω—è–º: –∞–≥–µ–Ω—Ç—ã –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç –Ω–∞—Ä–∞–±–æ—Ç–∫—É ‚Üí intent –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ 4/6
- **–≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ quota_ops_excess, –∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ state_2_operations**

### –ú–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

1. ‚úÖ **SQL –∑–∞–ø—Ä–æ—Å—ã –∫ –°–£–ë–î** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
   - –î–∏–Ω–∞–º–∏–∫–∞ i2, i3 –ø–æ –¥–Ω—è–º
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏—è–º–∏ (balance = –¥–µ–º–æ—É—Ç)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è (oldest first)

2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**
   - i2 + i3 = const (–Ω–µ—Ç —É—Ç–µ—á–µ–∫)
   - –î–µ–º–æ—É—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç balance
   - –°—Ç–∞—Ä—ã–µ –∞–≥–µ–Ω—Ç—ã –¥–µ–º–æ—É—Ç—è—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏

3. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ**
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ `printf` —É–¥–∞–ª–µ–Ω—ã –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –°–£–ë–î**

4. ‚úÖ **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º**
   - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–≥–æ–Ω—ã –¥–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   - 1,042,318 —Å—Ç—Ä–æ–∫ MP2 (—Å—Ç–∞–±–∏–ª—å–Ω–æ)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚ö†Ô∏è **quota_ops_excess —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –ë–ï–ó state_manager –º–æ–¥—É–ª–µ–π:**

1. **–ê–≥–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ operations:**
   - –î–µ–º–æ—É—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç intent=3, –Ω–æ state –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
   - –ê–≥–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ `state='operations'` —Å `intent_state=3`
   - –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ: state_manager_operations –ø—Ä–∏–º–µ–Ω–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥ 2‚Üí3 (operations ‚Üí serviceable)

2. **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ intent=2:**
   - –ê–≥–µ–Ω—Ç—ã –≤ state=operations –º–æ–≥—É—Ç –∏–º–µ—Ç—å intent‚â†2 (intent=4/6 –∏–∑ state_2_operations)
   - –ù–∞ –¥–µ–Ω—å 180: –≤—Å–µ–≥–æ 52 —Å intent=2, –Ω–æ 14 –µ—â–µ –≤ intent=3 (–∂–¥—É—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞)
   - **–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ**: count_ops —Å—á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ intent=2 ‚Üí balance —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

3. **–ö–∞—Å–∫–∞–¥–Ω—ã–µ –ø—Ä–æ–º–æ—É—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:**
   - –î–µ–º–æ—É—Ç —Å–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤ intent=3
   - –ù–æ quota_promote_serviceable –µ—â–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
   - –í –ø–æ–ª–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ: –ø—Ä–æ–º–æ—É—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç —ç—Ç–æ—Ç —Ä–µ–∑–µ—Ä–≤

### –ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞

‚úÖ **–ú–æ–¥—É–ª—å quota_ops_excess –ø—Ä–æ—à—ë–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é:**
- ‚úÖ –î–µ–º–æ—É—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ balance (curr - target)
- ‚úÖ –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ mfg_date —Ä–∞–±–æ—Ç–∞–µ—Ç (oldest first)
- ‚úÖ i2 + i3 —Å—Ç–∞–±–∏–ª—å–Ω–æ (–Ω–µ—Ç —É—Ç–µ—á–µ–∫)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ –°–£–ë–î
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞ (+14% –∫ count_ops)
- ‚úÖ –ö–æ–¥ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Å quota_promote_serviceable –∏ state_manager –º–æ–¥—É–ª—è–º–∏.**

