#!/usr/bin/env python3
"""
–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å 1 (–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ) –¥–ª—è –ø–ª–∞–Ω–µ—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 0
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ partno –ø–ª–∞–Ω–µ—Ä–æ–≤
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ (pandas DataFrame)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –≠–¢–ê–ü–ï 3 –≤ dual_loader.py

–ü–ª–∞–Ω–µ—Ä—ã: –ú–ò-8–¢, –ú–ò-8–ü, –ú–ò-8–ü–°, –ú–ò-8–¢–ü, –ú–ò-8–ê–ú–¢, –ú–ò-8–ú–¢–í

–ê–≤—Ç–æ—Ä: AI Assistant
–î–∞—Ç–∞: 2025-01-11
"""

import pandas as pd
from datetime import datetime

def process_inactive_planery_status(pandas_df, client):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤ –≤ DataFrame
    
    Args:
        pandas_df: DataFrame —Å –¥–∞–Ω–Ω—ã–º–∏ heli_pandas
        client: –ö–ª–∏–µ–Ω—Ç ClickHouse (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    
    Returns:
        DataFrame —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
    """
    try:
        print("üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤...")
        
        # –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–µ—Ä–æ–≤ —Å–æ —Å–∫—Ä–∏–Ω–∞
        planery_partno = ['–ú–ò-8–¢', '–ú–ò-8–ü', '–ú–ò-8–ü–°', '–ú–ò-8–¢–ü', '–ú–ò-8–ê–ú–¢', '–ú–ò-8–ú–¢–í']
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–∫–∏ status
        if 'status' not in pandas_df.columns:
            print("‚ö†Ô∏è –ö–æ–ª–æ–Ω–∫–∞ 'status' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º 0")
            pandas_df['status'] = 0
        
        # –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–ª–∞–Ω–µ—Ä–∞–º
        planery_mask = pandas_df['partno'].isin(planery_partno)
        planery_df = pandas_df[planery_mask]
        
        print(f"üìã –ù–∞–π–¥–µ–Ω–æ {len(planery_df)} –∑–∞–ø–∏—Å–µ–π –ø–ª–∞–Ω–µ—Ä–æ–≤")
        
        if len(planery_df) == 0:
            print("‚ö†Ô∏è –ó–∞–ø–∏—Å–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            return pandas_df
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å—ã –ø–ª–∞–Ω–µ—Ä–æ–≤ –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏
        print("üìä –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞–Ω–µ—Ä–æ–≤ –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏:")
        status_counts_before = planery_df['status'].value_counts().sort_index()
        for status, count in status_counts_before.items():
            print(f"  –°—Ç–∞—Ç—É—Å {status}: {count} –∑–∞–ø–∏—Å–µ–π")
        
        # –ù–∞—Ö–æ–¥–∏–º –ø–ª–∞–Ω–µ—Ä—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 0 (–Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏)
        inactive_mask = planery_mask & (pandas_df['status'] == 0)
        inactive_count = inactive_mask.sum()
        
        if inactive_count == 0:
            print("‚úÖ –í—Å–µ –ø–ª–∞–Ω–µ—Ä—ã —É–∂–µ –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å (–æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏)")
            return pandas_df
        
        print(f"üéØ –ù–∞–π–¥–µ–Ω–æ {inactive_count} –ø–ª–∞–Ω–µ—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 0 ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å 1 (–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ)")
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å 1 (–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ) –¥–ª—è –ø–ª–∞–Ω–µ—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 0
        pandas_df.loc[inactive_mask, 'status'] = 1
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å—ã –ø–ª–∞–Ω–µ—Ä–æ–≤ –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏
        planery_df_after = pandas_df[planery_mask]
        print("üìä –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞–Ω–µ—Ä–æ–≤ –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏:")
        status_counts_after = planery_df_after['status'].value_counts().sort_index()
        for status, count in status_counts_after.items():
            print(f"  –°—Ç–∞—Ç—É—Å {status}: {count} –∑–∞–ø–∏—Å–µ–π")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ partno
        print("üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞–Ω–µ—Ä–æ–≤:")
        for partno in planery_partno:
            partno_mask = pandas_df['partno'] == partno
            partno_count = partno_mask.sum()
            if partno_count > 0:
                partno_inactive = ((pandas_df['partno'] == partno) & (pandas_df['status'] == 1)).sum()
                print(f"  {partno}: {partno_count} –∑–∞–ø–∏—Å–µ–π, {partno_inactive} –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö")
        
        print(f"‚úÖ –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ {inactive_count} –∑–∞–ø–∏—Å–µ–π")
        
        return pandas_df
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤: {e}")
        return pandas_df

if __name__ == "__main__":
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–µ—Ä–æ–≤")
    print("üí° –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ dual_loader.py")
    print("üí° –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—É—Å—Ç–∏—Ç–µ: python3 code/dual_loader.py") 