# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π pipeline

## üèóÔ∏è –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (2 —Ç–∞–±–ª–∏—Ü—ã)

### **–¢–∞–±–ª–∏—Ü–∞ 1: RAW –¥–∞–Ω–Ω—ã–µ**
- **–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è**: partno, serialno (üîë –∫–ª—é—á —Å–≤—è–∑–∏), ac_typ, component_type, location, owner, condition
- **–†–µ—Å—É—Ä—Å—ã**: ll, oh, oh_threshold, sne, ppr, –¥–∞—Ç—ã
- **–ß–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è GPU**: partno_id, ac_type_mask, component_type_id, owner_id, condition_mask (–æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–µ –≤ pandas)
- **–î–≤–∏–∂–æ–∫**: MergeTree, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ (component_type, toYYYYMM(version_date))
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: (serialno, component_type_id, partno_id, version_date)

### **–¢–∞–±–ª–∏—Ü–∞ 2: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–º—É–ª—è—Ü–∏–π**
- **–°–≤—è–∑—å**: serialno (üîë –∫–ª—é—á —Å–≤—è–∑–∏ —Å RAW)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã GPU**: predicted_failure_days, maintenance_priority, replacement_recommended, remaining_resource_pct, risk_score
- **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è**: partno, component_name, component_type, ac_typ, location, owner, condition (–æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–µ –∏–∑ RAW —á–µ—Ä–µ–∑ serialno)
- **–ò—Å—Ö–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã**: current_ll, current_oh, oh_threshold (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ**: simulation_id, simulation_date, model_version, input_version_date, processing_time_ms
- **–î–≤–∏–∂–æ–∫**: MergeTree, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ (component_type, toYYYYMM(simulation_date))
- **–ò–Ω–¥–µ–∫—Å—ã**: risk_score, failure_days, component_type –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## üöÄ –ê–ª–≥–æ—Ä–∏—Ç–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ Pipeline

### **–®–∞–≥ 1: –û–±–æ–≥–∞—â–µ–Ω–∏–µ –≤ pandas**
1. **–ó–∞–≥—Ä—É–∑–∫–∞ Excel** ‚Üí pandas (Status_Components, MD_Dictionary, MD_Components)
2. **–°–æ–∑–¥–∞–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö ID** –≤ pandas:
   - `partno_mapping`: partno ‚Üí UInt16 ID
   - `ac_type_mapping`: –±–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏ (–ú–∏-8–¢=32, –ú–∏-17=64, –ú–∏-26=128)
   - `component_type_mapping`: —Ç–∏–ø –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ‚Üí UInt8 ID
   - `condition_mapping`: –±–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ dataframe** —á–∏—Å–ª–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

### **–®–∞–≥ 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ RAW + –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ GPU**
1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫**: –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ RAW —Ç–∞–±–ª–∏—Ü—É
2. **–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫**: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è GPU
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π (serialno + ID + —Ä–µ—Å—É—Ä—Å—ã)
   - **Arrow transfer**: pandas ‚Üí cuDF (–±—ã—Å—Ç—Ä—ã–π GPU transfer)

### **–®–∞–≥ 3: GPU —Å–∏–º—É–ª—è—Ü–∏—è**
1. **Flame GPU —Å–∏–º—É–ª—è—Ü–∏—è** —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 600M —è—á–µ–µ–∫ –º–∞—Ç—Ä–∏—Ü—ã —Ä–∞—Å—á–µ—Ç–∞
3. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ serialno (drop_duplicates)

### **–®–∞–≥ 4: –û–±–æ–≥–∞—â–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ë–ï–ó JOIN**
1. **cuDF ‚Üí pandas**: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ GPU
2. **Lookup —á–µ—Ä–µ–∑ dict**: `original_df.set_index('serialno').to_dict('index')`
3. **–ë—ã—Å—Ç—Ä–æ–µ map –æ–±–æ–≥–∞—â–µ–Ω–∏–µ** –≤–º–µ—Å—Ç–æ –¥–æ—Ä–æ–≥–æ–≥–æ ClickHouse JOIN
4. **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–®–∞–≥ 5: –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
1. **Arrow batch –∑–∞–≥—Ä—É–∑–∫–∞**: pandas ‚Üí ClickHouse —á–µ—Ä–µ–∑ `client.insert_arrow()`
2. **Batch —Ä–∞–∑–º–µ—Ä**: 500K –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **Async insert**: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –±–∞—Ç—á–µ–π
4. **–§–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: OPTIMIZE TABLE

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### **1. –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- ‚úÖ **–¢–æ–ª—å–∫–æ 2 —Ç–∞–±–ª–∏—Ü—ã**: RAW + Results (—É–±—Ä–∞–ª–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π ENRICHED —Å–ª–æ–π)
- ‚úÖ **–°–≤—è–∑—å —á–µ—Ä–µ–∑ serialno**: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–û–±–æ–≥–∞—â–µ–Ω–∏–µ –≤ pandas**: –≤–º–µ—Å—Ç–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü ClickHouse

### **2. –ò–∑–±–µ–∂–∞–Ω–∏–µ JOIN –≤ ClickHouse**
- ‚úÖ **Lookup —á–µ—Ä–µ–∑ dict**: –±—ã—Å—Ç—Ä–æ–µ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –≤ pandas –ø–∞–º—è—Ç–∏
- ‚úÖ **Arrow transfer**: –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏
- ‚úÖ **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: –≥–æ—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### **3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –∑–∞–≥—Ä—É–∑–∫–∞ RAW –≤–æ –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ GPU
- ‚úÖ **Arrow —Ñ–æ—Ä–º–∞—Ç –≤–µ–∑–¥–µ**: pandas ‚Üî cuDF ‚Üî ClickHouse
- ‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: 600M —è—á–µ–µ–∫ ‚Üí —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ serialno
- ‚úÖ **Batch –æ–ø–µ—Ä–∞—Ü–∏–∏**: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏

### **4. –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è**
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏**: –º–∏–Ω–∏–º—É–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ–µ–≤
- ‚úÖ **–ì–æ—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**: –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö JOIN
- ‚úÖ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å**: —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: Arrow + batch –¥–ª—è —Ä–æ—Å—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å pipeline

### **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:**
- **–û–±–æ–≥–∞—â–µ–Ω–∏–µ –≤ pandas**: ~2-3 —Å–µ–∫ (108k –∑–∞–ø–∏—Å–µ–π)
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ RAW**: –≤ —Ñ–æ–Ω–µ –≤–æ –≤—Ä–µ–º—è GPU –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
- **Arrow transfer pandas‚ÜícuDF**: ~0.5 —Å–µ–∫
- **GPU —Å–∏–º—É–ª—è—Ü–∏—è**: –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç Flame GPU)
- **Lookup –æ–±–æ–≥–∞—â–µ–Ω–∏–µ**: ~1-2 —Å–µ–∫ —á–µ—Ä–µ–∑ dict
- **Arrow batch –∑–∞–≥—Ä—É–∑–∫–∞**: ~5-10 —Å–µ–∫ (–º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π)

### **–†–∞–∑–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö:**
- **RAW —Ç–∞–±–ª–∏—Ü–∞**: ~25 MB (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã + —á–∏—Å–ª–æ–≤—ã–µ ID)
- **Results —Ç–∞–±–ª–∏—Ü–∞**: ~2-5 GB (–ø–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ 600M —è—á–µ–µ–∫)
- **–≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞**: 80-90% –±–ª–∞–≥–æ–¥–∞—Ä—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –¥—É–±–ª–µ–π

**–ò—Ç–æ–≥–æ**: –í–µ—Å—å pipeline –∫—Ä–æ–º–µ GPU —Å–∏–º—É–ª—è—Ü–∏–∏ –∑–∞–π–º–µ—Ç ~10-15 —Å–µ–∫—É–Ω–¥!

---

## üèÜ –ò—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞** - —Ç–æ–ª—å–∫–æ 2 —Ç–∞–±–ª–∏—Ü—ã MergeTree
2. **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - Arrow + –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å + –±–µ–∑ JOIN
3. **–ì–æ—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** - –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –ø—Ä—è–º–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
4. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å** - –º–æ–¥–µ–ª—å –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ—Ä—Ç–æ–ª–µ—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–æ—Ç pipeline –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏! 